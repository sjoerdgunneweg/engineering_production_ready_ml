{"version":3,"file":"619.js?_cache=cfeda66845272207b185","mappings":"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","sources":["webpack://grafana-pyroscope-app/./constants.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/types.ts","webpack://grafana-pyroscope-app/./shared/domain/prepareHistoryEntry.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventTimeseriesDataReceived.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/types.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/DataSourceProxyClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/labels/http/LabelsApiClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/MemoryCacheClient.ts","webpack://grafana-pyroscope-app/./shared/types/helpers/invariant.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/AbstractRepository.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/labels/LabelsApiClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/labels/labelsRepository.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/areFiltersEqual.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/buildIsEmptyFilter.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/filtersToQuery.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/getLastFilter.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isMultipleValuesOperator.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isPartialFilter.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isSwitchingOperatorMode.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/queryToFilters.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/toggleCompleteFilters.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/actions.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/getFilterUnderEdition.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/guards.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/infrastructure/operatorsRepository.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isPrivateLabel.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/services.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/autoSuggestProxy.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/constants.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isRegexOperator.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/idle.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/loadLabels.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/loadLabelValues.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/loadOperators.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/stateMachine.ts","webpack://grafana-pyroscope-app/./shared/domain/localeCompare.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/MultipleEditionSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/inputs/SingleEditionInput.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/SingleEditionSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/ChicletAttributeOperator.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/ChicletAttributeOperatorValue.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/PartialChiclet.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/Chiclet.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/ChicletsList.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/SingleSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/DisabledSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/MultipleSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/QueryBuilder.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/useStateMachine.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/hooks.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/pyroscope-data-sources.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/ProfileMetricVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/ServiceNameVariable/ServiceNameVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/ServiceNameVariable/domain/useBuildServiceNameOptions.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/useBuildPyroscopeQuery.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/ProfilesDataSourceVariable.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/FiltersVariable/filters-ops.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/FiltersVariable/FiltersVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/getSceneVariableValue.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/getColorByIndex.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/helpers/getSeriesLabelFieldName.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/helpers/getSeriesStatsValue.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/withPreventInvalidQuery.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/timeseries/buildTimeSeriesQueryRunner.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/infrastructure/data-transformations.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesBarGauge.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/formatSingleSeriesDisplayName.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesHistogram.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesTable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/computeRoundedTimeRange.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/helpers/safeInterpolate.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/labels/LabelsDataSource.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/helpers/getProfileMetricLabel.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesTimeseries/SceneTimeseriesMenu.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/getExploreUrl.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/useGetPluginExtensionLink.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesTimeseries/SceneLabelValuesTimeseries.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/vizPanelBuilder.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneEmptyState/ui/useMousePosition.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneEmptyState/ui/GrotNotFound.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneEmptyState/ui/EmptyState.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneEmptyState/SceneEmptyState.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneErrorState/SceneErrorState.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneQuickFilter.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/favorites/FavoritesDataSource.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/helpers/interpolateQueryRunnerVariables.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/actions/FavAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/domain/sortFavGridItems.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventExpandPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventSelectLabel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventViewServiceFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventViewServiceLabels.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventViewServiceProfiles.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/actions/SelectAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreAllServices/SceneExploreAllServices.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneDrawer.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/FavoriteVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreFavorites/SceneExploreFavorites.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/GroupByVariable/GroupBySelector.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/GroupByVariable/GroupByVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneMainServiceTimeseries.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventViewDiffFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/events/EventSelectForCompare.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/components/SceneStatsPanel/ui/CompareAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/components/SceneStatsPanel/ui/StatsPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/components/SceneStatsPanel/SceneStatsPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/components/SceneLabelValuePanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/infrastructure/buildLabelValuesGridQueryRunner.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/SceneLabelValuesGrid.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/events/EventClearLabelFromFilters.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/events/EventExcludeLabelFromFilters.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/events/EventIncludeLabelInFilters.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/actions/IncludeExcludeAction/ui/FilterButtons.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/actions/IncludeExcludeAction/IncludeExcludeAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/ui/CompareControls.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/SceneGroupByLabels.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/SceneExploreServiceLabels.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceProfileTypes/SceneExploreServiceProfileTypes.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/buildTimeRange.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/SpanSelectorVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/formatSeriesToProfileMetrics.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/formatSeriesToServices.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/DataSourceProxyClientBuilder.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/formatSeriesResponse.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/SeriesApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/seriesRepository.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/SeriesDataSource.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneCreateMetricModal/domain/useCreateRecordingRule.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneCreateMetricModal/SceneCreateRecordingRuleModal.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/events/EventEnableSyncTimeRanges.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/events/EventSyncRefresh.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/events/EventSyncTimeRanges.ts","webpack://grafana-pyroscope-app/./shared/components/SceneTimePickerWithoutSync/SceneTimePickerWithoutSync.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/parseUrlParam.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/RangeAnnotation.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/components/SceneTimeRangeWithAnnotations.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/evaluateTimeRange.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/events/EventSwitchTimerangeSelectionMode.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/actions/SwitchTimeRangeSelectionModeAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/infrastructure/buildCompareTimeSeriesQueryRunner.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/ui/colors.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/SceneComparePanel.tsx","webpack://grafana-pyroscope-app/./shared/domain/useToggleSidePanel.ts","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/DelayRender.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/PanelMenu.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/HoverWidget.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/TitleItem.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/PanelDescription.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/PanelStatus.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/GrafanaPanelBox.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/Panel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/useGrafanaAssistant.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/domain/buildLlmPrompts.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/profiles/ProfileApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/infrastructure/useFetchDotProfiles.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/infrastructure/cleanupDotResponse.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/AnalyzeDiffFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/components/AiButton/AIButton.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/components/AiButton/infrastructure/useFetchLlmPluginStatus.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/components/AiReply.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/components/FollowUpForm.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/SceneAiPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/domain/useOpenAiChatCompletions.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/events/EventDiffAutoSelect.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/events/EventDiffChoosePreset.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneDiffFlameGraph/infrastructure/DiffProfileApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneDiffFlameGraph/infrastructure/useFetchDiffProfile.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneDiffFlameGraph/ui/MissingSelectionsBanner.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneDiffFlameGraph/SceneDiffFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/GiveFeedbackButton.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/ScenePresetsPicker/ScenePresetsPicker.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/behaviours/syncYAxis.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/SceneExploreDiffFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/VcsClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/infrastructure/GitSessionCookie.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/infrastructure/GitSessionCookieManager.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/openLoginPopup.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/githubLogin.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/authFromUrl.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/usePollGitHubPopup.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/GitHubContext.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/infrastructure/PrivateVcsClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/GitHubContextProvider.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/generateNonce.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/useGithubSessionCookie.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/FunctionVersionContext.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/domain/events/RemoveSpanSelector.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/ResolutionBoostExtensionPoint/index.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/flame-graph/buildFlameGraphQueryRunner.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/infrastructure/PprofRequest.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/infrastructure/PprofApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneExportMenu/domain/getExportFilename.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneExportMenu/infrastructure/flamegraphDotComApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneExportMenu/SceneExportMenu.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/useGitHubContext.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/useGitHubIntegration.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/buildStackTrace.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/AiSuggestionsPanel/domain/buildLlmSuggestionPrompts.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/AiSuggestionsPanel/domain/useAiSuggestionsPanel.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/AiSuggestionsPanel/domain/useOpenAiSuggestions.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/AiSuggestionsPanel/AiSuggestionsPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/domain/annotateLines.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/domain/buildGithubUrlForFunction.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/domain/useCodeContainer.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/infrastructure/useFetchVCSFile.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/buildUnitFormatter.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/ui/Code.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/CodeContainer.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubRepository.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/getCommitsWithSamples.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/isGitHubRepository.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/getRepositoryDetails.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/convertPprofToFunctionDetails.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/fetchCommitsInfo.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/helpers/getTotalSum.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/helpers/sortByTotal.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/useFetchFunctionsDetails.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/getRelativeTimeString.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/formatCommitDate.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/CommitOption.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/CommitOptionSelected.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/CommitSelect.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/GitHubIntegrationBanner.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/InlineSpinner.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/OverrideRepositoryDetailsButton.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/SceneFunctionDetailsPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/calculateIsGitHubSupported.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/formatFileName.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/SpanSelectorLabel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/SceneFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneCreateMetricModal/domain/useMenuOption.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/SceneExploreServiceFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/components/domain/useHeader.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/components/domain/builsShareableUrl.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/components/ui/ExplorationTypeSelector.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/components/Header.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/SceneProfilesExplorer.tsx","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/infrastructure/flamegraphDotComApiClient.ts","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/domain/getExportFilename.ts","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/domain/useExportMenu.ts","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/ExportMenu.tsx","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/ExportData.tsx","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/domain/flamebearerToDataFrameDTO.ts","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/FlameGraph.tsx","webpack://grafana-pyroscope-app/./shared/domain/displayStatus.ts","webpack://grafana-pyroscope-app/./shared/domain/noOp.ts","webpack://grafana-pyroscope-app/./shared/domain/reportInteraction.ts","webpack://grafana-pyroscope-app/./shared/domain/url-params/parseQuery.ts","webpack://grafana-pyroscope-app/./shared/domain/url-params/useMaxNodesFromUrl.ts","webpack://grafana-pyroscope-app/./shared/domain/url-params/useUrlSearchParams.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/http/ApiClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/http/HttpClientError.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/http/HttpClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/profile-metrics/getProfileMetric.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/react-query/queryClient.ts","webpack://grafana-pyroscope-app/./shared/pyroscope-api/types/v1/types_pb.ts","webpack://grafana-pyroscope-app/./shared/pyroscope-api/settings/v1/recording_rules_pb.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/recording-rules/recordingRulesApiClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/recording-rules/useFetchRecordingRules.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/settings/PluginSettings.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/settings/featureToggles.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/settings/settingsApiClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/settings/useFetchPluginSettings.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/faro/faro-environments.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/faro/faro.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/faro/getFaroEnvironment.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/getEnvironment.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/logger.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/userStorage.ts","webpack://grafana-pyroscope-app/./shared/ui/InlineBanner.tsx","webpack://grafana-pyroscope-app/./shared/ui/PluginInfo.tsx","webpack://grafana-pyroscope-app/./shared/ui/PyroscopeLogo.tsx","webpack://grafana-pyroscope-app/./version.ts"],"sourcesContent":["import plugin from './plugin.json';\n\nexport const PYROSCOPE_APP_ID = plugin.id;\n\nexport const PLUGIN_BASE_URL = `/a/${PYROSCOPE_APP_ID}`;\n\nexport enum ROUTES {\n  EXPLORE = '/explore',\n  ADHOC = '/ad-hoc',\n  SETTINGS = '/settings',\n  RECORDING_RULES = '/recording-rules',\n  GITHUB_CALLBACK = '/github/callback',\n}\n","export enum CompareTarget {\n  BASELINE = 'baseline',\n  COMPARISON = 'comparison',\n}\n","/**\n * Prepares browser history before a user action is called\n *\n * This can be called BEFORE a user action is triggered. It is expected that the app is using UrlSyncManager\n * and the user action will change at least one variable or state synced with the URL. Once any variable or\n * state synced with the URL is triggered, UrlSyncManager will take care of replacing the prepared history entry.\n */\nexport function prepareHistoryEntry() {\n  history.pushState(null, '');\n}\n","import { BusEventWithPayload, DataFrame } from '@grafana/data';\n\ninterface EventTimeseriesDataReceivedPayload {\n  series?: DataFrame[];\n}\n\nexport class EventTimeseriesDataReceived extends BusEventWithPayload<EventTimeseriesDataReceivedPayload> {\n  public static type = 'timeseries-data-received';\n}\n","import { State } from 'xstate';\n\nexport enum FilterKind {\n  'partial' = 'partial',\n  'attribute-operator-value' = 'attribute-operator-value',\n  'attribute-operator' = 'attribute-operator',\n}\n\nexport enum OperatorKind {\n  '=' = '=',\n  '!=' = '!=',\n  'in' = 'in',\n  'not-in' = 'not-in',\n  'is-empty' = 'is-empty',\n  '=~' = '=~',\n  '!~' = '!~',\n}\n\nexport type PartialFilter = {\n  id: string;\n  type: FilterKind;\n  attribute: Suggestion;\n  operator?: Suggestion;\n  value?: Suggestion;\n  active: boolean;\n};\n\nexport type CompleteFilter = {\n  id: string;\n  type: FilterKind;\n  attribute: Suggestion;\n  operator: Suggestion;\n  value: Suggestion;\n  active: boolean;\n};\n\nexport type Filter = PartialFilter | CompleteFilter;\n\nexport type CompleteFilters = CompleteFilter[];\n\nexport type Filters = [PartialFilter] | CompleteFilter[] | [...CompleteFilter[], PartialFilter];\n\nexport enum FilterPartKind {\n  attribute = 'attribute',\n  operator = 'operator',\n  value = 'value',\n}\n\nexport type Suggestion = {\n  value: string;\n  label: string;\n  description?: string;\n};\n\nexport type Suggestions = Suggestion[];\n\nexport enum SuggestionKind {\n  'attribute' = 'attribute',\n  'operator' = 'operator',\n  'value' = 'value',\n}\n\nexport type InputParams = {\n  query: string;\n  from: number;\n  to: number;\n  // TODO: after migrate the legacy comparison pages to Scenes, dataSourceUid will be mandatory\n  dataSourceUid?: string;\n};\n\nexport type Edition = {\n  filterId: string;\n  part: FilterPartKind;\n};\n\nexport type QueryBuilderContext = {\n  inputParams: InputParams;\n  query: string;\n  filters: Filters;\n  isQueryUpToDate: boolean;\n  edition: Edition | null;\n  suggestions: {\n    type: SuggestionKind | null;\n    items: Suggestions;\n    isVisible: boolean;\n    isLoading: boolean;\n    error: Error | null;\n    placeholder: string;\n    noOptionsMessage: string;\n    allowCustomValue: boolean;\n    multiple: boolean;\n    disabled: boolean;\n  };\n};\n\nexport type QueryBuilderSchema = {\n  states: {\n    idle: State<QueryBuilderContext, QueryBuilderEvent>;\n    loadLabels: State<QueryBuilderContext, QueryBuilderEvent>;\n    displayLabels: State<QueryBuilderContext, QueryBuilderEvent>;\n    loadLabelValues: State<QueryBuilderContext, QueryBuilderEvent>;\n    loadOperators: State<QueryBuilderContext, QueryBuilderEvent>;\n    displayOperators: State<QueryBuilderContext, QueryBuilderEvent>;\n    displayLabelValues: State<QueryBuilderContext, QueryBuilderEvent>;\n    autoSuggestProxy: State<QueryBuilderContext, QueryBuilderEvent>;\n  };\n};\n\ntype StartEvent = { type: 'START_INPUT' };\nexport type SelectEvent = { type: 'SELECT_SUGGESTION'; data: Suggestion };\ntype DiscardEvent = { type: 'DISCARD_SUGGESTIONS' };\nexport type EditEvent = { type: 'EDIT_FILTER'; data: Edition };\nexport type RemoveFilterEvent = { type: 'REMOVE_FILTER'; data: string }; // data = filterId\ntype RemoveLastFilterEvent = { type: 'REMOVE_LAST_FILTER' };\nexport type ChangeInputParamsEvent = { type: 'CHANGE_INPUT_PARAMS'; data: InputParams };\ntype ExecuteQueryEvent = { type: 'EXECUTE_QUERY' };\n\nexport type QueryBuilderEvent =\n  | StartEvent\n  | SelectEvent\n  | DiscardEvent\n  | EditEvent\n  | RemoveFilterEvent\n  | RemoveLastFilterEvent\n  | ChangeInputParamsEvent\n  | ExecuteQueryEvent;\n","import { config } from '@grafana/runtime';\nimport { HttpClient } from '@shared/infrastructure/http/HttpClient';\n\nexport class DataSourceProxyClient extends HttpClient {\n  dataSourceUid: string;\n\n  constructor(options: { dataSourceUid: string }) {\n    const { dataSourceUid } = options;\n\n    let { appSubUrl = '', bootData } = config;\n    if (appSubUrl?.at(-1) !== '/') {\n      // ensures that the API pathname is appended correctly (appUrl seems to always have it but better to be extra careful)\n      appSubUrl += '/';\n    }\n\n    super(`${appSubUrl}api/datasources/proxy/uid/${dataSourceUid}`, {\n      'content-type': 'application/json',\n      'X-Grafana-Org-Id': String(bootData?.user?.orgId || ''),\n    });\n\n    this.dataSourceUid = options.dataSourceUid;\n  }\n}\n","import { DataSourceProxyClient } from '../../series/http/DataSourceProxyClient';\n\nexport class LabelsApiClient extends DataSourceProxyClient {\n  static queryToMatchers(query: string) {\n    const labelsIndex = query.indexOf('{');\n\n    if (labelsIndex > 0) {\n      const profileTypeID = query.substring(0, labelsIndex);\n      return [`{__profile_type__=\\\"${profileTypeID}\\\", ${query.substring(labelsIndex + 1, query.length)}`];\n    }\n\n    if (labelsIndex === 0) {\n      return [query];\n    }\n\n    return [`{__profile_type__=\\\"${query}\\\"}`];\n  }\n\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n  }\n\n  async fetchLabels(query: string, from: number, to: number) {\n    return this._post('/querier.v1.QuerierService/LabelNames', {\n      matchers: LabelsApiClient.queryToMatchers(query),\n      start: from,\n      end: to,\n    }).then((response) => response.json());\n  }\n\n  async fetchLabelValues(labelId: string, query: string, from: number, to: number) {\n    return this._post('/querier.v1.QuerierService/LabelValues', {\n      name: labelId,\n      matchers: LabelsApiClient.queryToMatchers(query),\n      start: from,\n      end: to,\n    }).then((response) => response.json());\n  }\n\n  _post(pathname: string, body: Record<string, any>) {\n    return super.fetch(pathname, {\n      method: 'POST',\n      body: JSON.stringify(body),\n    });\n  }\n}\n","type CacheKeyable = { toString(): string };\n\nexport class MemoryCacheClient {\n  store = new Map<string, any>();\n\n  static buildCacheKey(args: CacheKeyable[]) {\n    let key = '';\n    for (const arg of args) {\n      key += String(arg);\n    }\n    return key;\n  }\n\n  get(args: CacheKeyable[]): any {\n    return this.store.get(MemoryCacheClient.buildCacheKey(args));\n  }\n\n  // TODO: TTL?\n  set(args: CacheKeyable[], data: any) {\n    this.store.set(MemoryCacheClient.buildCacheKey(args), data);\n  }\n\n  delete(args: CacheKeyable[]) {\n    this.store.delete(MemoryCacheClient.buildCacheKey(args));\n  }\n}\n","export function invariant(check: boolean, message: string): asserts check {\n  if (!check) {\n    throw new Error(message);\n  }\n}\n","import { ApiClient } from './http/ApiClient';\n\nexport abstract class AbstractRepository<T extends ApiClient, U> {\n  apiClient?: T;\n  cacheClient: U | undefined;\n\n  constructor(options: { apiClient?: T; cacheClient?: U }) {\n    this.apiClient = options.apiClient;\n    this.cacheClient = options?.cacheClient;\n  }\n\n  setApiClient(apiClient: T) {\n    this.apiClient = apiClient;\n  }\n\n  setCacheClient(cacheClient: U) {\n    this.cacheClient = cacheClient;\n  }\n\n  cancel(reason: any) {\n    this.apiClient!.abort(reason);\n  }\n}\n","import { ApiClient } from '@shared/infrastructure/http/ApiClient';\n\nexport class LabelsApiClient extends ApiClient {\n  static queryToMatchers(query: string) {\n    const labelsIndex = query.indexOf('{');\n\n    if (labelsIndex > 0) {\n      const profileTypeID = query.substring(0, labelsIndex);\n      return [`{__profile_type__=\\\"${profileTypeID}\\\", ${query.substring(labelsIndex + 1, query.length)}`];\n    }\n\n    if (labelsIndex === 0) {\n      return [query];\n    }\n\n    return [`{__profile_type__=\\\"${query}\\\"}`];\n  }\n\n  async fetchLabels(query: string, from: number, to: number) {\n    // all /querier requests: timerange in Unix time ms (unix * 1000)\n    return this._post('/querier.v1.QuerierService/LabelNames', {\n      matchers: LabelsApiClient.queryToMatchers(query),\n      start: from,\n      end: to,\n    }).then((response) => response.json());\n  }\n\n  async fetchLabelValues(labelId: string, query: string, from: number, to: number) {\n    // all /querier requests: timerange in Unix time ms (unix * 1000)\n    return this._post('/querier.v1.QuerierService/LabelValues', {\n      name: labelId,\n      matchers: LabelsApiClient.queryToMatchers(query),\n      start: from,\n      end: to,\n    }).then((response) => response.json());\n  }\n\n  _post(pathname: string, body: Record<string, any>) {\n    return super.fetch(pathname, {\n      method: 'POST',\n      body: JSON.stringify(body),\n    });\n  }\n}\n","import { MemoryCacheClient } from '@shared/infrastructure/MemoryCacheClient';\n\nimport { Suggestions } from '../../components/QueryBuilder/domain/types';\nimport { invariant } from '../../types/helpers/invariant';\nimport { AbstractRepository } from '../AbstractRepository';\nimport { LabelsApiClient } from './LabelsApiClient';\n\ntype ListLabelsOptions = {\n  query: string;\n  from: number;\n  to: number;\n};\n\ntype ListLabelValuesOptions = ListLabelsOptions & {\n  label: string;\n};\n\nclass LabelsRepository extends AbstractRepository<LabelsApiClient, MemoryCacheClient> {\n  cacheClient: MemoryCacheClient;\n\n  static isNotMetaLabelOrServiceName = (label: string) => !/^(__.+__|service_name)$/.test(label);\n\n  static parseLabelsResponse(json: Record<string, any>): Suggestions {\n    if (!Array.isArray(json.names)) {\n      return [];\n    }\n\n    const uniqueLabels: string[] = Array.from(new Set(json.names.filter(LabelsRepository.isNotMetaLabelOrServiceName)));\n\n    return uniqueLabels.map((label) => ({ value: label, label }));\n  }\n\n  static parseLabelValuesResponse(json: Record<string, any>): Suggestions {\n    if (!Array.isArray(json.names)) {\n      return [];\n    }\n\n    const labelValues: string[] = json.names;\n\n    return labelValues.map((label) => ({ value: label, label }));\n  }\n\n  constructor(options: { apiClient: LabelsApiClient; cacheClient: MemoryCacheClient }) {\n    super({ apiClient: options.apiClient });\n\n    this.cacheClient = options.cacheClient;\n  }\n\n  static assertParams(query: string, from: number, to: number) {\n    invariant(Boolean(query), 'Missing \"query\" parameter!');\n    invariant(from > 0 && to > 0 && to > from, 'Invalid timerange!');\n  }\n\n  async listLabels({ query, from, to }: ListLabelsOptions): Promise<Suggestions> {\n    LabelsRepository.assertParams(query, from, to);\n\n    const cacheParams = [this.apiClient!.baseUrl, query, from, to];\n\n    const labelsFromCacheP = this.cacheClient.get(cacheParams);\n    if (labelsFromCacheP) {\n      const json = await labelsFromCacheP;\n      const labels = LabelsRepository.parseLabelsResponse(json);\n\n      if (!labels.length) {\n        this.cacheClient.delete(cacheParams);\n      }\n\n      return labels;\n    }\n\n    const fetchP = this.apiClient!.fetchLabels(query, from, to);\n    this.cacheClient.set(cacheParams, fetchP);\n\n    try {\n      const json = await fetchP;\n      return LabelsRepository.parseLabelsResponse(json);\n    } catch (error) {\n      this.cacheClient.delete(cacheParams);\n      throw error;\n    }\n  }\n\n  async listLabelValues({ label, query, from, to }: ListLabelValuesOptions): Promise<Suggestions> {\n    LabelsRepository.assertParams(query, from, to);\n    invariant(Boolean(label), 'Missing label value!');\n\n    const cacheParams = [this.apiClient!.baseUrl, label, query, from, to];\n\n    const labelValuesFromCacheP = this.cacheClient.get(cacheParams);\n    if (labelValuesFromCacheP) {\n      const json = await labelValuesFromCacheP;\n      const labelValues = LabelsRepository.parseLabelsResponse(json);\n\n      if (!labelValues.length) {\n        this.cacheClient.delete(cacheParams);\n      }\n\n      return labelValues;\n    }\n\n    const fetchP = this.apiClient!.fetchLabelValues(label, query, from, to);\n    this.cacheClient.set(cacheParams, fetchP);\n\n    try {\n      const json = await fetchP;\n      return LabelsRepository.parseLabelValuesResponse(json);\n    } catch (error) {\n      this.cacheClient.delete(cacheParams);\n      throw error;\n    }\n  }\n}\n\nexport const labelsRepository = new LabelsRepository({\n  apiClient: new LabelsApiClient(),\n  cacheClient: new MemoryCacheClient(),\n});\n","import { FilterKind, Filters } from '../types';\n\nexport function areFiltersEqual(newFilters: Filters, previousFilters: Filters): boolean {\n  const newFiltersWithoutPartial = newFilters.filter(({ type }) => type !== FilterKind.partial);\n  const previousFiltersWithoutPartial = previousFilters.filter(({ type }) => type !== FilterKind.partial);\n\n  return (\n    newFiltersWithoutPartial.length === previousFiltersWithoutPartial.length &&\n    newFiltersWithoutPartial.every((filter) =>\n      previousFiltersWithoutPartial.find(\n        ({ type, attribute, operator, value }) =>\n          type === filter.type &&\n          attribute.value === filter.attribute.value &&\n          operator?.value === filter.operator?.value &&\n          value?.value === filter.value?.value\n      )\n    )\n  );\n}\n","import { Filter, FilterKind, OperatorKind } from '../types';\n\nconst IsEmptyFilter = {\n  type: FilterKind['attribute-operator'],\n  operator: {\n    value: OperatorKind['is-empty'],\n    label: 'is empty',\n  },\n  value: {\n    value: OperatorKind['is-empty'],\n    label: '',\n  },\n};\n\nexport const buildIsEmptyFilter = (filter: Filter) => ({ ...filter, ...IsEmptyFilter });\n","import { CompleteFilter, FilterKind, Filters, OperatorKind } from '../types';\n\nexport function filtersToQuery(query: string, filters: Filters) {\n  const labelsList = filters\n    .filter(({ type }) => type !== FilterKind.partial)\n    .map((filter) => {\n      const { attribute, operator, value } = filter as CompleteFilter;\n\n      switch (operator.value) {\n        case OperatorKind.in:\n          return `${attribute.value}=~\"${value.value}\"`;\n\n        case OperatorKind['not-in']:\n          return `${attribute.value}!~\"${value.value}\"`;\n\n        case OperatorKind['is-empty']:\n          return `${attribute.value}=\"\"`;\n\n        default:\n          return `${attribute.value}${operator.value}\"${value.value}\"`;\n      }\n    });\n\n  const [, serviceNameLabel] = query.match(/{.*(service_name=\"[^\"]*\").*}/) ?? [];\n\n  if (serviceNameLabel) {\n    labelsList.unshift(serviceNameLabel);\n  }\n\n  return query.replace(/{(.*)}$/, `{${labelsList.join(',')}}`);\n}\n","import { Filter, Filters } from '../types';\n\nexport const getLastFilter = (filters: Filters): Filter | null => filters.at(-1) || null;\n","import { OperatorKind } from '../types';\n\nexport const isMultipleValuesOperator = (operator: string | OperatorKind) =>\n  operator === OperatorKind['in'] || operator === OperatorKind['not-in'];\n","import { invariant } from '../../../../types/helpers/invariant';\nimport { Filter, FilterKind } from '../types';\n\nexport const isPartialFilter = (filter: Filter): boolean => {\n  invariant(Boolean(filter), 'The filter is falsy!');\n\n  return filter.type === FilterKind.partial;\n};\n","import { invariant } from '../../../../types/helpers/invariant';\nimport { Filter, OperatorKind } from '../types';\n\n/**\n * Determines if we switch from strict operators (=, !=) to loose ones (=~)\n *\n * This is used when/after editing a filter:\n * - to determine to which state to transition to (see states/loadOperators.ts and domain/guards.ts)\n * - to set the correct edition data after the switch (see domain/actions.ts - editFilterOperator)\n *\n * Returns true when the value should be edited after the switch\n */\nexport function isEditingOperatorMode(currentOperator: string, newOperator: string) {\n  if (currentOperator === newOperator) {\n    return false;\n  }\n\n  if (newOperator === OperatorKind['is-empty']) {\n    return false;\n  }\n\n  return (\n    [\n      OperatorKind['=~'],\n      OperatorKind['!~'],\n      OperatorKind['in'],\n      OperatorKind['not-in'],\n      OperatorKind['is-empty'],\n    ].includes(currentOperator as OperatorKind) ||\n    [OperatorKind['=~'], OperatorKind['!~'], OperatorKind['in'], OperatorKind['not-in']].includes(\n      newOperator as OperatorKind\n    )\n  );\n}\n\nexport function isSwitchingOperatorMode(filterUnderEdition: Filter, newOperator: string) {\n  invariant(typeof filterUnderEdition.operator !== 'undefined', 'No operator for the filter under edition!');\n\n  const currentOperator = filterUnderEdition.operator.value;\n\n  return isEditingOperatorMode(currentOperator, newOperator);\n}\n","import { nanoid } from 'nanoid';\n\nimport { FilterKind, Filters, OperatorKind } from '../types';\nimport { buildIsEmptyFilter } from './buildIsEmptyFilter';\n\nconst parseRawFilters = (rawFilters: string): string[][] => {\n  const matches = rawFilters.matchAll(/(\\w+)(=|!=|=~|!~)\"([^\"]*)\"/g);\n  return Array.from(matches).map(([, attribute, operator, value]) => [attribute, operator, value]);\n};\n\nconst LABELS_REGEX = /.+:[^{]+\\{(.+)\\}$/;\nconst REGEX_CHARS_REGEX = /.*(\\^|\\$|\\*|\\+|\\{|\\}|\\?).*/;\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function queryToFilters(query: string): Filters {\n  // 'process_cpu:cpu:nanoseconds:cpu:nanoseconds{service_name=\"ebpf/gcp-logs-ops/grafana-agent\", namespace=\"gcp-logs-ops\"}'\n  if (!query) {\n    return [];\n  }\n\n  const rawLabels = query.match(LABELS_REGEX);\n  // [_, 'service_name=\"ebpf/gcp-logs-ops/grafana-agent\", namespace=\"gcp-logs-ops\"']\n  if (!rawLabels) {\n    return [];\n  }\n\n  const rawFilters = parseRawFilters(rawLabels[1]);\n\n  // [[service_name, =, ebpf/gcp-logs-ops/grafana-agent], [namespace, =, gcp-logs-ops]]\n\n  return (rawFilters as string[][])\n    .filter(([attribute]) => attribute !== 'service_name')\n    .map(([attribute, operator, value]) => {\n      const filter = {\n        id: nanoid(10),\n        type: FilterKind['attribute-operator-value'],\n        active: true,\n        attribute: { value: attribute, label: attribute },\n        operator: { value: operator, label: operator },\n        value: { value: value, label: value },\n      };\n\n      const shouldConvertToIsEmptyOperator = operator === OperatorKind['='] && value === '';\n      if (shouldConvertToIsEmptyOperator) {\n        return buildIsEmptyFilter(filter);\n      }\n\n      const shouldConvertToInNotInOperator =\n        [OperatorKind['=~'], OperatorKind['!~']].includes(operator as OperatorKind) && !REGEX_CHARS_REGEX.test(value);\n\n      if (shouldConvertToInNotInOperator) {\n        return {\n          ...filter,\n          operator:\n            operator === OperatorKind['=~']\n              ? { value: OperatorKind.in, label: 'in' }\n              : { value: OperatorKind['not-in'], label: 'not in' },\n          value: {\n            value: value,\n            label: value\n              .split('|')\n              .map((v) => v.trim())\n              .join(', '),\n          },\n        };\n      }\n\n      return filter;\n    });\n}\n","import { FilterKind, Filters } from '../types';\n\nexport const toggleCompleteFilters = (filters: Filters, active: boolean): Filters =>\n  filters.map((filter) => (filter.type !== FilterKind.partial ? { ...filter, active } : filter)) as Filters;\n","import { nanoid } from 'nanoid';\nimport { assign } from 'xstate';\n\nimport { LabelsApiClient } from '../../../../pages/ProfilesExplorerView/infrastructure/labels/http/LabelsApiClient';\nimport { labelsRepository } from '../../../infrastructure/labels/labelsRepository';\nimport { areFiltersEqual } from './helpers/areFiltersEqual';\nimport { buildIsEmptyFilter } from './helpers/buildIsEmptyFilter';\nimport { filtersToQuery } from './helpers/filtersToQuery';\nimport { getLastFilter } from './helpers/getLastFilter';\nimport { isMultipleValuesOperator } from './helpers/isMultipleValuesOperator';\nimport { isPartialFilter } from './helpers/isPartialFilter';\nimport { isEditingOperatorMode } from './helpers/isSwitchingOperatorMode';\nimport { queryToFilters } from './helpers/queryToFilters';\nimport { toggleCompleteFilters } from './helpers/toggleCompleteFilters';\nimport {\n  ChangeInputParamsEvent,\n  EditEvent,\n  FilterKind,\n  FilterPartKind,\n  Filters,\n  OperatorKind,\n  QueryBuilderContext,\n  RemoveFilterEvent,\n  SelectEvent,\n} from './types';\n\nfunction updateFiltersAndQuery(newFilters: Filters, context: QueryBuilderContext) {\n  const isQueryUpToDate = areFiltersEqual(newFilters, queryToFilters(context.inputParams.query));\n\n  return {\n    filters: isQueryUpToDate ? toggleCompleteFilters(newFilters, true) : newFilters,\n    query: filtersToQuery(context.query, newFilters),\n    isQueryUpToDate,\n  };\n}\n\nexport const actions: any = {\n  cancelAllLoad: () => {\n    labelsRepository.cancel('Discarded by user');\n  },\n  // FILTER ATTRIBUTES\n  setFilterAttribute: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    const newFilters = [\n      ...context.filters,\n      { id: nanoid(10), type: FilterKind.partial, active: false, attribute: event.data },\n    ] as Filters;\n\n    return {\n      ...context,\n      filters: newFilters,\n      isQueryUpToDate: areFiltersEqual(newFilters, queryToFilters(context.inputParams.query)),\n    };\n  }),\n  editFilterAttribute: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    if (context.edition === null) {\n      throw new Error('Cannot edit filter attribute without edition data!');\n    }\n\n    const { filterId } = context.edition;\n\n    const newFilters = context.filters.map((filter) =>\n      filter.id === filterId\n        ? {\n            ...filter,\n            attribute: event.data,\n            operator: undefined,\n            value: undefined,\n          }\n        : filter\n    ) as Filters;\n\n    return {\n      ...context,\n      filters: newFilters,\n      // note: we can only edit the attribute of partial filters, so no need to rebuild the query here\n      isQueryUpToDate: areFiltersEqual(newFilters, queryToFilters(context.inputParams.query)),\n      edition: null,\n    };\n  }),\n  // FILTER OPERATORS\n  setFilterOperator: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    const newFilters = context.filters.map((filter) => {\n      if (!isPartialFilter(filter)) {\n        return filter;\n      }\n\n      const newOperator = event.data;\n\n      if (newOperator.value === OperatorKind['is-empty']) {\n        return buildIsEmptyFilter(filter);\n      }\n\n      return {\n        ...filter,\n        operator: newOperator,\n        value: undefined,\n      };\n    }) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n    };\n  }),\n  // eslint-disable-next-line sonarjs/cognitive-complexity\n  editFilterOperator: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    if (context.edition === null) {\n      throw new Error('Cannot edit filter operator without edition data!');\n    }\n\n    const { filterId } = context.edition;\n    const newOperator = event.data;\n    let newEdition = null;\n\n    const newFilters = context.filters.map((filter) => {\n      const previousOperator = filter.operator!.value;\n\n      if (filter.id !== filterId || previousOperator === newOperator.value) {\n        return filter;\n      }\n\n      if (newOperator.value === OperatorKind['is-empty']) {\n        return buildIsEmptyFilter({\n          ...filter,\n          active: false,\n        });\n      }\n\n      if (previousOperator === OperatorKind['is-empty']) {\n        filter.value = { value: '(no value)', label: '(no value)' };\n      }\n\n      if (!isPartialFilter(filter) && isEditingOperatorMode(previousOperator, newOperator.value)) {\n        newEdition = { ...context.edition, part: FilterPartKind.value };\n      }\n\n      return {\n        ...filter,\n        operator: newOperator,\n        value:\n          isMultipleValuesOperator(previousOperator) && !isMultipleValuesOperator(newOperator.value) && filter.value\n            ? {\n                value: filter.value.value.split('|').shift(),\n                label: filter.value.label.split(', ').shift(),\n              }\n            : filter.value,\n        active: false,\n      };\n    }) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n      edition: newEdition,\n    };\n  }),\n  // FILTER VALUES\n  setFilterValue: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    const newFilters = context.filters.map((filter) =>\n      isPartialFilter(filter)\n        ? {\n            ...filter,\n            type: FilterKind['attribute-operator-value'],\n            active: false,\n            value: event.data,\n          }\n        : filter\n    ) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n    };\n  }),\n  editFilterValue: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    if (context.edition === null) {\n      throw new Error('Cannot edit filter value without edition data!');\n    }\n\n    const { filterId } = context.edition;\n\n    const newFilters = context.filters.map((filter) =>\n      filter.id === filterId\n        ? {\n            ...filter,\n            type: FilterKind['attribute-operator-value'],\n            active: false,\n            value: event.data,\n          }\n        : filter\n    ) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n      edition: null,\n    };\n  }),\n  // FILTER REMOVAL\n  removeFilter: assign((context: QueryBuilderContext, event: RemoveFilterEvent) => {\n    const filterId = event.data;\n    const newFilters = toggleCompleteFilters(context.filters.filter(({ id }) => id !== filterId) as Filters, false);\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n    };\n  }),\n  removeLastFilter: assign((context: QueryBuilderContext) => {\n    const { filters } = context;\n\n    const lastFilter = getLastFilter(filters);\n    if (!lastFilter) {\n      return context;\n    }\n\n    if (isPartialFilter(lastFilter) && lastFilter.operator) {\n      const newFilters = filters.slice(0, filters.length - 1).concat({ ...lastFilter, operator: undefined }) as Filters;\n\n      return {\n        ...context,\n        filters: newFilters,\n        // query doesn't have to change\n        isQueryUpToDate: true,\n      };\n    }\n\n    const newFilters = filters.slice(0, filters.length - 1).map((filter) => ({ ...filter, active: false })) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n    };\n  }),\n  // MISC\n  setEdition: assign({ edition: (context, event: EditEvent) => event.data }),\n  changeInputParams: assign((context: QueryBuilderContext, event: ChangeInputParamsEvent) => {\n    // TODO: remove this condition after migrating the legacy comparison pages to Scenes\n    // because dataSourceUid will always be provided\n    if (event.data.dataSourceUid) {\n      labelsRepository.setApiClient(new LabelsApiClient({ dataSourceUid: event.data.dataSourceUid }));\n    }\n\n    return {\n      inputParams: event.data,\n      query: event.data.query,\n      // See also buildStateMachine() in domain/stateMachine.ts\n      filters: queryToFilters(event.data.query),\n      isQueryUpToDate: true,\n    };\n  }),\n  activateFilters: assign((context: QueryBuilderContext) => ({\n    ...context,\n    ...updateFiltersAndQuery(context.filters, context),\n  })),\n};\n","import { invariant } from '../../../../types/helpers/invariant';\nimport { Filter, QueryBuilderContext } from '../types';\n\nexport function getFilterUnderEdition(context: QueryBuilderContext): Filter {\n  const { edition, filters } = context;\n\n  invariant(edition !== null, '\"edition\" is null!');\n\n  const filter = filters.find(({ id }) => id === edition.filterId);\n\n  invariant(filter !== undefined, 'Cannot find the filter under edition!');\n\n  return filter;\n}\n","import { getFilterUnderEdition } from './helpers/getFilterUnderEdition';\nimport { getLastFilter } from './helpers/getLastFilter';\nimport { isPartialFilter } from './helpers/isPartialFilter';\nimport { isSwitchingOperatorMode } from './helpers/isSwitchingOperatorMode';\nimport { EditEvent, FilterPartKind, QueryBuilderContext, QueryBuilderEvent, SelectEvent } from './types';\n\ntype CondFn<TContext, TEvent> = (context: TContext, event: TEvent) => boolean;\ntype Guards<TContext, TEvent> = Record<string, CondFn<TContext, TEvent>>;\n\nexport const guards: Guards<QueryBuilderContext, QueryBuilderEvent> = {\n  shouldSuggestAttributes: (context) => {\n    const lastFilter = getLastFilter(context.filters);\n    return !lastFilter || !isPartialFilter(lastFilter);\n  },\n  shouldSuggestOperators: (context) => {\n    return !getLastFilter(context.filters)?.operator;\n  },\n  shouldSuggestValues: (context) => {\n    const lastFilter = getLastFilter(context.filters);\n    return Boolean(lastFilter?.operator && !lastFilter?.value);\n  },\n  // edition only\n  isEditing: (context) => context.edition !== null,\n  shouldSuggestValuesAfterOperatorEdition: (context, event) => {\n    if (!context.edition) {\n      return false;\n    }\n\n    return isSwitchingOperatorMode(getFilterUnderEdition(context), (event as SelectEvent).data.value);\n  },\n  shouldNotSuggestValuesAfterOperatorEdition: (context, event) => {\n    if (!context.edition) {\n      return false;\n    }\n\n    return !isSwitchingOperatorMode(getFilterUnderEdition(context), (event as SelectEvent).data.value);\n  },\n  // after completion\n  hasPartialFilter: (context) => {\n    const lastFilter = getLastFilter(context.filters);\n    return Boolean(lastFilter && isPartialFilter(lastFilter));\n  },\n  shouldEditAttribute: (context, event) => (event as EditEvent).data.part === FilterPartKind.attribute,\n  shouldEditOperator: (context, event) => (event as EditEvent).data.part === FilterPartKind.operator,\n  shouldEditValue: (context, event) => (event as EditEvent).data.part === FilterPartKind.value,\n};\n","import { Suggestions } from '../domain/types';\n\nclass OperatorsRepository {\n  async list(): Promise<Suggestions> {\n    return [\n      { value: '=', label: '=' },\n      { value: '!=', label: '!=' },\n      { value: 'is-empty', label: 'is empty' },\n      { value: 'in', label: 'in', description: 'Is one of' },\n      { value: 'not-in', label: 'not in', description: 'Is not one of' },\n      { value: '=~', label: '=~', description: 'Matches regex' },\n      { value: '!~', label: '!~', description: 'Does not match regex' },\n    ];\n  }\n}\n\nexport const operatorsRepository = new OperatorsRepository();\n","export const isPrivateLabel = (label: string) => label.startsWith('__');\n","import { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { labelsRepository } from '../../../infrastructure/labels/labelsRepository';\nimport { operatorsRepository } from '../infrastructure/operatorsRepository';\nimport { filtersToQuery } from './helpers/filtersToQuery';\nimport { getLastFilter } from './helpers/getLastFilter';\nimport { isPrivateLabel } from './helpers/isPrivateLabel';\nimport { FilterKind, Filters, QueryBuilderContext, QueryBuilderEvent, Suggestions } from './types';\n\ntype ServiceFn<TContext, TEvent> = (context: TContext, event: TEvent) => Promise<Suggestions | Error>;\ntype Services<TContext, TEvent> = Record<string, ServiceFn<TContext, TEvent>>;\n\nfunction handleError(error: Error, info: string) {\n  const isAbortError = error instanceof DOMException && error.name === 'AbortError';\n  if (isAbortError) {\n    return [];\n  }\n\n  logger.error(error, { info });\n  throw error;\n}\n\nexport const services: Services<QueryBuilderContext, QueryBuilderEvent> = {\n  fetchLabels: async (context) => {\n    const { from, to } = context.inputParams;\n\n    try {\n      const labels = await labelsRepository.listLabels({ query: context.query, from, to });\n\n      const publicLabels: Suggestions = [];\n      const privateLabels: Suggestions = [];\n\n      // place private labels at the bottom of the suggestions list\n      labels.forEach((label) => {\n        if (isPrivateLabel(label.value)) {\n          privateLabels.push(label);\n        } else {\n          publicLabels.push(label);\n        }\n      });\n\n      return [...publicLabels, ...privateLabels];\n    } catch (error) {\n      return handleError(error as Error, 'Error while fetching labels!');\n    }\n  },\n  fetchOperators: async () => {\n    try {\n      return await operatorsRepository.list();\n    } catch (error) {\n      return handleError(error as Error, 'Error while fetching operators!');\n    }\n  },\n  // TODO: refactor indeed\n  // eslint-disable-next-line sonarjs/cognitive-complexity\n  fetchLabelValues: async (context) => {\n    let { query, edition, suggestions } = context;\n    let targetFilter;\n\n    try {\n      if (edition) {\n        const filters = context.filters.filter((filter) => {\n          if (filter.id === edition!.filterId) {\n            targetFilter = filter;\n            return false;\n          }\n\n          return true;\n        }) as Filters;\n\n        if (!targetFilter) {\n          throw new Error(`Impossible to edit filter id=\"${edition.filterId}\": no filter found!`);\n        }\n\n        query = filtersToQuery(query, filters);\n      } else {\n        targetFilter = getLastFilter(context.filters);\n\n        if (targetFilter?.type !== FilterKind.partial) {\n          throw new Error('Impossible to load label values: no partial filter found!');\n        }\n      }\n\n      if (suggestions.disabled) {\n        return [];\n      }\n\n      const labelId = targetFilter.attribute.value;\n      const { from, to } = context.inputParams;\n\n      return await labelsRepository.listLabelValues({ label: labelId, query, from, to });\n    } catch (error) {\n      return handleError(error as Error, 'Error while fetching label values!');\n    }\n  },\n};\n","import { State, StateNodeConfig } from 'xstate';\n\nimport { QueryBuilderContext, QueryBuilderEvent } from '../types';\n\nexport const autoSuggestProxy: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  // epsilon transition to automatically suggests missing partial filter parts\n  always: [\n    {\n      cond: 'shouldSuggestOperators',\n      target: 'loadOperators',\n    },\n    {\n      cond: 'shouldSuggestValues',\n      target: 'loadLabelValues',\n    },\n    { target: 'idle' },\n  ],\n};\n","export const MESSAGES = {\n  FILTER_ADD: 'Filter by label values...',\n  SELECT_LABEL: 'Select a label...',\n  SELECT_OPERATOR: 'Select an operator...',\n  SELECT_VALUE: 'Select a value...',\n  SELECT_VALUES: 'Select values...',\n  TYPE_VALUE: 'Type a regex...',\n  LOADING: 'Loading...',\n  ERROR_LOAD: 'An unexpected error occurred while loading! Please try again.',\n  SUGGESTIONS_NONE: 'No suggestions available.',\n  SUGGESTIONS_DISABLED: 'Suggestions are disabled for this label.',\n};\n","import { OperatorKind } from '../types';\n\nexport const isRegexOperator = (operator: string | OperatorKind) =>\n  operator === OperatorKind['=~'] || operator === OperatorKind['!~'];\n","import { assign, State, StateNodeConfig } from 'xstate';\n\nimport { MESSAGES } from '../../ui/constants';\nimport { getLastFilter } from '../helpers/getLastFilter';\nimport { isMultipleValuesOperator } from '../helpers/isMultipleValuesOperator';\nimport { isPartialFilter } from '../helpers/isPartialFilter';\nimport { isRegexOperator } from '../helpers/isRegexOperator';\nimport { defaultContext } from '../stateMachine';\nimport { QueryBuilderContext, QueryBuilderEvent } from '../types';\n\nexport const idle: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: [\n    'cancelAllLoad',\n    assign({\n      // eslint-disable-next-line sonarjs/cognitive-complexity\n      suggestions: (context) => {\n        let placeholder = MESSAGES.FILTER_ADD;\n        let allowCustomValue = false;\n        const lastFilter = getLastFilter(context.filters);\n\n        if (lastFilter && isPartialFilter(lastFilter)) {\n          if (!lastFilter.operator) {\n            placeholder = MESSAGES.SELECT_OPERATOR;\n          } else {\n            allowCustomValue = isRegexOperator(lastFilter.operator.value);\n\n            placeholder = isMultipleValuesOperator(lastFilter.operator.value)\n              ? MESSAGES.SELECT_VALUES\n              : allowCustomValue\n              ? MESSAGES.TYPE_VALUE\n              : MESSAGES.SELECT_VALUE;\n          }\n        }\n\n        return {\n          ...defaultContext.suggestions,\n          placeholder,\n          allowCustomValue,\n        };\n      },\n      edition: null,\n    }),\n  ],\n  on: {\n    START_INPUT: [\n      {\n        cond: 'shouldSuggestAttributes',\n        target: 'loadLabels',\n      },\n      {\n        cond: 'shouldSuggestOperators',\n        target: 'loadOperators',\n      },\n      {\n        cond: 'shouldSuggestValues',\n        target: 'loadLabelValues',\n      },\n    ],\n    EDIT_FILTER: [\n      {\n        cond: 'shouldEditAttribute',\n        target: 'loadLabels',\n        actions: ['setEdition'],\n      },\n      {\n        cond: 'shouldEditOperator',\n        target: 'loadOperators',\n        actions: ['setEdition'],\n      },\n      {\n        cond: 'shouldEditValue',\n        target: 'loadLabelValues',\n        actions: ['setEdition'],\n      },\n    ],\n    REMOVE_FILTER: [\n      {\n        cond: 'hasPartialFilter',\n        target: 'autoSuggestProxy',\n        actions: ['removeFilter'],\n      },\n      {\n        target: 'idle',\n        actions: ['removeFilter'],\n      },\n    ],\n    REMOVE_LAST_FILTER: {\n      target: 'idle',\n      actions: ['removeLastFilter'],\n    },\n    CHANGE_INPUT_PARAMS: {\n      target: 'idle',\n      actions: ['changeInputParams'],\n    },\n    EXECUTE_QUERY: {\n      target: 'idle',\n      actions: ['activateFilters'],\n    },\n  },\n};\n","import { assign, State, StateNodeConfig } from 'xstate';\n\nimport { MESSAGES } from '../../ui/constants';\nimport { defaultContext } from '../stateMachine';\nimport { QueryBuilderContext, QueryBuilderEvent, SuggestionKind, Suggestions } from '../types';\n\nexport const loadLabels: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: () => ({\n      ...defaultContext.suggestions,\n      isVisible: true,\n      isLoading: true,\n    }),\n  }),\n  invoke: {\n    id: 'fetchLabels',\n    src: 'fetchLabels',\n    onDone: {\n      target: 'displayLabels',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: (event.data as Suggestions).filter(\n            ({ value }) => !context.filters.some((filter) => filter.attribute?.value === value)\n          ),\n          isLoading: false,\n        }),\n      }),\n    },\n    onError: {\n      target: 'displayLabels',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          isLoading: false,\n          error: event.data,\n        }),\n      }),\n    },\n  },\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n  },\n};\n\nexport const displayLabels: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: (context) => ({\n      ...context.suggestions,\n      type: SuggestionKind.attribute,\n      isVisible: true,\n      placeholder: MESSAGES.SELECT_LABEL,\n    }),\n  }),\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n    SELECT_SUGGESTION: [\n      {\n        cond: 'isEditing',\n        target: 'loadOperators',\n        actions: ['editFilterAttribute'],\n      },\n      {\n        target: 'loadOperators',\n        actions: ['setFilterAttribute'],\n      },\n    ],\n    REMOVE_LAST_FILTER: {\n      target: 'idle',\n      actions: ['removeLastFilter'],\n    },\n  },\n};\n","import { assign, State, StateNodeConfig } from 'xstate';\n\nimport { invariant } from '../../../../types/helpers/invariant';\nimport { MESSAGES } from '../../ui/constants';\nimport { getFilterUnderEdition } from '../helpers/getFilterUnderEdition';\nimport { getLastFilter } from '../helpers/getLastFilter';\nimport { isMultipleValuesOperator } from '../helpers/isMultipleValuesOperator';\nimport { isPrivateLabel } from '../helpers/isPrivateLabel';\nimport { isRegexOperator } from '../helpers/isRegexOperator';\nimport { defaultContext } from '../stateMachine';\nimport { QueryBuilderContext, QueryBuilderEvent, SuggestionKind } from '../types';\n\nexport const loadLabelValues: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: (context) => {\n      const targetFilter = context.edition ? getFilterUnderEdition(context) : getLastFilter(context.filters);\n\n      invariant(typeof targetFilter?.operator !== undefined, 'No operator for the target filter!');\n\n      return {\n        ...defaultContext.suggestions,\n        disabled:\n          // don't fetch for these operators, an input will appear in the UI instead of a select\n          ['=~', '!~'].includes(targetFilter!.operator!.value) ||\n          // See https://github.com/grafana/pyroscope-app-plugin/issues/335\n          isPrivateLabel(targetFilter!.attribute!.value),\n        isVisible: true,\n        isLoading: true,\n      };\n    },\n  }),\n  invoke: {\n    id: 'fetchLabelValues',\n    src: 'fetchLabelValues',\n    onDone: {\n      target: 'displayLabelValues',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: event.data,\n          isLoading: false,\n        }),\n      }),\n    },\n    onError: {\n      target: 'displayLabelValues',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: [],\n          isLoading: false,\n          error: event.data,\n        }),\n      }),\n    },\n  },\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n  },\n};\n\nexport const displayLabelValues: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    // eslint-disable-next-line sonarjs/cognitive-complexity\n    suggestions: (context) => {\n      const targetFilter = context.edition ? getFilterUnderEdition(context) : getLastFilter(context.filters);\n\n      invariant(typeof targetFilter?.operator !== undefined, 'No operator for the target filter!');\n\n      const targetOperator = targetFilter!.operator!.value;\n\n      const allowCustomValue =\n        isRegexOperator(targetOperator) ||\n        // See https://github.com/grafana/pyroscope-app-plugin/issues/335\n        context.suggestions.disabled;\n\n      const multiple = isMultipleValuesOperator(targetOperator);\n\n      let placeholder: string;\n\n      if (allowCustomValue) {\n        placeholder = MESSAGES.TYPE_VALUE;\n      } else {\n        placeholder = multiple ? MESSAGES.SELECT_VALUES : MESSAGES.SELECT_VALUE;\n      }\n\n      let noOptionsMessage: string;\n\n      if (context.suggestions.error) {\n        noOptionsMessage = MESSAGES.ERROR_LOAD;\n      } else {\n        noOptionsMessage = context.suggestions.disabled ? MESSAGES.SUGGESTIONS_DISABLED : MESSAGES.SUGGESTIONS_NONE;\n      }\n\n      return {\n        ...context.suggestions,\n        type: SuggestionKind.value,\n        isVisible: true,\n        placeholder,\n        noOptionsMessage,\n        allowCustomValue,\n        multiple,\n      };\n    },\n  }),\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n    SELECT_SUGGESTION: [\n      {\n        cond: 'isEditing',\n        target: 'autoSuggestProxy',\n        actions: ['editFilterValue'],\n      },\n      {\n        target: 'idle',\n        actions: ['setFilterValue'],\n      },\n    ],\n    REMOVE_LAST_FILTER: {\n      target: 'loadOperators',\n      actions: ['removeLastFilter'],\n    },\n  },\n};\n","import { assign, State, StateNodeConfig } from 'xstate';\n\nimport { MESSAGES } from '../../ui/constants';\nimport { defaultContext } from '../stateMachine';\nimport { QueryBuilderContext, QueryBuilderEvent, SuggestionKind } from '../types';\n\nexport const loadOperators: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: () => ({\n      ...defaultContext.suggestions,\n      isVisible: true,\n      isLoading: true,\n    }),\n  }),\n  invoke: {\n    id: 'fetchOperators',\n    src: 'fetchOperators',\n    onDone: {\n      target: 'displayOperators',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: event.data,\n          isLoading: false,\n        }),\n      }),\n    },\n    onError: {\n      target: 'displayOperators',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: [],\n          isLoading: false,\n          error: event.data,\n        }),\n      }),\n    },\n  },\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n  },\n};\n\nexport const displayOperators: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: (context) => ({\n      ...context.suggestions,\n      type: SuggestionKind.operator,\n      isVisible: true,\n      placeholder: MESSAGES.SELECT_OPERATOR,\n      allowCustomValue: false,\n      multiple: false,\n    }),\n  }),\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n    SELECT_SUGGESTION: [\n      // edition\n      {\n        cond: 'shouldSuggestValuesAfterOperatorEdition',\n        target: 'loadLabelValues',\n        actions: ['editFilterOperator'],\n      },\n      {\n        cond: 'shouldNotSuggestValuesAfterOperatorEdition',\n        target: 'autoSuggestProxy',\n        actions: ['editFilterOperator'],\n      },\n      // no edition\n      {\n        cond: 'hasPartialFilter',\n        target: 'autoSuggestProxy',\n        actions: ['setFilterOperator'],\n      },\n      {\n        target: 'loadLabelValues',\n        actions: ['setFilterOperator'],\n      },\n    ],\n    REMOVE_LAST_FILTER: {\n      target: 'loadLabels',\n      actions: ['removeLastFilter'],\n    },\n  },\n};\n","import { createMachine, interpret, Interpreter, type MachineConfig, type MachineOptions } from 'xstate';\n\nimport { actions } from './actions';\nimport { guards } from './guards';\nimport { queryToFilters } from './helpers/queryToFilters';\nimport { services } from './services';\nimport { autoSuggestProxy } from './states/autoSuggestProxy';\nimport { idle } from './states/idle';\nimport { displayLabels, loadLabels } from './states/loadLabels';\nimport { displayLabelValues, loadLabelValues } from './states/loadLabelValues';\nimport { displayOperators, loadOperators } from './states/loadOperators';\nimport { InputParams, QueryBuilderContext, QueryBuilderEvent, QueryBuilderSchema } from './types';\n\nexport const defaultContext: QueryBuilderContext = Object.freeze({\n  inputParams: {\n    query: '',\n    from: 0,\n    to: 0,\n  },\n  query: '',\n  filters: [],\n  isQueryUpToDate: true,\n  edition: null,\n  suggestions: {\n    type: null,\n    items: [],\n    isVisible: false,\n    isLoading: false,\n    error: null,\n    placeholder: '',\n    noOptionsMessage: '',\n    allowCustomValue: false,\n    multiple: false,\n    disabled: false,\n  },\n});\n\nconst config = (\n  context: QueryBuilderContext\n): MachineConfig<QueryBuilderContext, QueryBuilderSchema, QueryBuilderEvent> => ({\n  id: 'query-builder',\n  initial: 'idle',\n  context,\n  predictableActionArguments: true,\n  states: {\n    idle,\n    loadLabels,\n    displayLabels,\n    loadOperators,\n    displayOperators,\n    loadLabelValues,\n    displayLabelValues,\n    autoSuggestProxy,\n  },\n});\n\nconst options: MachineOptions<QueryBuilderContext, QueryBuilderEvent> = {\n  guards,\n  services,\n  actions,\n};\n\nexport type Actor = Interpreter<QueryBuilderContext, QueryBuilderSchema, QueryBuilderEvent>;\n\nexport function buildStateMachine(inputParams: InputParams) {\n  const { query } = inputParams;\n\n  const initialContext: QueryBuilderContext = {\n    ...defaultContext,\n    inputParams,\n    query,\n    // See changeInputParams() in domain/actions.ts\n    filters: queryToFilters(query),\n  };\n\n  const stateMachine = createMachine(config(initialContext), options);\n\n  const actor = interpret(stateMachine) as unknown as Actor;\n\n  return { actor, initialContext };\n}\n","const collator = new Intl.Collator('en', { sensitivity: 'case' });\n\nexport const localeCompare = collator.compare;\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { MultiSelect, useStyles2 } from '@grafana/ui';\nimport { localeCompare } from '@shared/domain/localeCompare';\nimport React, { useCallback, useMemo, useState } from 'react';\n\nimport { Suggestion, Suggestions } from '../../domain/types';\nimport { MESSAGES } from '../constants';\n\ntype MultipleEditionSelectProps = {\n  selection: Suggestion;\n  suggestions: any;\n  onCloseMenu: (values: Suggestions) => void;\n};\n\nconst placeSelectedValuesFirst = (values: Suggestions) => (a: Suggestion, b: Suggestion) => {\n  const aIsSelected = values.some((v) => v.value === a.value);\n  const bIsSelected = values.some((v) => v.value === b.value);\n\n  if (aIsSelected && bIsSelected) {\n    return localeCompare(a.value, b.value);\n  }\n\n  if (bIsSelected) {\n    return +1;\n  }\n\n  if (aIsSelected) {\n    return -1;\n  }\n\n  return 0;\n};\n\nexport function MultipleEditionSelect({ selection, suggestions, onCloseMenu }: MultipleEditionSelectProps) {\n  const styles = useStyles2(getStyles);\n\n  const defaultValue = useMemo(() => {\n    const selectionValues = selection.value.split('|');\n    const selectionLabels = selection.label.split(', ');\n    return selectionValues.map((v, i) => ({ value: v, label: selectionLabels[i] }));\n  }, [selection]);\n\n  const [values, setValues] = useState<Suggestions>(defaultValue);\n\n  // we don't sort when values change so that, for long lists, the user keeps the context they're in\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const sortedOptions = useMemo(() => suggestions.items.sort(placeSelectedValuesFirst(values)), [suggestions.items]);\n\n  const onChange = useCallback((newValues: Array<SelectableValue<string>>) => {\n    setValues(newValues.map(({ value = '', label = '' }) => ({ value, label })));\n  }, []);\n\n  const onInternalCloseMenu = useCallback(() => {\n    onCloseMenu(values);\n  }, [onCloseMenu, values]);\n\n  return (\n    <MultiSelect\n      className={styles.editionSelect}\n      placeholder={suggestions.placeholder}\n      loadingMessage={MESSAGES.LOADING}\n      closeMenuOnSelect={false}\n      hideSelectedOptions={false}\n      backspaceRemovesValue\n      // auto focus required when switching from another operator type\n      autoFocus\n      value={values}\n      onChange={onChange}\n      onCloseMenu={onInternalCloseMenu}\n      options={sortedOptions}\n      isOpen\n      isLoading={suggestions.isLoading}\n      invalid={Boolean(suggestions.error)}\n      noOptionsMessage={suggestions.noOptionsMessage}\n    />\n  );\n}\n\nconst getStyles = () => ({\n  editionSelect: css`\n    position: absolute;\n    z-index: 1;\n\n    [aria-label='Remove'] svg {\n      display: none;\n    }\n  `,\n});\n","import { css, cx } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { Input, useStyles2 } from '@grafana/ui';\nimport React, { useEffect, useRef, useState } from 'react';\n\ntype SingleEditionInputProps = {\n  placeholder: string;\n  onChange: (suggestion: SelectableValue<string>) => void;\n  onBlur: () => void;\n  defaultValue?: string;\n  onFocus?: () => void;\n};\n\nexport function SingleEditionInput({ placeholder, defaultValue, onFocus, onChange, onBlur }: SingleEditionInputProps) {\n  const styles = useStyles2(getStyles);\n\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [invalid, setInvalid] = useState(false);\n\n  const onKeyUp = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    const value = (e.target as HTMLInputElement).value.trim();\n\n    // TODO: introduce an \"is empty\" value to handle this case (so that the filter will be synced in the URL)?\n    // see https://github.com/grafana/profiles-drilldown/pull/205\n    if (e.code === 'Enter') {\n      if (value) {\n        onChange({ value, label: value });\n      } else {\n        setInvalid(true);\n      }\n    }\n  };\n\n  const onInternalBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    const value = (e.target as HTMLInputElement).value.trim();\n\n    // TODO: introduce an \"is empty\" value to handle this case (so that the filter will be synced in the URL)?\n    // see https://github.com/grafana/explore-profiles/pull/205\n    if (value) {\n      onChange({ value, label: value });\n    } else {\n      onBlur();\n    }\n  };\n\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, []);\n\n  return (\n    <Input\n      ref={inputRef}\n      className={cx(defaultValue && styles.edition)}\n      invalid={invalid}\n      placeholder={placeholder}\n      defaultValue={defaultValue}\n      onFocus={onFocus}\n      onKeyUp={onKeyUp}\n      onBlur={onInternalBlur}\n    />\n  );\n}\n\nconst getStyles = () => ({\n  edition: css`\n    position: absolute;\n    z-index: 1;\n  `,\n});\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { Select, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { Suggestion } from '../../domain/types';\nimport { MESSAGES } from '../constants';\nimport { SingleEditionInput } from '../inputs/SingleEditionInput';\n\nconst getStyles = () => ({\n  editionSelect: css`\n    position: absolute;\n    z-index: 1;\n    min-width: 160px;\n    box-shadow: none;\n\n    & input:focus {\n      outline: none !important;\n    }\n  `,\n});\n\ntype EditionSelectProps = {\n  selection: Suggestion;\n  suggestions: any;\n  onChange: (suggestion: SelectableValue<string>) => void;\n  onCloseMenu: () => void;\n};\n\nexport function SingleEditionSelect({ selection, suggestions, onChange, onCloseMenu }: EditionSelectProps) {\n  const styles = useStyles2(getStyles);\n\n  if (suggestions.allowCustomValue) {\n    return (\n      <SingleEditionInput\n        defaultValue={selection.value}\n        placeholder={suggestions.placeholder}\n        onChange={onChange}\n        onBlur={onCloseMenu}\n      />\n    );\n  }\n\n  return (\n    <Select\n      className={styles.editionSelect}\n      placeholder={suggestions.placeholder}\n      loadingMessage={MESSAGES.LOADING}\n      closeMenuOnSelect={false}\n      autoFocus\n      value={selection.value}\n      onChange={onChange}\n      onCloseMenu={onCloseMenu}\n      options={suggestions.items}\n      isOpen\n      isLoading={suggestions.isLoading}\n      invalid={Boolean(suggestions.error)}\n      noOptionsMessage={suggestions.noOptionsMessage}\n    />\n  );\n}\n","import { cx } from '@emotion/css';\nimport { Tag, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { CompleteFilter, FilterPartKind } from '../../domain/types';\nimport { getStyles } from './Chiclet';\n\ntype ChicletAttributeOperatorValueProps = {\n  filter: CompleteFilter;\n  onClick: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter, part: FilterPartKind) => void;\n  onRemove: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter) => void;\n};\n\nconst noOp = () => {};\n\nexport const ChicletAttributeOperator = ({ filter, onClick, onRemove }: ChicletAttributeOperatorValueProps) => {\n  const styles = useStyles2(getStyles);\n\n  const { attribute, operator, active } = filter;\n  const className = active ? styles.chiclet : cx(styles.chiclet, styles.inactiveChiclet);\n\n  return (\n    <div className={className} aria-label=\"Filter\">\n      <Tag aria-label=\"Filter label\" className={styles.chicletAttribute} name={attribute.label} onClick={noOp} />\n\n      <Tag\n        aria-label=\"Filter operator\"\n        className={styles.chicletOperator}\n        name={operator.label}\n        onClick={(name, e) => onClick(e, filter, FilterPartKind.operator)}\n        tabIndex={0}\n      />\n\n      <Tag\n        aria-label=\"Remove filter\"\n        className={styles.chicletRemoveButton}\n        icon=\"times\"\n        name=\"\"\n        onClick={(name, e) => onRemove(e, filter)}\n        tabIndex={0}\n      />\n    </div>\n  );\n};\n","import { cx } from '@emotion/css';\nimport { Tag, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { CompleteFilter, FilterPartKind } from '../../domain/types';\nimport { getStyles } from './Chiclet';\n\ntype ChicletAttributeOperatorValueProps = {\n  filter: CompleteFilter;\n  onClick: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter, part: FilterPartKind) => void;\n  onRemove: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter) => void;\n};\n\nconst noOp = () => {};\n\nexport const ChicletAttributeOperatorValue = ({ filter, onClick, onRemove }: ChicletAttributeOperatorValueProps) => {\n  const styles = useStyles2(getStyles);\n\n  const { attribute, operator, value, active } = filter;\n  const className = active ? styles.chiclet : cx(styles.chiclet, styles.inactiveChiclet);\n\n  return (\n    <div className={className} aria-label=\"Filter\">\n      <Tag aria-label=\"Filter label\" className={styles.chicletAttribute} name={attribute.label} onClick={noOp} />\n\n      <Tag\n        aria-label=\"Filter operator\"\n        className={styles.chicletOperator}\n        name={operator.label}\n        onClick={(name, e) => onClick(e, filter, FilterPartKind.operator)}\n        tabIndex={0}\n      />\n\n      <Tooltip content={value.label}>\n        <Tag\n          aria-label=\"Filter value\"\n          name={value.label}\n          className={styles.chicletValue}\n          onClick={(name, e) => onClick(e, filter, FilterPartKind.value)}\n          tabIndex={0}\n        />\n      </Tooltip>\n\n      <Tag\n        aria-label=\"Remove filter\"\n        className={styles.chicletRemoveButton}\n        icon=\"times\"\n        name=\"\"\n        onClick={(name, e) => onRemove(e, filter)}\n        tabIndex={0}\n      />\n    </div>\n  );\n};\n","import { cx } from '@emotion/css';\nimport { Tag, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { FilterPartKind, PartialFilter } from '../../domain/types';\nimport { getStyles } from './Chiclet';\n\ntype PartialChicletProps = {\n  filter: PartialFilter;\n  onClick: (event: React.MouseEvent<HTMLElement>, filter: PartialFilter, part: FilterPartKind) => void;\n};\n\nexport const PartialChiclet = ({ filter, onClick }: PartialChicletProps) => {\n  const styles = useStyles2(getStyles);\n\n  const { attribute, operator } = filter;\n  if (!attribute && !operator) {\n    return null;\n  }\n\n  return (\n    <div className={cx(styles.chiclet, styles.partialChiclet)} aria-label=\"Partial filter\">\n      <Tag\n        colorIndex={9}\n        name={attribute.label}\n        title={`Edit \"${attribute.label}\"`}\n        onClick={(name, e) => onClick(e, filter, FilterPartKind.attribute)}\n        tabIndex={0}\n      />\n\n      {operator && (\n        <Tag\n          colorIndex={9}\n          name={operator.label}\n          title={`Edit \"${operator.label}\"`}\n          className={styles.chicletOperator}\n          onClick={(name, e) => onClick(e, filter, FilterPartKind.operator)}\n          tabIndex={0}\n        />\n      )}\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport React, { memo } from 'react';\n\nimport { CompleteFilter, Filter, FilterKind, FilterPartKind } from '../../domain/types';\nimport { ChicletAttributeOperator } from './ChicletAttributeOperator';\nimport { ChicletAttributeOperatorValue } from './ChicletAttributeOperatorValue';\nimport { PartialChiclet } from './PartialChiclet';\n\ntype ChicletProps = {\n  filter: Filter;\n  onClick: (event: React.MouseEvent<HTMLElement>, filter: Filter, part: FilterPartKind) => void;\n  onRemove: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter) => void;\n};\n\nconst activeBackgroundColor = 'rgb(61, 113, 217)';\nconst activeTextColor = '#fff';\nconst inactiveBorderColor = '#4a4b52';\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  chiclet: css`\n    display: flex;\n    align-items: center;\n    border: 1px solid ${activeBackgroundColor};\n    border-radius: 2px;\n\n    & > button {\n      height: 30px;\n      background-color: ${theme.colors.background.primary};\n      color: ${theme.colors.text.maxContrast};\n    }\n\n    & > :first-child {\n      background-color: ${activeBackgroundColor};\n      color: ${activeTextColor};\n      border-radius: 0;\n\n      &:hover {\n        cursor: not-allowed !important;\n      }\n    }\n\n    & > :last-child {\n      border-left: 1px solid ${activeBackgroundColor};\n      border-top-left-radius: 0;\n      border-bottom-left-radius: 0;\n    }\n  `,\n  partialChiclet: css`\n    border-color: ${inactiveBorderColor};\n    border-right: 0;\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n\n    & > :first-child {\n      background-color: ${theme.colors.background.secondary};\n      color: ${theme.colors.text.maxContrast};\n      border-radius: 0;\n      border-left: 0;\n\n      &:hover {\n        cursor: pointer !important;\n      }\n    }\n\n    & > :last-child {\n      border-color: ${inactiveBorderColor};\n      color: ${theme.colors.text.maxContrast};\n    }\n  `,\n  inactiveChiclet: css`\n    border-color: ${inactiveBorderColor};\n\n    & > button {\n      color: ${theme.colors.text.maxContrast};\n    }\n\n    & > :first-child {\n      background-color: ${theme.colors.background.secondary};\n      color: ${theme.colors.text.maxContrast};\n    }\n\n    & > :last-child {\n      border-color: ${inactiveBorderColor};\n    }\n  `,\n  chicletAttribute: css`\n    &:hover {\n      opacity: 1 !important;\n    }\n  `,\n  chicletOperator: css`\n    &:hover {\n      background-color: ${theme.colors.background.secondary};\n    }\n  `,\n  chicletValue: css`\n    flex-grow: 1;\n    text-align: left;\n    max-width: 420px;\n    text-overflow: ellipsis;\n    text-wrap: nowrap;\n    overflow: hidden;\n\n    &:hover {\n      background-color: ${theme.colors.background.secondary};\n    }\n  `,\n  chicletRemoveButton: css`\n    &:hover {\n      background-color: ${theme.colors.background.secondary};\n    }\n\n    & svg {\n      width: 12px;\n      height: 12px;\n    }\n  `,\n});\n\nconst ChicletComponent = ({ filter, onClick, onRemove }: ChicletProps) => {\n  switch (filter.type) {\n    case FilterKind.partial:\n      return <PartialChiclet filter={filter} onClick={onClick} />;\n\n    case FilterKind['attribute-operator-value']:\n      return <ChicletAttributeOperatorValue filter={filter as CompleteFilter} onClick={onClick} onRemove={onRemove} />;\n\n    case FilterKind['attribute-operator']:\n      return <ChicletAttributeOperator filter={filter as CompleteFilter} onClick={onClick} onRemove={onRemove} />;\n\n    default:\n      throw new TypeError(`Unsupported filter type \"${filter.type}\" (${JSON.stringify(filter)})!`);\n  }\n};\n\nexport const Chiclet = memo(\n  ChicletComponent,\n  (prevProps, nextProps) => JSON.stringify(prevProps.filter) === JSON.stringify(nextProps.filter)\n);\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { memo } from 'react';\n\nimport {\n  CompleteFilter,\n  Edition,\n  Filter,\n  FilterPartKind,\n  Filters,\n  QueryBuilderContext,\n  Suggestion,\n  Suggestions,\n} from '../../domain/types';\nimport { MultipleEditionSelect } from '../selects/MultipleEditionSelect';\nimport { SingleEditionSelect } from '../selects/SingleEditionSelect';\nimport { Chiclet } from './Chiclet';\n\nconst getStyles = () => ({\n  chicletsList: css`\n    display: flex;\n    align-items: center;\n    flex-wrap: wrap;\n    gap: 4px;\n  `,\n  editChicletContainer: css`\n    position: relative;\n  `,\n});\n\ntype ChicletsListProps = {\n  filters: Filters;\n  onClickChiclet: (event: React.MouseEvent<HTMLElement>, filter: Filter, part: FilterPartKind) => void;\n  onRemoveChiclet: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter) => void;\n  edition: Edition | null;\n  suggestions: QueryBuilderContext['suggestions'];\n  onChangeSingleSuggestion: (suggestion: SelectableValue<string>) => void;\n  onCloseSingleSuggestionsMenu: () => void;\n  onCloseMultipleSuggestionsMenu: (values: Suggestions) => void;\n};\n\nfunction ChicletsListComponent({\n  filters,\n  onClickChiclet,\n  onRemoveChiclet,\n  edition,\n  suggestions,\n  onChangeSingleSuggestion,\n  onCloseSingleSuggestionsMenu,\n  onCloseMultipleSuggestionsMenu,\n}: ChicletsListProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.chicletsList} data-testid=\"filtersList\">\n      {filters.map((filter) => (\n        <div key={filter.id} className={styles.editChicletContainer}>\n          <Chiclet filter={filter} onClick={onClickChiclet} onRemove={onRemoveChiclet} />\n\n          {edition?.filterId === filter.id ? (\n            !suggestions.multiple ? (\n              <SingleEditionSelect\n                // we add a key to force to unmount the component. this prevents the operator to stick when editing label values\n                key={edition.part}\n                selection={filter[edition.part] as Suggestion}\n                suggestions={suggestions}\n                onChange={onChangeSingleSuggestion}\n                onCloseMenu={onCloseSingleSuggestionsMenu}\n              />\n            ) : (\n              <MultipleEditionSelect\n                selection={filter[edition.part] as Suggestion}\n                suggestions={suggestions}\n                onCloseMenu={onCloseMultipleSuggestionsMenu}\n              />\n            )\n          ) : null}\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport const ChicletsList = memo(ChicletsListComponent);\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { Select, useStyles2 } from '@grafana/ui';\nimport React, { useEffect, useState } from 'react';\n\nimport { MESSAGES } from '../constants';\nimport { SingleEditionInput } from '../inputs/SingleEditionInput';\n\nexport const getStyles = () => ({\n  select: css`\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n  `,\n});\n\ntype SingleSelectProps = {\n  suggestions: any;\n  onFocus: () => void;\n  onChange: (suggestion: SelectableValue<string>) => void;\n  onKeyDown: (event: any) => void;\n  onCloseMenu: () => void;\n};\n\n// we use this hack to force the select to open after (e.g.) editing an existing attribute\n// in this case, regardless that the `isOpen` prop of the <Select /> component is true\n// the dropdown does not appear on the UI\n// it seems it's a bug from the <Select /> component itself\n// TODO: report it!\nfunction useEnsureIsOpenHack(isVisible: boolean) {\n  const [isOpen, setIsOpen] = useState(false);\n\n  useEffect(() => {\n    if (isVisible && !isOpen) {\n      setTimeout(() => setIsOpen(true), 0);\n      return;\n    }\n\n    if (isVisible !== isOpen) {\n      setIsOpen(isVisible);\n    }\n  }, [isOpen, isVisible]);\n\n  return isOpen;\n}\n\nexport function SingleSelect({ suggestions, onFocus, onChange, onKeyDown, onCloseMenu }: SingleSelectProps) {\n  const styles = useStyles2(getStyles);\n  const isOpen = useEnsureIsOpenHack(suggestions.isVisible);\n\n  if (suggestions.allowCustomValue) {\n    return (\n      <SingleEditionInput\n        placeholder={suggestions.placeholder}\n        onFocus={onFocus}\n        onChange={onChange}\n        onBlur={onCloseMenu}\n      />\n    );\n  }\n\n  return (\n    <Select\n      className={styles.select}\n      placeholder={suggestions.placeholder}\n      loadingMessage={MESSAGES.LOADING}\n      closeMenuOnSelect={false}\n      value={null}\n      onFocus={onFocus}\n      onKeyDown={onKeyDown}\n      onChange={onChange}\n      onCloseMenu={onCloseMenu}\n      options={suggestions.items}\n      isOpen={isOpen}\n      isLoading={suggestions.isLoading}\n      invalid={Boolean(suggestions.error)}\n      noOptionsMessage={suggestions.noOptionsMessage}\n    />\n  );\n}\n","import { Select, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { MESSAGES } from '../constants';\nimport { getStyles } from './SingleSelect';\n\nconst noOp = () => {};\n\nexport function DisabledSelect() {\n  const styles = useStyles2(getStyles);\n\n  return <Select disabled className={styles.select} placeholder={MESSAGES.FILTER_ADD} onChange={noOp} />;\n}\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { MultiSelect, useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useState } from 'react';\n\nimport { Suggestions } from '../../domain/types';\nimport { MESSAGES } from '../constants';\n\ntype MultipleSelectProps = {\n  suggestions: any;\n  onFocus: () => void;\n  onKeyDown: (event: any, values: Suggestions) => void;\n  onCloseMenu: (values: Suggestions) => void;\n};\n\nexport function MultipleSelect({ suggestions, onFocus, onKeyDown, onCloseMenu }: MultipleSelectProps) {\n  const styles = useStyles2(getStyles);\n  const [values, setValues] = useState<Suggestions>([]);\n\n  const onChange = useCallback((newValues: Array<SelectableValue<string>>) => {\n    setValues(newValues.map(({ value = '', label = '' }) => ({ value, label })));\n  }, []);\n\n  const onInternalKeyDown = useCallback(\n    (event: any) => {\n      onKeyDown(event, values);\n    },\n    [onKeyDown, values]\n  );\n\n  const onInternalCloseMenu = useCallback(() => {\n    onCloseMenu(values);\n  }, [onCloseMenu, values]);\n\n  return (\n    <MultiSelect\n      className={styles.select}\n      placeholder={suggestions.placeholder}\n      loadingMessage={MESSAGES.LOADING}\n      closeMenuOnSelect={false}\n      hideSelectedOptions={false}\n      backspaceRemovesValue\n      // auto focus required when switching from another operator type\n      autoFocus\n      value={values}\n      onFocus={onFocus}\n      onKeyDown={onInternalKeyDown}\n      onChange={onChange}\n      onCloseMenu={onInternalCloseMenu}\n      options={suggestions.items}\n      isOpen={suggestions.isVisible}\n      isLoading={suggestions.isLoading}\n      invalid={Boolean(suggestions.error)}\n      noOptionsMessage={suggestions.noOptionsMessage}\n    />\n  );\n}\n\nconst getStyles = () => ({\n  select: css`\n    [aria-label='Remove'] svg {\n      display: none;\n    }\n  `,\n});\n","import { css, cx } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { usePrevious } from '@shared/components/QueryBuilder/ui/hooks';\nimport React, { memo, useCallback, useEffect } from 'react';\nimport { StateListener } from 'xstate/lib/interpreter';\n\nimport { Actor } from './domain/stateMachine';\nimport {\n  CompleteFilter,\n  CompleteFilters,\n  Filter,\n  FilterPartKind,\n  QueryBuilderContext,\n  QueryBuilderEvent,\n  Suggestions,\n} from './domain/types';\nimport { useStateMachine } from './domain/useStateMachine';\nimport { ChicletsList } from './ui/chiclets/ChicletsList';\nimport { DisabledSelect } from './ui/selects/DisabledSelect';\nimport { MultipleSelect } from './ui/selects/MultipleSelect';\nimport { SingleSelect } from './ui/selects/SingleSelect';\n\nconst getStyles = () => ({\n  queryBuilder: css`\n    display: flex;\n    justify-content: flex-start;\n    align-items: flex-end;\n    flex-wrap: wrap;\n    gap: 4px;\n    width: 100%;\n  `,\n  controls: css`\n    display: flex;\n    align-self: flex-start;\n    flex-grow: 1;\n  `,\n  executeButton: css`\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n  `,\n});\n\nexport type QueryBuilderProps = {\n  id: string;\n  // TODO: after migrate the legacy comparison pages to Scenes, dataSourceUid will be mandatory\n  dataSourceUid?: string;\n  query: string;\n  from: number;\n  to: number;\n  onChangeQuery: (newQuery: string, filters: CompleteFilters) => void;\n  className?: string;\n  autoExecute?: boolean;\n};\n\nfunction QueryBuilderComponent(props: QueryBuilderProps) {\n  const styles = useStyles2(getStyles);\n\n  const { actor, internalProps } = useStateMachine(props);\n  const { filters, edition, isQueryUpToDate, suggestions } = internalProps;\n\n  const { onClickChiclet, onRemoveChiclet } = useChicletHandlers(actor);\n\n  const {\n    onFocus,\n    onChangeSingleSuggestion,\n    onSingleSelectKeyDown,\n    onCloseSingleMenu,\n    onMultipleSelectKeyDown,\n    onCloseMultipleMenu,\n  } = useSelectHandlers(actor, suggestions, props.id);\n\n  const onClickExecute = useCallback(() => {\n    actor.send({ type: 'EXECUTE_QUERY' });\n  }, [actor]);\n\n  useEffect(() => {\n    if (!props.autoExecute) {\n      return;\n    }\n\n    const onTransition: StateListener<QueryBuilderContext, QueryBuilderEvent> = ({ value, context, event }) => {\n      if (value === 'idle' && !context.isQueryUpToDate && event.type !== 'EXECUTE_QUERY') {\n        actor.send({ type: 'EXECUTE_QUERY' });\n      }\n    };\n\n    actor.onTransition(onTransition);\n\n    return () => {\n      actor.off(onTransition);\n    };\n  }, [actor, props.autoExecute]);\n\n  return (\n    <div id={props.id} className={cx(styles.queryBuilder, props.className)}>\n      {filters.length > 0 ? (\n        <ChicletsList\n          filters={filters}\n          onClickChiclet={onClickChiclet}\n          onRemoveChiclet={onRemoveChiclet}\n          edition={edition}\n          suggestions={suggestions}\n          onChangeSingleSuggestion={onChangeSingleSuggestion}\n          onCloseSingleSuggestionsMenu={onCloseSingleMenu}\n          onCloseMultipleSuggestionsMenu={onCloseMultipleMenu}\n        />\n      ) : null}\n\n      <div className={styles.controls}>\n        {edition ? (\n          <DisabledSelect />\n        ) : suggestions.multiple ? (\n          <MultipleSelect\n            suggestions={suggestions}\n            onFocus={onFocus}\n            onKeyDown={onMultipleSelectKeyDown}\n            onCloseMenu={onCloseMultipleMenu}\n          />\n        ) : (\n          <SingleSelect\n            suggestions={suggestions}\n            onFocus={onFocus}\n            onChange={onChangeSingleSuggestion}\n            onKeyDown={onSingleSelectKeyDown}\n            onCloseMenu={onCloseSingleMenu}\n          />\n        )}\n\n        {!props.autoExecute && (\n          <Button\n            onClick={onClickExecute}\n            tooltip={!isQueryUpToDate ? 'Execute new query' : 'Nothing to execute, all filters applied'}\n            className={styles.executeButton}\n            disabled={isQueryUpToDate}\n          >\n            Execute\n          </Button>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction useChicletHandlers(actor: Actor) {\n  const onClickChiclet = useCallback(\n    (event: any, filter: Filter, part: FilterPartKind) => {\n      actor.send({ type: 'EDIT_FILTER', data: { filterId: filter.id, part } });\n    },\n    [actor]\n  );\n\n  const onRemoveChiclet = useCallback(\n    (event: any, filter: CompleteFilter) => {\n      actor.send({ type: 'REMOVE_FILTER', data: filter.id });\n    },\n    [actor]\n  );\n\n  return {\n    onClickChiclet,\n    onRemoveChiclet,\n  };\n}\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nfunction useSelectHandlers(actor: Actor, suggestions: QueryBuilderContext['suggestions'], queryBuilderId: string) {\n  /* single & multiple */\n  const onFocus = useCallback(() => {\n    actor.send({ type: 'START_INPUT' });\n  }, [actor]);\n\n  /* single only */\n  const onChangeSingleSuggestion = useCallback(\n    (suggestion: SelectableValue<string>) => {\n      const { value = '', label = '' } = suggestion;\n\n      actor.send({ type: 'SELECT_SUGGESTION', data: { value, label } });\n    },\n    [actor]\n  );\n\n  const onSingleSelectKeyDown = useCallback(\n    (event: any) => {\n      if (event.code === 'Backspace' && !event.target.value) {\n        actor.send({ type: 'REMOVE_LAST_FILTER' });\n      }\n    },\n    [actor]\n  );\n\n  const onCloseSingleMenu = useCallback(() => {\n    actor.send({ type: 'DISCARD_SUGGESTIONS' });\n  }, [actor]);\n\n  /* multiple only */\n  const onMultipleSelectKeyDown = useCallback(\n    (event: any, values: Suggestions) => {\n      if (event.code === 'Backspace' && !event.target.value && !values.length) {\n        actor.send({ type: 'REMOVE_LAST_FILTER' });\n      }\n    },\n\n    [actor]\n  );\n\n  const onCloseMultipleMenu = useCallback(\n    (values: Suggestions) => {\n      if (values.length) {\n        actor.send({\n          type: 'SELECT_SUGGESTION',\n          data: { value: values.map((v) => v.value).join('|'), label: values.map((v) => v.label).join(', ') },\n        });\n      } else {\n        actor.send({ type: 'DISCARD_SUGGESTIONS' });\n      }\n    },\n    [actor]\n  );\n\n  /* misc */\n\n  const previousSuggestionsIsVisible = usePrevious(suggestions.isVisible);\n\n  useEffect(() => {\n    if (!suggestions.isVisible && previousSuggestionsIsVisible) {\n      // ensures that the input is blurred when a filter has been completed.\n      // we could have used blurInputOnSelect but this allows us to handle properly the case of\n      // editing a complete filter operator from (e.g.) =~ to = (and vice-versa).\n      // indeed, in such cases, we know if the input should be blurred only after selecting a\n      // suggestion, when the select is already rendered.\n      (document.querySelector(`#${queryBuilderId} input`) as HTMLInputElement)?.blur();\n    }\n  }, [suggestions.isVisible, previousSuggestionsIsVisible, queryBuilderId]);\n\n  return {\n    onFocus,\n    onChangeSingleSuggestion,\n    onSingleSelectKeyDown,\n    onMultipleSelectKeyDown,\n    onCloseSingleMenu,\n    onCloseMultipleMenu,\n  };\n}\n\nexport const QueryBuilder = memo(QueryBuilderComponent);\n","import { useEffect, useMemo, useState } from 'react';\n\nimport { QueryBuilderProps } from '../QueryBuilder';\nimport { buildStateMachine } from './stateMachine';\nimport { CompleteFilters, QueryBuilderContext } from './types';\n\nexport function useStateMachine({ dataSourceUid, query, from, to, onChangeQuery }: QueryBuilderProps) {\n  const { actor, initialContext } = useMemo(\n    () => buildStateMachine({ query, from, to }),\n    // We don't want to build a new state machine when the props change, props change is handheld via the CHANGE_INPUT_PARAMS action below\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n\n  useEffect(() => {\n    actor.send({ type: 'CHANGE_INPUT_PARAMS', data: { dataSourceUid, query, from, to } });\n  }, [actor, dataSourceUid, query, from, to]);\n\n  const [internalProps, setInternalProps] = useState<QueryBuilderContext>(initialContext);\n\n  useEffect(() => {\n    actor.start();\n\n    // actor.subscribe(({ value: state, event, context }) => {\n    //   logger.debug('*** %o', JSON.stringify(event));\n    //   logger.debug('***', JSON.stringify(context, null, 1));\n    //   logger.debug('*** ---------------------> \"%s\"', state);\n    actor.subscribe(({ event, context }) => {\n      if (event.type === 'EXECUTE_QUERY') {\n        onChangeQuery(context.query, context.filters as CompleteFilters);\n      }\n\n      setInternalProps(context);\n    });\n\n    return () => {\n      actor.stop();\n    };\n    // onChangeQuery is not a stable prop, we omit it to prevent multiple machine initializations that would end up in a broken UI\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [actor]);\n\n  return { actor, internalProps };\n}\n","/**\n * This is the same use react-use: usePrevious()\n * If more react-use like hooks are needed, we can consider adding react-use as a dependency\n */\nimport { useEffect, useRef } from 'react';\n\nexport function usePrevious<T>(state: T): T | undefined {\n  const ref = useRef<T>();\n\n  useEffect(() => {\n    ref.current = state;\n  });\n\n  return ref.current;\n}\n","type DataSourceDef = {\n  type: string;\n  uid: string;\n};\n\nexport const PYROSCOPE_DATA_SOURCE: DataSourceDef = Object.freeze({\n  type: 'grafana-pyroscope-datasource',\n  uid: '$dataSource', // interpolated variable\n});\n\n/* Runtime data sources */\n\nexport const PYROSCOPE_SERIES_DATA_SOURCE: DataSourceDef = Object.freeze({\n  type: 'grafana-pyroscope-series-datasource',\n  uid: 'grafana-pyroscope-series-datasource',\n});\n\nexport const PYROSCOPE_FAVORITES_DATA_SOURCE: DataSourceDef = Object.freeze({\n  type: 'grafana-pyroscope-favorites-datasource',\n  uid: 'grafana-pyroscope-favorites-datasource',\n});\n\nexport const PYROSCOPE_LABELS_DATA_SOURCE: DataSourceDef = Object.freeze({\n  type: 'grafana-pyroscope-labels-datasource',\n  uid: 'grafana-pyroscope-labels-datasource',\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, VariableRefresh } from '@grafana/data';\nimport { MultiValueVariable, QueryVariable, SceneComponentProps, VariableValueOption } from '@grafana/scenes';\nimport { Cascader, CascaderOption, Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport { localeCompare } from '@shared/domain/localeCompare';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { nanoid } from 'nanoid';\nimport React, { useMemo } from 'react';\nimport { lastValueFrom } from 'rxjs';\n\nimport { PYROSCOPE_SERIES_DATA_SOURCE } from '../../infrastructure/pyroscope-data-sources';\n\ntype ProfileMetricOptions = Array<{\n  value: string;\n  label: string;\n  type: string;\n  group: string;\n}>;\n\ntype ProfileMetricVariableState = {\n  query: string;\n  skipUrlSync: boolean;\n};\n\nexport class ProfileMetricVariable extends QueryVariable {\n  static DEFAULT_VALUE = 'process_cpu:cpu:nanoseconds:cpu:nanoseconds';\n\n  // hack: subscribe to changes of dataSource only\n  static QUERY_DEFAULT = '$dataSource and all profile metrics';\n\n  // hack: subscribe to changes of dataSource and serviceName to avoid showing options that don't have any data associated\n  static QUERY_SERVICE_NAME_DEPENDENT = '$dataSource and only $serviceName profile metrics';\n\n  constructor(state?: ProfileMetricVariableState) {\n    super({\n      key: 'profileMetricId',\n      name: 'profileMetricId',\n      label: 'Profile type',\n      datasource: PYROSCOPE_SERIES_DATA_SOURCE,\n      query: ProfileMetricVariable.QUERY_DEFAULT,\n      loading: true,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      ...state,\n    });\n\n    this.changeValueTo = this.changeValueTo.bind(this);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    if (!this.state.value) {\n      this.setState({ value: ProfileMetricVariable.DEFAULT_VALUE });\n    }\n  }\n\n  async update(force = false) {\n    if (!force && this.state.loading) {\n      return;\n    }\n\n    let options: VariableValueOption[] = [];\n    let error = null;\n\n    this.setState({ loading: true, options: [], error: null });\n\n    try {\n      options = await lastValueFrom(this.getValueOptions({}));\n    } catch (e) {\n      error = e;\n    } finally {\n      this.setState({ loading: false, options, error });\n    }\n  }\n\n  static buildCascaderOptions(options: ProfileMetricOptions): CascaderOption[] {\n    const optionsMap = new Map();\n\n    for (const { value } of options) {\n      const profileMetric = getProfileMetric(value as ProfileMetricId);\n      const { group, type } = profileMetric;\n\n      const nameSpaceServices = optionsMap.get(group) || {\n        value: group,\n        label: group,\n        items: [],\n      };\n\n      const items = nameSpaceServices.items || [];\n\n      items.push({\n        value,\n        label: type,\n      });\n\n      nameSpaceServices.items = items;\n\n      optionsMap.set(group, nameSpaceServices);\n    }\n\n    return Array.from(optionsMap.values()).sort((a, b) => localeCompare(b.label, a.label));\n  }\n\n  onSelect = (newValue: string) => {\n    reportInteraction('g_pyroscope_app_profile_metric_selected');\n\n    if (!this.state.skipUrlSync) {\n      prepareHistoryEntry();\n    }\n    this.changeValueTo(newValue);\n  };\n\n  static Component = ({ model }: SceneComponentProps<MultiValueVariable & { onSelect?: any }>) => {\n    const styles = useStyles2(getStyles);\n    const { loading, value, options, error } = model.useState();\n\n    const cascaderOptions = useMemo(() => {\n      return ProfileMetricVariable.buildCascaderOptions(options as ProfileMetricOptions);\n    }, [options]);\n\n    if (error) {\n      return (\n        <Tooltip theme=\"error\" content={error.toString()}>\n          <Icon className={styles.iconError} name=\"exclamation-triangle\" size=\"xl\" />\n        </Tooltip>\n      );\n    }\n\n    return (\n      <Cascader\n        // we add a key to ensure that the Cascader selects the initial value or available options properly when landing on the page\n        // and when switching exploration types, because the value might also be changed after the component has been rendered by SceneProfilesExplorer\n        key={nanoid(5)}\n        aria-label=\"Profile metrics list\"\n        width={24}\n        separator=\"/\"\n        displayAllSelectedLevels\n        placeholder={loading ? 'Loading...' : `Select a profile metric (${options.length})`}\n        options={cascaderOptions}\n        initialValue={value as string}\n        changeOnSelect={false}\n        onSelect={model.onSelect}\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  iconError: css`\n    height: 32px;\n    align-self: center;\n    color: ${theme.colors.error.text};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { AdHocVariableFilter, GrafanaTheme2, VariableRefresh } from '@grafana/data';\nimport { MultiValueVariable, QueryVariable, SceneComponentProps, VariableValueOption } from '@grafana/scenes';\nimport { Cascader, Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { userStorage } from '@shared/infrastructure/userStorage';\nimport { nanoid } from 'nanoid';\nimport React, { useMemo } from 'react';\nimport { lastValueFrom } from 'rxjs';\n\nimport { PYROSCOPE_SERIES_DATA_SOURCE } from '../../../infrastructure/pyroscope-data-sources';\nimport { buildServiceNameCascaderOptions } from './domain/useBuildServiceNameOptions';\n\ntype ServiceNameVariableState = {\n  query?: string;\n  skipUrlSync?: boolean;\n  initialFilters?: AdHocVariableFilter[];\n};\n\nexport class ServiceNameVariable extends QueryVariable {\n  // hack: subscribe to changes of dataSource only\n  static QUERY_DEFAULT = '$dataSource and all services';\n\n  // hack: subscribe to changes of dataSource and profileMetricId\n  static QUERY_PROFILE_METRIC_DEPENDENT = '$dataSource and only $profileMetricId services';\n\n  private initialFilters?: AdHocVariableFilter[];\n\n  constructor(state?: ServiceNameVariableState) {\n    super({\n      key: 'serviceName',\n      name: 'serviceName',\n      label: 'Service',\n      datasource: PYROSCOPE_SERIES_DATA_SOURCE,\n      query: ServiceNameVariable.QUERY_DEFAULT,\n      loading: true,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      ...state,\n    });\n\n    this.initialFilters = state?.initialFilters;\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setInitialValue();\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.value && newState.value !== prevState.value) {\n        const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER) || {};\n        storage.serviceName = newState.value;\n        userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n      }\n    });\n  }\n\n  setInitialValue() {\n    const { serviceName: serviceNameFromStorage } = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER) || {};\n\n    const initialServiceName = this.initialFilters?.find(\n      (filter: AdHocVariableFilter) => filter.key === 'service_name' && filter.operator === '='\n    )?.value;\n\n    if (serviceNameFromStorage && !this.state.value && !initialServiceName) {\n      this.setState({ value: serviceNameFromStorage });\n    } else if (initialServiceName) {\n      this.setState({ value: initialServiceName });\n    }\n  }\n\n  async update() {\n    if (this.state.loading) {\n      return;\n    }\n\n    let options: VariableValueOption[] = [];\n    let error = null;\n\n    this.setState({ loading: true, options: [], error: null });\n\n    try {\n      options = await lastValueFrom(this.getValueOptions({}));\n    } catch (e) {\n      error = e;\n    } finally {\n      this.setState({ loading: false, options, error });\n    }\n  }\n\n  selectNewValue = (newValue: string) => {\n    reportInteraction('g_pyroscope_app_service_name_selected');\n\n    if (!this.state.skipUrlSync) {\n      prepareHistoryEntry();\n    }\n\n    this.changeValueTo(newValue);\n  };\n\n  static Component = ({ model }: SceneComponentProps<MultiValueVariable & { selectNewValue?: any }>) => {\n    const styles = useStyles2(getStyles);\n    const { loading, value, options, error } = model.useState();\n\n    const cascaderOptions = useMemo(\n      () => buildServiceNameCascaderOptions(options.map(({ label }) => label)),\n      [options]\n    );\n\n    if (error) {\n      return (\n        <Tooltip theme=\"error\" content={error.toString()}>\n          <Icon className={styles.iconError} name=\"exclamation-triangle\" size=\"xl\" />\n        </Tooltip>\n      );\n    }\n\n    return (\n      <Cascader\n        // we add a key to ensure that the Cascader selects the initial value properly when landing on the page\n        // and when switching exploration types, because the value might also be changed after the component has been rendered by SceneProfilesExplorer\n        // (e.g. in SceneExploreServiceProfileTypes)\n        // it's also required for supporting the Investigations app when opening a link with a different data source\n        // than the one currently selected\n        key={nanoid(5)}\n        aria-label=\"Services list\"\n        width={32}\n        separator=\"/\"\n        displayAllSelectedLevels\n        placeholder={loading ? 'Loading services...' : `Select a service (${options.length})`}\n        options={cascaderOptions}\n        initialValue={value as string}\n        changeOnSelect={false}\n        onSelect={model.selectNewValue}\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  iconError: css`\n    height: 32px;\n    align-self: center;\n    color: ${theme.colors.error.text};\n  `,\n});\n","import { CascaderOption } from '@grafana/ui';\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function buildServiceNameCascaderOptions(serviceNames: string[]) {\n  // Sort the service names to ensure consistent ordering\n  const sortedServiceNames = [...serviceNames].sort();\n\n  // Keep track of the root elements\n  const rootElements: CascaderOption[] = [];\n\n  // Create a map to store the hierarchy\n  const hierarchy = new Map<string, CascaderOption>();\n\n  for (const serviceId of sortedServiceNames) {\n    const parts = serviceId.split('/');\n    let currentPath = '';\n\n    for (let i = 0; i < parts.length; i++) {\n      const part = parts[i];\n      const previousPath = currentPath;\n      currentPath = currentPath ? `${currentPath}/${part}` : part;\n\n      const isComplete = i === parts.length - 1;\n\n      if (!hierarchy.has(currentPath) || isComplete) {\n        const option: CascaderOption = {\n          // the value needs to be different for a complete one vs the one that goes deeper otherwise it will not be selected.\n          value: isComplete ? currentPath : currentPath + '/',\n          label: part,\n          items: isComplete ? undefined : [],\n        };\n\n        // if the option is not complete it should be part of the hierachy\n        if (!isComplete) {\n          hierarchy.set(currentPath, option);\n        }\n\n        // Add to parent's items if not root level, other wise it will be added to the rootElements\n        if (previousPath) {\n          const parent = hierarchy.get(previousPath);\n          if (parent && parent.items) {\n            parent.items.push(option);\n          }\n        } else {\n          rootElements.push(option);\n        }\n      }\n    }\n  }\n  return rootElements;\n}\n","import { sceneGraph, SceneObject } from '@grafana/scenes';\nimport { useMemo } from 'react';\n\nimport { FiltersVariable } from './variables/FiltersVariable/FiltersVariable';\nimport { ProfileMetricVariable } from './variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from './variables/ServiceNameVariable/ServiceNameVariable';\n\nexport function useBuildPyroscopeQuery(sceneObject: SceneObject, filterKey: string) {\n  const { value: serviceName } = sceneGraph\n    .findByKeyAndType(sceneObject, 'serviceName', ServiceNameVariable)\n    .useState();\n\n  const { value: profileMetricId } = sceneGraph\n    .findByKeyAndType(sceneObject, 'profileMetricId', ProfileMetricVariable)\n    .useState();\n\n  const { filterExpression } = sceneGraph.findByKeyAndType(sceneObject, filterKey, FiltersVariable).useState();\n\n  return useMemo(\n    () => `${profileMetricId}{service_name=\"${serviceName}\",${filterExpression}}`,\n    [filterExpression, profileMetricId, serviceName]\n  );\n}\n","import { DataSourceVariable } from '@grafana/scenes';\nimport { ApiClient } from '@shared/infrastructure/http/ApiClient';\nimport { userStorage } from '@shared/infrastructure/userStorage';\n\nexport class ProfilesDataSourceVariable extends DataSourceVariable {\n  constructor({ initialDS }: { initialDS?: string }) {\n    super({\n      pluginId: 'grafana-pyroscope-datasource',\n      key: 'dataSource',\n      name: 'dataSource',\n      label: 'Data source',\n      skipUrlSync: true,\n      // we ensure that we'll always have the expected default data source (when the \"var-dataSource\" URL search param is missing, incorrect, etc.)\n      value: initialDS ?? ApiClient.selectDefaultDataSource().uid,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState({ skipUrlSync: false });\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.value && newState.value !== prevState.value) {\n        const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER) || {};\n        storage.dataSource = newState.value;\n        userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n      }\n    });\n  }\n}\n","import { AdHocVariableFilter } from '@grafana/data';\nimport { CompleteFilter, OperatorKind } from '@shared/components/QueryBuilder/domain/types';\n\nexport const convertPyroscopeToVariableFilter = (filter: CompleteFilter): AdHocVariableFilter => {\n  let newOperator = filter.operator.value;\n\n  if (filter.operator.value === OperatorKind['in']) {\n    newOperator = OperatorKind['=~'];\n  } else if (filter.operator.value === OperatorKind['not-in']) {\n    newOperator = OperatorKind['!~'];\n  }\n\n  return {\n    key: filter.attribute.value,\n    operator: newOperator,\n    value: filter.value.value,\n  };\n};\n\nfunction searchForFilter(filters: AdHocVariableFilter[], filterKey: string) {\n  let found: AdHocVariableFilter | undefined;\n\n  const filtersWithoutFound = filters.filter((f) => {\n    if (f.key === filterKey) {\n      found = f;\n      return false;\n    }\n\n    return true;\n  });\n\n  return { found, filtersWithoutFound };\n}\n\nconst addToFilters = (filters: AdHocVariableFilter[], filterToAdd: AdHocVariableFilter) => [...filters, filterToAdd];\n\nexport function includeLabelValue(\n  filters: AdHocVariableFilter[],\n  filterForInclude: AdHocVariableFilter\n): AdHocVariableFilter[] {\n  const { found, filtersWithoutFound } = searchForFilter(filters, filterForInclude.key);\n\n  if (!found) {\n    return addToFilters(filters, { ...filterForInclude, operator: '=~' });\n  }\n\n  if (['!~', '!='].includes(found.operator)) {\n    return addToFilters(filtersWithoutFound, { ...filterForInclude, operator: '=~' });\n  }\n\n  const foundValues = new Set(found.value.split('|'));\n\n  if (found.operator === '=~') {\n    return addToFilters(filtersWithoutFound, {\n      ...found,\n      value: Array.from(foundValues.add(filterForInclude.value)).join('|'),\n    });\n  }\n\n  // found.operator is '='\n  return found.value === filterForInclude.value\n    ? filters\n    : addToFilters(filtersWithoutFound, {\n        ...filterForInclude,\n        operator: '=~',\n        value: Array.from(foundValues.add(filterForInclude.value)).join('|'),\n      });\n}\n\nexport function excludeLabelValue(\n  filters: AdHocVariableFilter[],\n  filterForExclude: AdHocVariableFilter\n): AdHocVariableFilter[] {\n  const { found, filtersWithoutFound } = searchForFilter(filters, filterForExclude.key);\n\n  if (!found) {\n    return addToFilters(filters, { ...filterForExclude, operator: '!~' });\n  }\n\n  if (['=~', '='].includes(found.operator)) {\n    return addToFilters(filtersWithoutFound, { ...filterForExclude, operator: '!~' });\n  }\n\n  const foundValues = new Set(found.value.split('|'));\n\n  if (found.operator === '!~') {\n    return addToFilters(filtersWithoutFound, {\n      ...found,\n      value: Array.from(foundValues.add(filterForExclude.value)).join('|'),\n    });\n  }\n\n  // found.operator is '!='\n  return found.value === filterForExclude.value\n    ? filters\n    : addToFilters(filtersWithoutFound, {\n        ...filterForExclude,\n        operator: '!~',\n        value: Array.from(foundValues.add(filterForExclude.value)).join('|'),\n      });\n}\n\nexport function clearLabelValue(\n  filters: AdHocVariableFilter[],\n  filterForClear: AdHocVariableFilter\n): AdHocVariableFilter[] {\n  const { found, filtersWithoutFound } = searchForFilter(filters, filterForClear.key);\n\n  if (!found) {\n    return filters;\n  }\n\n  const filteredValues = found.value.split('|').filter((v) => v !== filterForClear.value);\n\n  if (filteredValues.length > 0) {\n    return addToFilters(filtersWithoutFound, {\n      ...found,\n      value: filteredValues.join('|'),\n    });\n  }\n\n  return [...filtersWithoutFound];\n}\n\nexport const isFilterValid = (filter: AdHocVariableFilter) => filter.operator in OperatorKind;\n","import { AdHocVariableFilter } from '@grafana/data';\nimport { AdHocFiltersVariable, SceneComponentProps, sceneGraph, SceneObject } from '@grafana/scenes';\nimport { CompleteFilters, OperatorKind } from '@shared/components/QueryBuilder/domain/types';\nimport { QueryBuilder } from '@shared/components/QueryBuilder/QueryBuilder';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { uniq } from 'lodash';\nimport React from 'react';\n\nimport { useBuildPyroscopeQuery } from '../../useBuildPyroscopeQuery';\nimport { ProfilesDataSourceVariable } from '../ProfilesDataSourceVariable';\nimport { convertPyroscopeToVariableFilter, isFilterValid } from './filters-ops';\n\nexport class FiltersVariable extends AdHocFiltersVariable {\n  static DEFAULT_VALUE = [];\n  private initialFilters?: AdHocVariableFilter[];\n\n  constructor({ key, initialFilters }: { key: string; initialFilters?: AdHocVariableFilter[] }) {\n    super({\n      key,\n      name: key,\n      label: 'Filters',\n      filters: FiltersVariable.DEFAULT_VALUE,\n      expressionBuilder: (filters) =>\n        filters\n          // after parsing the URL search parameters the filters might end up having an invalid operator, which in turn, will\n          // generate an invalid query that will make the API requests fail - we prevent this to happen by sanitizing the filters here\n          .filter(isFilterValid)\n          .map(({ key, operator, value }) =>\n            operator === OperatorKind['is-empty'] ? `${key}=\"\"` : `${key}${operator}\"${value}\"`\n          )\n          .join(','),\n    });\n    this.initialFilters = initialFilters;\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  reset() {\n    this.setState({ filters: FiltersVariable.DEFAULT_VALUE });\n  }\n\n  static resetAll(sceneObject: SceneObject) {\n    ['filters', 'filtersBaseline', 'filtersComparison'].forEach((filterKey) => {\n      sceneGraph.findByKeyAndType(sceneObject, filterKey, FiltersVariable).reset();\n    });\n  }\n\n  onActivate() {\n    this.setInitialValue();\n\n    // VariableDependencyConfig does not work :man_shrug: (never called)\n    const dataSourceSub = sceneGraph\n      .findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable)\n      .subscribeToState(() => {\n        this.reset();\n      });\n\n    return () => {\n      dataSourceSub.unsubscribe();\n    };\n  }\n\n  setInitialValue() {\n    if (this.initialFilters && this.initialFilters.length > 0) {\n      this.setState({ filters: this.initialFilters });\n    }\n  }\n\n  onChangeQuery = (query: string, filters: CompleteFilters) => {\n    reportInteraction('g_pyroscope_app_filters_changed', {\n      name: this.state.name,\n      count: filters.length,\n      operators: uniq(filters.map((f) => f.operator.label)),\n    });\n\n    this.setState({\n      filters: filters.map(convertPyroscopeToVariableFilter),\n    });\n  };\n\n  static Component = ({ model }: SceneComponentProps<AdHocFiltersVariable & { onChangeQuery?: any }>) => {\n    const { key } = model.useState();\n\n    const query = useBuildPyroscopeQuery(model, key as string);\n\n    const { value: dataSourceUid } = sceneGraph\n      .findByKeyAndType(model, 'dataSource', ProfilesDataSourceVariable)\n      .useState();\n\n    const { from, to } = sceneGraph.getTimeRange(model).state.value;\n\n    return (\n      <QueryBuilder\n        id={`query-builder-${key}`}\n        autoExecute\n        dataSourceUid={dataSourceUid as string}\n        query={query}\n        from={from.unix() * 1000}\n        to={to.unix() * 1000}\n        onChangeQuery={model.onChangeQuery}\n      />\n    );\n  };\n}\n","import { sceneGraph, SceneObject } from '@grafana/scenes';\n\nexport function getSceneVariableValue(sceneObject: SceneObject, variableName: string): string {\n  return sceneGraph.lookupVariable(variableName, sceneObject)?.getValue() as string;\n}\n","import {\n  SceneComponentProps,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nexport enum PanelType {\n  TIMESERIES = 'time-series',\n  BARGAUGE = 'bar-gauge',\n  TABLE = 'table',\n  HISTOGRAM = 'histogram',\n}\n\nexport interface ScenePanelTypeSwitcherState extends SceneObjectState {\n  panelType: PanelType;\n  onChange?: (panelType: PanelType) => void;\n}\n\nexport class ScenePanelTypeSwitcher extends SceneObjectBase<ScenePanelTypeSwitcherState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['panelType'] });\n\n  static OPTIONS = [\n    { label: 'Time series', value: PanelType.TIMESERIES, icon: 'heart-rate' },\n    { label: 'Totals', value: PanelType.BARGAUGE, icon: 'align-left' },\n    { label: 'Maxima', value: PanelType.TABLE, icon: 'angle-double-up' },\n    { label: 'Histograms', value: PanelType.HISTOGRAM, icon: 'graph-bar' },\n  ];\n\n  static DEFAULT_PANEL_TYPE = PanelType.TIMESERIES;\n\n  constructor() {\n    super({\n      key: 'panel-type-switcher',\n      panelType: ScenePanelTypeSwitcher.DEFAULT_PANEL_TYPE,\n    });\n  }\n\n  getUrlState() {\n    return {\n      panelType: this.state.panelType,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<ScenePanelTypeSwitcherState> = {};\n\n    if (typeof values.panelType === 'string' && values.panelType !== this.state.panelType) {\n      stateUpdate.panelType = Object.values(PanelType).includes(values.panelType as PanelType)\n        ? (values.panelType as PanelType)\n        : ScenePanelTypeSwitcher.DEFAULT_PANEL_TYPE;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  reset() {\n    this.setState({ panelType: ScenePanelTypeSwitcher.DEFAULT_PANEL_TYPE });\n  }\n\n  onChange = (panelType: PanelType) => {\n    reportInteraction('g_pyroscope_app_panel_type_changed', { panelType });\n\n    this.setState({ panelType });\n  };\n\n  static Component = ({ model }: SceneComponentProps<ScenePanelTypeSwitcher>) => {\n    const { panelType } = model.useState();\n\n    return (\n      <RadioButtonGroup\n        aria-label=\"Panel type switcher\"\n        options={ScenePanelTypeSwitcher.OPTIONS}\n        value={panelType}\n        onChange={model.onChange}\n        fullWidth={false}\n      />\n    );\n  };\n}\n","import { config } from '@grafana/runtime';\n\nexport function getColorByIndex(index: number) {\n  const visTheme = config.theme2.visualization;\n  return visTheme.getColorByName(visTheme.palette[index % 8]);\n}\n","import { Field } from '@grafana/data';\n\nexport const getSeriesLabelFieldName = (metricField: Field, label?: string) =>\n  metricField.labels?.[label as string] || '(no value)'; // metricField.labels can be empty when the ingested profiles do not have a label value set\n","import { DataFrame } from '@grafana/data';\n\nexport const getSeriesStatsValue = (series: DataFrame, displayName: string) =>\n  series.meta?.stats?.find((s) => s.displayName === displayName)?.value;\n","import { LoadingState } from '@grafana/data';\nimport { sceneGraph, SceneQueryRunner } from '@grafana/scenes';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nexport function withPreventInvalidQuery(queryRunner: SceneQueryRunner) {\n  queryRunner.addActivationHandler(() => {\n    const { profileTypeId, labelSelector } = queryRunner.state.queries[0];\n\n    if (!profileTypeId) {\n      queryRunner.setState({\n        queries: [{ refId: 'null' }],\n        data: buildErrorData(queryRunner, 'Missing profile type!'),\n      });\n      return;\n    }\n\n    if (!labelSelector) {\n      queryRunner.setState({\n        queries: [{ refId: 'null' }],\n        data: buildErrorData(queryRunner, 'Missing label selector!'),\n      });\n      return;\n    }\n\n    if (!sceneGraph.interpolate(queryRunner, '$profileMetricId')) {\n      queryRunner.setState({\n        queries: [{ refId: 'null' }],\n        data: buildErrorData(queryRunner, 'Missing profile type!'),\n      });\n      return;\n    }\n\n    const parsed = parseQuery(sceneGraph.interpolate(queryRunner, `$profileTypeId${labelSelector})`));\n\n    if (!parsed.serviceId) {\n      queryRunner.setState({\n        queries: [{ refId: 'null' }],\n        data: buildErrorData(queryRunner, 'Missing service name!'),\n      });\n    }\n  });\n\n  return queryRunner;\n}\n\nfunction buildErrorData(queryRunner: SceneQueryRunner, errorMsg: string) {\n  const error = new Error(errorMsg);\n\n  logger.error(error);\n\n  return {\n    state: LoadingState.Error,\n    errors: [error],\n    series: [],\n    timeRange: sceneGraph.getTimeRange(queryRunner).state.value,\n  };\n}\n","import { SceneQueryRunner } from '@grafana/scenes';\n\nimport { PYROSCOPE_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { withPreventInvalidQuery } from '../withPreventInvalidQuery';\nimport { TimeSeriesQueryRunnerParams } from './TimeSeriesQueryRunnerParams';\n\nexport type TimeSeriesQuery = {\n  refId: string;\n  queryType: 'metrics';\n  profileTypeId: string;\n  labelSelector: string;\n  groupBy: string[];\n};\n\nexport function buildTimeSeriesQueryRunner(\n  { serviceName, profileMetricId, groupBy, filters }: TimeSeriesQueryRunnerParams,\n  limit?: number,\n  annotations?: boolean\n) {\n  const completeFilters = filters ? [...filters] : [];\n  completeFilters.unshift({ key: 'service_name', operator: '=', value: serviceName || '$serviceName' });\n\n  const selector = completeFilters.map(({ key, operator, value }) => `${key}${operator}\"${value}\"`).join(',');\n\n  const queryRunner = new SceneQueryRunner({\n    datasource: PYROSCOPE_DATA_SOURCE,\n    queries: [\n      {\n        refId: `${profileMetricId || '$profileMetricId'}-${selector}-${groupBy?.label || 'no-group-by'}`,\n        queryType: 'metrics',\n        profileTypeId: profileMetricId || '$profileMetricId',\n        labelSelector: `{${selector},$filters}`,\n        groupBy: groupBy?.label ? [groupBy.label] : [],\n        limit,\n        annotations,\n      },\n    ],\n  });\n\n  return withPreventInvalidQuery(queryRunner);\n}\n","import { DataFrame } from '@grafana/data';\nimport { merge } from 'lodash';\nimport { map, Observable } from 'rxjs';\n\n// General note: because (e.g.) SceneLabelValuesTimeseries sets the data provider in its constructor, data can come as undefined, hence all the optional chaining operators\n// in the transformers below\n\nexport const addRefId = () => (source: Observable<DataFrame[]>) =>\n  source.pipe(map((data: DataFrame[]) => data?.map((d, i) => merge(d, { refId: `${d.refId}-${i}` }))));\n\nexport const addStats = () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) => {\n      const totalSeriesCount = data?.length;\n\n      // TODO: in case of a groupBy query, find a way to always add a rank to each label value (based on allValuesSum) so that we can use it as startColorIndex to\n      // always display each series consistently in the same color regardless of it's timseries, bar gauges with sums, or tables with maxima\n      return data?.map((d) => {\n        let maxValue = Number.NEGATIVE_INFINITY;\n\n        const allValuesSum = d.fields\n          ?.find((field) => field.type === 'number')\n          ?.values.reduce((acc: number, value: number) => {\n            if (value > maxValue) {\n              maxValue = value;\n            }\n            return acc + value;\n          }, 0);\n\n        return merge(d, {\n          meta: {\n            stats: [\n              {\n                displayName: 'totalSeriesCount',\n                value: totalSeriesCount,\n              },\n              {\n                displayName: 'allValuesSum',\n                value: allValuesSum,\n              },\n              {\n                displayName: 'maxValue',\n                value: maxValue,\n              },\n            ],\n          },\n        });\n      });\n    })\n  );\n","import { DataFrame, FieldMatcherID, LoadingState, ThresholdsMode, VizOrientation } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataTransformer,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { BarGaugeDisplayMode, BarGaugeNamePlacement, BarGaugeSizing, BarGaugeValueMode } from '@grafana/schema';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../domain/events/EventTimeseriesDataReceived';\nimport { getColorByIndex } from '../helpers/getColorByIndex';\nimport { getSeriesLabelFieldName } from '../infrastructure/helpers/getSeriesLabelFieldName';\nimport { getSeriesStatsValue } from '../infrastructure/helpers/getSeriesStatsValue';\nimport { buildTimeSeriesQueryRunner } from '../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { addRefId, addStats } from './SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from './SceneByVariableRepeaterGrid/types/GridItemData';\n\ninterface SceneLabelValuesBarGaugeState extends SceneObjectState {\n  body: VizPanel;\n}\n\nexport class SceneLabelValuesBarGauge extends SceneObjectBase<SceneLabelValuesBarGaugeState> {\n  constructor({\n    item,\n    headerActions,\n  }: {\n    item: GridItemData;\n    headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  }) {\n    super({\n      key: 'bar-gauge-label-values',\n      body: PanelBuilders.bargauge()\n        .setTitle(item.label)\n        .setData(\n          new SceneDataTransformer({\n            $data: buildTimeSeriesQueryRunner(item.queryRunnerParams),\n            transformations: [addRefId, addStats],\n          })\n        )\n        .setHeaderActions(headerActions(item))\n        .build(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item: GridItemData) {\n    const { body } = this.state;\n\n    const sub = (body.state.$data as SceneDataTransformer)!.subscribeToState((newState) => {\n      if (newState.data?.state !== LoadingState.Done) {\n        return;\n      }\n\n      const { series } = newState.data;\n\n      if (series?.length) {\n        body.setState(this.getConfig(item, series));\n      }\n\n      // we publish the event only after setting the new config so that the subscribers can modify it\n      this.publishEvent(new EventTimeseriesDataReceived({ series }), true);\n    });\n\n    return () => {\n      sub.unsubscribe();\n    };\n  }\n\n  getConfig(item: GridItemData, series: DataFrame[]) {\n    let max = Number.NEGATIVE_INFINITY;\n\n    for (const s of series) {\n      const allValuesSum = getSeriesStatsValue(s, 'allValuesSum') || 0;\n\n      if (allValuesSum > max) {\n        max = allValuesSum;\n      }\n    }\n\n    const groupByLabel = item.queryRunnerParams.groupBy?.label;\n\n    const description = groupByLabel ? 'This panel displays aggregate values over the current time period' : undefined;\n\n    return {\n      title: series.length > 1 ? `${item.label} (${series.length})` : item.label,\n      description,\n      options: {\n        reduceOptions: { values: false, calcs: ['sum'] },\n        orientation: VizOrientation.Horizontal,\n        displayMode: BarGaugeDisplayMode.Gradient,\n        valueMode: BarGaugeValueMode.Text,\n        showUnfilled: true,\n        sizing: BarGaugeSizing.Manual,\n        text: { titleSize: 13, valueSize: 13 },\n        namePlacement: BarGaugeNamePlacement.Top,\n        minVizHeight: 36,\n        maxVizHeight: 36,\n        legend: {\n          showLegend: false,\n        },\n      },\n      fieldConfig: {\n        defaults: {\n          // we force the label value because the overrides don't seem to work when we receive a single serie\n          displayName: series.length === 1 ? groupByLabel : undefined,\n          min: 0,\n          max,\n          thresholds: {\n            mode: ThresholdsMode.Percentage,\n            steps: [],\n          },\n        },\n        overrides: this.getOverrides(item, series),\n      },\n    };\n  }\n\n  getOverrides(item: GridItemData, series: DataFrame[]) {\n    const { index: startColorIndex, queryRunnerParams } = item;\n    const groupByLabel = queryRunnerParams.groupBy?.label;\n\n    return series.map((s, i) => ({\n      matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n      properties: [\n        {\n          id: 'displayName',\n          value: getSeriesLabelFieldName(s.fields[1], groupByLabel),\n        },\n        {\n          id: 'color',\n          value: { mode: 'fixed', fixedColor: getColorByIndex(startColorIndex + i) },\n        },\n      ],\n    }));\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesBarGauge>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { DataFrame, getValueFormat } from '@grafana/data';\n\nimport { getSeriesStatsValue } from '../infrastructure/helpers/getSeriesStatsValue';\n\nfunction isRateCalculatedByBackend(s: DataFrame): boolean {\n  const rateCalculated = s.meta?.custom?.rateCalculated;\n  return Boolean(rateCalculated);\n}\n\nexport function formatSingleSeriesDisplayName(label: string, s: DataFrame) {\n  const metricFieldUnit = s.fields[1]?.config?.unit || 'short';\n  const allValuesSum = getSeriesStatsValue(s, 'allValuesSum') || 0;\n  const maxValue = getSeriesStatsValue(s, 'maxValue') || 0;\n\n  const isRateCalculated = isRateCalculatedByBackend(s);\n\n  let displayValue: number;\n  let displayLabel: string;\n\n  if (isRateCalculated) {\n    // Show average of those rate values over the time period\n    const valueField = s.fields.find((f) => f.type === 'number');\n    const dataPointCount = valueField?.values?.length || 1;\n    displayValue = allValuesSum / dataPointCount;\n    displayLabel = 'avg';\n  } else {\n    // For instant profiles, show total\n    displayValue = allValuesSum;\n    displayLabel = 'total';\n  }\n\n  const displayFormatted = getValueFormat(metricFieldUnit)(displayValue);\n  const maxValueFormatted = getValueFormat(metricFieldUnit)(maxValue);\n\n  return `${displayLabel} ${label} = ${displayFormatted.text}${displayFormatted.suffix} / max = ${maxValueFormatted.text}${maxValueFormatted.suffix}`;\n}\n","import { DataFrame, FieldMatcherID, LoadingState } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataTransformer,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { SortOrder } from '@grafana/schema';\nimport { LegendDisplayMode, TooltipDisplayMode, VizLegendOptions } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../domain/events/EventTimeseriesDataReceived';\nimport { formatSingleSeriesDisplayName } from '../helpers/formatSingleSeriesDisplayName';\nimport { getColorByIndex } from '../helpers/getColorByIndex';\nimport { getSeriesLabelFieldName } from '../infrastructure/helpers/getSeriesLabelFieldName';\nimport { buildTimeSeriesQueryRunner } from '../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { addRefId, addStats } from './SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from './SceneByVariableRepeaterGrid/types/GridItemData';\n\ninterface SceneLabelValuesHistogramState extends SceneObjectState {\n  body: VizPanel;\n  legendPlacement: VizLegendOptions['placement'];\n}\n\nexport class SceneLabelValuesHistogram extends SceneObjectBase<SceneLabelValuesHistogramState> {\n  constructor({\n    item,\n    headerActions,\n    legendPlacement,\n  }: {\n    item: GridItemData;\n    headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n    legendPlacement?: SceneLabelValuesHistogramState['legendPlacement'];\n  }) {\n    super({\n      key: 'histogram-label-values',\n      legendPlacement: legendPlacement || 'bottom',\n      body: PanelBuilders.histogram()\n        .setTitle(item.label)\n        .setData(\n          new SceneDataTransformer({\n            $data: buildTimeSeriesQueryRunner(item.queryRunnerParams),\n            transformations: [addRefId, addStats],\n          })\n        )\n        .setHeaderActions(headerActions(item))\n        .build(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item: GridItemData) {\n    const { body } = this.state;\n\n    const sub = (body.state.$data as SceneDataTransformer)!.subscribeToState((newState) => {\n      if (newState.data?.state !== LoadingState.Done) {\n        return;\n      }\n\n      const { series } = newState.data;\n\n      if (series?.length) {\n        body.setState(this.getConfig(item, series));\n      }\n\n      // we publish the event only after setting the new config so that the subscribers can modify it\n      this.publishEvent(new EventTimeseriesDataReceived({ series }), true);\n    });\n\n    return () => {\n      sub.unsubscribe();\n    };\n  }\n\n  getConfig(item: GridItemData, series: DataFrame[]) {\n    const { legendPlacement } = this.state;\n    const groupByLabel = item.queryRunnerParams.groupBy?.label;\n\n    return {\n      title: series.length > 1 ? `${item.label} (${series.length})` : item.label,\n      options: {\n        tooltip: {\n          mode: TooltipDisplayMode.Single,\n          sort: SortOrder.None,\n        },\n        legend: {\n          showLegend: true,\n          displayMode: LegendDisplayMode.List,\n          placement: legendPlacement,\n          calcs: [],\n        },\n      },\n      fieldConfig: {\n        defaults: {\n          // we force the label value because the overrides don't seem to work when we receive a single serie\n          displayName: series.length === 1 ? groupByLabel : undefined,\n          custom: {\n            lineWidth: 1,\n          },\n        },\n        overrides: this.getOverrides(item, series),\n      },\n    };\n  }\n\n  getOverrides(item: GridItemData, series: DataFrame[]) {\n    const { index: startColorIndex, queryRunnerParams } = item;\n    const groupByLabel = queryRunnerParams.groupBy?.label;\n\n    return series.map((s, i) => {\n      const metricField = s.fields[1];\n      let displayName = groupByLabel ? getSeriesLabelFieldName(metricField, groupByLabel) : metricField.name;\n\n      if (series.length === 1) {\n        displayName = formatSingleSeriesDisplayName(displayName, s);\n      }\n\n      return {\n        matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n        properties: [\n          {\n            id: 'displayName',\n            value: displayName,\n          },\n          {\n            id: 'color',\n            value: { mode: 'fixed', fixedColor: getColorByIndex(startColorIndex + i) },\n          },\n        ],\n      };\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesHistogram>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { css } from '@emotion/css';\nimport { DataFrame, DataTransformerID, LoadingState } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../domain/events/EventTimeseriesDataReceived';\nimport { ProfileMetricVariable } from '../domain/variables/ProfileMetricVariable';\nimport { getColorByIndex } from '../helpers/getColorByIndex';\nimport { buildTimeSeriesQueryRunner } from '../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { GridItemData } from './SceneByVariableRepeaterGrid/types/GridItemData';\n\ninterface SceneLabelValuesTableState extends SceneObjectState {\n  body: VizPanel;\n}\n\nexport class SceneLabelValuesTable extends SceneObjectBase<SceneLabelValuesTableState> {\n  constructor({\n    item,\n    headerActions,\n  }: {\n    item: GridItemData;\n    headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  }) {\n    super({\n      key: 'table-label-values',\n      body: PanelBuilders.table()\n        .setTitle(item.label)\n        .setData(\n          new SceneDataTransformer({\n            $data: buildTimeSeriesQueryRunner(item.queryRunnerParams),\n            transformations: [\n              {\n                id: DataTransformerID.reduce,\n                options: {\n                  reducers: ['max'],\n                  labelsToFields: true,\n                },\n              },\n              {\n                id: DataTransformerID.filterFieldsByName,\n                options: {\n                  exclude: {\n                    names: ['Field'],\n                  },\n                },\n              },\n              {\n                id: DataTransformerID.renameByRegex,\n                options: {\n                  regex: 'Max',\n                  renamePattern: 'max',\n                },\n              },\n              {\n                id: DataTransformerID.sortBy,\n                options: {\n                  sort: [\n                    {\n                      field: 'max',\n                      desc: true,\n                    },\n                  ],\n                },\n              },\n            ],\n          })\n        )\n        .setHeaderActions(headerActions(item))\n        .build(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item: GridItemData) {\n    const { body } = this.state;\n\n    const sub = (body.state.$data as SceneDataTransformer)!.subscribeToState((newState) => {\n      if (newState.data?.state !== LoadingState.Done) {\n        return;\n      }\n\n      const { series } = newState.data;\n\n      if (series?.length) {\n        body.setState(this.getConfig(item, series));\n      }\n\n      // we publish the event only after setting the new config so that the subscribers can modify it\n      this.publishEvent(new EventTimeseriesDataReceived({ series }), true);\n    });\n\n    return () => {\n      sub.unsubscribe();\n    };\n  }\n\n  getConfig(item: GridItemData, series: DataFrame[]) {\n    const cardinality = series[0].fields[0].values.length;\n\n    const profileMetricId = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable).state\n      .value as ProfileMetricId;\n    const profileMetric = getProfileMetric(profileMetricId);\n    const unitValue = profileMetric.unit;\n\n    return {\n      title: cardinality > 1 ? `${item.label} (${cardinality})` : item.label,\n      fieldConfig: {\n        defaults: {\n          custom: {\n            filterable: true,\n            cellOptions: {},\n          },\n        },\n        overrides: [\n          {\n            matcher: {\n              id: 'byName',\n              options: 'max',\n            },\n            properties: [\n              {\n                id: 'unit',\n                value: unitValue,\n              },\n              {\n                id: 'custom.width',\n                value: 100,\n              },\n            ],\n          },\n        ],\n      },\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesTable>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { body } = model.useState();\n\n    return (\n      <span className={styles.container}>\n        <body.Component model={body} />\n      </span>\n    );\n  }\n}\n\nconst getStyles = () => ({\n  // couldn't find a better way just by configuring the table panel :man_shrug:\n  container: css`\n    [data-testid='data-testid table body'] [role='row']:first-child {\n      color: ${getColorByIndex(3)};\n      font-weight: 500;\n    }\n  `,\n});\n","import { TimeRange } from '@grafana/data';\n\nexport function computeRoundedTimeRange(timeRange: TimeRange) {\n  // round to 10s\n  return {\n    from: Math.floor((timeRange.from.valueOf() || 0) / 10000) * 10000,\n    to: Math.floor((timeRange.to.valueOf() || 0) / 10000) * 10000,\n  };\n}\n","import { sceneGraph, SceneObject } from '@grafana/scenes';\n\n// When URL sync/context is not initialized yet, interpolation can throw due to missing $variables.\n// Fall back to empty strings to avoid hard errors during variable bootstrap.\nexport function safeInterpolate(sceneObject: SceneObject | undefined, expr: string): string {\n  try {\n    return sceneGraph.interpolate(sceneObject as any, expr) ?? '';\n  } catch {\n    return '';\n  }\n}\n","import {\n  DataQueryResponse,\n  FieldType,\n  LegacyMetricFindQueryOptions,\n  LoadingState,\n  MetricFindValue,\n  TestDataSourceResponse,\n  TimeRange,\n} from '@grafana/data';\nimport { RuntimeDataSource } from '@grafana/scenes';\nimport { isPrivateLabel } from '@shared/components/QueryBuilder/domain/helpers/isPrivateLabel';\nimport { labelsRepository } from '@shared/infrastructure/labels/labelsRepository';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport pLimit from 'p-limit';\n\nimport { GroupByVariable } from '../../domain/variables/GroupByVariable/GroupByVariable';\nimport { computeRoundedTimeRange } from '../../helpers/computeRoundedTimeRange';\nimport { PYROSCOPE_LABELS_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { safeInterpolate } from '../series/helpers/safeInterpolate';\nimport { LabelsApiClient } from './http/LabelsApiClient';\n\nconst MAX_CONCURRENT_LABEL_VALUES_REQUESTS = 20;\nconst limit = pLimit(MAX_CONCURRENT_LABEL_VALUES_REQUESTS);\n\nexport class LabelsDataSource extends RuntimeDataSource {\n  static MAX_TIMESERIES_LABEL_VALUES = 10;\n\n  constructor() {\n    super(PYROSCOPE_LABELS_DATA_SOURCE.type, PYROSCOPE_LABELS_DATA_SOURCE.uid);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Labels',\n          fields: [\n            {\n              name: 'Label',\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  getParams(options: LegacyMetricFindQueryOptions) {\n    const { scopedVars, range } = options;\n    const sceneObject = scopedVars?.__sceneObject?.valueOf() as GroupByVariable;\n\n    const dataSourceUid = safeInterpolate(sceneObject, '$dataSource');\n    const serviceName = safeInterpolate(sceneObject, '$serviceName');\n    const profileMetricId = safeInterpolate(sceneObject, '$profileMetricId');\n\n    // we could interpolate ad hoc filters, but the Labels exploration type would reload all labels each time they are modified\n    // const filters = sceneGraph.interpolate(sceneObject, '$filters');\n    // const pyroscopeQuery = `${profileMetricId}{service_name=\"${serviceName}\",${filters}}`;\n    const query = `${profileMetricId}{service_name=\"${serviceName}\"}`;\n\n    const { from, to } = computeRoundedTimeRange(range as TimeRange);\n\n    return {\n      dataSourceUid,\n      serviceName,\n      profileMetricId,\n      query,\n      from,\n      to,\n    };\n  }\n\n  async fetchLabels(dataSourceUid: string, query: string, from: number, to: number, variableName?: string) {\n    labelsRepository.setApiClient(new LabelsApiClient({ dataSourceUid }));\n\n    try {\n      return await labelsRepository.listLabels({ query, from, to });\n    } catch (error) {\n      logger.error(error as Error, {\n        info: 'Error while loading Pyroscope label names!',\n        variableName: variableName || '',\n      });\n\n      throw error;\n    }\n  }\n\n  async fetchLabelValues(\n    index: number,\n    query: string,\n    from: number,\n    to: number,\n    labelName: string,\n    variableName?: string\n  ) {\n    let values;\n\n    try {\n      values = await labelsRepository.listLabelValues({ query, from, to, label: labelName });\n    } catch (error) {\n      logger.error(error as Error, {\n        info: 'Error while loading Pyroscope label values!',\n        variableName: variableName || '',\n      });\n    }\n\n    const count = values ? values.length : -1;\n\n    return {\n      value: {\n        value: labelName,\n        groupBy: {\n          label: labelName,\n          values: values || [],\n        },\n      },\n      text: `${labelName} (${count > -1 ? count : '?'})`,\n      count,\n    };\n  }\n\n  async metricFindQuery(_: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.valueOf() as GroupByVariable;\n\n    // save bandwidth\n    // TODO: remove this when we can declare the GroupByVariable in the Scene it's used\n    // without messing up the variable URL sync\n    if (!sceneObject.isActive) {\n      return [];\n    }\n\n    const { dataSourceUid, serviceName, profileMetricId, query, from, to } = this.getParams(options);\n\n    if (!serviceName || !profileMetricId) {\n      logger.warn(\n        'LabelsDataSource: either serviceName=\"%s\" and/or profileMetricId=\"%s\" is empty! Discarding request.',\n        serviceName,\n        profileMetricId\n      );\n      return [];\n    }\n\n    const labels = await this.fetchLabels(dataSourceUid, query, from, to, options.variable?.name);\n\n    const labelsWithValuesAndCount = await Promise.all(\n      labels\n        .filter(({ value }) => !isPrivateLabel(value))\n        .map(({ value }, index) =>\n          limit(() => this.fetchLabelValues(index, query, from, to, value, options.variable?.name))\n        )\n    );\n\n    const sortedLabels = labelsWithValuesAndCount\n      .sort((a, b) => b.count - a.count)\n      .map(({ value, text }, index) => {\n        return {\n          // TODO: check if there's a better way\n          value: JSON.stringify({ ...value, index }),\n          text,\n        };\n      });\n\n    return [\n      // we do this here because GroupByVariable may set its default value to the 1st element automatically\n      {\n        value: 'all',\n        text: 'All',\n      },\n      ...sortedLabels,\n    ];\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","import { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\n\nexport function getProfileMetricLabel(profileMetricId: string) {\n  const profileMetric = getProfileMetric(profileMetricId as ProfileMetricId);\n  return `${profileMetric.type} (${profileMetric.group})`;\n}\n","import { PanelMenuItem, PluginExtensionLink } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport {\n  SceneComponentProps,\n  SceneDataQuery,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VizPanelMenu,\n} from '@grafana/scenes';\nimport { ScaleDistribution, ScaleDistributionConfig } from '@grafana/schema';\nimport PyroscopeLogo from '@img/logo.svg';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\nimport { nanoid } from 'nanoid';\nimport React, { useEffect, useMemo } from 'react';\n\nimport {\n  INVESTIGATIONS_APP_ID,\n  INVESTIGATIONS_EXTENSTION_POINT_ID,\n  useGetPluginExtensionLink,\n} from '../../domain/useGetPluginExtensionLink';\nimport { getExploreUrl } from '../../helpers/getExploreUrl';\nimport { getProfileMetricLabel } from '../../infrastructure/series/helpers/getProfileMetricLabel';\nimport { TimeSeriesQuery } from '../../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { SceneLabelValuesTimeseries } from './SceneLabelValuesTimeseries';\n\ninterface SceneTimeseriesMenuState extends SceneObjectState {\n  items?: PanelMenuItem[];\n  scaleType?: ScaleDistribution;\n}\n\nconst SCALE_TYPES = [\n  {\n    text: 'Linear',\n    scaleDistribution: { type: ScaleDistribution.Linear },\n  },\n  {\n    text: 'Log2',\n    scaleDistribution: { type: ScaleDistribution.Log, log: 2 },\n  },\n];\n\nexport class SceneTimeseriesMenu extends SceneObjectBase<SceneTimeseriesMenuState> {\n  constructor(state: SceneTimeseriesMenuState) {\n    super({\n      scaleType: ScaleDistribution.Linear,\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState({ items: this.buildMenuItems() });\n  }\n\n  buildMenuItems(addToInvestigationLink?: PluginExtensionLink): PanelMenuItem[] {\n    const { items, scaleType } = this.state;\n\n    const menuItems: PanelMenuItem[] = [\n      {\n        text: 'Scale type',\n        type: 'group',\n        subMenu: SCALE_TYPES.map((option) => ({\n          text: `${scaleType === option.scaleDistribution.type ? ' ' : ''}${option.text}`,\n          onClick: () => this.onClickScaleOption(option),\n        })),\n      },\n      {\n        type: 'divider',\n        text: '',\n      },\n      {\n        iconClassName: 'compass',\n        text: 'Open in Explore',\n        onClick: () => this.onClickExplore(),\n      },\n    ];\n\n    if (addToInvestigationLink) {\n      menuItems.push({\n        iconClassName: 'plus-square',\n        text: 'Add to investigation (beta)',\n        onClick: () => {\n          addToInvestigationLink.onClick!();\n        },\n      });\n    } else {\n      const existingAddToInvestigationItem = items?.find((i) => i.text.includes('Add to investigation'));\n\n      if (existingAddToInvestigationItem) {\n        menuItems.push({ ...existingAddToInvestigationItem });\n      }\n    }\n\n    return menuItems;\n  }\n\n  onClickScaleOption(option: PanelMenuItem & { scaleDistribution: ScaleDistributionConfig }) {\n    const { scaleDistribution, text } = option;\n\n    reportInteraction('g_pyroscope_app_timeseries_scale_changed', { scale: scaleDistribution.type });\n\n    const timeseries = sceneGraph.getAncestor(this, SceneLabelValuesTimeseries);\n\n    timeseries.changeScale(scaleDistribution, text);\n\n    this.setState({\n      scaleType: scaleDistribution.type,\n      items: this.buildMenuItems(),\n    });\n  }\n\n  onClickExplore() {\n    reportInteraction('g_pyroscope_app_open_in_explore_clicked');\n\n    const rawTimeRange = sceneGraph.getTimeRange(this).state.value.raw;\n    const query = this.getInterpolatedQuery();\n    const datasource = sceneGraph.interpolate(this, '${dataSource}');\n\n    const exploreUrl = getExploreUrl(rawTimeRange, query, datasource);\n\n    window.open(exploreUrl, '_blank');\n  }\n\n  getInterpolatedQuery() {\n    const timeseries = sceneGraph.getAncestor(this, SceneLabelValuesTimeseries);\n    const queryRunner = timeseries.state.body.state.$data?.state.$data as SceneQueryRunner;\n    const nonInterpolatedQuery = queryRunner?.state.queries[0] as SceneDataQuery;\n\n    return Object.entries(nonInterpolatedQuery)\n      .map(([key, value]) => [key, typeof value === 'string' ? sceneGraph.interpolate(this, value) : value])\n      .reduce(\n        (acc, [key, value]) => ({\n          ...acc,\n          [key]: value,\n        }),\n        {}\n      ) as TimeSeriesQuery;\n  }\n\n  useGetInvestigationPluginLinkContext() {\n    const { refId, queryType, profileTypeId, labelSelector, groupBy } = this.getInterpolatedQuery();\n\n    const parsedQuery = parseQuery(`${profileTypeId}${labelSelector}`);\n    const titleParts = [parsedQuery.serviceId, getProfileMetricLabel(parsedQuery.profileMetricId)];\n\n    if (groupBy?.length) {\n      titleParts.push(groupBy[0]);\n    }\n\n    if (parsedQuery.labels.length) {\n      titleParts.push(parsedQuery.labels.join(', '));\n    }\n\n    const title = titleParts.join('  ');\n    const datasource = sceneGraph.interpolate(this, '${dataSource}');\n    const timeRange = sceneGraph.getTimeRange(this).state.value;\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    return useMemo(() => {\n      return {\n        id: nanoid(),\n        origin: 'Grafana Profiles Drilldown',\n        url: window.location.href,\n        logoPath: PyroscopeLogo,\n        title,\n        type: 'timeseries',\n        timeRange: { ...timeRange },\n        queries: [{ refId, queryType, profileTypeId, labelSelector, groupBy }],\n        datasource,\n      };\n    }, [datasource, groupBy, labelSelector, profileTypeId, queryType, refId, timeRange, title]);\n  }\n\n  useUpdateMenuItems() {\n    const context = this.useGetInvestigationPluginLinkContext();\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const link = useGetPluginExtensionLink({\n      extensionPointId: INVESTIGATIONS_EXTENSTION_POINT_ID,\n      context,\n      pluginId: INVESTIGATIONS_APP_ID,\n    });\n\n    // wrapped in a useEffect to prevent a warning when clicking on the \"Add to investigation\" link\n    // (\"Cannot update a component while rendering a different component\")\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    useEffect(() => {\n      if (link) {\n        this.setState({ items: this.buildMenuItems(link) });\n      }\n    }, [link]);\n  }\n\n  static Component({ model }: SceneComponentProps<SceneTimeseriesMenu>) {\n    model.useUpdateMenuItems();\n\n    return <VizPanelMenu.Component model={model as unknown as VizPanelMenu} />;\n  }\n}\n","import { RawTimeRange, toURLRange, urlUtil } from '@grafana/data';\nimport { config } from '@grafana/runtime';\n\nimport { TimeSeriesQuery } from '../infrastructure/timeseries/buildTimeSeriesQueryRunner';\n\nexport function getExploreUrl(rawTimeRange: RawTimeRange, query: TimeSeriesQuery, datasource: string): string {\n  const exploreState = JSON.stringify({\n    ['pyroscope-explore']: {\n      range: toURLRange(rawTimeRange),\n      queries: [{ ...query, datasource }],\n      panelsState: {},\n      datasource,\n    },\n  });\n\n  const subUrl = config.appSubUrl ?? '';\n\n  return urlUtil.renderUrl(`${subUrl}/explore`, {\n    panes: exploreState,\n    schemaVersion: 1,\n  });\n}\n","import { PluginExtensionLink } from '@grafana/data';\nimport { usePluginLinks } from '@grafana/runtime';\n\nexport const INVESTIGATIONS_EXTENSTION_POINT_ID = 'grafana-pyroscope-app/investigation/v1';\nexport const INVESTIGATIONS_APP_ID = 'grafana-investigations-app';\n\ntype UseGetPluginLinkParams = {\n  extensionPointId: string;\n  context?: object | Record<string | symbol, unknown>;\n  pluginId: string;\n};\n\nexport function useGetPluginExtensionLink({\n  extensionPointId,\n  context,\n  pluginId,\n}: UseGetPluginLinkParams): PluginExtensionLink | undefined {\n  const pluginLinks = usePluginLinks({ extensionPointId, context });\n\n  const [link] = pluginLinks.links.filter((link) => link.pluginId === pluginId);\n\n  return link;\n}\n","import { DataFrame, FieldMatcherID, LoadingState } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataProvider,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VizPanel,\n  VizPanelMenu,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { GraphGradientMode, ScaleDistribution, ScaleDistributionConfig, SortOrder } from '@grafana/schema';\nimport { LegendDisplayMode, TooltipDisplayMode, VizLegendOptions } from '@grafana/ui';\nimport { isEqual, merge } from 'lodash';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../../domain/events/EventTimeseriesDataReceived';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { formatSingleSeriesDisplayName } from '../../helpers/formatSingleSeriesDisplayName';\nimport { getColorByIndex } from '../../helpers/getColorByIndex';\nimport { getSeriesLabelFieldName } from '../../infrastructure/helpers/getSeriesLabelFieldName';\nimport { LabelsDataSource } from '../../infrastructure/labels/LabelsDataSource';\nimport { buildTimeSeriesQueryRunner } from '../../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { addRefId, addStats } from '../SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneTimeseriesMenu } from './SceneTimeseriesMenu';\n\ninterface SceneLabelValuesTimeseriesState extends SceneObjectState {\n  item: GridItemData;\n  headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  body: VizPanel;\n  displayAllValues: boolean;\n  legendPlacement: VizLegendOptions['placement'];\n  overrides?: (series: DataFrame[]) => VizPanelState['fieldConfig']['overrides'];\n}\n\nexport class SceneLabelValuesTimeseries extends SceneObjectBase<SceneLabelValuesTimeseriesState> {\n  constructor({\n    item,\n    headerActions,\n    displayAllValues,\n    legendPlacement,\n    data,\n    overrides,\n    annotations,\n  }: {\n    item: SceneLabelValuesTimeseriesState['item'];\n    headerActions: SceneLabelValuesTimeseriesState['headerActions'];\n    displayAllValues?: SceneLabelValuesTimeseriesState['displayAllValues'];\n    legendPlacement?: SceneLabelValuesTimeseriesState['legendPlacement'];\n    data?: SceneDataTransformer;\n    overrides?: SceneLabelValuesTimeseriesState['overrides'];\n    annotations?: boolean;\n  }) {\n    super({\n      key: 'timeseries-label-values',\n      item,\n      headerActions,\n      displayAllValues: Boolean(displayAllValues),\n      legendPlacement: legendPlacement || 'bottom',\n      overrides,\n      body: PanelBuilders.timeseries()\n        .setTitle(item.label)\n        .setData(\n          data ||\n            new SceneDataTransformer({\n              $data: buildTimeSeriesQueryRunner(\n                item.queryRunnerParams,\n                displayAllValues ? undefined : LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES,\n                annotations\n              ),\n              transformations: [addRefId, addStats],\n            })\n        )\n        .setHeaderActions(headerActions(item))\n        .setMenu(new SceneTimeseriesMenu({}) as unknown as VizPanelMenu)\n        .build(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const { body } = this.state;\n\n    const dataSub = (body.state.$data as SceneDataProvider).subscribeToState(this.handleDataStateChange.bind(this));\n\n    const profileMetricSub = this.subscribeToProfileMetricChanges();\n\n    return () => {\n      dataSub.unsubscribe();\n      profileMetricSub?.unsubscribe();\n    };\n  }\n\n  private handleDataStateChange(newState: any, prevState: any) {\n    if (newState.data?.state !== LoadingState.Done) {\n      return;\n    }\n\n    this.retainPreviousAnnotations(newState, prevState);\n\n    const { series } = newState.data;\n\n    if (series?.length) {\n      this.updateBodyConfig(series);\n    }\n\n    this.publishEvent(new EventTimeseriesDataReceived({ series }), true);\n  }\n\n  private retainPreviousAnnotations(newState: any, prevState: any) {\n    if (!newState.data.annotations?.length && prevState.data?.annotations?.length) {\n      newState.data.annotations = prevState.data.annotations;\n    }\n  }\n\n  private updateBodyConfig(series: DataFrame[]) {\n    const { body } = this.state;\n    const config = this.state.displayAllValues ? this.getAllValuesConfig(series) : this.getConfig(series);\n    body.setState(merge({}, body.state, config));\n  }\n\n  private subscribeToProfileMetricChanges() {\n    try {\n      const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n      return profileMetricVariable.subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.handleProfileMetricChange();\n        }\n      });\n    } catch (error) {\n      return null;\n    }\n  }\n\n  private handleProfileMetricChange() {\n    const { body } = this.state;\n    const currentData = (body.state.$data as SceneDataProvider).state.data;\n    if (currentData?.series?.length) {\n      this.updateBodyConfig(currentData.series);\n    }\n  }\n\n  getConfig(series: DataFrame[]) {\n    const { body, item, legendPlacement } = this.state;\n    let { title } = body.state;\n    let description;\n\n    if (item.queryRunnerParams.groupBy?.label) {\n      title = series.length > 1 ? `${item.label} (${series.length})` : item.label;\n      description = this.buildDescription(item.queryRunnerParams.groupBy!);\n    }\n\n    return {\n      title,\n      description,\n      options: {\n        tooltip: {\n          mode: 'single',\n          sort: 'none',\n        },\n        legend: {\n          showLegend: true,\n          displayMode: 'list',\n          placement: legendPlacement,\n        },\n      },\n      fieldConfig: {\n        defaults: {\n          min: 0,\n          custom: {\n            fillOpacity: series.length >= LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES ? 0 : 9,\n            gradientMode: series.length === 1 ? GraphGradientMode.None : GraphGradientMode.Opacity,\n            pointSize: 3,\n          },\n        },\n        overrides: this.getOverrides(series),\n      },\n    };\n  }\n\n  buildDescription(groupBy: GridItemData['queryRunnerParams']['groupBy']) {\n    if (!groupBy) {\n      return '';\n    }\n\n    // this case is for favorites: they are stored in localStorage without the `values` array\n    if (!groupBy!.values) {\n      return `Showing only ${LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES} series to preserve readability. To view all the series, click on the expand icon on this panel.`;\n    }\n\n    if (groupBy!.values.length > LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES) {\n      return `Showing only ${LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES} out of ~${\n        groupBy!.values.length\n      } series to preserve readability. To view all the series for the current filters, click on the expand icon on this panel.`;\n    }\n\n    return '';\n  }\n\n  getAllValuesConfig(series: DataFrame[]) {\n    const { legendPlacement } = this.state;\n\n    return {\n      options: {\n        tooltip: {\n          mode: TooltipDisplayMode.Single,\n          sort: SortOrder.None,\n        },\n        legend: {\n          showLegend: true,\n          displayMode: LegendDisplayMode.List,\n          placement: legendPlacement,\n          calcs: [],\n        },\n      },\n      fieldConfig: {\n        defaults: {\n          min: 0,\n          custom: {\n            fillOpacity: 0,\n            pointSize: 5,\n          },\n        },\n        overrides: this.getOverrides(series),\n      },\n    };\n  }\n\n  getOverrides(series: DataFrame[]) {\n    if (this.state.overrides) {\n      return this.state.overrides(series);\n    }\n\n    const { item } = this.state;\n    const groupByLabel = item.queryRunnerParams.groupBy?.label;\n\n    return series.map((s, i) => {\n      const metricField = s.fields[1];\n      let displayName = groupByLabel ? getSeriesLabelFieldName(metricField, groupByLabel) : metricField.name;\n\n      displayName = formatSingleSeriesDisplayName(displayName, s);\n\n      const properties = [\n        {\n          id: 'displayName',\n          value: displayName,\n        },\n        {\n          id: 'color',\n          value: { mode: 'fixed', fixedColor: getColorByIndex(item.index + i) },\n        },\n      ];\n\n      return {\n        matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n        properties,\n      };\n    });\n  }\n\n  updateItem(partialItem: Partial<GridItemData>) {\n    const { item, headerActions, body } = this.state;\n    const updatedItem = merge({}, item, partialItem);\n\n    if (partialItem.queryRunnerParams?.hasOwnProperty('groupBy')) {\n      if (partialItem.queryRunnerParams.groupBy === undefined) {\n        delete updatedItem.queryRunnerParams.groupBy;\n      } else {\n        // we completely replace groupBy because merge() above concatenates groupBy.values\n        updatedItem.queryRunnerParams.groupBy = partialItem.queryRunnerParams.groupBy;\n      }\n    }\n\n    if (\n      partialItem.queryRunnerParams?.hasOwnProperty('filters') &&\n      partialItem.queryRunnerParams.filters === undefined\n    ) {\n      delete updatedItem.queryRunnerParams.filters;\n    }\n\n    this.setState({ item: updatedItem });\n\n    body.setState({\n      title: partialItem.label,\n      description: this.buildDescription(updatedItem.queryRunnerParams.groupBy),\n      headerActions: headerActions(updatedItem),\n    });\n\n    if (!isEqual(item.queryRunnerParams, updatedItem.queryRunnerParams)) {\n      const { queries } = buildTimeSeriesQueryRunner(\n        updatedItem.queryRunnerParams,\n        LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES\n      ).state;\n\n      const queryRunner = body.state.$data?.state.$data as SceneQueryRunner;\n\n      // this allows us not to have to subscribe to the data provider changes as we do in onActivate() above\n      queryRunner?.setState({ queries });\n      queryRunner?.runQueries();\n    }\n  }\n\n  changeScale(scaleDistribution: ScaleDistributionConfig, axisLabel: string) {\n    const { body } = this.state;\n\n    body.clearFieldConfigCache();\n\n    body.setState({\n      fieldConfig: merge({}, body.state.fieldConfig, {\n        defaults: {\n          custom: {\n            scaleDistribution,\n            axisLabel: scaleDistribution.type !== ScaleDistribution.Linear ? axisLabel : '',\n          },\n        },\n      }),\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesTimeseries>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { PanelType } from '../components/SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneLabelValuesBarGauge } from '../components/SceneLabelValuesBarGauge';\nimport { SceneLabelValuesHistogram } from '../components/SceneLabelValuesHistogram';\nimport { SceneLabelValuesTable } from '../components/SceneLabelValuesTable';\nimport { SceneLabelValuesTimeseries } from '../components/SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\n\nexport function vizPanelBuilder(panelType: PanelType, options: any) {\n  switch (panelType) {\n    case PanelType.BARGAUGE:\n      return new SceneLabelValuesBarGauge(options);\n\n    case PanelType.TABLE:\n      return new SceneLabelValuesTable(options);\n\n    case PanelType.HISTOGRAM:\n      return new SceneLabelValuesHistogram(options);\n\n    case PanelType.TIMESERIES:\n    default:\n      return new SceneLabelValuesTimeseries(options);\n  }\n}\n","import { throttle } from 'lodash';\nimport { useEffect, useState } from 'react';\n\ninterface MousePosition {\n  x: number | null;\n  y: number | null;\n}\n\n// For performance reasons, we throttle the mouse position updates\nconst DEFAULT_THROTTLE_INTERVAL_MS = 50;\n\nconst useMousePosition = (throttleInterval = DEFAULT_THROTTLE_INTERVAL_MS) => {\n  const [mousePosition, setMousePosition] = useState<MousePosition>({ x: null, y: null });\n\n  useEffect(() => {\n    const updateMousePosition = throttle((event: MouseEvent) => {\n      setMousePosition({ x: event.clientX, y: event.clientY });\n    }, throttleInterval);\n    window.addEventListener('mousemove', updateMousePosition);\n\n    return () => {\n      window.removeEventListener('mousemove', updateMousePosition);\n    };\n  }, [throttleInterval]);\n\n  return mousePosition;\n};\n\nexport default useMousePosition;\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2, useTheme2 } from '@grafana/ui';\nimport React, { SVGProps } from 'react';\nimport SVG from 'react-inlinesvg';\n\nimport dark404 from './img/grot-404-dark.svg';\nimport light404 from './img/grot-404-light.svg';\nimport useMousePosition from './useMousePosition';\n\nconst MIN_ARM_ROTATION = -20;\nconst MAX_ARM_ROTATION = 5;\nconst MIN_ARM_TRANSLATION = -5;\nconst MAX_ARM_TRANSLATION = 5;\n\ninterface Props {\n  width?: SVGProps<SVGElement>['width'];\n  height?: SVGProps<SVGElement>['height'];\n  show404?: boolean;\n}\n\nexport const GrotNotFound = ({ width = 'auto', height, show404 = false }: Props) => {\n  const theme = useTheme2();\n  const { x, y } = useMousePosition();\n  const styles = useStyles2(getStyles, x, y, show404);\n  return (\n    <SVG\n      src={(theme.isDark ? dark404 : light404) as unknown as string}\n      className={styles.svg}\n      height={height}\n      width={width}\n    />\n  );\n};\n\nGrotNotFound.displayName = 'GrotNotFound';\n\nconst getStyles = (theme: GrafanaTheme2, xPos: number | null, yPos: number | null, show404: boolean) => {\n  const { innerWidth, innerHeight } = window;\n  const heightRatio = yPos && yPos / innerHeight;\n  const widthRatio = xPos && xPos / innerWidth;\n  const rotation = heightRatio !== null ? getIntermediateValue(heightRatio, MIN_ARM_ROTATION, MAX_ARM_ROTATION) : 0;\n  const translation =\n    widthRatio !== null ? getIntermediateValue(widthRatio, MIN_ARM_TRANSLATION, MAX_ARM_TRANSLATION) : 0;\n\n  return {\n    svg: css({\n      '#grot-404-arm, #grot-404-magnifier': {\n        transform: `rotate(${rotation}deg) translateX(${translation}%)`,\n        transformOrigin: 'center',\n        transition: 'transform 50ms linear',\n      },\n      '#grot-404-text': {\n        display: show404 ? 'block' : 'none',\n      },\n    }),\n  };\n};\n\n/**\n * Given a start value, end value, and a ratio, return the intermediate value\n * Works with negative and inverted start/end values\n */\nconst getIntermediateValue = (ratio: number, start: number, end: number) => {\n  const value = ratio * (end - start) + start;\n  return value;\n};\n","import { css } from '@emotion/css';\nimport { Box, Stack, Text, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GrotNotFound } from './GrotNotFound';\n\ninterface Props {\n  message: string;\n}\n\nexport const EmptyState = ({ message }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <Box paddingY={8}>\n        <Stack direction=\"column\" alignItems=\"center\" gap={3}>\n          <GrotNotFound width={300} />\n          <Text variant=\"h5\">{message}</Text>\n        </Stack>\n      </Box>\n    </div>\n  );\n};\n\nEmptyState.displayName = 'EmptyState';\n\nfunction getStyles() {\n  return {\n    container: css({\n      width: '100%',\n      display: 'flex',\n      justifyContent: 'space-evenly',\n      flexDirection: 'column',\n    }),\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React from 'react';\n\nimport { EmptyState } from './ui/EmptyState';\n\ninterface SceneEmptyStateState extends SceneObjectState {\n  message: string;\n}\n\nexport class SceneEmptyState extends SceneObjectBase<SceneEmptyStateState> {\n  public static Component = ({ model }: SceneComponentProps<SceneEmptyState>) => {\n    const { message } = model.useState();\n    return <EmptyState message={message} />;\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Alert } from '@grafana/ui';\nimport React from 'react';\n\ninterface SceneErrorStateState extends SceneObjectState {\n  message: string;\n}\n\nexport class SceneErrorState extends SceneObjectBase<SceneErrorStateState> {\n  public static Component = ({ model }: SceneComponentProps<SceneErrorState>) => {\n    const { message } = model.useState();\n    return (\n      <Alert title=\"Query error!\" severity=\"error\">\n        {message}\n      </Alert>\n    );\n  };\n}\n","import {\n  SceneComponentProps,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nexport enum LayoutType {\n  GRID = 'grid',\n  ROWS = 'rows',\n}\n\nexport interface SceneLayoutSwitcherState extends SceneObjectState {\n  layout: LayoutType;\n  onChange?: (layout: LayoutType) => void;\n}\n\nexport class SceneLayoutSwitcher extends SceneObjectBase<SceneLayoutSwitcherState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['layout'] });\n\n  static OPTIONS = [\n    { label: 'Grid', value: LayoutType.GRID },\n    { label: 'Rows', value: LayoutType.ROWS },\n  ];\n\n  static DEFAULT_LAYOUT = LayoutType.GRID;\n\n  constructor() {\n    super({\n      key: 'layout-switcher',\n      layout: SceneLayoutSwitcher.DEFAULT_LAYOUT,\n    });\n  }\n\n  getUrlState() {\n    return {\n      layout: this.state.layout,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<SceneLayoutSwitcherState> = {};\n\n    if (typeof values.layout === 'string' && values.layout !== this.state.layout) {\n      stateUpdate.layout = Object.values(LayoutType).includes(values.layout as LayoutType)\n        ? (values.layout as LayoutType)\n        : SceneLayoutSwitcher.DEFAULT_LAYOUT;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  onChange = (layout: LayoutType) => {\n    reportInteraction('g_pyroscope_app_layout_changed', { layout });\n\n    this.setState({ layout });\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneLayoutSwitcher>) => {\n    const { layout } = model.useState();\n\n    return (\n      <RadioButtonGroup\n        aria-label=\"Layout switcher\"\n        options={SceneLayoutSwitcher.OPTIONS}\n        value={layout}\n        onChange={model.onChange}\n        fullWidth={false}\n      />\n    );\n  };\n}\n","import {\n  SceneComponentProps,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { InlineSwitch } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nexport interface SceneNoDataSwitcherState extends SceneObjectState {\n  hideNoData: string;\n  onChange?: (hideNoData: string) => void;\n}\n\nexport class SceneNoDataSwitcher extends SceneObjectBase<SceneNoDataSwitcherState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['hideNoData'] });\n\n  static DEFAULT_VALUE = 'off';\n\n  constructor() {\n    super({\n      key: 'no-data-switcher',\n      hideNoData: SceneNoDataSwitcher.DEFAULT_VALUE,\n    });\n  }\n\n  getUrlState() {\n    return {\n      hideNoData: this.state.hideNoData,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<SceneNoDataSwitcherState> = {};\n\n    if (typeof values.hideNoData === 'string' && values.hideNoData !== this.state.hideNoData) {\n      stateUpdate.hideNoData = ['on', 'off'].includes(values.hideNoData)\n        ? values.hideNoData\n        : SceneNoDataSwitcher.DEFAULT_VALUE;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  onChange = (hideNoData: 'on' | 'off') => {\n    reportInteraction('g_pyroscope_app_hide_no_data_changed', { hideNoData });\n\n    this.setState({ hideNoData });\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneNoDataSwitcher>) => {\n    const { hideNoData } = model.useState();\n\n    return (\n      <InlineSwitch\n        data-testid=\"noDataSwitcher\"\n        showLabel\n        label=\"Hide panels without data\"\n        value={hideNoData === 'on'}\n        onChange={(event: React.ChangeEvent<HTMLInputElement>) => model.onChange(event.target.checked ? 'on' : 'off')}\n      />\n    );\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneComponentProps,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { Icon, IconButton, Input, Tag, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nexport interface SceneQuickFilterState extends SceneObjectState {\n  placeholder: string;\n  searchText: string;\n  onChange?: (searchText: string) => void;\n  resultsCount: string;\n}\n\nexport class SceneQuickFilter extends SceneObjectBase<SceneQuickFilterState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['searchText'] });\n\n  static DEFAULT_SEARCH_TEXT = '';\n\n  static DEBOUNCE_DELAY = 250;\n\n  constructor({ placeholder }: { placeholder: string }) {\n    super({\n      key: 'quick-filter',\n      placeholder,\n      searchText: SceneQuickFilter.DEFAULT_SEARCH_TEXT,\n      resultsCount: '',\n    });\n  }\n\n  setPlaceholder(placeholder: string) {\n    this.setState({ placeholder });\n  }\n\n  setResultsCount(resultsCount: number) {\n    this.setState({ resultsCount: String(resultsCount) });\n  }\n\n  getUrlState() {\n    return {\n      searchText: this.state.searchText,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<SceneQuickFilterState> = {};\n\n    if (typeof values.searchText === 'string' && values.searchText !== this.state.searchText) {\n      stateUpdate.searchText = values.searchText;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    this.setState({ searchText: e.target.value });\n  };\n\n  reset() {\n    this.setState({ placeholder: '', searchText: '', resultsCount: '' });\n  }\n\n  clearSearchText = () => {\n    this.setState({ searchText: '' });\n  };\n\n  onFocus = () => {\n    reportInteraction('g_pyroscope_app_quick_filter_focused');\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneQuickFilter>) => {\n    const styles = useStyles2(getStyles);\n    const { placeholder, searchText, resultsCount } = model.useState();\n\n    return (\n      <Input\n        type=\"text\"\n        className=\"quick-filter\"\n        aria-label=\"Quick filter\"\n        placeholder={placeholder}\n        value={searchText}\n        prefix={<Icon name=\"search\" />}\n        suffix={\n          <>\n            {resultsCount !== '' && (\n              <Tag\n                className={styles.resultsCount}\n                name={resultsCount}\n                colorIndex={9}\n                data-testid=\"quick-filter-results-count\"\n              />\n            )}\n            <IconButton name=\"times\" aria-label=\"Clear search\" onClick={model.clearSearchText} />\n          </>\n        }\n        onChange={model.onChange}\n        onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => {\n          if (e.key === 'Escape') {\n            model.clearSearchText();\n          }\n        }}\n        onFocus={model.onFocus}\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  resultsCount: css`\n    margin-right: ${theme.spacing(1)};\n    border-radius: 11px;\n    padding: 2px 8px;\n    color: ${theme.colors.text.primary};\n    background-color: ${theme.colors.background.secondary};\n  `,\n});\n","import {\n  AdHocVariableFilter,\n  DataQueryResponse,\n  FieldType,\n  LoadingState,\n  MetricFindValue,\n  TestDataSourceResponse,\n} from '@grafana/data';\nimport { RuntimeDataSource } from '@grafana/scenes';\nimport { userStorage } from '@shared/infrastructure/userStorage';\nimport { isEqual } from 'lodash';\n\nimport { PanelType } from '../../components/SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { PYROSCOPE_FAVORITES_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { getProfileMetricLabel } from '../series/helpers/getProfileMetricLabel';\n\nexport type Favorite = {\n  index: number; // for colouring purpose only\n  queryRunnerParams: {\n    serviceName: string;\n    profileMetricId: string;\n    groupBy?: {\n      label: string;\n    };\n    filters?: AdHocVariableFilter[];\n  };\n  panelType?: PanelType;\n};\n\nexport class FavoritesDataSource extends RuntimeDataSource {\n  static getAllFavorites() {\n    return userStorage.get(userStorage.KEYS.PROFILES_EXPLORER)?.favorites || [];\n  }\n\n  static areFavoritesEqual(f1: Favorite, f2: Favorite) {\n    return f1.panelType === f2.panelType && isEqual(f1.queryRunnerParams, f2.queryRunnerParams);\n  }\n\n  static exists(favorite: Favorite) {\n    return FavoritesDataSource.getAllFavorites().some((f: Favorite) =>\n      FavoritesDataSource.areFavoritesEqual(f, favorite)\n    );\n  }\n\n  static addFavorite(favorite: Favorite) {\n    const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER);\n    storage.favorites.push(favorite);\n    userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n  }\n\n  static removeFavorite(favorite: Favorite) {\n    const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER);\n    storage.favorites = storage.favorites.filter((f: Favorite) => !FavoritesDataSource.areFavoritesEqual(f, favorite));\n    userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n  }\n\n  constructor() {\n    super(PYROSCOPE_FAVORITES_DATA_SOURCE.type, PYROSCOPE_FAVORITES_DATA_SOURCE.uid);\n\n    const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER) || {};\n    storage.favorites ||= [];\n\n    // ensures backward compatibility for older favorites without panel type\n    storage.favorites = storage.favorites.map((f: Favorite) => ({\n      panelType: PanelType.TIMESERIES,\n      ...f,\n    }));\n\n    userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Favories',\n          fields: [\n            {\n              name: null,\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(): Promise<MetricFindValue[]> {\n    return FavoritesDataSource.getAllFavorites().map((f: Favorite) => {\n      const { serviceName, profileMetricId, groupBy, filters } = f.queryRunnerParams || {};\n      const textParts = [serviceName, getProfileMetricLabel(profileMetricId)];\n\n      if (groupBy?.label) {\n        textParts.push(groupBy.label);\n      }\n\n      if (filters?.length) {\n        textParts.push(filters.map(({ key, operator, value }) => `${key}${operator}\"${value}\"`).join(', '));\n      }\n\n      return {\n        value: JSON.stringify({ value: JSON.stringify(f), ...f }),\n        text: textParts.join('  '),\n      };\n    });\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","import { AdHocVariableFilter } from '@grafana/data';\nimport { sceneGraph, SceneObject } from '@grafana/scenes';\nimport { clone, defaults, uniqBy } from 'lodash';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\n\ntype InterpolatedQueryRunnerParams = GridItemData['queryRunnerParams'] & {\n  serviceName: string;\n  profileMetricId: string;\n  filters: AdHocVariableFilter[];\n};\n\nexport function interpolateQueryRunnerVariables(\n  sceneObject: SceneObject,\n  item: GridItemData\n): InterpolatedQueryRunnerParams {\n  const { queryRunnerParams } = item;\n\n  const interpolatedParams = defaults(clone(queryRunnerParams), {\n    serviceName: getSceneVariableValue(sceneObject, 'serviceName'),\n    profileMetricId: getSceneVariableValue(sceneObject, 'profileMetricId'),\n  });\n\n  // state.filters has the AdHocFilterWithLabels[] type so we get rid of keyLabel and valueLabel\n  const parsedFilters = (sceneGraph.lookupVariable('filters', sceneObject) as FiltersVariable).state.filters.map(\n    ({ key, operator, value }) => ({ key, operator, value })\n  );\n\n  interpolatedParams.filters = uniqBy(\n    [...(interpolatedParams.filters || []), ...parsedFilters],\n    ({ key, operator, value }) => `${key}${operator}${value}`\n  );\n\n  return interpolatedParams as InterpolatedQueryRunnerParams;\n}\n","import { css } from '@emotion/css';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState, VariableDependencyConfig } from '@grafana/scenes';\nimport { IconButton, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { Favorite, FavoritesDataSource } from '../../infrastructure/favorites/FavoritesDataSource';\nimport { interpolateQueryRunnerVariables } from '../../infrastructure/helpers/interpolateQueryRunnerVariables';\n\ninterface FavActionState extends SceneObjectState {\n  item: GridItemData;\n  isFav?: boolean;\n  skipVariablesInterpolation?: boolean;\n}\n\nexport class FavAction extends SceneObjectBase<FavActionState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: ['serviceName', 'profileMetricId', 'filters'],\n    onReferencedVariableValueChanged: () => {\n      this.update();\n    },\n  });\n\n  constructor(state: FavActionState) {\n    super(state);\n\n    this.addActivationHandler(() => this.update());\n  }\n\n  update() {\n    this.setState({ isFav: this.isStored() });\n  }\n\n  isStored() {\n    return FavoritesDataSource.exists(this.buildFavorite());\n  }\n\n  static buildFavorite(item: GridItemData): Favorite {\n    const { index, queryRunnerParams, panelType } = item;\n\n    const favorite: Favorite = {\n      index,\n      queryRunnerParams: {\n        serviceName: queryRunnerParams.serviceName as string,\n        profileMetricId: queryRunnerParams.profileMetricId as string,\n      },\n      panelType,\n    };\n\n    // we don't store values, we'll fetch all timeseries by using the `groupBy` parameter\n    if (queryRunnerParams.groupBy) {\n      favorite.queryRunnerParams.groupBy = {\n        label: queryRunnerParams.groupBy.label,\n      };\n    }\n\n    // we don't store filters if empty\n    if (queryRunnerParams.filters?.length) {\n      favorite.queryRunnerParams.filters = queryRunnerParams.filters;\n    }\n\n    return favorite;\n  }\n\n  buildFavorite(): Favorite {\n    const { item, skipVariablesInterpolation } = this.state;\n\n    return FavAction.buildFavorite({\n      index: item.index,\n      queryRunnerParams: skipVariablesInterpolation\n        ? item.queryRunnerParams\n        : interpolateQueryRunnerVariables(this, item),\n      panelType: item.panelType,\n    } as GridItemData);\n  }\n\n  public onClick = () => {\n    reportInteraction('g_pyroscope_app_fav_action_clicked', { favAfterClick: !this.state.isFav });\n\n    if (!this.state.isFav) {\n      FavoritesDataSource.addFavorite(this.buildFavorite());\n    } else {\n      FavoritesDataSource.removeFavorite(this.buildFavorite());\n    }\n\n    this.setState({ isFav: !this.state.isFav });\n  };\n\n  public static Component = ({ model }: SceneComponentProps<FavAction>) => {\n    const styles = useStyles2(getStyles);\n    const { isFav } = model.useState();\n\n    return (\n      <IconButton\n        className={isFav ? styles.favedButton : styles.notFavedbutton}\n        name={isFav ? 'favorite' : 'star'}\n        variant=\"secondary\"\n        size=\"sm\"\n        aria-label={isFav ? 'Unfavorite' : 'Favorite'}\n        tooltip={isFav ? 'Unfavorite' : 'Favorite'}\n        tooltipPlacement=\"top\"\n        onClick={model.onClick}\n      />\n    );\n  };\n}\n\nconst getStyles = () => ({\n  favedButton: css`\n    color: #f2cc0d;\n    margin: 0;\n  `,\n  notFavedbutton: css`\n    margin: 0;\n  `,\n});\n","import { localeCompare } from '@shared/domain/localeCompare';\n\nimport { FavAction } from '../../..//domain/actions/FavAction';\nimport { FavoritesDataSource } from '../../../infrastructure/favorites/FavoritesDataSource';\nimport { GridItemData } from '../types/GridItemData';\n\nexport const sortFavGridItems: (a: GridItemData, b: GridItemData) => number = function (a, b) {\n  const aIsFav = FavoritesDataSource.exists(FavAction.buildFavorite(a));\n  const bIsFav = FavoritesDataSource.exists(FavAction.buildFavorite(b));\n\n  if (aIsFav && bIsFav) {\n    return localeCompare(a.label, b.label);\n  }\n\n  if (bIsFav) {\n    return +1;\n  }\n\n  if (aIsFav) {\n    return -1;\n  }\n\n  return 0;\n};\n","import { DashboardCursorSync } from '@grafana/data';\nimport {\n  behaviors,\n  EmbeddedSceneState,\n  QueryVariable,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  VariableValueOption,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { Spinner } from '@grafana/ui';\nimport { noOp } from '@shared/domain/noOp';\nimport { debounce, isEqual } from 'lodash';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../../domain/events/EventTimeseriesDataReceived';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { vizPanelBuilder } from '../../helpers/vizPanelBuilder';\nimport { SceneLabelValuesBarGauge } from '../SceneLabelValuesBarGauge';\nimport { SceneLabelValuesHistogram } from '../SceneLabelValuesHistogram';\nimport { SceneLabelValuesTable } from '../SceneLabelValuesTable';\nimport { SceneLabelValuesTimeseries } from '../SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\nimport { SceneEmptyState } from './components/SceneEmptyState/SceneEmptyState';\nimport { SceneErrorState } from './components/SceneErrorState/SceneErrorState';\nimport { LayoutType, SceneLayoutSwitcher, SceneLayoutSwitcherState } from './components/SceneLayoutSwitcher';\nimport { SceneNoDataSwitcher, SceneNoDataSwitcherState } from './components/SceneNoDataSwitcher';\nimport { ScenePanelTypeSwitcher } from './components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter, SceneQuickFilterState } from './components/SceneQuickFilter';\nimport { sortFavGridItems } from './domain/sortFavGridItems';\nimport { GridItemData } from './types/GridItemData';\n\ninterface SceneByVariableRepeaterGridState extends EmbeddedSceneState {\n  variableName: string;\n  items: GridItemData[];\n  headerActions: (item: GridItemData, items: GridItemData[]) => VizPanelState['headerActions'];\n  mapOptionToItem: (\n    option: VariableValueOption,\n    index: number,\n    variablesValues: Record<string, string>\n  ) => GridItemData | null;\n  sortItemsFn: (a: GridItemData, b: GridItemData) => number;\n  hideNoData: boolean;\n}\n\nconst GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\nconst GRID_TEMPLATE_ROWS = '1fr';\nconst GRID_AUTO_ROWS = '240px';\n\nexport class SceneByVariableRepeaterGrid extends SceneObjectBase<SceneByVariableRepeaterGridState> {\n  static buildGridItemKey(item: GridItemData) {\n    return `grid-item-${item.index}-${item.value}`;\n  }\n\n  static getGridColumnsTemplate(layout: LayoutType) {\n    return layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS;\n  }\n\n  constructor({\n    key,\n    variableName,\n    headerActions,\n    mapOptionToItem,\n    sortItemsFn,\n  }: {\n    key: string;\n    variableName: SceneByVariableRepeaterGridState['variableName'];\n    headerActions: SceneByVariableRepeaterGridState['headerActions'];\n    mapOptionToItem: SceneByVariableRepeaterGridState['mapOptionToItem'];\n    sortItemsFn?: SceneByVariableRepeaterGridState['sortItemsFn'];\n  }) {\n    super({\n      key,\n      variableName,\n      items: [],\n      headerActions,\n      mapOptionToItem,\n      sortItemsFn: sortItemsFn || sortFavGridItems,\n      hideNoData: false,\n      body: new SceneCSSGridLayout({\n        templateColumns: SceneByVariableRepeaterGrid.getGridColumnsTemplate(SceneLayoutSwitcher.DEFAULT_LAYOUT),\n        autoRows: GRID_AUTO_ROWS,\n        isLazy: true,\n        $behaviors: [\n          new behaviors.CursorSync({\n            key: 'metricCrosshairSync',\n            sync: DashboardCursorSync.Crosshair,\n          }),\n        ],\n        children: [],\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    // here we try to emulate VariableDependencyConfig.onVariableUpdateCompleted\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this) as QueryVariable & { update: () => void };\n\n    const variableSub = variable.subscribeToState((newState, prevState) => {\n      if (!newState.loading && prevState.loading) {\n        this.renderGridItems();\n      }\n    });\n\n    // if the variable is inactive, the data source will not fetch the options\n    // so we force an update here to be sure we have the latest values\n    variable.update();\n\n    const quickFilterSub = this.subscribeToQuickFilterChange();\n    const layoutChangeSub = this.subscribeToLayoutChange();\n    const hideNoDataSub = this.subscribeToHideNoDataChange();\n    const filtersSub = this.subscribeToFiltersChange();\n\n    return () => {\n      filtersSub.unsubscribe();\n      hideNoDataSub.unsubscribe();\n      layoutChangeSub.unsubscribe();\n      quickFilterSub.unsubscribe();\n\n      variableSub.unsubscribe();\n    };\n  }\n\n  subscribeToQuickFilterChange() {\n    const quickFilter = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.items.length !== prevState.items.length) {\n        quickFilter.setResultsCount(newState.items.length);\n      }\n    });\n\n    const onChangeState = (newState: SceneQuickFilterState, prevState?: SceneQuickFilterState) => {\n      if (newState.searchText !== prevState?.searchText) {\n        this.renderGridItems();\n      }\n    };\n\n    return quickFilter.subscribeToState(debounce(onChangeState, SceneQuickFilter.DEBOUNCE_DELAY));\n  }\n\n  subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher);\n\n    const body = this.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: SceneLayoutSwitcherState, prevState?: SceneLayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: SceneByVariableRepeaterGrid.getGridColumnsTemplate(newState.layout),\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state);\n\n    return layoutSwitcher.subscribeToState(onChangeState);\n  }\n\n  subscribeToHideNoDataChange() {\n    const noDataSwitcher = sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher);\n\n    if (!noDataSwitcher.isActive) {\n      this.setState({ hideNoData: false });\n\n      return {\n        unsubscribe: noOp,\n      };\n    }\n\n    const onChangeState = (newState: SceneNoDataSwitcherState, prevState?: SceneNoDataSwitcherState) => {\n      if (newState.hideNoData !== prevState?.hideNoData) {\n        this.setState({ hideNoData: newState.hideNoData === 'on' });\n\n        // we force render because this.state.items certainly have not changed but we want to update the UI panels anyway\n        this.renderGridItems(true);\n      }\n    };\n\n    onChangeState(noDataSwitcher.state);\n\n    return noDataSwitcher.subscribeToState(onChangeState);\n  }\n\n  subscribeToFiltersChange() {\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n    const noDataSwitcher = sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher);\n\n    // the handler will be called each time a filter is added/removed/modified\n    return filtersVariable.subscribeToState(() => {\n      if (noDataSwitcher.state.hideNoData === 'on') {\n        // to be sure the list is updated we force render because the filters only influence the query made in each panel\n        this.renderGridItems(true);\n      }\n    });\n  }\n\n  buildItemsData(variable: QueryVariable) {\n    const { mapOptionToItem } = this.state;\n\n    const variableValues = {\n      serviceName: getSceneVariableValue(this, 'serviceName'),\n      profileMetricId: getSceneVariableValue(this, 'profileMetricId'),\n      panelType: sceneGraph.findByKeyAndType(this, 'panel-type-switcher', ScenePanelTypeSwitcher).state.panelType,\n    };\n\n    const items = variable.state.options\n      .map((option, i) => mapOptionToItem(option, i, variableValues))\n      .filter(Boolean) as GridItemData[];\n\n    return this.filterItems(items).sort(this.state.sortItemsFn);\n  }\n\n  shouldRenderItems(newItems: SceneByVariableRepeaterGridState['items']) {\n    const { items } = this.state;\n\n    if (!newItems.length || items.length !== newItems.length) {\n      return true;\n    }\n\n    return !isEqual(items, newItems);\n  }\n\n  renderGridItems(forceRender = false) {\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this) as QueryVariable;\n\n    if (variable.state.loading) {\n      return;\n    }\n\n    if (variable.state.error) {\n      this.renderErrorState(variable.state.error);\n      return;\n    }\n\n    const newItems = this.buildItemsData(variable);\n\n    if (!forceRender && !this.shouldRenderItems(newItems)) {\n      return;\n    }\n\n    this.setState({ items: newItems });\n\n    if (!this.state.items.length) {\n      this.renderEmptyState();\n      return;\n    }\n\n    const gridItems = this.state.items.map((item) => {\n      const vizPanel = vizPanelBuilder(item.panelType, {\n        item,\n        headerActions: this.state.headerActions.bind(null, item, this.state.items),\n      });\n\n      if (this.state.hideNoData) {\n        this.setupHideNoData(vizPanel);\n      }\n\n      return new SceneCSSGridItem({\n        key: SceneByVariableRepeaterGrid.buildGridItemKey(item),\n        body: vizPanel,\n      });\n    });\n\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: GRID_AUTO_ROWS, // required to have the correct grid items height\n      children: gridItems,\n    });\n  }\n\n  setupHideNoData(\n    vizPanel: SceneLabelValuesTimeseries | SceneLabelValuesBarGauge | SceneLabelValuesHistogram | SceneLabelValuesTable\n  ) {\n    const sub = vizPanel.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      if (event.payload.series?.length) {\n        return;\n      }\n\n      const gridItem = sceneGraph.getAncestor(vizPanel, SceneCSSGridItem);\n      const { key: gridItemKey } = gridItem.state;\n      const grid = sceneGraph.getAncestor(gridItem, SceneCSSGridLayout);\n\n      const filteredChildren = grid.state.children.filter((c) => c.state.key !== gridItemKey);\n\n      if (!filteredChildren.length) {\n        this.renderEmptyState();\n      } else {\n        grid.setState({ children: filteredChildren });\n      }\n    });\n\n    vizPanel.addActivationHandler(() => {\n      return () => {\n        sub.unsubscribe();\n      };\n    });\n  }\n\n  filterItems(items: SceneByVariableRepeaterGridState['items']) {\n    const quickFilterScene = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n    const { searchText } = quickFilterScene.state;\n\n    if (!searchText) {\n      return items;\n    }\n\n    const regexes = searchText\n      .split(',')\n      .map((t) => t.trim())\n      .filter(Boolean)\n      .map((r) => {\n        try {\n          return new RegExp(r);\n        } catch {\n          return null;\n        }\n      })\n      .filter(Boolean) as RegExp[];\n\n    return items.filter(({ label }) => regexes.some((r) => r.test(label)));\n  }\n\n  renderEmptyState() {\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: '480px',\n      children: [\n        new SceneCSSGridItem({\n          body: new SceneEmptyState({\n            message: 'No results',\n          }),\n        }),\n      ],\n    });\n  }\n\n  renderErrorState(error: Error) {\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: '480px',\n      children: [\n        new SceneCSSGridItem({\n          body: new SceneErrorState({\n            message: error.message || error.toString(),\n          }),\n        }),\n      ],\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneByVariableRepeaterGrid>) {\n    const { body, variableName } = model.useState();\n    const { loading } = (sceneGraph.lookupVariable(variableName, model) as QueryVariable)?.useState();\n\n    return loading ? <Spinner /> : <body.Component model={body} />;\n  }\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventExpandPanelPayload {\n  item: GridItemData;\n}\n\nexport class EventExpandPanel extends BusEventWithPayload<EventExpandPanelPayload> {\n  public static type = 'expand-panel';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventSelectLabelPayload {\n  item: GridItemData;\n}\n\nexport class EventSelectLabel extends BusEventWithPayload<EventSelectLabelPayload> {\n  public static type = 'select-label';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventViewServiceFlameGraphPayload {\n  item: GridItemData;\n}\n\nexport class EventViewServiceFlameGraph extends BusEventWithPayload<EventViewServiceFlameGraphPayload> {\n  public static type = 'view-service-flame-graph';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventViewServiceLabelsPayload {\n  item: GridItemData;\n}\n\nexport class EventViewServiceLabels extends BusEventWithPayload<EventViewServiceLabelsPayload> {\n  public static type = 'view-service-labels';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventViewServiceProfilesPayload {\n  item: GridItemData;\n}\n\nexport class EventViewServiceProfiles extends BusEventWithPayload<EventViewServiceProfilesPayload> {\n  public static type = 'view-service-profiles';\n}\n","import { css } from '@emotion/css';\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, IconName, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { merge } from 'lodash';\nimport React from 'react';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { interpolateQueryRunnerVariables } from '../../infrastructure/helpers/interpolateQueryRunnerVariables';\nimport { EventExpandPanel, EventExpandPanelPayload } from '../events/EventExpandPanel';\nimport { EventSelectLabel, EventSelectLabelPayload } from '../events/EventSelectLabel';\nimport { EventViewServiceFlameGraph, EventViewServiceFlameGraphPayload } from '../events/EventViewServiceFlameGraph';\nimport { EventViewServiceLabels, EventViewServiceLabelsPayload } from '../events/EventViewServiceLabels';\nimport { EventViewServiceProfiles, EventViewServiceProfilesPayload } from '../events/EventViewServiceProfiles';\n\ntype ActionType = 'expand-panel' | 'select-label' | 'view-flame-graph' | 'view-labels' | 'view-profiles';\n\ntype EventLookup = {\n  icon?: IconName;\n  label?: string;\n  ariaLabel?: string;\n  tooltip: (item: GridItemData, model: SceneObject) => string;\n  EventConstructor:\n    | (new (payload: EventExpandPanelPayload) => EventExpandPanel)\n    | (new (payload: EventSelectLabelPayload) => EventSelectLabel)\n    | (new (payload: EventViewServiceFlameGraphPayload) => EventViewServiceFlameGraph)\n    | (new (payload: EventViewServiceLabelsPayload) => EventViewServiceLabels)\n    | (new (payload: EventViewServiceProfilesPayload) => EventViewServiceProfiles);\n};\n\nconst Events = new Map<ActionType, EventLookup>([\n  [\n    'expand-panel',\n    Object.freeze({\n      ariaLabel: 'Expand panel',\n      icon: 'expand-arrows',\n      tooltip: () => 'Expand this panel to view all the data for the current filters',\n      EventConstructor: EventExpandPanel,\n    }),\n  ],\n  [\n    'select-label',\n    Object.freeze({\n      label: 'Select',\n      tooltip: ({ queryRunnerParams }) => `View \"${queryRunnerParams.groupBy?.label}\" values breakdown`,\n      EventConstructor: EventSelectLabel,\n    }),\n  ],\n  [\n    'view-flame-graph',\n    Object.freeze({\n      label: 'Flame graph',\n      tooltip: ({ queryRunnerParams }, model) => {\n        const serviceName = queryRunnerParams.serviceName || getSceneVariableValue(model, 'serviceName');\n        const profileMetricId = queryRunnerParams.profileMetricId || getSceneVariableValue(model, 'profileMetricId');\n        return `View the \"${getProfileMetric(profileMetricId as ProfileMetricId).type}\" flame graph of ${serviceName}`;\n      },\n      EventConstructor: EventViewServiceFlameGraph,\n    }),\n  ],\n  [\n    'view-labels',\n    Object.freeze({\n      label: 'Labels',\n      tooltip: ({ queryRunnerParams }, model) => {\n        const serviceName = queryRunnerParams.serviceName || getSceneVariableValue(model, 'serviceName');\n        return `Explore the labels of ${serviceName}`;\n      },\n      EventConstructor: EventViewServiceLabels,\n    }),\n  ],\n  [\n    'view-profiles',\n    Object.freeze({\n      label: 'Profile types',\n      tooltip: ({ queryRunnerParams }, model) => {\n        const serviceName = queryRunnerParams.serviceName || getSceneVariableValue(model, 'serviceName');\n        return `View the profile types of ${serviceName}`;\n      },\n      EventConstructor: EventViewServiceProfiles,\n    }),\n  ],\n]);\n\ninterface SelectActionState extends SceneObjectState {\n  type: ActionType;\n  EventConstructor: EventLookup['EventConstructor'];\n  item: GridItemData;\n  label?: string;\n  ariaLabel?: string;\n  icon?: IconName;\n  tooltip?: EventLookup['tooltip'];\n  skipVariablesInterpolation?: boolean;\n}\n\nexport class SelectAction extends SceneObjectBase<SelectActionState> {\n  constructor({\n    type,\n    item,\n    tooltip,\n    skipVariablesInterpolation,\n  }: {\n    type: ActionType;\n    item: SelectActionState['item'];\n    tooltip?: SelectActionState['tooltip'];\n    skipVariablesInterpolation?: SelectActionState['skipVariablesInterpolation'];\n  }) {\n    const lookup = Events.get(type);\n    if (!lookup) {\n      throw new TypeError(`Unknown event type=\"${type}\"!`);\n    }\n\n    super({ type, item, ...merge({}, lookup, { tooltip, skipVariablesInterpolation }) });\n  }\n\n  public onClick = () => {\n    reportInteraction('g_pyroscope_app_select_action_clicked', { type: this.state.type });\n\n    this.publishEvent(this.buildEvent(), true);\n  };\n\n  buildEvent() {\n    const { EventConstructor, item, skipVariablesInterpolation } = this.state;\n\n    const completeItem = {\n      ...item,\n      queryRunnerParams: skipVariablesInterpolation\n        ? item.queryRunnerParams\n        : interpolateQueryRunnerVariables(this, item),\n    };\n\n    return new EventConstructor({\n      item: completeItem,\n    });\n  }\n\n  public static Component = ({ model }: SceneComponentProps<SelectAction>) => {\n    const styles = useStyles2(getStyles);\n    const { ariaLabel, label, icon, tooltip, item } = model.useState();\n\n    return (\n      <Button\n        className={styles.selectButton}\n        aria-label={ariaLabel || label}\n        variant=\"primary\"\n        size=\"sm\"\n        fill=\"text\"\n        onClick={model.onClick}\n        icon={icon}\n        tooltip={tooltip?.(item, model)}\n        tooltipPlacement=\"top\"\n      >\n        {label}\n      </Button>\n    );\n  };\n}\n\nconst getStyles = () => ({\n  selectButton: css`\n    margin: 0;\n    padding: 0;\n  `,\n});\n","import {\n  EmbeddedSceneState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { SceneByVariableRepeaterGrid } from '../../components/SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid';\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { SceneLayoutSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { PanelType } from '../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter } from '../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\n\ninterface SceneExploreAllServicesState extends EmbeddedSceneState {}\n\nexport class SceneExploreAllServices extends SceneObjectBase<SceneExploreAllServicesState> {\n  constructor() {\n    super({\n      key: 'explore-all-services',\n      $variables: new SceneVariableSet({\n        variables: [\n          // we use a custom instance of ServiceNameVariable to display only the services associated to the selected profile metric\n          new ServiceNameVariable({\n            query: ServiceNameVariable.QUERY_PROFILE_METRIC_DEPENDENT,\n            skipUrlSync: true,\n          }),\n        ],\n      }),\n      body: new SceneByVariableRepeaterGrid({\n        key: 'all-services-grid',\n        variableName: 'serviceName',\n        mapOptionToItem: (option, index, { profileMetricId }) => ({\n          index,\n          value: option.value as string,\n          label: option.label,\n          queryRunnerParams: {\n            serviceName: option.value as string,\n            profileMetricId,\n          },\n          panelType: PanelType.TIMESERIES,\n        }),\n        headerActions: (item) => [\n          new SelectAction({ type: 'view-profiles', item }),\n          new SelectAction({ type: 'view-labels', item }),\n          new SelectAction({ type: 'view-flame-graph', item }),\n          new FavAction({ item }),\n        ],\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search services (comma-separated regexes are supported)');\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable)],\n      gridControls: [\n        sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter),\n        sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher),\n      ],\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreAllServices>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Drawer } from '@grafana/ui';\nimport React from 'react';\n\ninterface SceneDrawerState extends SceneObjectState {\n  key?: string;\n  isOpen?: boolean;\n  title?: string;\n  subTitle?: string;\n  body?: SceneObject;\n}\n\nexport class SceneDrawer extends SceneObjectBase<SceneDrawerState> {\n  constructor(state?: SceneDrawerState) {\n    super({\n      key: 'drawer',\n      isOpen: false,\n      ...state,\n    });\n  }\n\n  open = ({\n    title,\n    subTitle,\n    body,\n  }: {\n    title?: SceneDrawerState['title'];\n    subTitle?: SceneDrawerState['subTitle'];\n    body?: SceneDrawerState['body'];\n  }) => {\n    this.setState({ ...this.state, isOpen: true, title, subTitle, body });\n  };\n\n  close = () => {\n    this.setState({ isOpen: false });\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneDrawer>) => {\n    const { isOpen, title, subTitle, body } = model.useState();\n\n    return (\n      <>\n        {body && isOpen && (\n          <Drawer size=\"lg\" title={title} subtitle={subTitle} closeOnMaskClick onClose={model.close}>\n            <body.Component model={body} />\n          </Drawer>\n        )}\n      </>\n    );\n  };\n}\n","import { VariableRefresh } from '@grafana/data';\nimport { QueryVariable, VariableValueOption } from '@grafana/scenes';\nimport { lastValueFrom } from 'rxjs';\n\nimport { PYROSCOPE_FAVORITES_DATA_SOURCE } from '../../infrastructure/pyroscope-data-sources';\n\nexport class FavoriteVariable extends QueryVariable {\n  constructor() {\n    super({\n      name: 'favorite',\n      label: ' Favorite',\n      datasource: PYROSCOPE_FAVORITES_DATA_SOURCE,\n      // \"hack\": we want to subscribe to changes of dataSource\n      query: '$dataSource',\n      loading: true,\n      refresh: VariableRefresh.never,\n      skipUrlSync: true,\n    });\n  }\n\n  async update() {\n    if (this.state.loading) {\n      return;\n    }\n\n    let options: VariableValueOption[] = [];\n    let error = null;\n\n    this.setState({ loading: true, options: [], error: null });\n\n    try {\n      options = await lastValueFrom(this.getValueOptions({}));\n    } catch (e) {\n      error = e;\n    } finally {\n      this.setState({ loading: false, options, error });\n    }\n  }\n}\n","import {\n  EmbeddedSceneState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport { localeCompare } from '@shared/domain/localeCompare';\nimport React from 'react';\n\nimport { SceneByVariableRepeaterGrid } from '../../components/SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid';\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneDrawer } from '../../components/SceneDrawer';\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { EventExpandPanel } from '../../domain/events/EventExpandPanel';\nimport { FavoriteVariable } from '../../domain/variables/FavoriteVariable';\nimport { vizPanelBuilder } from '../../helpers/vizPanelBuilder';\nimport { SceneLayoutSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { SceneNoDataSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher';\nimport { SceneQuickFilter } from '../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\n\ninterface SceneExploreFavoritesState extends EmbeddedSceneState {\n  drawer: SceneDrawer;\n}\n\nexport class SceneExploreFavorites extends SceneObjectBase<SceneExploreFavoritesState> {\n  constructor() {\n    super({\n      key: 'explore-favorites',\n      $variables: new SceneVariableSet({ variables: [new FavoriteVariable()] }),\n      body: new SceneByVariableRepeaterGrid({\n        key: 'favorites-grid',\n        variableName: 'favorite',\n        mapOptionToItem: (option) => {\n          // see FavoritesDataSource.ts\n          const { index, value, panelType, queryRunnerParams } = JSON.parse(option.value as string);\n\n          return {\n            index,\n            value,\n            label: option.label,\n            queryRunnerParams,\n            panelType,\n          };\n        },\n        sortItemsFn: (a, b) => localeCompare(a.label, b.label),\n        headerActions: (item) => {\n          const actions: Array<SelectAction | FavAction> = [\n            new SelectAction({ type: 'view-labels', item, skipVariablesInterpolation: true }),\n            new SelectAction({ type: 'view-flame-graph', item, skipVariablesInterpolation: true }),\n          ];\n\n          if (item.queryRunnerParams.groupBy) {\n            actions.push(\n              new SelectAction({\n                type: 'expand-panel',\n                item,\n                tooltip: () => 'Expand panel to view all the data',\n                skipVariablesInterpolation: true,\n              })\n            );\n          }\n\n          actions.push(new FavAction({ item, skipVariablesInterpolation: true }));\n\n          return actions;\n        },\n      }),\n      drawer: new SceneDrawer(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search favorites (comma-separated regexes are supported)');\n\n    const expandPanelSub = this.subscribeToEvent(EventExpandPanel, async (event) => {\n      this.openExpandedPanelDrawer(event.payload.item);\n    });\n\n    return () => {\n      expandPanelSub.unsubscribe();\n    };\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [],\n      gridControls: [\n        sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter),\n        sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher),\n        sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher),\n      ],\n    };\n  }\n\n  openExpandedPanelDrawer(item: GridItemData) {\n    const headerActions = () => [\n      new SelectAction({ type: 'view-labels', item }),\n      new SelectAction({ type: 'view-flame-graph', item }),\n    ];\n\n    this.state.drawer.open({\n      title: item.label,\n      body: vizPanelBuilder(item.panelType, {\n        displayAllValues: true,\n        legendPlacement: 'right',\n        item,\n        headerActions,\n      }),\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreFavorites>) {\n    const { body, drawer } = model.useState();\n\n    return (\n      <>\n        <body.Component model={body} />\n        <drawer.Component model={drawer} />\n      </>\n    );\n  }\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Field, measureText, RadioButtonGroup, RefreshPicker, Select, useStyles2, useTheme2 } from '@grafana/ui';\nimport { useResizeObserver } from '@react-aria/utils';\nimport { noOp } from '@shared/domain/noOp';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { GroupByVariable } from './GroupByVariable';\n\ntype Props = {\n  options: Array<SelectableValue<string>>;\n  mainLabels: string[];\n  value?: string;\n  onChange: (label: string) => void;\n  onRefresh: () => void;\n};\n\nexport function GroupBySelector({ options, mainLabels, value, onChange, onRefresh }: Props) {\n  const styles = useStyles2(getStyles);\n  const theme = useTheme2();\n\n  const [labelSelectorRequiredWidth, setLabelSelectorRequiredWidth] = useState<number>(0);\n  const [availableWidth, setAvailableWidth] = useState<number>(0);\n\n  const useHorizontalLabelSelector = availableWidth > labelSelectorRequiredWidth;\n\n  const controlsContainer = useRef<HTMLDivElement>(null);\n\n  useResizeObserver({\n    ref: controlsContainer,\n    onResize: () => {\n      const element = controlsContainer.current;\n      if (element) {\n        setAvailableWidth(element.clientWidth);\n      }\n    },\n  });\n\n  const mainOptions = options.filter((o) => mainLabels.includes(o.value as string));\n  const otherOptions = options.filter((o) => !mainLabels.includes(o.value as string));\n\n  useEffect(() => {\n    const { fontSize } = theme.typography;\n    const text = mainOptions.map((option) => option.label || option.text || '').join(' ');\n    const textWidth = measureText(text, fontSize).width;\n    const additionalWidthPerItem = 70;\n    setLabelSelectorRequiredWidth(textWidth + additionalWidthPerItem * mainOptions.length);\n  }, [mainOptions, theme]);\n\n  return (\n    <Field label=\"Group by labels\">\n      <div ref={controlsContainer} className={styles.container}>\n        {useHorizontalLabelSelector ? (\n          <>\n            <RadioButtonGroup aria-label=\"Labels selector\" options={mainOptions} value={value} onChange={onChange} />\n            <Select\n              aria-label=\"Other labels selector\"\n              className={styles.select}\n              placeholder=\"Other labels\"\n              options={otherOptions}\n              value={value && otherOptions.some((x) => x.value === value) ? value : null} // remove value from select when radio button clicked\n              onChange={(selected) => onChange(selected?.value ?? 'all')}\n              isClearable\n            />\n          </>\n        ) : (\n          <Select\n            aria-label=\"Labels selector\"\n            className={styles.select}\n            value={value}\n            placeholder=\"Select label\"\n            options={options}\n            onChange={(selected) => onChange(selected?.value || GroupByVariable.DEFAULT_VALUE)}\n            isClearable\n          />\n        )}\n        <RefreshPicker\n          noIntervalPicker\n          onRefresh={onRefresh}\n          isOnCanvas={false}\n          onIntervalChanged={noOp}\n          tooltip=\"Click to refresh all labels\"\n        />\n      </div>\n    </Field>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    gap: ${theme.spacing(1)};\n  `,\n  select: css`\n    max-width: ${theme.spacing(22)};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { MultiValueVariable, QueryVariable, SceneComponentProps, VariableValueOption } from '@grafana/scenes';\nimport { Field, Icon, RefreshPicker, Spinner, Tooltip, useStyles2 } from '@grafana/ui';\nimport { noOp } from '@shared/domain/noOp';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React, { useMemo } from 'react';\nimport { lastValueFrom } from 'rxjs';\nimport { GridItemData } from 'src/pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nimport { PYROSCOPE_LABELS_DATA_SOURCE } from '../../../infrastructure/pyroscope-data-sources';\nimport { GroupBySelector } from './GroupBySelector';\n\nexport type OptionWithIndex = VariableValueOption & {\n  index: number;\n  value: string;\n  label: string;\n  groupBy: GridItemData['queryRunnerParams']['groupBy'];\n};\n\nexport class GroupByVariable extends QueryVariable {\n  static DEFAULT_VALUE = 'all';\n\n  static MAX_MAIN_LABELS = 8;\n\n  constructor() {\n    super({\n      key: 'groupBy',\n      name: 'groupBy',\n      label: 'Group by labels',\n      datasource: PYROSCOPE_LABELS_DATA_SOURCE,\n      // \"hack\": we want to subscribe to changes of dataSource, serviceName and profileMetricId\n      // we could also add filters, but the Service labels exploration type would reload all labels each time they are modified\n      // which wouldn't be great UX\n      query: '$dataSource and $profileMetricId{service_name=\"$serviceName\"}',\n      loading: true,\n    });\n\n    this.changeValueTo = this.changeValueTo.bind(this);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    if (!this.state.value) {\n      this.setState({ value: GroupByVariable.DEFAULT_VALUE });\n    }\n  }\n\n  update = async () => {\n    if (this.state.loading) {\n      return;\n    }\n\n    let options: VariableValueOption[] = [];\n    let error = null;\n\n    this.setState({ loading: true, options: [], error: null });\n\n    try {\n      options = await lastValueFrom(this.getValueOptions({}));\n    } catch (e) {\n      error = e;\n    } finally {\n      this.setState({ loading: false, options, error });\n    }\n  };\n\n  onChange = (newValue: string) => {\n    reportInteraction('g_pyroscope_app_group_by_label_clicked');\n\n    prepareHistoryEntry();\n    this.changeValueTo(newValue);\n  };\n\n  findCurrentOption(): OptionWithIndex {\n    const { value } = this.state;\n\n    // See LabelsDataSource.ts\n    const option = this.state.options\n      .filter((o) => o.value !== 'all')\n      .find((o) => JSON.parse(o.value as string).value === value);\n\n    if (option) {\n      const parsedValue = JSON.parse(option.value as string);\n      return {\n        index: parsedValue.index,\n        value: parsedValue.value,\n        label: parsedValue.value,\n        groupBy: parsedValue.groupBy,\n      };\n    }\n\n    return {\n      index: 0,\n      value: value as string,\n      label: value as string,\n      groupBy: undefined,\n    };\n  }\n\n  static Component = ({ model }: SceneComponentProps<MultiValueVariable & { update?: any; onChange?: any }>) => {\n    const styles = useStyles2(getStyles);\n    const { loading, value, options, error } = model.useState();\n\n    const groupByOptions = useMemo(\n      () =>\n        options.map(({ label, value }) => {\n          return value === 'all'\n            ? { label, value }\n            : {\n                label,\n                // see src/pages/ProfilesExplorerView/data/labels/LabelsDataSource.ts\n                value: JSON.parse(String(value)).value,\n              };\n        }),\n      [options]\n    );\n\n    if (loading) {\n      return (\n        <Field label=\"Group by labels\">\n          <Spinner className={styles.spinner} />\n        </Field>\n      );\n    }\n\n    if (error) {\n      return (\n        <Field label=\"Group by labels\">\n          <div className={styles.groupByErrorContainer}>\n            <Tooltip theme=\"error\" content={error.toString()}>\n              <Icon className={styles.iconError} name=\"exclamation-triangle\" size=\"xl\" />\n            </Tooltip>\n            <RefreshPicker noIntervalPicker onRefresh={model.update} isOnCanvas={false} onIntervalChanged={noOp} />\n          </div>\n        </Field>\n      );\n    }\n\n    const getMainLabels = (groupByOptions: Array<SelectableValue<string>>) => {\n      return groupByOptions.slice(0, GroupByVariable.MAX_MAIN_LABELS).map(({ value }) => value as string);\n    };\n\n    return (\n      <GroupBySelector\n        options={groupByOptions}\n        value={value as string}\n        mainLabels={getMainLabels(groupByOptions)}\n        onChange={model.onChange}\n        onRefresh={model.update}\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  spinner: css`\n    height: 32px;\n    line-height: 32px;\n  `,\n  groupByErrorContainer: css`\n    display: flex;\n  `,\n  iconError: css`\n    height: 32px;\n    align-self: center;\n    color: ${theme.colors.error.text};\n  `,\n});\n","import {\n  SceneComponentProps,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React from 'react';\n\nimport { FiltersVariable } from '../domain/variables/FiltersVariable/FiltersVariable';\nimport { GroupByVariable } from '../domain/variables/GroupByVariable/GroupByVariable';\nimport { ProfileMetricVariable } from '../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { getSceneVariableValue } from '../helpers/getSceneVariableValue';\nimport { PYROSCOPE_DATA_SOURCE } from '../infrastructure/pyroscope-data-sources';\nimport { getProfileMetricLabel } from '../infrastructure/series/helpers/getProfileMetricLabel';\nimport { PanelType } from './SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { addRefId, addStats } from './SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from './SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneLabelValuesTimeseries } from './SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\n\ninterface SceneMainServiceTimeseriesState extends SceneObjectState {\n  headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  body?: SceneLabelValuesTimeseries;\n}\n\nexport class SceneMainServiceTimeseries extends SceneObjectBase<SceneMainServiceTimeseriesState> {\n  static MIN_HEIGHT = 240;\n\n  constructor({\n    item,\n    headerActions,\n    supportGroupBy,\n  }: {\n    item?: GridItemData;\n    headerActions: SceneMainServiceTimeseriesState['headerActions'];\n    supportGroupBy?: boolean;\n  }) {\n    super({\n      headerActions,\n      body: undefined,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item, supportGroupBy));\n  }\n\n  onActivate(item?: GridItemData, supportGroupBy?: boolean) {\n    if (item) {\n      this.initVariables(item);\n    }\n\n    this.setState({ body: this.buildTimeseries(item, supportGroupBy) });\n\n    if (supportGroupBy) {\n      this.subscribeToGroupByStateChanges(item);\n    }\n\n    const serviceNameVariable = sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable);\n    const profileMetricsVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n\n    this._subs.add(\n      serviceNameVariable.subscribeToState((newState, prevState) => {\n        if (newState?.value !== prevState?.value) {\n          this.resetTimeseries(true); // reset filters when service name changes\n        }\n      })\n    );\n\n    this._subs.add(\n      profileMetricsVariable.subscribeToState((newState, prevState) => {\n        if (newState?.value !== prevState?.value) {\n          this.resetTimeseries(false); // keep same filters whe just profiles metric changes\n        }\n      })\n    );\n  }\n\n  initVariables(item: GridItemData) {\n    const { serviceName, profileMetricId, filters } = item.queryRunnerParams;\n\n    if (serviceName) {\n      const serviceNameVariable = sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable);\n      serviceNameVariable.changeValueTo(serviceName);\n    }\n\n    if (profileMetricId) {\n      const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n      profileMetricVariable.changeValueTo(profileMetricId);\n    }\n\n    if (filters) {\n      const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n      filtersVariable.setState({ filters });\n    }\n  }\n\n  buildTimeseries(item?: GridItemData, supportGroupBy?: boolean) {\n    const { headerActions } = this.state;\n\n    const timeseriesItem: GridItemData = {\n      index: 0,\n      value: '',\n      queryRunnerParams: {}, // let interpolation happen\n      label: this.buildTitle(),\n      panelType: PanelType.TIMESERIES,\n    };\n\n    if (item && supportGroupBy) {\n      timeseriesItem.queryRunnerParams.groupBy = item.queryRunnerParams.groupBy;\n    }\n\n    const groupBy = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable).state.value;\n\n    return new SceneLabelValuesTimeseries({\n      item: timeseriesItem,\n      headerActions,\n      annotations: true,\n      // we pass data for the scenarios where we land on the page from a shared link\n      // we do this to prevent rendering a timeseries without groupBy for a second then with groupBy\n      // and also to directly render something when there's no groupBy in the URL\n      data:\n        !item && supportGroupBy && groupBy && groupBy !== 'all'\n          ? new SceneDataTransformer({\n              $data: new SceneQueryRunner({ datasource: PYROSCOPE_DATA_SOURCE, queries: [] }),\n              transformations: [addRefId, addStats],\n            })\n          : undefined,\n    });\n  }\n\n  subscribeToGroupByStateChanges(item?: GridItemData) {\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n\n    this._subs.add(\n      groupByVariable.subscribeToState((newState, prevState) => {\n        if (newState.loading || !newState.options.length) {\n          return;\n        }\n\n        // First load:\n        // here we check for the item to prevent two queries to occur when coming from (e.g) favorites and\n        // selecting an item with a different profile metric than the current ProfileMetricVariable value\n        if (!item && prevState.loading) {\n          this.onGroupByChanged(groupByVariable);\n          return;\n        }\n\n        if (newState.value !== prevState.value) {\n          this.onGroupByChanged(groupByVariable);\n        }\n      })\n    );\n  }\n\n  onGroupByChanged(groupByVariable: GroupByVariable) {\n    if (!groupByVariable.state.value || groupByVariable.state.value === 'all') {\n      this.resetTimeseries();\n      return;\n    }\n\n    const { index, value, groupBy } = groupByVariable.findCurrentOption();\n\n    (this.state.body as SceneLabelValuesTimeseries)?.updateItem({\n      index,\n      label: `${this.buildTitle()}, grouped by ${value}`,\n      queryRunnerParams: { groupBy },\n    });\n  }\n\n  resetTimeseries(resetFilters = false) {\n    if (resetFilters) {\n      sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable).reset();\n    }\n\n    (this.state.body as SceneLabelValuesTimeseries)?.updateItem({\n      index: 0,\n      label: this.buildTitle(),\n      queryRunnerParams: { groupBy: undefined },\n    });\n  }\n\n  buildTitle() {\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const { description } = getProfileMetric(profileMetricId as ProfileMetricId);\n    return description || getProfileMetricLabel(profileMetricId);\n  }\n\n  static Component({ model }: SceneComponentProps<SceneMainServiceTimeseries>) {\n    const { body } = model.useState();\n\n    return body && <body.Component model={body} />;\n  }\n}\n","import { AdHocVariableFilter, BusEventWithPayload } from '@grafana/data';\n\ninterface EventViewDiffFlameGraphPayload {\n  useAncestorTimeRange: boolean;\n  clearDiffRange: boolean;\n  baselineFilters: AdHocVariableFilter[];\n  comparisonFilters: AdHocVariableFilter[];\n}\n\nexport class EventViewDiffFlameGraph extends BusEventWithPayload<EventViewDiffFlameGraphPayload> {\n  public static type = 'view-diff-flame-graph';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { CompareTarget } from '../../../../../SceneExploreDiffFlameGraph/domain/types';\n\ninterface EventSelectForComparePayload {\n  compareTarget: CompareTarget;\n  item: GridItemData;\n}\n\nexport class EventSelectForCompare extends BusEventWithPayload<EventSelectForComparePayload> {\n  public static type = 'select-for-compare';\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Checkbox, Tooltip, useStyles2 } from '@grafana/ui';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { CompareTarget } from '../../../../../../../../SceneExploreDiffFlameGraph/domain/types';\n\ntype CompareActionProps = {\n  option: {\n    label: string;\n    value: CompareTarget;\n    description: string;\n  };\n  checked: boolean;\n  onChange: (compareTarget: CompareTarget) => void;\n};\n\nexport function CompareAction({ option, checked, onChange }: CompareActionProps) {\n  const styles = useStyles2(getStyles);\n\n  const [showTooltip, setShowTooltip] = useState(false);\n  const checkboxRef = useRef<HTMLInputElement>(null);\n  const label = (checkboxRef.current as HTMLInputElement)?.closest('label');\n\n  // we write custom code to provide the tooltips because wrapping our checkbox into the <Tooltip> component does not work\n  useEffect(() => {\n    if (!label || checked) {\n      setShowTooltip(false);\n      return;\n    }\n\n    const onMouseEnter = () => {\n      setShowTooltip(true);\n    };\n\n    const onMouseLeave = () => {\n      setShowTooltip(false);\n    };\n\n    label.addEventListener('mouseenter', onMouseEnter);\n    label.addEventListener('mouseleave', onMouseLeave);\n\n    return () => {\n      label.removeEventListener('mouseleave', onMouseLeave);\n      label.removeEventListener('mouseenter', onMouseEnter);\n    };\n  }, [checked, label]);\n\n  return (\n    <>\n      <Tooltip content={option.description} show={!checked && showTooltip} placement=\"top\">\n        <span className={styles.tooltipAnchor} />\n      </Tooltip>\n      <Checkbox\n        ref={checkboxRef}\n        className={cx(styles.checkbox, 'checkbox', checked && 'checked')}\n        checked={checked}\n        label={option.label}\n        onChange={() => onChange(option.value)}\n      />\n    </>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  tooltipAnchor: css`\n    position: relative;\n    left: 42px;\n  `,\n  checkbox: css`\n    column-gap: 4px;\n\n    &:last-child {\n      & :nth-child(1) {\n        grid-column-start: 2;\n      }\n      & :nth-child(2) {\n        grid-column-start: 1;\n      }\n    }\n\n    span {\n      color: ${theme.colors.text.secondary};\n    }\n    span:hover {\n      color: ${theme.colors.text.primary};\n    }\n\n    &.checked span {\n      color: ${theme.colors.text.primary};\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { getValueFormat, GrafanaTheme2 } from '@grafana/data';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React, { useMemo } from 'react';\n\nimport { GridItemData } from '../../../../../../../../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { getColorByIndex } from '../../../../../../../../../helpers/getColorByIndex';\nimport { CompareTarget } from '../../../../../../../../SceneExploreDiffFlameGraph/domain/types';\nimport { ItemStats } from '../SceneStatsPanel';\nimport { CompareAction } from './CompareAction';\n\ntype StatsPanelProps = {\n  item: GridItemData;\n  itemStats?: ItemStats;\n  statsDescription: string;\n  compareActionChecks: boolean[];\n  onChangeCompareTarget: (compareTarget: CompareTarget) => void;\n};\n\nexport function StatsPanel({\n  item,\n  itemStats,\n  statsDescription,\n  compareActionChecks,\n  onChangeCompareTarget,\n}: StatsPanelProps) {\n  const styles = useStyles2(getStyles);\n\n  const { index, value } = item;\n\n  const color = getColorByIndex(index);\n\n  const total = useMemo(() => {\n    if (!itemStats) {\n      return <Spinner inline />;\n    }\n\n    const { allValuesSum, unit } = itemStats;\n    const { text, suffix } = getValueFormat(unit)(allValuesSum);\n\n    return `${text}${suffix}`;\n  }, [itemStats]);\n\n  const options = useMemo(\n    () => [\n      {\n        label: 'Baseline',\n        value: CompareTarget.BASELINE,\n        description: !compareActionChecks[0] ? `Click to select \"${value}\" as baseline for comparison` : '',\n      },\n      {\n        label: 'Comparison',\n        value: CompareTarget.COMPARISON,\n        description: !compareActionChecks[1] ? `Click to select \"${value}\" as target for comparison` : '',\n      },\n    ],\n    [compareActionChecks, value]\n  );\n\n  return (\n    <div className={styles.container} data-testid={`stats-panel-${value}`}>\n      <h1 style={{ color }} className={styles.title} title={`${statsDescription}: ${total}`}>\n        {total}\n      </h1>\n\n      <div className={styles.compareActions}>\n        <CompareAction option={options[0]} checked={compareActionChecks[0]} onChange={onChangeCompareTarget} />\n        <CompareAction option={options[1]} checked={compareActionChecks[1]} onChange={onChangeCompareTarget} />\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    background-color: ${theme.colors.background.canvas};\n    padding: ${theme.spacing(1)};\n    border: 1px solid ${theme.colors.border.weak};\n    border-right: none;\n    border-radius: 2px 0 0 2px;\n  `,\n  title: css`\n    font-size: 24px;\n    width: 100%;\n    text-align: center;\n    margin-top: ${theme.spacing(5)};\n  `,\n  compareActions: css`\n    display: flex;\n    justify-content: space-between;\n    font-size: 11px;\n    border-top: 1px solid ${theme.colors.border.weak};\n    padding: ${theme.spacing(1)} 0 0 0;\n\n    & .checkbox:nth-child(2) {\n      padding-right: 4px;\n      border-right: 1px solid ${theme.colors.border.strong};\n    }\n    & .checkbox:nth-child(4) {\n      padding-left: 4px;\n    }\n  `,\n});\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React from 'react';\nimport { getSceneVariableValue } from 'src/pages/ProfilesExplorerView/helpers/getSceneVariableValue';\nimport { getProfileMetricLabel } from 'src/pages/ProfilesExplorerView/infrastructure/series/helpers/getProfileMetricLabel';\n\nimport { GridItemData } from '../../../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { CompareTarget } from '../../../../../../../SceneExploreDiffFlameGraph/domain/types';\nimport { EventSelectForCompare } from '../../../../domain/events/EventSelectForCompare';\nimport { SceneGroupByLabels } from '../../../../SceneGroupByLabels';\nimport { StatsPanel } from './ui/StatsPanel';\n\nexport type ItemStats = {\n  allValuesSum: number;\n  unit: string;\n};\n\ninterface SceneStatsPanelState extends SceneObjectState {\n  item: GridItemData;\n  itemStats?: ItemStats;\n  compareActionChecks: boolean[];\n  statsDescription: string;\n}\n\nexport class SceneStatsPanel extends SceneObjectBase<SceneStatsPanelState> {\n  static WIDTH_IN_PIXELS = 186;\n\n  constructor({ item }: { item: GridItemData }) {\n    super({\n      item,\n      itemStats: undefined,\n      compareActionChecks: [false, false],\n      statsDescription: '',\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const compare = sceneGraph.findByKeyAndType(this, 'group-by-labels', SceneGroupByLabels).getCompare();\n\n    this.updateCompareActions(compare.get(CompareTarget.BASELINE), compare.get(CompareTarget.COMPARISON));\n\n    this.setState({ statsDescription: this.getStatsDescription() });\n  }\n\n  updateCompareActions(baselineItem?: GridItemData, comparisonItem?: GridItemData) {\n    const { item } = this.state;\n\n    this.setState({\n      compareActionChecks: [baselineItem?.value === item.value, comparisonItem?.value === item.value],\n    });\n  }\n\n  getStatsDescription() {\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const { description } = getProfileMetric(profileMetricId as ProfileMetricId);\n    return description || getProfileMetricLabel(profileMetricId);\n  }\n\n  onChangeCompareTarget = (compareTarget: CompareTarget) => {\n    this.publishEvent(\n      new EventSelectForCompare({\n        compareTarget,\n        item: this.state.item,\n      }),\n      true\n    );\n  };\n\n  getStats() {\n    return this.state.itemStats;\n  }\n\n  updateStats(itemStats: ItemStats) {\n    this.setState({ itemStats });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneStatsPanel>) {\n    const { item, itemStats, statsDescription, compareActionChecks } = model.useState();\n\n    return (\n      <StatsPanel\n        item={item}\n        itemStats={itemStats}\n        statsDescription={statsDescription}\n        compareActionChecks={compareActionChecks}\n        onChangeCompareTarget={model.onChangeCompareTarget}\n      />\n    );\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState, VizPanelState } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../../../../../../../domain/events/EventTimeseriesDataReceived';\nimport { getSeriesStatsValue } from '../../../../../../../infrastructure/helpers/getSeriesStatsValue';\nimport { GridItemData } from '../../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneLabelValuesTimeseries } from '../../../../../../SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\nimport { GRID_AUTO_ROWS } from '../SceneLabelValuesGrid';\nimport { SceneStatsPanel } from './SceneStatsPanel/SceneStatsPanel';\n\ninterface SceneLabelValuesStatAndTimeseriesState extends SceneObjectState {\n  statsPanel: SceneStatsPanel;\n  timeseriesPanel: SceneLabelValuesTimeseries;\n}\n\nexport class SceneLabelValuePanel extends SceneObjectBase<SceneLabelValuesStatAndTimeseriesState> {\n  static buildPanelKey(item: GridItemData) {\n    return `compare-panel-${item.value}`;\n  }\n\n  constructor({\n    item,\n    headerActions,\n  }: {\n    item: GridItemData;\n    headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  }) {\n    super({\n      key: 'label-value-panel',\n      statsPanel: new SceneStatsPanel({ item }),\n      timeseriesPanel: new SceneLabelValuesTimeseries({ item, headerActions }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const { statsPanel, timeseriesPanel } = this.state;\n\n    const timeseriesSub = timeseriesPanel.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      const s = event.payload.series?.[0];\n\n      if (!s) {\n        statsPanel.updateStats({ allValuesSum: 0, unit: 'short' });\n        return;\n      }\n\n      const allValuesSum = getSeriesStatsValue(s, 'allValuesSum') || 0;\n\n      if (statsPanel.getStats()?.allValuesSum !== allValuesSum) {\n        statsPanel.updateStats({\n          allValuesSum,\n          unit: s.fields[1].config.unit || 'short',\n        });\n      }\n    });\n\n    return () => {\n      timeseriesSub.unsubscribe();\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuePanel>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { statsPanel, timeseriesPanel } = model.useState();\n    const { compareActionChecks } = statsPanel.useState();\n    const isSelected = compareActionChecks[0] || compareActionChecks[1];\n\n    return (\n      <div className={cx(styles.container, isSelected && 'selected')}>\n        <div className={styles.statsPanel}>\n          <statsPanel.Component model={statsPanel} />\n        </div>\n        <div className={styles.timeseriesPanel}>\n          <timeseriesPanel.Component model={timeseriesPanel} />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    min-width: 0px;\n    min-height: ${GRID_AUTO_ROWS};\n    flex-flow: row;\n\n    box-sizing: border-box;\n    border: 1px solid transparent;\n    &.selected {\n      border: 1px solid ${theme.colors.primary.main};\n    }\n\n    & > div {\n      display: flex;\n      position: relative;\n      flex-direction: row;\n      align-self: stretch;\n      min-height: ${GRID_AUTO_ROWS};\n    }\n  `,\n  statsPanel: css`\n    width: ${SceneStatsPanel.WIDTH_IN_PIXELS}px;\n  `,\n  timeseriesPanel: css`\n    flex-grow: 1;\n\n    & [data-viz-panel-key] > * {\n      border-top-left-radius: 0;\n      border-bottom-left-radius: 0;\n    }\n  `,\n});\n","import { SceneQueryRunner } from '@grafana/scenes';\n\nimport { PYROSCOPE_DATA_SOURCE } from '../../../../../../../infrastructure/pyroscope-data-sources';\n\nexport function buildLabelValuesGridQueryRunner({ label }: { label: string }) {\n  const selector = 'service_name=\"$serviceName\"';\n\n  return new SceneQueryRunner({\n    datasource: PYROSCOPE_DATA_SOURCE,\n    queries: [\n      {\n        refId: `$profileMetricId-${selector}-${label}`,\n        queryType: 'metrics',\n        profileTypeId: '$profileMetricId',\n        labelSelector: `{${selector}}`,\n        groupBy: [label],\n      },\n    ],\n  });\n}\n","import { DashboardCursorSync, DataFrame, LoadingState } from '@grafana/data';\nimport {\n  behaviors,\n  EmbeddedSceneState,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { Spinner } from '@grafana/ui';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport { debounce, isEqual } from 'lodash';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../../../../../../domain/events/EventTimeseriesDataReceived';\nimport { FiltersVariable } from '../../../../../../domain/variables/FiltersVariable/FiltersVariable';\nimport { GroupByVariable } from '../../../../../../domain/variables/GroupByVariable/GroupByVariable';\nimport { getSceneVariableValue } from '../../../../../../helpers/getSceneVariableValue';\nimport { getSeriesLabelFieldName } from '../../../../../../infrastructure/helpers/getSeriesLabelFieldName';\nimport { SceneEmptyState } from '../../../../../SceneByVariableRepeaterGrid/components/SceneEmptyState/SceneEmptyState';\nimport { SceneErrorState } from '../../../../../SceneByVariableRepeaterGrid/components/SceneErrorState/SceneErrorState';\nimport {\n  LayoutType,\n  SceneLayoutSwitcher,\n  SceneLayoutSwitcherState,\n} from '../../../../../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport {\n  SceneNoDataSwitcher,\n  SceneNoDataSwitcherState,\n} from '../../../../../SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher';\nimport { PanelType } from '../../../../../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport {\n  SceneQuickFilter,\n  SceneQuickFilterState,\n} from '../../../../../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\nimport { sortFavGridItems } from '../../../../../SceneByVariableRepeaterGrid/domain/sortFavGridItems';\nimport { addRefId, addStats } from '../../../../../SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneLabelValuePanel } from './components/SceneLabelValuePanel';\nimport { buildLabelValuesGridQueryRunner } from './infrastructure/buildLabelValuesGridQueryRunner';\n\ninterface SceneLabelValuesGridState extends EmbeddedSceneState {\n  $data: SceneDataProvider;\n  isLoading: boolean;\n  items: GridItemData[];\n  label: string;\n  startColorIndex: number;\n  headerActions: (item: GridItemData, items: GridItemData[]) => VizPanelState['headerActions'];\n  sortItemsFn: (a: GridItemData, b: GridItemData) => number;\n  hideNoData: boolean;\n}\n\nconst GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(600px, 1fr))';\nconst GRID_TEMPLATE_ROWS = '1fr';\nexport const GRID_AUTO_ROWS = '160px';\n\nexport class SceneLabelValuesGrid extends SceneObjectBase<SceneLabelValuesGridState> {\n  static buildGridItemKey(item: GridItemData) {\n    return `grid-item-${item.index}-${item.value}`;\n  }\n\n  constructor({\n    key,\n    label,\n    startColorIndex,\n    headerActions,\n  }: {\n    key: string;\n    label: SceneLabelValuesGridState['label'];\n    startColorIndex: SceneLabelValuesGridState['startColorIndex'];\n    headerActions: SceneLabelValuesGridState['headerActions'];\n  }) {\n    super({\n      key,\n      label,\n      startColorIndex,\n      items: [],\n      isLoading: true,\n      $data: new SceneDataTransformer({\n        $data: buildLabelValuesGridQueryRunner({ label }),\n        transformations: [addRefId, addStats],\n      }),\n      hideNoData: false,\n      headerActions,\n      sortItemsFn: sortFavGridItems,\n      body: new SceneCSSGridLayout({\n        templateColumns: GRID_TEMPLATE_ROWS,\n        autoRows: GRID_AUTO_ROWS,\n        isLazy: true,\n        $behaviors: [\n          new behaviors.CursorSync({\n            key: 'metricCrosshairSync',\n            sync: DashboardCursorSync.Crosshair,\n          }),\n        ],\n        children: [],\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.subscribeOnceToDataChange();\n\n    const groupBySub = this.subscribeToGroupByChange();\n\n    const refreshSub = this.subscribeToRefreshClick();\n    const quickFilterSub = this.subscribeToQuickFilterChange();\n    const layoutChangeSub = this.subscribeToLayoutChange();\n    const hideNoDataSub = this.subscribeToHideNoDataChange();\n    const filtersSub = this.subscribeToFiltersChange();\n\n    return () => {\n      filtersSub.unsubscribe();\n      hideNoDataSub.unsubscribe();\n      layoutChangeSub.unsubscribe();\n      quickFilterSub.unsubscribe();\n      refreshSub.unsubscribe();\n      groupBySub.unsubscribe();\n    };\n  }\n\n  subscribeOnceToDataChange(forceRender = false) {\n    const dataSub = this.state.$data.subscribeToState((newState) => {\n      if (newState.data?.state === LoadingState.Loading) {\n        return;\n      }\n\n      dataSub.unsubscribe();\n\n      this.renderGridItems(forceRender);\n\n      this.setState({ isLoading: false });\n    });\n  }\n\n  subscribeToGroupByChange() {\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n\n    return groupByVariable.subscribeToState((newState, prevState) => {\n      if (!newState.loading && prevState.loading) {\n        this.refetchData();\n      }\n    });\n  }\n\n  subscribeToRefreshClick() {\n    const onClickRefresh = () => {\n      this.refetchData();\n    };\n\n    // start of hack, for a better UX: we disable the variable \"refresh\" option and we allow the user to reload the list only by clicking on the \"Refresh\" button\n    // if we don't do this, every time the time range changes (even with auto-refresh on),\n    // all the timeseries present on the screen would be re-created, resulting in blinking and a poor UX\n    const refreshButton = document.querySelector(\n      '[data-testid=\"data-testid RefreshPicker run button\"]'\n    ) as HTMLButtonElement;\n\n    if (!refreshButton) {\n      logger.error(\n        new Error('SceneByVariableRepeaterGrid: Refresh button not found! The list of items will never be updated.')\n      );\n    }\n\n    refreshButton?.addEventListener('click', onClickRefresh);\n    refreshButton?.setAttribute('title', 'Click to completely refresh all the panels present on the screen');\n    // end of hack\n\n    return {\n      unsubscribe() {\n        refreshButton?.removeAttribute('title');\n        refreshButton?.removeEventListener('click', onClickRefresh);\n      },\n    };\n  }\n\n  subscribeToQuickFilterChange() {\n    const quickFilter = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.items.length !== prevState.items.length) {\n        quickFilter.setResultsCount(newState.items.length);\n      }\n    });\n\n    const onChangeState = (newState: SceneQuickFilterState, prevState?: SceneQuickFilterState) => {\n      if (newState.searchText !== prevState?.searchText) {\n        this.renderGridItems();\n      }\n    };\n\n    return quickFilter.subscribeToState(debounce(onChangeState, SceneQuickFilter.DEBOUNCE_DELAY));\n  }\n\n  subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher);\n    const body = this.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: SceneLayoutSwitcherState, prevState?: SceneLayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state);\n\n    return layoutSwitcher.subscribeToState(onChangeState);\n  }\n\n  subscribeToHideNoDataChange() {\n    const noDataSwitcher = sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher);\n\n    this.setState({ hideNoData: noDataSwitcher.state.hideNoData === 'on' });\n\n    const onChangeState = (newState: SceneNoDataSwitcherState, prevState?: SceneNoDataSwitcherState) => {\n      if (newState.hideNoData !== prevState?.hideNoData) {\n        this.setState({ hideNoData: newState.hideNoData === 'on' });\n\n        this.refetchData(true);\n      }\n    };\n\n    return noDataSwitcher.subscribeToState(onChangeState);\n  }\n\n  subscribeToFiltersChange() {\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n    const noDataSwitcher = sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher);\n\n    // the handler will be called each time a filter is added/removed/modified\n    return filtersVariable.subscribeToState(() => {\n      if (noDataSwitcher.state.hideNoData === 'on') {\n        // to be sure the list is updated we refetch because the filters only influence the query made in each panel\n        this.refetchData();\n      }\n    });\n  }\n\n  refetchData(forceRender = false) {\n    this.setState({\n      isLoading: true,\n      $data: new SceneDataTransformer({\n        $data: buildLabelValuesGridQueryRunner({ label: this.state.label }),\n        transformations: [addRefId, addStats],\n      }),\n    });\n\n    this.subscribeOnceToDataChange(forceRender);\n  }\n\n  shouldRenderItems(newItems: SceneLabelValuesGridState['items']) {\n    const { items } = this.state;\n\n    if (!newItems.length || items.length !== newItems.length) {\n      return true;\n    }\n\n    return !isEqual(items, newItems);\n  }\n\n  buildItemsData(series: DataFrame[]) {\n    const serviceName = getSceneVariableValue(this, 'serviceName');\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n\n    const { label, startColorIndex, sortItemsFn } = this.state;\n\n    // the series are already sorted by the data transformation\n    const items = series.map((s, index) => {\n      const metricField = s.fields[1];\n      const labelValue = metricField.labels?.[label] || '';\n      const labelName = getSeriesLabelFieldName(metricField, label);\n\n      return {\n        index: startColorIndex + index,\n        value: labelValue,\n        label: labelName,\n        queryRunnerParams: {\n          serviceName,\n          profileMetricId,\n          // defaults to an \"is empty\" operator in the UI when the label value is not set\n          filters: [{ key: label, operator: '=', value: labelValue }],\n        },\n        panelType: PanelType.TIMESERIES,\n      };\n    });\n\n    return this.filterItems(items).sort(sortItemsFn);\n  }\n\n  renderGridItems(forceRender = false) {\n    if (!this.state.$data.state.data) {\n      return;\n    }\n\n    const { state: loadingState, series, errors } = this.state.$data.state.data;\n\n    if (loadingState === LoadingState.Loading) {\n      return;\n    }\n\n    if (loadingState === LoadingState.Error) {\n      // TODO: check if we need https://github.com/grafana/grafana/blob/d7f7cd1e61eac1e0103e0ca1e2122264aa831ffd/public/app/plugins/datasource/azuremonitor/utils/messageFromError.ts#L30\n      this.renderErrorState(errors?.[0] as Error);\n      return;\n    }\n\n    const newItems = this.buildItemsData(series);\n\n    if (!forceRender && !this.shouldRenderItems(newItems)) {\n      return;\n    }\n\n    this.setState({ items: newItems });\n\n    if (!this.state.items.length) {\n      this.renderEmptyState();\n      return;\n    }\n\n    const gridItems = newItems.map((item) => {\n      return new SceneCSSGridItem({\n        key: SceneLabelValuesGrid.buildGridItemKey(item),\n        body: this.buildVizPanel(item),\n      });\n    });\n\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: GRID_AUTO_ROWS, // required to have the correct grid items height\n      children: gridItems,\n    });\n  }\n\n  buildVizPanel(item: GridItemData) {\n    const vizPanel = new SceneLabelValuePanel({\n      item,\n      headerActions: this.state.headerActions.bind(null, item, this.state.items),\n    });\n\n    const sub = vizPanel.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      if (!this.state.hideNoData || event.payload.series?.length) {\n        return;\n      }\n\n      const gridItem = sceneGraph.getAncestor(vizPanel, SceneCSSGridItem);\n      const { key: gridItemKey } = gridItem.state;\n      const grid = sceneGraph.getAncestor(gridItem, SceneCSSGridLayout);\n\n      const filteredChildren = grid.state.children.filter((c) => c.state.key !== gridItemKey);\n\n      if (!filteredChildren.length) {\n        this.renderEmptyState();\n      } else {\n        grid.setState({ children: filteredChildren });\n      }\n    });\n\n    vizPanel.addActivationHandler(() => {\n      return () => {\n        sub.unsubscribe();\n      };\n    });\n\n    return vizPanel;\n  }\n\n  filterItems(items: SceneLabelValuesGridState['items']) {\n    const quickFilterScene = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n    const { searchText } = quickFilterScene.state;\n\n    if (!searchText) {\n      return items;\n    }\n\n    const regexes = searchText\n      .split(',')\n      .map((t) => t.trim())\n      .filter(Boolean)\n      .map((r) => {\n        try {\n          return new RegExp(r);\n        } catch {\n          return null;\n        }\n      })\n      .filter(Boolean) as RegExp[];\n\n    return items.filter(({ label }) => regexes.some((r) => r.test(label)));\n  }\n\n  renderEmptyState() {\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: '480px',\n      children: [\n        new SceneCSSGridItem({\n          body: new SceneEmptyState({\n            message: 'No results',\n          }),\n        }),\n      ],\n    });\n  }\n\n  renderErrorState(error: Error) {\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: '480px',\n      children: [\n        new SceneCSSGridItem({\n          body: new SceneErrorState({\n            message: error.message || error.toString(),\n          }),\n        }),\n      ],\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesGrid>) {\n    const { body, isLoading } = model.useState();\n\n    return isLoading ? (\n      <Spinner />\n    ) : (\n      <div style={{ marginBottom: '2px' }}>\n        <body.Component model={body} />\n      </div>\n    );\n  }\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventClearLabelFromFiltersPayload {\n  item: GridItemData;\n}\n\nexport class EventClearLabelFromFilters extends BusEventWithPayload<EventClearLabelFromFiltersPayload> {\n  public static type = 'clear-label-from-filters';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventExcludeLabelFromFiltersPayload {\n  item: GridItemData;\n}\n\nexport class EventExcludeLabelFromFilters extends BusEventWithPayload<EventExcludeLabelFromFiltersPayload> {\n  public static type = 'exclude-label-from-filters';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventIncludeLabelInFiltersPayload {\n  item: GridItemData;\n}\n\nexport class EventIncludeLabelInFilters extends BusEventWithPayload<EventIncludeLabelInFiltersPayload> {\n  public static type = 'include-label-in-filters';\n}\n\nexport interface EventExcludeLabelFromFiltersPayload {\n  item: GridItemData;\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React, { memo } from 'react';\n\ntype FilterButtonsProps = {\n  label: string;\n  status: 'included' | 'excluded' | 'clear';\n  onInclude: () => void;\n  onExclude: () => void;\n  onClear: () => void;\n};\n\nfunction getStatus({ status, label, onInclude, onExclude, onClear }: FilterButtonsProps) {\n  const isIncludeSelected = status === 'included';\n  const includeTooltip = !isIncludeSelected ? `Include \"${label}\" in the filters` : `Clear \"${label}\" from the filters`;\n\n  const isExcludeSelected = status === 'excluded';\n  const excludeTooltip = !isExcludeSelected ? `Exclude \"${label}\" in the filters` : `Clear \"${label}\" from the filters`;\n\n  return {\n    include: {\n      isSelected: isIncludeSelected,\n      tooltip: includeTooltip,\n      onClick: isIncludeSelected ? onClear : onInclude,\n    },\n    exclude: {\n      isSelected: isExcludeSelected,\n      tooltip: excludeTooltip,\n      onClick: isExcludeSelected ? onClear : onExclude,\n    },\n  };\n}\n\n// Kindly borrowed and adapted from https://github.com/grafana/explore-logs/blob/main/src/Components/FilterButton.tsx :)\nconst FilterButtonsComponent = (props: FilterButtonsProps) => {\n  const styles = useStyles2(getStyles);\n\n  const { include, exclude } = getStatus(props);\n\n  return (\n    <div className={styles.container}>\n      <Button\n        size=\"sm\"\n        fill=\"outline\"\n        variant={include.isSelected ? 'primary' : 'secondary'}\n        aria-selected={include.isSelected}\n        className={cx(styles.includeButton, include.isSelected && 'selected')}\n        onClick={include.onClick}\n        tooltip={include.tooltip}\n        tooltipPlacement=\"top\"\n        data-testid=\"filter-button-include\"\n      >\n        Include\n      </Button>\n      <Button\n        size=\"sm\"\n        fill=\"outline\"\n        variant={exclude.isSelected ? 'primary' : 'secondary'}\n        aria-selected={exclude.isSelected}\n        className={cx(styles.excludeButton, exclude.isSelected && 'selected')}\n        onClick={exclude.onClick}\n        tooltip={exclude.tooltip}\n        tooltipPlacement=\"top\"\n        data-testid=\"filter-button-exclude\"\n      >\n        Exclude\n      </Button>\n    </div>\n  );\n};\n\nexport const FilterButtons = memo(FilterButtonsComponent);\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    container: css`\n      display: flex;\n      justify-content: center;\n    `,\n    includeButton: css`\n      border-radius: ${theme.shape.radius.default} 0 0 ${theme.shape.radius.default};\n\n      &:not(.selected) {\n        border-right: none;\n      }\n    `,\n    excludeButton: css`\n      border-radius: 0 ${theme.shape.radius.default} ${theme.shape.radius.default} 0;\n\n      &:not(.selected) {\n        border-left: none;\n      }\n    `,\n  };\n};\n","import { AdHocVariableFilter } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { isRegexOperator } from '@shared/components/QueryBuilder/domain/helpers/isRegexOperator';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React, { useMemo } from 'react';\n\nimport { FiltersVariable } from '../../../../../../../domain/variables/FiltersVariable/FiltersVariable';\nimport { GridItemData } from '../../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { EventClearLabelFromFilters } from '../../events/EventClearLabelFromFilters';\nimport { EventExcludeLabelFromFilters } from '../../events/EventExcludeLabelFromFilters';\nimport { EventIncludeLabelInFilters } from '../../events/EventIncludeLabelInFilters';\nimport { FilterButtons } from './ui/FilterButtons';\n\nexport interface IncludeExcludeActionState extends SceneObjectState {\n  item: GridItemData;\n}\n\nexport class IncludeExcludeAction extends SceneObjectBase<IncludeExcludeActionState> {\n  constructor({ item }: IncludeExcludeActionState) {\n    super({ item });\n  }\n\n  getStatus(filters: AdHocVariableFilter[]) {\n    const { key, value } = this.state.item.queryRunnerParams.filters![0];\n\n    const found = filters.find((f) => f.key === key);\n    if (!found) {\n      return 'clear';\n    }\n\n    if (isRegexOperator(found.operator) && found.value.split('|').includes(value)) {\n      return found.operator === '=~' ? 'included' : 'excluded';\n    }\n\n    // found.operator is '=' or '!='\n    if (found.value === value) {\n      return found.operator === '=' ? 'included' : 'excluded';\n    }\n\n    return 'clear';\n  }\n\n  onInclude = () => {\n    reportInteraction('g_pyroscope_app_include_action_clicked');\n\n    this.publishEvent(new EventIncludeLabelInFilters({ item: this.state.item }), true);\n  };\n\n  onExclude = () => {\n    reportInteraction('g_pyroscope_app_exclude_action_clicked');\n\n    this.publishEvent(new EventExcludeLabelFromFilters({ item: this.state.item }), true);\n  };\n\n  onClear = () => {\n    this.publishEvent(new EventClearLabelFromFilters({ item: this.state.item }), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<IncludeExcludeAction>) => {\n    const { item } = model.useState();\n\n    const { filters } = (sceneGraph.findByKeyAndType(model, 'filters', FiltersVariable) as FiltersVariable).useState();\n    const status = useMemo(() => model.getStatus(filters), [filters, model]);\n\n    return (\n      <FilterButtons\n        label={item.value}\n        status={status}\n        onInclude={model.onInclude}\n        onExclude={model.onExclude}\n        onClear={model.onClear}\n      />\n    );\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { noOp } from '@shared/domain/noOp';\nimport React, { useMemo } from 'react';\n\nimport { CompareTarget } from '../../../../SceneExploreDiffFlameGraph/domain/types';\nimport { SceneStatsPanel } from '../components/SceneLabelValuesGrid/components/SceneStatsPanel/SceneStatsPanel';\nimport { SceneGroupByLabelsState } from '../SceneGroupByLabels';\n\ntype CompareButtonProps = {\n  compare: SceneGroupByLabelsState['compare'];\n  onClickCompare: () => void;\n  onClickClear: () => void;\n};\n\nexport function CompareControls({ compare, onClickCompare, onClickClear }: CompareButtonProps) {\n  const styles = useStyles2(getStyles);\n  const compareIsDisabled = compare.size < 2;\n  const hasSelection = compare.size > 0;\n\n  const tooltip = useMemo(() => {\n    if (compare.size === 2) {\n      return `Compare \"${compare.get(CompareTarget.BASELINE)?.label}\" vs \"${\n        compare.get(CompareTarget.COMPARISON)?.label\n      }\"`;\n    }\n    if (compare.size === 0) {\n      return 'Select both a baseline and a comparison panel to compare their flame graphs';\n    }\n\n    return compare.has(CompareTarget.BASELINE)\n      ? `Select another panel to compare against \"${compare.get(CompareTarget.BASELINE)?.label}\"`\n      : `Select another panel to compare against \"${compare.get(CompareTarget.COMPARISON)?.label}\"`;\n  }, [compare]);\n\n  return (\n    <div className={styles.container}>\n      <Button\n        arial-label=\"Compare\"\n        className={styles.compareButton}\n        variant=\"primary\"\n        disabled={compareIsDisabled}\n        onClick={compareIsDisabled ? noOp : onClickCompare}\n        tooltip={tooltip}\n      >\n        Compare ({compare.size}/2)\n      </Button>\n\n      <Button\n        data-testid=\"clearComparison\"\n        className={cx(styles.clearButton, !compareIsDisabled ? styles.clearButtonActive : undefined)}\n        icon=\"times\"\n        variant=\"secondary\"\n        tooltip={hasSelection ? 'Clear comparison selection' : ''}\n        disabled={!hasSelection}\n        onClick={!hasSelection ? noOp : onClickClear}\n      />\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    align-items: center;\n    width: ${SceneStatsPanel.WIDTH_IN_PIXELS}px;\n  `,\n  compareButton: css`\n    width: ${SceneStatsPanel.WIDTH_IN_PIXELS - 32}px;\n    border-right: none;\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n  `,\n  clearButton: css`\n    box-sizing: border-box;\n    width: 32px !important;\n    height: 32px !important;\n    color: ${theme.colors.text.secondary};\n    background-color: transparent;\n    border-left: none !important;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n\n    &:not([disabled]),\n    &:not([disabled]):hover {\n      background-color: transparent;\n      box-shadow: none;\n    }\n  `,\n  clearButtonActive: css`\n    border-color: ${theme.colors.border.medium};\n\n    &:hover {\n      border-color: ${theme.colors.border.medium};\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Stack, useStyles2 } from '@grafana/ui';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React, { useMemo } from 'react';\nimport { Unsubscribable } from 'rxjs';\nimport { EventViewDiffFlameGraph } from 'src/pages/ProfilesExplorerView/domain/events/EventViewDiffFlameGraph';\n\nimport { FavAction } from '../../../../domain/actions/FavAction';\nimport { SelectAction } from '../../../../domain/actions/SelectAction';\nimport { EventSelectLabel } from '../../../../domain/events/EventSelectLabel';\nimport {\n  clearLabelValue,\n  excludeLabelValue,\n  includeLabelValue,\n} from '../../../../domain/variables/FiltersVariable/filters-ops';\nimport { FiltersVariable } from '../../../../domain/variables/FiltersVariable/FiltersVariable';\nimport { GroupByVariable } from '../../../../domain/variables/GroupByVariable/GroupByVariable';\nimport { getSceneVariableValue } from '../../../../helpers/getSceneVariableValue';\nimport { interpolateQueryRunnerVariables } from '../../../../infrastructure/helpers/interpolateQueryRunnerVariables';\nimport { SceneLayoutSwitcher } from '../../../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { SceneNoDataSwitcher } from '../../../SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher';\nimport {\n  PanelType,\n  ScenePanelTypeSwitcher,\n  ScenePanelTypeSwitcherState,\n} from '../../../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter } from '../../../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\nimport { SceneByVariableRepeaterGrid } from '../../../SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid';\nimport { GridItemData } from '../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { CompareTarget } from '../../../SceneExploreDiffFlameGraph/domain/types';\nimport { SceneProfilesExplorer } from '../../../SceneProfilesExplorer/SceneProfilesExplorer';\nimport { SceneStatsPanel } from './components/SceneLabelValuesGrid/components/SceneStatsPanel/SceneStatsPanel';\nimport { SceneLabelValuesGrid } from './components/SceneLabelValuesGrid/SceneLabelValuesGrid';\nimport { IncludeExcludeAction } from './domain/actions/IncludeExcludeAction/IncludeExcludeAction';\nimport { EventClearLabelFromFilters } from './domain/events/EventClearLabelFromFilters';\nimport { EventExcludeLabelFromFilters } from './domain/events/EventExcludeLabelFromFilters';\nimport { EventIncludeLabelInFilters } from './domain/events/EventIncludeLabelInFilters';\nimport { EventSelectForCompare } from './domain/events/EventSelectForCompare';\nimport { CompareControls } from './ui/CompareControls';\n\nexport interface SceneGroupByLabelsState extends SceneObjectState {\n  body?: SceneObject;\n  compare: Map<CompareTarget, GridItemData>;\n  panelTypeChangeSub?: Unsubscribable;\n}\n\nexport class SceneGroupByLabels extends SceneObjectBase<SceneGroupByLabelsState> {\n  constructor({ item }: { item?: GridItemData }) {\n    super({\n      key: 'group-by-labels',\n      body: undefined,\n      compare: new Map(),\n      panelTypeChangeSub: undefined,\n    });\n\n    this.addActivationHandler(() => {\n      this.onActivate(item);\n    });\n  }\n\n  async onActivate(item?: GridItemData) {\n    // initial load\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n    await groupByVariable.update();\n\n    if (item) {\n      this.initVariablesAndControls(item);\n    }\n\n    this.renderBody(groupByVariable);\n\n    const groupBySub = this.subscribeToGroupByChange();\n    const panelEventsSub = this.subscribeToPanelEvents();\n\n    return () => {\n      panelEventsSub.unsubscribe();\n      groupBySub.unsubscribe();\n\n      this.state.panelTypeChangeSub?.unsubscribe();\n    };\n  }\n\n  initVariablesAndControls(item: GridItemData) {\n    const { queryRunnerParams, panelType } = item;\n    const { groupBy } = queryRunnerParams;\n\n    if (groupBy?.label) {\n      const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n      groupByVariable.changeValueTo(groupBy.label);\n    }\n\n    if (panelType) {\n      const panelTypeSwitcher = sceneGraph.findByKeyAndType(this, 'panel-type-switcher', ScenePanelTypeSwitcher);\n      panelTypeSwitcher.setState({ panelType });\n    }\n  }\n\n  subscribeToGroupByChange() {\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n    const quickFilter = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n\n    return groupByVariable.subscribeToState((newState, prevState) => {\n      if (newState.value !== prevState?.value) {\n        quickFilter.clearSearchText();\n\n        this.renderBody(groupByVariable);\n      }\n    });\n  }\n\n  subscribeToPanelEvents() {\n    const selectLabelSub = this.subscribeToEvent(EventSelectLabel, (event) => {\n      this.selectLabel(event.payload.item);\n    });\n\n    const selectForCompareSub = this.subscribeToEvent(EventSelectForCompare, (event) => {\n      const { compareTarget, item } = event.payload;\n      this.selectForCompare(compareTarget, item);\n    });\n\n    const includeFilterSub = this.subscribeToEvent(EventIncludeLabelInFilters, (event) => {\n      this.includeLabelValueInFilters(event.payload.item);\n    });\n\n    const excludeFilterSub = this.subscribeToEvent(EventExcludeLabelFromFilters, (event) => {\n      this.excludeLabelValueFromFilters(event.payload.item);\n    });\n\n    const clearFilterSub = this.subscribeToEvent(EventClearLabelFromFilters, (event) => {\n      this.clearLabelValueFromFilters(event.payload.item);\n    });\n\n    return {\n      unsubscribe() {\n        clearFilterSub.unsubscribe();\n        excludeFilterSub.unsubscribe();\n        includeFilterSub.unsubscribe();\n        selectForCompareSub.unsubscribe();\n        selectLabelSub.unsubscribe();\n      },\n    };\n  }\n\n  subscribeToPanelTypeChange() {\n    const panelTypeSwitcher = sceneGraph.findByKeyAndType(this, 'panel-type-switcher', ScenePanelTypeSwitcher);\n\n    return panelTypeSwitcher.subscribeToState(\n      (newState: ScenePanelTypeSwitcherState, prevState?: ScenePanelTypeSwitcherState) => {\n        if (newState.panelType !== prevState?.panelType) {\n          (this.state.body as SceneByVariableRepeaterGrid)?.renderGridItems();\n        }\n      }\n    );\n  }\n\n  renderBody(groupByVariable: GroupByVariable) {\n    this.state.panelTypeChangeSub?.unsubscribe();\n\n    if (groupByVariable.state.value === 'all') {\n      // we have to resubscribe every time because the subscription is removed every time the ScenePanelTypeSwitcher UI component is unmounted\n      this.setState({ panelTypeChangeSub: this.subscribeToPanelTypeChange() });\n\n      this.switchToLabelNamesGrid();\n    } else {\n      this.switchToLabelValuesGrid(groupByVariable);\n    }\n  }\n\n  switchToLabelNamesGrid() {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search labels (comma-separated regexes are supported)');\n\n    this.setState({\n      body: this.buildSceneLabelNamesGrid(),\n    });\n  }\n\n  buildSceneLabelNamesGrid() {\n    return new SceneByVariableRepeaterGrid({\n      key: 'service-labels-grid',\n      variableName: 'groupBy',\n      mapOptionToItem: (option, index, { serviceName, profileMetricId, panelType }) => {\n        if (option.value === 'all') {\n          return null;\n        }\n\n        // see LabelsDataSource.ts\n        const { value, groupBy } = JSON.parse(option.value as string);\n\n        return {\n          index: index - 1, // the 'all' option has been removed ;)\n          value,\n          // remove the count in parenthesis that exists in option.label\n          // it'll be set by SceneLabelValuesTimeseries or SceneLabelValuesBarGauge\n          label: value,\n          queryRunnerParams: {\n            serviceName,\n            profileMetricId,\n            groupBy,\n            filters: [],\n          },\n          panelType: panelType as PanelType,\n        };\n      },\n      headerActions: (item) => [\n        new SelectAction({ type: 'select-label', item }),\n        new SelectAction({ type: 'expand-panel', item }),\n        new FavAction({ item }),\n      ],\n    });\n  }\n\n  switchToLabelValuesGrid(groupByVariable: GroupByVariable) {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search label values (comma-separated regexes are supported)');\n\n    this.clearCompare();\n\n    const { index, value } = groupByVariable.findCurrentOption();\n\n    this.setState({\n      body: this.buildSceneLabelValuesGrid(value, index),\n    });\n  }\n\n  buildSceneLabelValuesGrid(label: string, startColorIndex: number) {\n    return new SceneLabelValuesGrid({\n      key: 'service-label-values-grid',\n      startColorIndex,\n      label,\n      headerActions: (item) => [\n        new SelectAction({\n          type: 'view-flame-graph',\n          item,\n          tooltip: (item, model) => {\n            const { queryRunnerParams, label } = item;\n            const profileMetricId =\n              queryRunnerParams.profileMetricId || getSceneVariableValue(model, 'profileMetricId');\n            const groupByValue = getSceneVariableValue(model, 'groupBy');\n\n            return `View the \"${\n              getProfileMetric(profileMetricId as ProfileMetricId).type\n            }\" flame graph for \"${groupByValue}=${label}\"`;\n          },\n        }),\n        new IncludeExcludeAction({ item }),\n        new FavAction({ item }),\n      ],\n    });\n  }\n\n  selectLabel({ queryRunnerParams }: GridItemData) {\n    const labelValue = queryRunnerParams!.groupBy!.label;\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n\n    prepareHistoryEntry();\n    groupByVariable.changeValueTo(labelValue);\n  }\n\n  includeLabelValueInFilters(item: GridItemData) {\n    const [filterToInclude] = item.queryRunnerParams.filters!;\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n\n    filtersVariable.setState({ filters: includeLabelValue(filtersVariable.state.filters, filterToInclude) });\n  }\n\n  excludeLabelValueFromFilters(item: GridItemData) {\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n    const [filterToExclude] = item.queryRunnerParams.filters!;\n\n    filtersVariable.setState({ filters: excludeLabelValue(filtersVariable.state.filters, filterToExclude) });\n  }\n\n  clearLabelValueFromFilters(item: GridItemData) {\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n    const [filterToClear] = item.queryRunnerParams.filters!;\n\n    filtersVariable.setState({ filters: clearLabelValue(filtersVariable.state.filters, filterToClear) });\n  }\n\n  selectForCompare(compareTarget: CompareTarget, item: GridItemData) {\n    const compare = new Map(this.state.compare);\n\n    if (compare.get(compareTarget)?.value === item.value) {\n      compare.delete(compareTarget);\n    } else {\n      compare.set(compareTarget, item);\n    }\n\n    this.setState({ compare });\n\n    this.updateStatsPanels();\n  }\n\n  updateStatsPanels() {\n    const { compare } = this.state;\n    const baselineItem = compare.get(CompareTarget.BASELINE);\n    const comparisonItem = compare.get(CompareTarget.COMPARISON);\n\n    const statsPanels = sceneGraph.findAllObjects(this, (o) => o instanceof SceneStatsPanel) as SceneStatsPanel[];\n\n    // TODO: optimize if needed\n    // we can remove the loop if we clear the current selection in the UI before updating the compare map (see selectForCompare() and onClickClearCompareButton())\n    for (const panel of statsPanels) {\n      panel.updateCompareActions(baselineItem, comparisonItem);\n    }\n  }\n\n  getCompare() {\n    return this.state.compare;\n  }\n\n  clearCompare() {\n    this.setState({ compare: new Map() });\n  }\n\n  onClickCompareButton = () => {\n    reportInteraction('g_pyroscope_app_compare_link_clicked');\n\n    const { compare } = this.state;\n\n    const { filters: baselineFilters } = interpolateQueryRunnerVariables(\n      this,\n      compare.get(CompareTarget.BASELINE) as GridItemData\n    );\n\n    const { filters: comparisonFilters } = interpolateQueryRunnerVariables(\n      this,\n      compare.get(CompareTarget.COMPARISON) as GridItemData\n    );\n\n    this.publishEvent(\n      new EventViewDiffFlameGraph({\n        useAncestorTimeRange: true,\n        clearDiffRange: true,\n        baselineFilters,\n        comparisonFilters,\n      }),\n      true\n    );\n  };\n\n  onClickClearCompareButton = () => {\n    this.clearCompare();\n    this.updateStatsPanels();\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneGroupByLabels>) => {\n    const styles = useStyles2(getStyles);\n\n    const { body, compare } = model.useState();\n\n    const groupByVariable = sceneGraph.findByKeyAndType(model, 'groupBy', GroupByVariable);\n    const { value: groupByVariableValue } = groupByVariable.useState();\n\n    const gridControls = useMemo(\n      () =>\n        groupByVariableValue === 'all'\n          ? sceneGraph.findByKeyAndType(model, 'profiles-explorer', SceneProfilesExplorer).state.gridControls\n          : ([\n              sceneGraph.findByKeyAndType(model, 'quick-filter', SceneQuickFilter),\n              sceneGraph.findByKeyAndType(model, 'layout-switcher', SceneLayoutSwitcher),\n              sceneGraph.findByKeyAndType(model, 'no-data-switcher', SceneNoDataSwitcher),\n            ] as SceneObject[]),\n      [groupByVariableValue, model]\n    );\n\n    return (\n      <div className={styles.container} data-testid=\"groupByLabelsContainer\">\n        <groupByVariable.Component model={groupByVariable} />\n\n        <div className={styles.sceneControls}>\n          <Stack wrap=\"wrap\">\n            {groupByVariableValue !== 'all' && (\n              <CompareControls\n                compare={compare}\n                onClickCompare={model.onClickCompareButton}\n                onClickClear={model.onClickClearCompareButton}\n              />\n            )}\n\n            {gridControls.map((control) => (\n              <control.Component key={control.state.key} model={control} />\n            ))}\n          </Stack>\n        </div>\n\n        {body && <body.Component model={body} />}\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    margin-top: ${theme.spacing(1)};\n  `,\n  sceneControls: css`\n    margin-bottom: ${theme.spacing(1)};\n\n    & .quick-filter {\n      flex: 1;\n      min-width: 112px;\n    }\n  `,\n});\n","import { DashboardCursorSync } from '@grafana/data';\nimport {\n  behaviors,\n  SceneComponentProps,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n} from '@grafana/scenes';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React from 'react';\n\nimport { SceneMainServiceTimeseries } from '../../components/SceneMainServiceTimeseries';\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { EventExpandPanel } from '../../domain/events/EventExpandPanel';\nimport { EventSelectLabel } from '../../domain/events/EventSelectLabel';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { vizPanelBuilder } from '../../helpers/vizPanelBuilder';\nimport { getProfileMetricLabel } from '../../infrastructure/series/helpers/getProfileMetricLabel';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneDrawer } from '../SceneDrawer';\nimport { SceneGroupByLabels } from './components/SceneGroupByLabels/SceneGroupByLabels';\n\ninterface SceneExploreServiceLabelsState extends SceneObjectState {\n  body: SceneFlexLayout;\n  drawer: SceneDrawer;\n}\n\nexport class SceneExploreServiceLabels extends SceneObjectBase<SceneExploreServiceLabelsState> {\n  constructor({ item }: { item?: GridItemData }) {\n    super({\n      key: 'explore-service-labels',\n      body: new SceneFlexLayout({\n        direction: 'column',\n        $behaviors: [\n          new behaviors.CursorSync({\n            key: 'metricCrosshairSync',\n            sync: DashboardCursorSync.Crosshair,\n          }),\n        ],\n        children: [\n          new SceneFlexItem({\n            minHeight: SceneMainServiceTimeseries.MIN_HEIGHT,\n            body: new SceneMainServiceTimeseries({\n              item,\n              headerActions: (item) => {\n                return item.queryRunnerParams.groupBy\n                  ? [\n                      new SelectAction({ type: 'view-flame-graph', item }),\n                      new SelectAction({\n                        type: 'expand-panel',\n                        item,\n                      }),\n                      new FavAction({ item }),\n                    ]\n                  : [new SelectAction({ type: 'view-flame-graph', item }), new FavAction({ item })];\n              },\n              supportGroupBy: true,\n            }),\n          }),\n          new SceneFlexItem({\n            body: new SceneGroupByLabels({ item }),\n          }),\n        ],\n      }),\n      drawer: new SceneDrawer(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item?: GridItemData) {\n    if (item) {\n      this.initVariables(item);\n    }\n\n    const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n\n    profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_SERVICE_NAME_DEPENDENT });\n    profileMetricVariable.update(true);\n\n    const panelEventsSub = this.subscribeToPanelEvents();\n\n    return () => {\n      panelEventsSub.unsubscribe();\n      profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_DEFAULT });\n      profileMetricVariable.update(true);\n    };\n  }\n\n  initVariables(item: GridItemData) {\n    const { queryRunnerParams } = item;\n    const { serviceName, profileMetricId, filters } = queryRunnerParams;\n\n    if (serviceName) {\n      const serviceNameVariable = sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable);\n      serviceNameVariable.changeValueTo(serviceName);\n    }\n\n    if (profileMetricId) {\n      const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n      profileMetricVariable.changeValueTo(profileMetricId);\n    }\n\n    if (filters) {\n      const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n      filtersVariable.setState({ filters });\n    }\n  }\n\n  subscribeToPanelEvents() {\n    const expandPanelSub = this.subscribeToEvent(EventExpandPanel, async (event) => {\n      this.openExpandedPanelDrawer(event.payload.item);\n    });\n\n    const selectLabelSub = this.subscribeToEvent(EventSelectLabel, () => {\n      // the event may be published from an expanded panel in the drawer\n      this.state.drawer.close();\n    });\n\n    return {\n      unsubscribe() {\n        selectLabelSub.unsubscribe();\n        expandPanelSub.unsubscribe();\n      },\n    };\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [\n        sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable),\n        sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable),\n        sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable),\n      ],\n      gridControls: [],\n    };\n  }\n\n  openExpandedPanelDrawer(item: GridItemData) {\n    const title = getSceneVariableValue(this, 'serviceName');\n\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const profileMetricDescription =\n      getProfileMetric(profileMetricId as ProfileMetricId).description || getProfileMetricLabel(profileMetricId);\n    const timeseriesTitle = `${profileMetricDescription}, grouped by ${item.queryRunnerParams.groupBy?.label || '?'}`;\n\n    this.state.drawer.open({\n      title,\n      body: vizPanelBuilder(item.panelType, {\n        displayAllValues: true,\n        legendPlacement: 'right',\n        item: { ...item, label: timeseriesTitle },\n        headerActions: () => [new SelectAction({ type: 'select-label', item }), new FavAction({ item })],\n      }),\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreServiceLabels>) {\n    const { body, drawer } = model.useState();\n\n    return (\n      <>\n        <body.Component model={body} />\n        <drawer.Component model={drawer} />\n      </>\n    );\n  }\n}\n","import {\n  EmbeddedSceneState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { SceneByVariableRepeaterGrid } from '../../components/SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid';\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { SceneLayoutSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { PanelType } from '../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter } from '../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\n\ninterface SceneExploreServiceProfileTypesState extends EmbeddedSceneState {}\n\nexport class SceneExploreServiceProfileTypes extends SceneObjectBase<SceneExploreServiceProfileTypesState> {\n  constructor({ item }: { item?: GridItemData }) {\n    super({\n      key: 'explore-service-profile-types',\n      $variables: new SceneVariableSet({\n        variables: [\n          // we use a custom instance of ProfileMetricVariable to display only the profile metrics associated to the selected service\n          new ProfileMetricVariable({\n            query: ProfileMetricVariable.QUERY_SERVICE_NAME_DEPENDENT,\n            skipUrlSync: true,\n          }),\n        ],\n      }),\n      body: new SceneByVariableRepeaterGrid({\n        key: 'profile-metrics-grid',\n        variableName: 'profileMetricId',\n        mapOptionToItem: (option, index, { serviceName }) => ({\n          index,\n          value: option.value as string,\n          label: option.label,\n          queryRunnerParams: {\n            serviceName,\n            profileMetricId: option.value as string,\n          },\n          panelType: PanelType.TIMESERIES,\n        }),\n        headerActions: (item) => [\n          new SelectAction({ type: 'view-labels', item }),\n          new SelectAction({ type: 'view-flame-graph', item }),\n          new FavAction({ item }),\n        ],\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item?: GridItemData) {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search profile types (comma-separated regexes are supported)');\n\n    if (item) {\n      this.initVariables(item);\n    }\n  }\n\n  initVariables(item: GridItemData) {\n    if (item.queryRunnerParams.serviceName) {\n      const serviceNameVariable = sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable);\n      serviceNameVariable.changeValueTo(item.queryRunnerParams.serviceName);\n    }\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable)],\n      gridControls: [\n        sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter),\n        sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher),\n      ],\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreServiceProfileTypes>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { dateTimeParse } from '@grafana/data';\nimport { SceneTimeRangeState } from '@grafana/scenes';\n\nexport function buildTimeRange(from: string, to: string): SceneTimeRangeState {\n  return {\n    from,\n    to,\n    value: {\n      from: dateTimeParse(from),\n      to: dateTimeParse(to),\n      raw: { from, to },\n    },\n  };\n}\n\nexport const getDefaultTimeRange = () => buildTimeRange('now-30m', 'now');\n","import { CustomVariable } from '@grafana/scenes';\n\nexport class SpanSelectorVariable extends CustomVariable {\n  constructor() {\n    super({\n      key: 'spanSelector',\n      name: 'spanSelector',\n      label: 'Span selector',\n      value: undefined,\n    });\n  }\n\n  reset() {\n    this.setState({ value: undefined });\n  }\n}\n","import { MetricFindValue } from '@grafana/data';\nimport { localeCompare } from '@shared/domain/localeCompare';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\n\nimport { PyroscopeSeries } from './http/SeriesApiClient';\n\nexport function formatSeriesToProfileMetrics(\n  pyroscopeSeries: PyroscopeSeries,\n  serviceName?: string\n): MetricFindValue[] {\n  if (serviceName) {\n    const profileMetricsMap = pyroscopeSeries.services.get(serviceName) || new Map();\n\n    return Array.from(profileMetricsMap.values())\n      .sort((a, b) => localeCompare(b.group, a.group))\n      .map(({ id, type, group }) => ({\n        value: id,\n        text: `${type} (${group})`,\n      }));\n  }\n\n  return Array.from(pyroscopeSeries.profileMetrics.keys())\n    .map((id) => getProfileMetric(id as ProfileMetricId))\n    .sort((a, b) => localeCompare(b.group, a.group))\n    .map(({ id, type, group }) => ({\n      value: id,\n      text: `${type} (${group})`,\n    }));\n}\n","import { MetricFindValue } from '@grafana/data';\nimport { localeCompare } from '@shared/domain/localeCompare';\n\nimport { PyroscopeSeries } from './http/SeriesApiClient';\n\nexport function formatSeriesToServices(pyroscopeSeries: PyroscopeSeries, profileMetricId?: string): MetricFindValue[] {\n  if (profileMetricId) {\n    const servicesSet = pyroscopeSeries.profileMetrics.get(profileMetricId) || new Set();\n\n    return Array.from(servicesSet)\n      .sort(localeCompare)\n      .map((serviceName) => ({\n        text: serviceName,\n        value: serviceName,\n      }));\n  }\n\n  return Array.from(pyroscopeSeries.services.keys())\n    .sort(localeCompare)\n    .map((serviceName) => ({\n      text: serviceName,\n      value: serviceName,\n    }));\n}\n","import { DataSourceProxyClient } from './DataSourceProxyClient';\n\nexport class DataSourceProxyClientBuilder {\n  private static cache = new Map<string, DataSourceProxyClient>();\n\n  static build<ApiClentType>(\n    dataSourceUid: string,\n    ApiClientClass: { new (options: { dataSourceUid: string }): ApiClentType }\n  ) {\n    const cacheKey = `${dataSourceUid}-${ApiClientClass.name}`;\n\n    const cachedInstance = DataSourceProxyClientBuilder.cache.get(cacheKey);\n    if (cachedInstance instanceof ApiClientClass) {\n      return cachedInstance;\n    }\n\n    const clientInstance = new ApiClientClass({ dataSourceUid });\n\n    DataSourceProxyClientBuilder.cache.set(cacheKey, clientInstance as DataSourceProxyClient);\n\n    return clientInstance;\n  }\n}\n","import { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { PyroscopeSeries } from './SeriesApiClient';\n\ntype Labels = Array<{ name: string; value: string }>;\n\nfunction findServiceNameAndProfileMetricId(labels: Labels) {\n  let serviceName;\n  let profileMetricId;\n\n  for (const { name, value } of labels) {\n    if (name === 'service_name') {\n      serviceName = value;\n    }\n\n    if (name === '__profile_type__') {\n      profileMetricId = value;\n    }\n\n    if (serviceName && profileMetricId) {\n      return [serviceName, profileMetricId];\n    }\n  }\n\n  return [];\n}\n\nexport function formatSeriesResponse(data: { labelsSet: Array<{ labels: Labels }> }): PyroscopeSeries {\n  const services: PyroscopeSeries['services'] = new Map();\n  const profileMetrics: PyroscopeSeries['profileMetrics'] = new Map();\n\n  if (!data.labelsSet) {\n    logger.warn('Pyroscope SeriesApiClient: no data received!');\n    return { services, profileMetrics };\n  }\n\n  for (const { labels } of data.labelsSet) {\n    const [serviceName, profileMetricId] = findServiceNameAndProfileMetricId(labels);\n\n    if (!serviceName || !profileMetricId) {\n      logger.warn(\n        'Pyroscope ServicesApiClient: \"service_name\" and/or \"__profile_type__\" are missing in the labels received!',\n        labels\n      );\n      continue;\n    }\n\n    const serviceProfileMetrics = services.get(serviceName) || new Map();\n    serviceProfileMetrics.set(profileMetricId, getProfileMetric(profileMetricId as ProfileMetricId));\n    services.set(serviceName, serviceProfileMetrics);\n\n    const profileMetricServices = profileMetrics.get(profileMetricId) || new Set();\n    profileMetricServices.add(serviceName);\n    profileMetrics.set(profileMetricId, profileMetricServices);\n  }\n\n  return { services, profileMetrics };\n}\n","import { ProfileMetric } from '@shared/infrastructure/profile-metrics/getProfileMetric';\n\nimport { DataSourceProxyClient } from './DataSourceProxyClient';\nimport { formatSeriesResponse } from './formatSeriesResponse';\n\ntype ProfileMetricsMap = Map<ProfileMetric['id'], ProfileMetric>;\ntype ServiceToProfileMetricsMap = Map<string, ProfileMetricsMap>;\n\ntype ServicesSet = Set<string>;\ntype ProfileMetricToServicesSet = Map<string, ServicesSet>;\n\nexport type PyroscopeSeries = { services: ServiceToProfileMetricsMap; profileMetrics: ProfileMetricToServicesSet };\n\nexport class SeriesApiClient extends DataSourceProxyClient {\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n  }\n\n  async list(options: { from: number; to: number }): Promise<PyroscopeSeries> {\n    const { from, to } = options;\n\n    return this.fetch('/querier.v1.QuerierService/Series', {\n      method: 'POST',\n      body: JSON.stringify({\n        start: from,\n        end: to,\n        labelNames: ['service_name', '__profile_type__'],\n        matchers: [],\n      }),\n    })\n      .then((response) => response.json())\n      .then(formatSeriesResponse);\n  }\n}\n","import { TimeRange } from '@grafana/data';\nimport { AbstractRepository } from '@shared/infrastructure/AbstractRepository';\nimport { MemoryCacheClient } from '@shared/infrastructure/MemoryCacheClient';\n\nimport { computeRoundedTimeRange } from '../../../helpers/computeRoundedTimeRange';\nimport { PyroscopeSeries, SeriesApiClient } from './SeriesApiClient';\n\nclass SeriesRepository extends AbstractRepository<SeriesApiClient, MemoryCacheClient> {\n  constructor(options: { cacheClient: MemoryCacheClient }) {\n    super(options);\n  }\n\n  async list(options: { timeRange: TimeRange }): Promise<PyroscopeSeries> {\n    const { from, to } = computeRoundedTimeRange(options.timeRange);\n\n    const cacheParams = [this.apiClient!.baseUrl, from, to];\n\n    const responseFromCacheP = this.cacheClient!.get(cacheParams);\n    if (responseFromCacheP) {\n      const { services, profileMetrics } = await responseFromCacheP;\n\n      if (!services.size && !profileMetrics.size) {\n        this.cacheClient!.delete(cacheParams);\n      }\n\n      return { services, profileMetrics };\n    }\n\n    const fetchP = this.apiClient!.list({ from, to });\n    this.cacheClient!.set(cacheParams, fetchP);\n\n    try {\n      const { services, profileMetrics } = await fetchP;\n      return { services, profileMetrics };\n    } catch (error) {\n      this.cacheClient!.delete(cacheParams);\n      throw error;\n    }\n  }\n}\n\nexport const seriesRepository = new SeriesRepository({\n  cacheClient: new MemoryCacheClient(),\n});\n","import {\n  DataQueryResponse,\n  FieldType,\n  LegacyMetricFindQueryOptions,\n  LoadingState,\n  MetricFindValue,\n  TestDataSourceResponse,\n  TimeRange,\n} from '@grafana/data';\nimport { RuntimeDataSource } from '@grafana/scenes';\nimport { ApiClient } from '@shared/infrastructure/http/ApiClient';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { PYROSCOPE_SERIES_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { formatSeriesToProfileMetrics } from './formatSeriesToProfileMetrics';\nimport { formatSeriesToServices } from './formatSeriesToServices';\nimport { safeInterpolate } from './helpers/safeInterpolate';\nimport { DataSourceProxyClientBuilder } from './http/DataSourceProxyClientBuilder';\nimport { SeriesApiClient } from './http/SeriesApiClient';\nimport { seriesRepository } from './http/seriesRepository';\n\nexport class SeriesDataSource extends RuntimeDataSource {\n  constructor() {\n    super(PYROSCOPE_SERIES_DATA_SOURCE.type, PYROSCOPE_SERIES_DATA_SOURCE.uid);\n  }\n\n  async fetchSeries(dataSourceUid: string, timeRange: TimeRange, variableName?: string) {\n    seriesRepository.setApiClient(DataSourceProxyClientBuilder.build(dataSourceUid, SeriesApiClient));\n\n    try {\n      return await seriesRepository.list({ timeRange });\n    } catch (error) {\n      logger.error(error as Error, {\n        info: 'Error while loading Pyroscope series!',\n        variableName: variableName || '',\n      });\n\n      throw error;\n    }\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'PyroscopeSeries',\n          fields: [\n            {\n              name: 'PyroscopeSeries',\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(query: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.valueOf() as ServiceNameVariable | ProfileMetricVariable;\n\n    let dataSourceUid = safeInterpolate(sceneObject, '$dataSource');\n    const serviceName = safeInterpolate(sceneObject, '$serviceName');\n    const profileMetricId = safeInterpolate(sceneObject, '$profileMetricId');\n\n    // Fallback to default datasource if interpolation not ready yet\n    if (!dataSourceUid) {\n      dataSourceUid = ApiClient.selectDefaultDataSource().uid as string;\n    }\n\n    const pyroscopeSeries = await this.fetchSeries(dataSourceUid, options.range as TimeRange, options.variable?.name);\n\n    switch (query) {\n      // queries that depend only on the selected data source\n      case '$dataSource and all services':\n        return formatSeriesToServices(pyroscopeSeries);\n\n      case '$dataSource and all profile metrics':\n        return formatSeriesToProfileMetrics(pyroscopeSeries);\n\n      // queries that depend on the selected profile metric or the selected service\n      case '$dataSource and only $profileMetricId services':\n        return formatSeriesToServices(pyroscopeSeries, profileMetricId);\n\n      case '$dataSource and only $serviceName profile metrics':\n        return formatSeriesToProfileMetrics(pyroscopeSeries, serviceName);\n\n      default:\n        throw new TypeError(`Unsupported query \"${query}\"!`);\n    }\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","import { displayError, displaySuccess } from '@shared/domain/displayStatus';\nimport { useFetchRecordingRules } from '@shared/infrastructure/recording-rules/useFetchRecordingRules';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\n\nexport function useCreateRecordingRule() {\n  const { recordingRules, error: fetchError, mutate } = useFetchRecordingRules();\n\n  return {\n    data: {\n      recordingRules,\n      fetchError,\n    },\n    actions: {\n      async save(rule: RecordingRuleViewModel) {\n        try {\n          await mutate(rule);\n          displaySuccess([`Recording rule ${rule.metricName} created successfully!`]);\n        } catch (e) {\n          displayError(e as Error, [`Failed to save recording rule ${rule.metricName}.`]);\n        }\n      },\n    },\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, Divider, Field, Input, Modal, MultiSelect, Text, useStyles2 } from '@grafana/ui';\nimport { labelsRepository } from '@shared/infrastructure/labels/labelsRepository';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\nimport React, { useState } from 'react';\nimport { Controller, FieldError, SubmitHandler, useForm } from 'react-hook-form';\nimport { useMount } from 'react-use';\n\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { ExplorationType, SceneProfilesExplorer } from '../SceneProfilesExplorer/SceneProfilesExplorer';\nimport { useCreateRecordingRule } from './domain/useCreateRecordingRule';\n\nconst METRIC_NAME_PREFIX = 'profiles_recorded_';\n\ninterface RecordingRuleForm {\n  metricName: string;\n  labels: Array<SelectableValue<string>>;\n  serviceName: string;\n  profileType: string;\n  matcher: string;\n  functionName?: string;\n}\n\ninterface SceneCreateRecordingRuleModalState extends SceneObjectState {}\n\n/**\n * Returns the service name if a service name dropdown is visible on the screen for the user.\n *\n * In \"All services\" and \"Favorites\" exploration types, the service name is not shown on the screen,\n * though the variable is still present in the URL so we need to check explicitly what's the current\n * exploration type instead of just reading the variable name.\n */\nfunction useCurrentServiceName(model: SceneCreateRecordingRuleModal) {\n  const serviceNameVariable = sceneGraph.findByKeyAndType(model, 'serviceName', ServiceNameVariable);\n  const serviceName = serviceNameVariable.state.value;\n\n  const explorationType = sceneGraph\n    .findByKeyAndType(model, 'profiles-explorer', SceneProfilesExplorer)\n    .useState().explorationType;\n  return explorationType === ExplorationType.ALL_SERVICES || explorationType === ExplorationType.FAVORITES\n    ? undefined\n    : serviceName;\n}\n\nexport class SceneCreateRecordingRuleModal extends SceneObjectBase<SceneCreateRecordingRuleModalState> {\n  constructor() {\n    super({});\n  }\n\n  // TODO: https://github.com/grafana/profiles-drilldown/issues/614\n  // eslint-disable-next-line sonarjs/cognitive-complexity\n  static Component = function ({\n    model,\n    isModalOpen,\n    onDismiss,\n    onCreated,\n    functionName,\n  }: SceneComponentProps<SceneCreateRecordingRuleModal> & {\n    isModalOpen: boolean;\n    onDismiss: () => void;\n    onCreated: () => void;\n    functionName?: string;\n  }) {\n    const [options, setOptions] = useState<string[]>([]);\n\n    const { actions } = useCreateRecordingRule();\n\n    const profileMetricVariable = sceneGraph.findByKeyAndType(model, 'profileMetricId', ProfileMetricVariable);\n    const profileMetric = getProfileMetric(profileMetricVariable.state.value as ProfileMetricId);\n\n    const serviceNameVariable = useCurrentServiceName(model);\n\n    const filtersVariable = sceneGraph.findByKeyAndType(model, 'filters', FiltersVariable);\n    const filters = filtersVariable.state.filters;\n    const filterQuery = filters.map((filter) => `${filter.key}${filter.operator}\"${filter.value}\"`).join(', ');\n\n    const serviceName = serviceNameVariable?.toString() || '';\n    const ruleForAllServices = !serviceName;\n\n    const {\n      register,\n      handleSubmit,\n      control,\n      formState: { errors },\n    } = useForm<RecordingRuleForm>({\n      mode: 'onChange',\n      shouldUnregister: true,\n      values: {\n        functionName,\n        metricName: '',\n        labels: ruleForAllServices ? [{ label: 'service_name', value: 'service_name' }] : [],\n        serviceName,\n        matcher: '',\n        profileType: profileMetric.id,\n      },\n    });\n\n    const onSubmit: SubmitHandler<RecordingRuleForm> = async (data) => {\n      const rule: RecordingRuleViewModel = {\n        id: '',\n        metricName: METRIC_NAME_PREFIX + data.metricName,\n        serviceName: data.serviceName,\n        profileType: data.profileType,\n        matchers: filterQuery ? [`{${filterQuery}}`] : [],\n        groupBy: data.labels ? data.labels.map((label) => label.value ?? '') : [],\n        functionName: data.functionName,\n        readonly: false,\n      };\n      await actions.save(rule);\n      onCreated();\n    };\n\n    useMount(() => {\n      const timeRange = sceneGraph.getTimeRange(model).state.value;\n      labelsRepository\n        .listLabels({\n          query: `{${filterQuery}}`,\n          from: timeRange.from.unix() * 1000,\n          to: timeRange.to.unix() * 1000,\n        })\n        .then((suggestions) => {\n          let options = suggestions.map((s) => s.value);\n          if (ruleForAllServices) {\n            options = ['service_name', ...options];\n          }\n          setOptions(options);\n        });\n    });\n\n    return (\n      <Modal\n        title=\"Create recording rule\"\n        isOpen={isModalOpen}\n        onDismiss={onDismiss}\n        data-testid=\"Create recording rule modal\"\n      >\n        <form onSubmit={handleSubmit(onSubmit)}>\n          <Field\n            label=\"Metric name\"\n            description={`Prometheus metric name (automatically prefixed with ${METRIC_NAME_PREFIX}).`}\n            error={MetricNameErrorComponent(errors.metricName)}\n            invalid={!!errors.metricName}\n          >\n            <div className={css({ display: 'flex' })}>\n              <div className={css({ alignContent: 'center', fontFamily: 'monospace' })}>{METRIC_NAME_PREFIX}</div>\n              <Input\n                className={css({ input: { fontFamily: 'monospace', paddingLeft: 0 } })}\n                placeholder={`${profileMetric.type}_${(serviceName || 'name')\n                  .toString()\n                  .replace(/[^a-zA-Z0-9_]/g, '_')}`}\n                aria-label=\"Metric name\"\n                required\n                autoFocus\n                {...register('metricName', {\n                  required: 'Metric name is required.',\n                  // This pattern was pulled from here: https://prometheus.io/docs/concepts/data_model/#metric-names-and-labels\n                  pattern: {\n                    value: /^[a-zA-Z_][a-zA-Z0-9_]*$/,\n                    message: 'Invalid metric name.',\n                  },\n                })}\n              />\n            </div>\n          </Field>\n\n          <Field label=\"Additional labels\" description=\"Additional profiling labels to forward to the metric\">\n            <Controller\n              name=\"labels\"\n              control={control}\n              render={({ field }) => (\n                <MultiSelect\n                  {...field}\n                  options={options.map((opt) => ({ label: opt, value: opt }))}\n                  toggleAllOptions={{\n                    enabled: true,\n                  }}\n                  closeMenuOnSelect={false}\n                  hideSelectedOptions={false}\n                />\n              )}\n            />\n          </Field>\n\n          <Divider />\n\n          <Field label=\"Service name\" data-testid=\"Create recording rule modal service name field\">\n            {serviceName ? (\n              <div>{`${serviceName}`}</div>\n            ) : (\n              <Text element=\"span\" color=\"secondary\">\n                All services\n              </Text>\n            )}\n          </Field>\n\n          <input type=\"text\" hidden {...register('serviceName')} />\n\n          <Field label=\"Profile type\">\n            <div>{`${profileMetric.group}/${profileMetric.type}`}</div>\n          </Field>\n          <input type=\"text\" hidden {...register('profileType')} />\n\n          <Field label=\"Function name\" description=\"Optional function name to filter the recording rule\">\n            <Input\n              aria-label=\"Function name\"\n              placeholder=\"Leave empty for total aggregation\"\n              {...register('functionName')}\n            />\n          </Field>\n\n          <Field label=\"Filters\" description=\"Filters selected in the main view will be applied to this rule\">\n            <div>{filters.length === 0 ? 'No filters selected' : filterQuery}</div>\n          </Field>\n\n          <Modal.ButtonRow>\n            <Button variant=\"secondary\" fill=\"outline\" onClick={onDismiss} aria-label=\"Cancel\">\n              Cancel\n            </Button>\n            <Button variant=\"primary\" type=\"submit\">\n              Create\n            </Button>\n          </Modal.ButtonRow>\n        </form>\n      </Modal>\n    );\n  };\n}\n\nconst MetricNameErrorComponent = (error: FieldError | undefined) => {\n  const styles = useStyles2(getStyles);\n\n  if (error === undefined || error.message === undefined) {\n    return undefined;\n  }\n\n  if (error.type === 'pattern') {\n    return (\n      <span>\n        <span>Metric name is invalid, it must have the following properties:</span>\n        <ul className={styles.errorList}>\n          <li>Only contain alphanumeric characters or underscores</li>\n          <li>Must not begin with a number</li>\n        </ul>\n      </span>\n    );\n  }\n\n  return <span>{error.message}</span>;\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  errorList: css`\n    padding-left: ${theme.spacing(2)};\n  `,\n});\n","import { BusEventWithPayload, TimeRange } from '@grafana/data';\nimport { SceneTimeRangeState } from '@grafana/scenes';\n\nimport { CompareTarget } from '../../../../domain/types';\n\ninterface EventEnableSyncTimeRangesPayload {\n  source: CompareTarget;\n  enable: boolean;\n  timeRange: SceneTimeRangeState;\n  annotationTimeRange: TimeRange;\n}\n\nexport class EventEnableSyncTimeRanges extends BusEventWithPayload<EventEnableSyncTimeRangesPayload> {\n  public static type = 'enable-sync-timeranges';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { CompareTarget } from '../../../../domain/types';\n\ninterface EventSyncRefreshPayload {\n  source: CompareTarget;\n}\n\nexport class EventSyncRefresh extends BusEventWithPayload<EventSyncRefreshPayload> {\n  public static type = 'sync-refresh';\n}\n","import { BusEventWithPayload, TimeRange } from '@grafana/data';\nimport { SceneTimeRangeState } from '@grafana/scenes';\n\nimport { CompareTarget } from '../../../../domain/types';\n\ninterface EventSyncTimeRangesPayload {\n  source: CompareTarget;\n  timeRange?: SceneTimeRangeState;\n  annotationTimeRange?: TimeRange;\n}\n\nexport class EventSyncTimeRanges extends BusEventWithPayload<EventSyncTimeRangesPayload> {\n  public static type = 'sync-timeranges';\n}\n","import { SceneComponentProps, sceneGraph, SceneTimePicker } from '@grafana/scenes';\nimport { TimeRangePicker } from '@grafana/ui';\nimport React from 'react';\n\nexport class SceneTimePickerWithoutSync extends SceneTimePicker {\n  public static Component = function SceneTimePickerRenderer({\n    model,\n  }: SceneComponentProps<SceneTimePickerWithoutSync>) {\n    const { hidePicker, isOnCanvas } = model.useState();\n    const timeRange = sceneGraph.getTimeRange(model);\n    const timeZone = timeRange.getTimeZone();\n    const timeRangeState = timeRange.useState();\n\n    if (hidePicker) {\n      return null;\n    }\n\n    return (\n      <TimeRangePicker\n        isOnCanvas={isOnCanvas ?? true}\n        value={timeRangeState.value}\n        onChange={timeRange.onTimeRangeChange}\n        timeZone={timeZone}\n        fiscalYearStartMonth={timeRangeState.fiscalYearStartMonth}\n        onMoveBackward={model.onMoveBackward}\n        onMoveForward={model.onMoveForward}\n        onZoom={model.onZoom}\n        onChangeTimeZone={timeRange.onTimeZoneChange}\n        onChangeFiscalYearStartMonth={model.onChangeFiscalYearStartMonth}\n        // disable the sync\n        isSynced={false}\n      />\n    );\n  };\n}\n","import { toUtc } from '@grafana/data';\nimport { SceneObjectUrlValue } from '@grafana/scenes';\n\nconst INTERVAL_STRING_REGEX = /^\\d+[yYmMsSwWhHdD]$/;\n\n/* Copied from https://github.com/grafana/scenes/blob/main/packages/scenes/src/utils/parseUrlParam.ts */\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function parseUrlParam(value: SceneObjectUrlValue): string | null {\n  if (typeof value !== 'string') {\n    return null;\n  }\n\n  if (value.indexOf('now') !== -1) {\n    return value;\n  }\n\n  if (INTERVAL_STRING_REGEX.test(value)) {\n    return value;\n  }\n\n  if (value.length === 8) {\n    const utcValue = toUtc(value, 'YYYYMMDD');\n    if (utcValue.isValid()) {\n      return utcValue.toISOString();\n    }\n  } else if (value.length === 15) {\n    const utcValue = toUtc(value, 'YYYYMMDDTHHmmss');\n    if (utcValue.isValid()) {\n      return utcValue.toISOString();\n    }\n  } else if (value.length === 24) {\n    const utcValue = toUtc(value);\n    return utcValue.toISOString();\n  }\n\n  const epoch = parseInt(value, 10);\n  if (!isNaN(epoch)) {\n    return toUtc(epoch).toISOString();\n  }\n\n  return null;\n}\n","import { FieldType, MutableDataFrame } from '@grafana/data';\n\nexport class RangeAnnotation extends MutableDataFrame {\n  constructor() {\n    super();\n    [\n      {\n        name: 'time',\n        type: FieldType.time,\n      },\n      {\n        name: 'timeEnd',\n        type: FieldType.time,\n      },\n      {\n        name: 'isRegion',\n        type: FieldType.boolean,\n      },\n      {\n        name: 'color',\n        type: FieldType.other,\n      },\n      {\n        name: 'text',\n        type: FieldType.string,\n      },\n    ].forEach((field) => this.addField(field));\n  }\n\n  addRange(entry: { time: number; timeEnd: number; color?: string; text: string }) {\n    this.add({ ...entry, isRegion: true });\n  }\n}\n","import { DateTime, dateTime, LoadingState, TimeRange } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneTimeRangeLike,\n  SceneTimeRangeState,\n  VariableDependencyConfig,\n  VizPanel,\n} from '@grafana/scenes';\nimport { omit } from 'lodash';\n\nimport { evaluateTimeRange } from '../domain/evaluateTimeRange';\nimport { parseUrlParam } from '../domain/parseUrlParam';\nimport { RangeAnnotation } from '../domain/RangeAnnotation';\n\nexport enum TimeRangeWithAnnotationsMode {\n  ANNOTATIONS = 'annotations',\n  DEFAULT = 'default',\n}\n\ninterface SceneTimeRangeWithAnnotationsState extends SceneTimeRangeState {\n  annotationTimeRange: TimeRange;\n  mode: TimeRangeWithAnnotationsMode;\n  annotationColor: string;\n  annotationTitle: string;\n}\n\nconst TIMERANGE_NIL = {\n  from: dateTime(0),\n  to: dateTime(0),\n  raw: { from: '', to: '' },\n};\n\n/**\n * This custom SceneTimeRange class provides the ability to draw annotations on timeseries vizualisations.\n * Indeed, timeseries visualizations don't support drawing annotations by dragging (it's only supported when holding ctrl/command key) so we need to hijack the zooming event to emulate drawing.\n * At the same time, the only way to hijack it is by passing custom $timeRange because TimeSeries vizualization handles zooming internally by looking for the nearest time range object.\n * @see https://github.com/grafana/scenes/pull/744\n */\nexport class SceneTimeRangeWithAnnotations\n  extends SceneObjectBase<SceneTimeRangeWithAnnotationsState>\n  implements SceneTimeRangeLike\n{\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: ['dataSource', 'serviceName'],\n    onReferencedVariableValueChanged: () => {\n      this.nullifyAnnotationTimeRange();\n      this.updateTimeseriesAnnotation();\n    },\n  });\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['diffFrom', 'diffTo'] });\n\n  constructor(options: {\n    key: string;\n    mode: TimeRangeWithAnnotationsMode;\n    annotationColor: string;\n    annotationTitle: string;\n  }) {\n    super({\n      from: TIMERANGE_NIL.raw.from,\n      to: TIMERANGE_NIL.raw.to,\n      value: TIMERANGE_NIL,\n      annotationTimeRange: TIMERANGE_NIL,\n      ...options,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState(omit(this.getAncestorTimeRange().state, 'key'));\n\n    this._subs.add(\n      this.getAncestorTimeRange().subscribeToState((newState) => {\n        this.setState(omit(newState, 'key'));\n      })\n    );\n\n    this._subs.add(\n      this.getTimeseries().state.$data?.subscribeToState((newState, prevState) => {\n        if (!newState.data || newState.data.state !== LoadingState.Done) {\n          return;\n        }\n\n        // add annotation for the first time\n        if (!newState.data.annotations?.length && !prevState.data?.annotations?.length) {\n          this.updateTimeseriesAnnotation();\n          return;\n        }\n\n        // ensure we retain the previous annotations, if they exist\n        if (!newState.data.annotations?.length && prevState.data?.annotations?.length) {\n          newState.data.annotations = prevState.data.annotations;\n        }\n      })\n    );\n  }\n\n  protected getAncestorTimeRange(): SceneTimeRangeLike {\n    if (!this.parent || !this.parent.parent) {\n      throw new Error(typeof this + ' must be used within $timeRange scope');\n    }\n\n    return sceneGraph.getTimeRange(this.parent.parent);\n  }\n\n  protected getTimeseries(): VizPanel {\n    try {\n      const vizPanel = sceneGraph.getAncestor(this, VizPanel);\n\n      if (vizPanel.state.pluginId !== 'timeseries') {\n        throw new TypeError('Incorrect VizPanel type!');\n      }\n\n      return vizPanel;\n    } catch (error) {\n      throw new Error('Ancestor timeseries panel not found!');\n    }\n  }\n\n  updateTimeseriesAnnotation() {\n    const { annotationTimeRange, annotationColor, annotationTitle } = this.state;\n\n    const { $data } = this.getTimeseries().state;\n\n    const data = $data?.state.data;\n    if (!data) {\n      return;\n    }\n\n    const annotation = new RangeAnnotation();\n\n    annotation.addRange({\n      color: annotationColor,\n      text: annotationTitle,\n      time: annotationTimeRange.from.unix() * 1000,\n      timeEnd: annotationTimeRange.to.unix() * 1000,\n    });\n\n    // tradeoff: this will notify all the $data subscribers even though the data itself hasn't changed\n    $data?.setState({\n      data: {\n        ...data,\n        annotations: [annotation],\n      },\n    });\n  }\n\n  setAnnotationTimeRange(annotationTimeRange: TimeRange, updateTimeseries = false) {\n    this.setState({ annotationTimeRange });\n\n    if (updateTimeseries) {\n      this.updateTimeseriesAnnotation();\n    }\n  }\n\n  nullifyAnnotationTimeRange() {\n    this.setAnnotationTimeRange(TIMERANGE_NIL);\n  }\n\n  getUrlState() {\n    const { annotationTimeRange } = this.state;\n\n    return {\n      diffFrom:\n        typeof annotationTimeRange.raw.from === 'string'\n          ? annotationTimeRange.raw.from\n          : annotationTimeRange.raw.from.toISOString(),\n      diffTo:\n        typeof annotationTimeRange.raw.to === 'string'\n          ? annotationTimeRange.raw.to\n          : annotationTimeRange.raw.to.toISOString(),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const { diffFrom, diffTo } = values;\n\n    if (!diffTo && !diffFrom) {\n      return;\n    }\n\n    const { annotationTimeRange } = this.state;\n\n    this.setAnnotationTimeRange(\n      this.buildAnnotationTimeRange(\n        parseUrlParam(diffFrom) ?? annotationTimeRange.from,\n        parseUrlParam(diffTo) ?? annotationTimeRange.to\n      )\n    );\n  }\n\n  buildAnnotationTimeRange(diffFrom: string | DateTime, diffTo: string | DateTime) {\n    return evaluateTimeRange(\n      diffFrom,\n      diffTo,\n      this.getTimeZone(),\n      this.state.fiscalYearStartMonth,\n      this.state.UNSAFE_nowDelay\n    );\n  }\n\n  onTimeRangeChange(timeRange: TimeRange): void {\n    const { mode } = this.state;\n\n    if (mode === TimeRangeWithAnnotationsMode.DEFAULT) {\n      this.getAncestorTimeRange().onTimeRangeChange(timeRange);\n      return;\n    }\n\n    // this triggers a timeseries request to the API\n    // TODO: caching?\n    this.setAnnotationTimeRange(timeRange, true);\n  }\n\n  onTimeZoneChange(timeZone: string): void {\n    this.getAncestorTimeRange().onTimeZoneChange(timeZone);\n  }\n\n  getTimeZone(): string {\n    return this.getAncestorTimeRange().getTimeZone();\n  }\n\n  onRefresh(): void {\n    this.getAncestorTimeRange().onRefresh();\n  }\n}\n","import { dateMath, DateTime, TimeRange } from '@grafana/data';\nimport { TimeZone } from '@grafana/schema';\n\n/* Copied from https://github.com/grafana/scenes/blob/main/packages/scenes/src/utils/evaluateTimeRange.ts */\n\nexport function evaluateTimeRange(\n  from: string | DateTime,\n  to: string | DateTime,\n  timeZone: TimeZone,\n  fiscalYearStartMonth?: number,\n  delay?: string\n): TimeRange {\n  const hasDelay = delay && to === 'now';\n\n  return {\n    from: dateMath.parse(from, false, timeZone, fiscalYearStartMonth)!,\n    to: dateMath.parse(hasDelay ? 'now-' + delay : to, true, timeZone, fiscalYearStartMonth)!,\n    raw: {\n      from: from,\n      to: to,\n    },\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { TimerangeSelectionMode } from '../actions/SwitchTimeRangeSelectionModeAction';\n\ninterface EventSwitchTimerangeSelectionModePayload {\n  mode: TimerangeSelectionMode;\n}\n\nexport class EventSwitchTimerangeSelectionMode extends BusEventWithPayload<EventSwitchTimerangeSelectionModePayload> {\n  public static type = 'switch-timerange-selection-mode';\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Icon, RadioButtonGroup, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventSwitchTimerangeSelectionMode } from '../events/EventSwitchTimerangeSelectionMode';\n\nexport enum TimerangeSelectionMode {\n  TIMEPICKER = 'timepicker',\n  FLAMEGRAPH = 'flame-graph',\n}\n\ninterface SwitchTimeRangeSelectionTypeActionState extends SceneObjectState {\n  mode: TimerangeSelectionMode;\n}\n\nexport class SwitchTimeRangeSelectionModeAction extends SceneObjectBase<SwitchTimeRangeSelectionTypeActionState> {\n  static OPTIONS = [\n    { label: 'Time picker', value: TimerangeSelectionMode.TIMEPICKER },\n    { label: 'Flame graph', value: TimerangeSelectionMode.FLAMEGRAPH },\n  ];\n\n  constructor() {\n    super({\n      mode: TimerangeSelectionMode.FLAMEGRAPH,\n    });\n  }\n\n  public onChange = (newMode: TimerangeSelectionMode) => {\n    this.setState({ mode: newMode });\n\n    this.publishEvent(new EventSwitchTimerangeSelectionMode({ mode: newMode }), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SwitchTimeRangeSelectionModeAction>) => {\n    const styles = useStyles2(getStyles);\n    const { mode } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <RadioButtonGroup\n          size=\"sm\"\n          options={SwitchTimeRangeSelectionModeAction.OPTIONS}\n          value={mode}\n          onChange={model.onChange}\n          aria-label=\"Range selection mode\"\n        />\n        <div>\n          <Tooltip\n            content={\n              <div className={styles.tooltip}>\n                <div>\n                  Use these buttons to change the behaviour when selecting a range with the mouse on the time series:\n                </div>\n                <dl>\n                  <dt>Time picker</dt>\n                  <dd>Time range zoom in (default behaviour)</dd>\n                  <dt>Flame graph</dt>\n                  <dd>\n                    Time range for building the flame graph (the stack traces will be retrieved only for the selected\n                    range)\n                  </dd>\n                </dl>\n              </div>\n            }\n            placement=\"top\"\n          >\n            <Icon name=\"question-circle\" />\n          </Tooltip>\n        </div>\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: row;\n    gap: ${theme.spacing(1)};\n  `,\n  tooltip: css`\n    padding: ${theme.spacing(1)};\n    & dl {\n      margin-top: ${theme.spacing(2)};\n      display: grid;\n      grid-gap: ${theme.spacing(1)} ${theme.spacing(2)};\n      grid-template-columns: max-content;\n    }\n    & dt {\n      font-weight: bold;\n    }\n    & dd {\n      margin: 0;\n      grid-column-start: 2;\n    }\n  `,\n  label: css`\n    font-size: 12px;\n    text-align: right;\n    margin-bottom: 2px;\n    color: ${theme.colors.text.secondary};\n  `,\n});\n","import { SceneQueryRunner } from '@grafana/scenes';\n\nimport { PYROSCOPE_DATA_SOURCE } from '../../../../../infrastructure/pyroscope-data-sources';\nimport { withPreventInvalidQuery } from '../../../../../infrastructure/withPreventInvalidQuery';\n\nexport function buildCompareTimeSeriesQueryRunner({\n  filterKey,\n}: {\n  filterKey: 'filtersBaseline' | 'filtersComparison';\n}) {\n  const queryRunner = new SceneQueryRunner({\n    datasource: PYROSCOPE_DATA_SOURCE,\n    queries: [\n      {\n        refId: `$profileMetricId-$serviceName-${filterKey}}`,\n        queryType: 'metrics',\n        profileTypeId: '$profileMetricId',\n        labelSelector: `{service_name=\"$serviceName\",$${filterKey}}`,\n      },\n    ],\n  });\n\n  return withPreventInvalidQuery(queryRunner);\n}\n","import Color from 'color';\n\nexport const BASELINE_COLORS = {\n  COLOR: Color('#d066d4'),\n  OVERLAY: Color('#d066d4').alpha(0.3),\n};\n\nexport const COMPARISON_COLORS = {\n  COLOR: Color('#1398f6'),\n  OVERLAY: Color('#1398f6').alpha(0.3),\n};\n","import { css, cx } from '@emotion/css';\nimport { AdHocVariableFilter, DataFrame, dateTime, FieldMatcherID, getValueFormat, GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneComponentProps,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  SceneTimeRangeLike,\n  SceneTimeRangeState,\n  VariableDependencyConfig,\n} from '@grafana/scenes';\nimport { IconButton, useStyles2 } from '@grafana/ui';\nimport { SceneTimePickerWithoutSync } from '@shared/components/SceneTimePickerWithoutSync/SceneTimePickerWithoutSync';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { omit } from 'lodash';\nimport React from 'react';\n\nimport { buildTimeRange } from '../../../../domain/buildTimeRange';\nimport { FiltersVariable } from '../../../../domain/variables/FiltersVariable/FiltersVariable';\nimport { formatSingleSeriesDisplayName } from '../../../../helpers/formatSingleSeriesDisplayName';\nimport { getSceneVariableValue } from '../../../../helpers/getSceneVariableValue';\nimport { getSeriesStatsValue } from '../../../../infrastructure/helpers/getSeriesStatsValue';\nimport { getProfileMetricLabel } from '../../../../infrastructure/series/helpers/getProfileMetricLabel';\nimport { PanelType } from '../../../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { addRefId, addStats } from '../../../SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { SceneLabelValuesTimeseries } from '../../../SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\nimport { CompareTarget } from '../../domain/types';\nimport { Preset } from '../ScenePresetsPicker/ScenePresetsPicker';\nimport {\n  SceneTimeRangeWithAnnotations,\n  TimeRangeWithAnnotationsMode,\n} from './components/SceneTimeRangeWithAnnotations';\nimport {\n  SwitchTimeRangeSelectionModeAction,\n  TimerangeSelectionMode,\n} from './domain/actions/SwitchTimeRangeSelectionModeAction';\nimport { EventEnableSyncTimeRanges } from './domain/events/EventEnableSyncTimeRanges';\nimport { EventSwitchTimerangeSelectionMode } from './domain/events/EventSwitchTimerangeSelectionMode';\nimport { EventSyncRefresh } from './domain/events/EventSyncRefresh';\nimport { EventSyncTimeRanges } from './domain/events/EventSyncTimeRanges';\nimport { RangeAnnotation } from './domain/RangeAnnotation';\nimport { buildCompareTimeSeriesQueryRunner } from './infrastructure/buildCompareTimeSeriesQueryRunner';\nimport { BASELINE_COLORS, COMPARISON_COLORS } from './ui/colors';\n\nconst ONE_DAY_IN_MS = 24 * 60 * 60 * 1000;\n\ninterface SceneComparePanelState extends SceneObjectState {\n  target: CompareTarget;\n  filterKey: 'filtersBaseline' | 'filtersComparison';\n  title: string;\n  color: string;\n  timePicker: SceneTimePicker;\n  refreshPicker: SceneRefreshPicker;\n  $timeRange: SceneTimeRange;\n  timeseriesPanel: SceneLabelValuesTimeseries;\n  timeRangeSyncEnabled: boolean;\n  lastSyncedStepSec?: number;\n}\n\nexport class SceneComparePanel extends SceneObjectBase<SceneComparePanelState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: ['profileMetricId'],\n    onReferencedVariableValueChanged: () => {\n      this.state.timeseriesPanel.updateItem({ label: this.buildTimeseriesTitle() });\n    },\n  });\n\n  constructor({\n    target,\n    useAncestorTimeRange,\n    clearDiffRange,\n    filters,\n  }: {\n    target: SceneComparePanelState['target'];\n    useAncestorTimeRange: boolean;\n    clearDiffRange: boolean;\n    filters: AdHocVariableFilter[];\n  }) {\n    const filterKey = target === CompareTarget.BASELINE ? 'filtersBaseline' : 'filtersComparison';\n    const title = target === CompareTarget.BASELINE ? 'Baseline' : 'Comparison';\n    const color =\n      target === CompareTarget.BASELINE ? BASELINE_COLORS.COLOR.toString() : COMPARISON_COLORS.COLOR.toString();\n\n    super({\n      key: `${target}-panel`,\n      target,\n      filterKey,\n      title,\n      color,\n      $timeRange: new SceneTimeRange({ key: `${target}-panel-timerange`, ...buildTimeRange('now-1h', 'now') }),\n      timePicker: new SceneTimePickerWithoutSync({ isOnCanvas: true }),\n      refreshPicker: new SceneRefreshPicker({ isOnCanvas: true }),\n      timeseriesPanel: SceneComparePanel.buildTimeSeriesPanel({ target, filterKey, title, color }),\n      timeRangeSyncEnabled: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, useAncestorTimeRange, clearDiffRange, filters));\n  }\n\n  onActivate(useAncestorTimeRange: boolean, clearDiffRange: boolean, filters: AdHocVariableFilter[]) {\n    const { $timeRange, timeseriesPanel, filterKey } = this.state;\n\n    if (clearDiffRange) {\n      this.setDiffRange(null);\n    }\n\n    if (useAncestorTimeRange) {\n      $timeRange.setState(omit(this.getAncestorTimeRange().state, 'key'));\n    }\n\n    if (filters.length) {\n      const filtersVariable = sceneGraph.findByKey(this, filterKey) as FiltersVariable;\n\n      filtersVariable.setState({ filters });\n    }\n\n    timeseriesPanel.updateItem({ label: this.buildTimeseriesTitle() });\n\n    const eventSub = this.subscribeToEvents();\n\n    return () => {\n      eventSub.unsubscribe();\n    };\n  }\n\n  static buildTimeSeriesPanel({ target, filterKey, title, color }: any): SceneLabelValuesTimeseries {\n    const timeseriesPanel: SceneLabelValuesTimeseries = new SceneLabelValuesTimeseries({\n      item: {\n        index: 0,\n        value: target,\n        label: '',\n        queryRunnerParams: {},\n        panelType: PanelType.TIMESERIES,\n      },\n      data: new SceneDataTransformer({\n        $data: buildCompareTimeSeriesQueryRunner({ filterKey }),\n        transformations: [addRefId, addStats],\n      }),\n      overrides: (series: DataFrame[]) => SceneComparePanel.buildSeriesOverrides(series, color),\n      headerActions: () => [new SwitchTimeRangeSelectionModeAction()],\n    });\n\n    SceneComparePanel.configureTimeRange(timeseriesPanel, target, title);\n    return timeseriesPanel;\n  }\n\n  private static buildSeriesOverrides(series: DataFrame[], color: string): Array<{ matcher: any; properties: any[] }> {\n    return series.map((s) => {\n      const metricField = s.fields[1];\n      const allValuesSum = getSeriesStatsValue(s, 'allValuesSum') || 0;\n\n      const properLabel = SceneComparePanel.getProperLabel(s);\n      const total = SceneComparePanel.formatTotalValue(allValuesSum, metricField.config.unit || 'short');\n\n      const properties = [\n        {\n          id: 'displayName',\n          value: `${properLabel} = ${total}`,\n        },\n        {\n          id: 'color',\n          value: { mode: 'fixed', fixedColor: color },\n        },\n      ];\n\n      return {\n        matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n        properties,\n      };\n    });\n  }\n\n  private static getProperLabel(s: DataFrame): string {\n    const displayNameWithLabel = formatSingleSeriesDisplayName('', s);\n    const labelMatch = displayNameWithLabel.match(/^(avg|total)/);\n    return labelMatch ? labelMatch[1] : 'total';\n  }\n\n  private static formatTotalValue(allValuesSum: number, displayUnit: string): string {\n    const safeDisplayUnit = displayUnit || 'short';\n    const formattedValue = getValueFormat(safeDisplayUnit)(allValuesSum);\n\n    return `${formattedValue.text}${formattedValue.suffix}`;\n  }\n\n  private static configureTimeRange(timeseriesPanel: SceneLabelValuesTimeseries, target: string, title: string) {\n    timeseriesPanel.state.body.setState({\n      $timeRange: new SceneTimeRangeWithAnnotations({\n        key: `${target}-annotation-timerange`,\n        mode: TimeRangeWithAnnotationsMode.ANNOTATIONS,\n        annotationColor:\n          target === CompareTarget.BASELINE ? BASELINE_COLORS.OVERLAY.toString() : COMPARISON_COLORS.OVERLAY.toString(),\n        annotationTitle: `${title} flame graph range`,\n      }),\n    });\n  }\n\n  static getDiffRange(\n    timeseriesPanel: SceneLabelValuesTimeseries\n  ): [number | undefined, number | undefined, string | undefined] {\n    let diffFrom: number | undefined;\n    let diffTo: number | undefined;\n\n    const annotation = timeseriesPanel.state.body.state.$data?.state.data?.annotations?.[0] as RangeAnnotation;\n\n    annotation?.fields.some(({ name, values }) => {\n      diffFrom = name === 'time' ? values[0] : diffFrom;\n      diffTo = name === 'timeEnd' ? values[0] : diffTo;\n      return diffFrom && diffTo;\n    });\n\n    return [diffFrom, diffTo, timeseriesPanel.state.$timeRange?.state.timeZone];\n  }\n\n  protected getAncestorTimeRange(): SceneTimeRangeLike {\n    if (!this.parent || !this.parent.parent) {\n      throw new Error(typeof this + ' must be used within $timeRange scope');\n    }\n\n    return sceneGraph.getTimeRange(this.parent.parent);\n  }\n\n  subscribeToEvents() {\n    const { target, timeseriesPanel, $timeRange } = this.state;\n\n    const $annotationTimeRange = timeseriesPanel.state.body.state.$timeRange as SceneTimeRangeWithAnnotations;\n\n    const switchSub = this.subscribeToEvent(EventSwitchTimerangeSelectionMode, (event) => {\n      // this triggers a timeseries request to the API\n      // TODO: caching?\n      $annotationTimeRange.setState({\n        mode:\n          event.payload.mode === TimerangeSelectionMode.FLAMEGRAPH\n            ? TimeRangeWithAnnotationsMode.ANNOTATIONS\n            : TimeRangeWithAnnotationsMode.DEFAULT,\n      });\n    });\n\n    const annotationTimeRangeSub = $annotationTimeRange.subscribeToState((newState, prevState) => {\n      if (this.state.timeRangeSyncEnabled && newState.annotationTimeRange !== prevState.annotationTimeRange) {\n        this.publishEvent(\n          new EventSyncTimeRanges({ source: target, annotationTimeRange: newState.annotationTimeRange }),\n          true\n        );\n      }\n    });\n\n    const timeRangeSub = $timeRange.subscribeToState((newState, prevState) => {\n      if (newState.from !== prevState.from || newState.to !== prevState.to) {\n        this.updateTitle('');\n\n        if (this.state.timeRangeSyncEnabled) {\n          this.publishEvent(new EventSyncTimeRanges({ source: target, timeRange: newState }), true);\n        }\n      }\n    });\n\n    // Subscribe to data changes for step synchronization\n    const dataSub = timeseriesPanel.state.body.state.$data?.subscribeToState((newState) => {\n      if (newState.data?.state === 'Done' && newState.data.series?.length) {\n        this.syncStepSizeWithSibling(newState.data.series);\n      }\n    });\n\n    return {\n      unsubscribe() {\n        timeRangeSub.unsubscribe();\n        annotationTimeRangeSub.unsubscribe();\n        switchSub.unsubscribe();\n        dataSub?.unsubscribe();\n      },\n    };\n  }\n\n  buildTimeseriesTitle() {\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const { description } = getProfileMetric(profileMetricId as ProfileMetricId);\n    return description || getProfileMetricLabel(profileMetricId);\n  }\n\n  useDiffTimeRange() {\n    return (this.state.timeseriesPanel.state.body.state.$timeRange as SceneTimeRangeWithAnnotations).useState();\n  }\n\n  applyPreset({ from, to, diffFrom, diffTo, label }: Preset) {\n    this.setDiffRange({ from: diffFrom, to: diffTo });\n\n    this.setTimeRange(buildTimeRange(from, to));\n\n    this.updateTitle(label);\n  }\n\n  setTimeRange(newTimeRange: SceneTimeRangeState) {\n    const { from, to } = this.state.$timeRange.state.value;\n\n    if (!from.isSame(newTimeRange.value.from) || !to.isSame(newTimeRange.value.to)) {\n      this.state.$timeRange.setState({ from: newTimeRange.from, to: newTimeRange.to, value: newTimeRange.value });\n    }\n  }\n\n  setDiffRange(options: { from: string; to: string } | null) {\n    const $diffTimeRange = this.state.timeseriesPanel.state.body.state.$timeRange as SceneTimeRangeWithAnnotations;\n\n    if (options === null) {\n      $diffTimeRange.nullifyAnnotationTimeRange();\n      return;\n    }\n\n    const { annotationTimeRange } = $diffTimeRange.state;\n    const newAnnotationTimeRange = $diffTimeRange.buildAnnotationTimeRange(options.from, options.to);\n\n    if (\n      !annotationTimeRange.from.isSame(newAnnotationTimeRange.from) ||\n      !annotationTimeRange.to.isSame(newAnnotationTimeRange.to)\n    ) {\n      $diffTimeRange.setAnnotationTimeRange(newAnnotationTimeRange, true);\n    }\n  }\n\n  /**\n   * This function is responsible for automatically selecting half of the time range (from the time picker) that will be used to build the diff flame graph\n   * For the baseline panel, the leftmost part, for the comparison one, the rightmost part.\n   * In the future, we might want to be smarter and provides a way to select (e.g.) the region with the lowest resource consumption on the baseline panel vs\n   * the region with the highest consumption on the comparison panel.\n   */\n  autoSelectDiffRange(selectWholeRange: boolean) {\n    const { $timeRange, target } = this.state;\n    const { from, to } = $timeRange.state.value;\n\n    this.updateTitle('');\n\n    if (selectWholeRange) {\n      this.setDiffRange({ from: from.toISOString(), to: to.toISOString() });\n      return;\n    }\n\n    const diff = to.diff(from);\n\n    // ensure that we don't kill the backend when selecting long periods like 7d\n    const range = Math.min(Math.round(diff * 0.25), ONE_DAY_IN_MS);\n\n    if (target === CompareTarget.BASELINE) {\n      // we have to create a new instance because add() mutates the original one\n      this.setDiffRange({ from: from.toISOString(), to: dateTime(from).add(range).toISOString() });\n    } else {\n      // we have to create a new instance because subtract() mutates the original one\n      this.setDiffRange({ from: dateTime(to).subtract(range).toISOString(), to: to.toISOString() });\n    }\n  }\n\n  updateTitle(label = '') {\n    const title = this.state.target === CompareTarget.BASELINE ? 'Baseline' : 'Comparison';\n    const newTitle = label ? `${title} (${label})` : title;\n\n    this.setState({ title: newTitle });\n  }\n\n  onClickTimeRangeSync = () => {\n    const { target, timeRangeSyncEnabled, $timeRange, timeseriesPanel } = this.state;\n    const $annotationTimeRange = timeseriesPanel.state.body.state.$timeRange as SceneTimeRangeWithAnnotations;\n\n    this.publishEvent(\n      new EventEnableSyncTimeRanges({\n        source: target,\n        enable: !timeRangeSyncEnabled,\n        timeRange: $timeRange.state,\n        annotationTimeRange: $annotationTimeRange.state.annotationTimeRange,\n      }),\n      true\n    );\n  };\n\n  toggleTimeRangeSync(timeRangeSyncEnabled: boolean) {\n    this.setState({ timeRangeSyncEnabled });\n  }\n\n  onClickRefresh = () => {\n    this.publishEvent(new EventSyncRefresh({ source: this.state.target }), true);\n  };\n\n  refreshTimeseries() {\n    this.state.$timeRange.onRefresh();\n  }\n\n  private syncStepSizeWithSibling(myData: DataFrame[]) {\n    const siblingPanel = this.getSiblingPanel();\n    if (!siblingPanel) {\n      return;\n    }\n\n    const siblingData = this.getSiblingData(siblingPanel);\n    if (!siblingData?.length) {\n      return;\n    }\n\n    this.performStepSynchronization(myData, siblingData);\n  }\n\n  private getSiblingPanel(): SceneComparePanel | null {\n    if (!this.parent) {\n      return null;\n    }\n\n    const parentState = 'state' in this.parent ? this.parent.state : this.parent;\n    if (!('baselinePanel' in parentState && 'comparisonPanel' in parentState)) {\n      return null;\n    }\n\n    return this.state.target === CompareTarget.BASELINE\n      ? (parentState.comparisonPanel as SceneComparePanel)\n      : (parentState.baselinePanel as SceneComparePanel);\n  }\n\n  private getSiblingData(siblingPanel: SceneComparePanel): DataFrame[] | null {\n    return siblingPanel.state.timeseriesPanel.state.body.state.$data?.state.data?.series || null;\n  }\n\n  private performStepSynchronization(myData: DataFrame[], siblingData: DataFrame[]) {\n    const myStep = this.extractStepDuration(myData);\n    const siblingStep = this.extractStepDuration(siblingData);\n\n    if (myStep && siblingStep && Math.abs(myStep - siblingStep) > 0.001) {\n      const targetStep = Math.max(myStep, siblingStep); // Use highest step (lowest resolution) to reduce data points\n\n      if (this.state.lastSyncedStepSec !== targetStep) {\n        this.setState({ lastSyncedStepSec: targetStep });\n        this.updateQueryStep(targetStep);\n      }\n    }\n  }\n\n  private extractStepDuration(data: DataFrame[]): number | null {\n    if (!data?.length) {\n      return null;\n    }\n\n    const timeField = data[0].fields.find((f) => f.type === 'time');\n    if (!timeField?.values?.length || timeField.values.length < 2) {\n      return null;\n    }\n\n    const times = timeField.values as number[];\n    const stepDurationMs = times[1] - times[0];\n    const stepDurationSec = stepDurationMs / 1000;\n    return stepDurationSec;\n  }\n\n  private updateQueryStep(targetStepSec: number) {\n    const queryRunner = this.state.timeseriesPanel.state.body.state.$data?.state.$data as SceneQueryRunner;\n    if (!queryRunner?.setState || !queryRunner?.runQueries) {\n      return;\n    }\n\n    const currentQueries = queryRunner.state.queries;\n\n    const updatedQueries = currentQueries.map((query: any) => ({\n      ...query,\n      step: targetStepSec,\n    }));\n\n    queryRunner.setState({ queries: updatedQueries });\n    queryRunner.runQueries();\n  }\n\n  public static Component = ({ model }: SceneComponentProps<SceneComparePanel>) => {\n    const {\n      target,\n      color,\n      title,\n      timeseriesPanel: timeseries,\n      timePicker,\n      refreshPicker,\n      filterKey,\n      timeRangeSyncEnabled,\n    } = model.useState();\n\n    const styles = useStyles2(getStyles, color);\n\n    const filtersVariable = sceneGraph.findByKey(model, filterKey) as FiltersVariable;\n\n    return (\n      <div className={styles.panel} data-testid={`panel-${target}`}>\n        <div className={styles.panelHeader}>\n          <h6>\n            <div className={styles.colorCircle} />\n            {title}\n          </h6>\n\n          <div className={styles.timeControls}>\n            <timePicker.Component model={timePicker} />\n\n            <div onClick={model.onClickRefresh}>\n              <refreshPicker.Component model={refreshPicker} />\n            </div>\n\n            <IconButton\n              className={cx(styles.syncButton, timeRangeSyncEnabled && 'active')}\n              name=\"link\"\n              aria-label={timeRangeSyncEnabled ? 'Unsync time ranges' : 'Sync time ranges'}\n              tooltip={timeRangeSyncEnabled ? 'Unsync time ranges' : 'Sync time ranges'}\n              onClick={model.onClickTimeRangeSync}\n            />\n          </div>\n        </div>\n\n        <div className={styles.filter}>\n          <filtersVariable.Component model={filtersVariable} />\n        </div>\n\n        <div className={styles.timeseries}>{timeseries && <timeseries.Component model={timeseries} />}</div>\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2, color: string) => ({\n  panel: css`\n    background-color: ${theme.colors.background.primary};\n    padding: ${theme.spacing(1)} ${theme.spacing(1)} 0 ${theme.spacing(1)};\n    border: 1px solid ${theme.colors.border.weak};\n    border-radius: 2px;\n  `,\n  panelHeader: css`\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin-bottom: ${theme.spacing(2)};\n    flex-wrap: wrap;\n\n    & > h6 {\n      font-size: 15px;\n      height: 32px;\n      line-height: 32px;\n      margin: 0 ${theme.spacing(1)} 0 0;\n    }\n  `,\n  colorCircle: css`\n    display: inline-block;\n    background-color: ${color};\n    border-radius: 50%;\n    width: 9px;\n    height: 9px;\n    margin-right: 6px;\n  `,\n  timeControls: css`\n    display: flex;\n    justify-content: flex-end;\n    gap: 4px;\n  `,\n  syncButton: css`\n    z-index: unset;\n    padding: ${theme.spacing(0, 1)};\n    margin: 0;\n    background: ${theme.colors.secondary.main};\n    border: 1px solid ${theme.colors.secondary.border};\n    border-radius: ${theme.shape.radius.default};\n\n    &:hover {\n      background: ${theme.colors.secondary.shade};\n    }\n\n    &.active {\n      color: ${theme.colors.primary.text};\n      border: 1px solid ${theme.colors.primary.text};\n    }\n  `,\n  filter: css`\n    display: flex;\n    margin-bottom: ${theme.spacing(3)};\n  `,\n  timeseries: css`\n    height: 200px;\n\n    & [data-viz-panel-key] > * {\n      border: 0 none;\n    }\n\n    & [data-viz-panel-key] [data-testid='uplot-main-div'] {\n      cursor: crosshair;\n    }\n  `,\n});\n","import { useState } from 'react';\n\ntype PanelId = 'ai' | 'function-details' | null;\n\ntype OnOpenHandler = () => void;\n\ntype SidePanel = {\n  onOpen: (handler: OnOpenHandler) => void;\n  isOpen: (panelId: PanelId) => boolean;\n  open: (panelId: PanelId) => void;\n  close: () => void;\n};\n\nexport function useToggleSidePanel(): SidePanel {\n  const [openPanelId, setOpenPanelId] = useState<PanelId>(null);\n  const [onOpenHandler, setOnOpenHandler] = useState<OnOpenHandler>();\n\n  return {\n    onOpen(handler: OnOpenHandler) {\n      setOnOpenHandler(() => handler);\n    },\n    isOpen(panelId: PanelId) {\n      return panelId === openPanelId;\n    },\n    open(panelId: PanelId) {\n      setOpenPanelId(panelId);\n      onOpenHandler?.();\n    },\n    close() {\n      setOpenPanelId(null);\n    },\n  };\n}\n","import React, { useEffect, useState } from 'react';\n\ninterface Props {\n  children: React.ReactNode;\n  delay: number;\n}\n\n/**\n * Delay the rendering of the children by N amount of milliseconds\n */\nexport function DelayRender({ children, delay }: Props) {\n  const [shouldRender, setShouldRender] = useState(false);\n  useEffect(() => {\n    window.setTimeout(() => {\n      setShouldRender(true);\n    }, delay);\n  }, [children, delay]);\n\n  return <>{shouldRender ? children : null}</>;\n}\n","import { cx } from '@emotion/css';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Dropdown, ToolbarButton } from '@grafana/ui';\nimport React, { ReactElement, useCallback } from 'react';\n\ntype TooltipPlacement =\n  | 'auto-start'\n  | 'auto'\n  | 'auto-end'\n  | 'top-start'\n  | 'top'\n  | 'top-end'\n  | 'right-start'\n  | 'right'\n  | 'right-end'\n  | 'bottom-end'\n  | 'bottom'\n  | 'bottom-start'\n  | 'left-end'\n  | 'left'\n  | 'left-start';\n\ninterface PanelMenuProps {\n  menu: ReactElement | (() => ReactElement);\n  menuButtonClass?: string;\n  dragClassCancel?: string;\n  title?: string;\n  placement?: TooltipPlacement;\n  offset?: [number, number];\n  onVisibleChange?: (state: boolean) => void;\n  onOpenMenu?: () => void;\n}\n\nexport function PanelMenu({\n  menu,\n  title,\n  placement = 'bottom',\n  offset,\n  dragClassCancel,\n  menuButtonClass,\n  onVisibleChange,\n  onOpenMenu,\n}: PanelMenuProps) {\n  const testId = title ? selectors.components.Panels.Panel.menu(title) : `panel-menu-button`;\n\n  const handleVisibility = useCallback(\n    (show: boolean) => {\n      if (show && onOpenMenu) {\n        onOpenMenu();\n      }\n      return onVisibleChange;\n    },\n    [onOpenMenu, onVisibleChange]\n  );\n\n  const label = title ? `Menu for panel with title ${title}` : `Menu for panel with no title`;\n\n  return (\n    <Dropdown overlay={menu} placement={placement} offset={offset} onVisibleChange={handleVisibility}>\n      <ToolbarButton\n        aria-label={label}\n        title=\"Menu\"\n        icon=\"ellipsis-v\"\n        iconSize=\"md\"\n        narrow\n        data-testid={testId}\n        className={cx(menuButtonClass, dragClassCancel)}\n      />\n    </Dropdown>\n  );\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors as e2eSelectors } from '@grafana/e2e-selectors';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport React, { ReactElement, useCallback, useRef, useState } from 'react';\n\nimport { PanelMenu } from './PanelMenu';\n\ninterface Props {\n  children?: React.ReactNode;\n  menu?: ReactElement | (() => ReactElement);\n  title?: string;\n  offset?: number;\n  dragClass?: string;\n  onOpenMenu?: () => void;\n}\n\nexport function HoverWidget({ menu, title, dragClass, children, offset = -32, onOpenMenu }: Props) {\n  const styles = useStyles2(getStyles);\n  const draggableRef = useRef<HTMLDivElement>(null);\n  const selectors = e2eSelectors.components.Panels.Panel.HoverWidget;\n  // Capture the pointer to keep the widget visible while dragging\n  const onPointerDown = useCallback((e: React.PointerEvent<HTMLDivElement>) => {\n    draggableRef.current?.setPointerCapture(e.pointerId);\n  }, []);\n\n  const onPointerUp = useCallback((e: React.PointerEvent<HTMLDivElement>) => {\n    draggableRef.current?.releasePointerCapture(e.pointerId);\n  }, []);\n\n  const [menuOpen, setMenuOpen] = useState(false);\n\n  if (children === undefined || React.Children.count(children) === 0) {\n    return null;\n  }\n\n  return (\n    <div\n      className={cx(styles.container, { 'show-on-hover': !menuOpen })}\n      style={{ top: `${offset}px` }}\n      data-testid={selectors.container}\n    >\n      {dragClass && (\n        <div\n          className={cx(styles.square, styles.draggable, dragClass)}\n          onPointerDown={onPointerDown}\n          onPointerUp={onPointerUp}\n          ref={draggableRef}\n          data-testid={selectors.dragIcon}\n        >\n          <Icon name=\"expand-arrows\" className={styles.draggableIcon} />\n        </div>\n      )}\n      {!title && <h6 className={cx(styles.untitled, { [styles.draggable]: !!dragClass }, dragClass)}>Untitled</h6>}\n      {children}\n      {menu && (\n        <PanelMenu\n          menu={menu}\n          title={title}\n          placement=\"bottom\"\n          menuButtonClass={styles.menuButton}\n          onVisibleChange={setMenuOpen}\n          onOpenMenu={onOpenMenu}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    hidden: css({\n      visibility: 'hidden',\n      opacity: '0',\n    }),\n    container: css({\n      label: 'hover-container-widget',\n      transition: `all .1s linear`,\n      display: 'flex',\n      position: 'absolute',\n      zIndex: 1,\n      right: 0,\n      boxSizing: 'content-box',\n      alignItems: 'center',\n      background: theme.colors.background.secondary,\n      color: theme.colors.text.primary,\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: theme.shape.radius.default,\n      height: theme.spacing(4),\n      boxShadow: theme.shadows.z1,\n    }),\n    square: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      width: theme.spacing(4),\n      height: '100%',\n    }),\n    draggable: css({\n      cursor: 'move',\n      // mobile do not support draggable panels\n      [theme.breakpoints.down('md')]: {\n        display: 'none',\n      },\n    }),\n    menuButton: css({\n      // Background and border are overriden when topnav toggle is disabled\n      background: 'inherit',\n      border: 'none',\n      '&:hover': {\n        background: theme.colors.secondary.main,\n      },\n    }),\n    untitled: css({\n      color: theme.colors.text.disabled,\n      fontStyle: 'italic',\n      padding: theme.spacing(0, 1),\n      marginBottom: 0,\n    }),\n    draggableIcon: css({\n      transform: 'rotate(45deg)',\n      color: theme.colors.text.secondary,\n      '&:hover': {\n        color: theme.colors.text.primary,\n      },\n    }),\n  };\n}\n","import { css, CSSObject, cx } from '@emotion/css';\nimport { GrafanaTheme2, LinkModel, LinkTarget } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React, { forwardRef } from 'react';\n\ntype TitleItemProps = {\n  className?: string;\n  children: React.ReactNode;\n  onClick?: LinkModel['onClick'];\n  href?: string;\n  target?: LinkTarget;\n  title?: string;\n};\n\ntype TitleItemElement = HTMLAnchorElement & HTMLButtonElement;\n\nexport const TitleItem = forwardRef<TitleItemElement, TitleItemProps>(\n  ({ className, children, href, onClick, target, title, ...rest }, ref) => {\n    const styles = useStyles2(getStyles);\n\n    if (href) {\n      return (\n        <a\n          ref={ref}\n          href={href}\n          onClick={onClick}\n          target={target}\n          title={title}\n          className={cx(styles.linkItem, className)}\n          {...rest}\n        >\n          {children}\n        </a>\n      );\n    } else if (onClick) {\n      return (\n        <Button ref={ref} className={cx(styles.item, className)} variant=\"secondary\" fill=\"text\" onClick={onClick}>\n          {children}\n        </Button>\n      );\n    } else {\n      return (\n        <span ref={ref} className={cx(styles.item, className)} {...rest}>\n          {children}\n        </span>\n      );\n    }\n  }\n);\n\nTitleItem.displayName = 'TitleItem';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const item = css({\n    color: `${theme.colors.text.secondary}`,\n    label: 'panel-header-item',\n    cursor: 'auto',\n    border: 'none',\n    borderRadius: `${theme.shape.radius.default}`,\n    padding: `${theme.spacing(0, 1)}`,\n    height: `${theme.spacing(theme.components.panel.headerHeight)}`,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n\n    '&:focus, &:focus-visible': {\n      ...getFocusStyles(theme),\n      zIndex: 1,\n    },\n    '&: focus:not(:focus-visible)': {\n      outline: 'none',\n      boxShadow: `none`,\n    },\n\n    '&:hover ': {\n      boxShadow: `${theme.shadows.z1}`,\n      background: `${theme.colors.background.secondary}`,\n      color: `${theme.colors.text.primary}`,\n    },\n  });\n\n  return {\n    item,\n    linkItem: cx(item, css({ cursor: 'pointer' })),\n  };\n};\n\nfunction getFocusStyles(theme: GrafanaTheme2): CSSObject {\n  return {\n    outline: '2px dotted transparent',\n    outlineOffset: '2px',\n    boxShadow: `0 0 0 2px ${theme.colors.background.canvas}, 0 0 0px 4px ${theme.colors.primary.main}`,\n    transitionTimingFunction: `cubic-bezier(0.19, 1, 0.22, 1)`,\n    transitionDuration: '0.2s',\n    transitionProperty: 'outline, outline-offset, box-shadow',\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { TitleItem } from './TitleItem';\n\ninterface Props {\n  description: string | (() => string);\n  className?: string;\n}\n\nexport function PanelDescription({ description, className }: Props) {\n  const styles = useStyles2(getStyles);\n\n  const getDescriptionContent = () => {\n    const panelDescription = typeof description === 'function' ? description() : description;\n\n    return (\n      <div className=\"panel-info-content markdown-html\">\n        <div dangerouslySetInnerHTML={{ __html: panelDescription }} />\n      </div>\n    );\n  };\n\n  return description !== '' ? (\n    <Tooltip interactive content={getDescriptionContent}>\n      <TitleItem className={cx(className, styles.description)}>\n        <Icon name=\"info-circle\" size=\"md\" />\n      </TitleItem>\n    </Tooltip>\n  ) : null;\n}\n\nconst getStyles = () => {\n  return {\n    description: css({\n      code: {\n        whiteSpace: 'normal',\n        wordWrap: 'break-word',\n      },\n\n      'pre > code': {\n        display: 'block',\n      },\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { ToolbarButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ninterface Props {\n  message?: string;\n  onClick?: (e: React.SyntheticEvent) => void;\n  ariaLabel?: string;\n}\n\nexport function PanelStatus({ message, onClick, ariaLabel = 'status' }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <ToolbarButton\n      className={styles.buttonStyles}\n      onClick={onClick}\n      variant={'destructive'}\n      icon=\"exclamation-triangle\"\n      iconSize=\"md\"\n      tooltip={message || ''}\n      aria-label={ariaLabel}\n    />\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const { headerHeight, padding } = theme.components.panel;\n\n  return {\n    buttonStyles: css({\n      label: 'panel-header-state-button',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      padding: theme.spacing(padding),\n      width: theme.spacing(headerHeight),\n      height: theme.spacing(headerHeight),\n      borderRadius: theme.shape.radius.default,\n    }),\n  };\n};\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2, LoadingState } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Icon, LoadingBar, Tooltip, useStyles2, useTheme2 } from '@grafana/ui';\nimport React, { CSSProperties, ReactElement, ReactNode, useEffect, useRef, useState } from 'react';\n\nimport { DelayRender } from './DelayRender';\nimport { HoverWidget } from './HoverWidget';\nimport { PanelDescription } from './PanelDescription';\nimport { PanelMenu } from './PanelMenu';\nimport { PanelStatus } from './PanelStatus';\nimport { TitleItem } from './TitleItem';\n\n// This `GrafanaPanelBox` has been derived from the `PanelChrome`, which is exportable via @grafana/ui\n// This variant makes it behave more like the panel/box from Pyroscope, where css dictates the style\n// versus explicit height & width props.\n// The various files in this subdirectory are lifted from grafana/grafana, but this base component, `PanelChromeProps`\n// has been altered slightly.\n//\n// TODO Consider creating a varation of this component that can be exported from @grafana/ui.\n\n/**\n * @internal\n */\ninterface PanelChromeProps {\n  children: ReactNode;\n  padding?: PanelPadding;\n  hoverHeaderOffset?: number;\n  title?: string;\n  description?: string | (() => string);\n  titleItems?: ReactNode;\n  menu?: ReactElement | (() => ReactElement);\n  dragClass?: string;\n  dragClassCancel?: string;\n  hoverHeader?: boolean;\n  /**\n   * Use only to indicate loading or streaming data in the panel.\n   * Any other values of loadingState are ignored.\n   */\n  loadingState?: LoadingState;\n  /**\n   * Used to display status message (used for panel errors currently)\n   */\n  statusMessage?: string;\n  /**\n   * Handle opening error details view (like inspect / error tab)\n   */\n  statusMessageOnClick?: (e: React.SyntheticEvent) => void;\n  actions?: ReactNode;\n  displayMode?: 'default' | 'transparent';\n  onCancelQuery?: () => void;\n  /**\n   * callback when opening the panel menu\n   */\n  onOpenMenu?: () => void;\n}\n\n/**\n * @internal\n */\ntype PanelPadding = 'none' | 'md';\n\n/**\n * @internal\n */\nexport function GrafanaPanelBox({\n  children,\n  padding = 'md',\n  title = '',\n  description = '',\n  displayMode = 'default',\n  titleItems,\n  menu,\n  dragClass,\n  dragClassCancel,\n  hoverHeader = false,\n  hoverHeaderOffset,\n  loadingState,\n  statusMessage,\n  statusMessageOnClick,\n  actions,\n  onCancelQuery,\n  onOpenMenu,\n}: PanelChromeProps) {\n  const theme = useTheme2();\n  const styles = useStyles2(getStyles);\n\n  const [width, setWidth] = useState(0);\n  const childrenContainerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (childrenContainerRef.current) {\n      setWidth(childrenContainerRef.current.offsetWidth);\n    }\n  }, [childrenContainerRef]);\n\n  const hasHeader = !hoverHeader;\n\n  // hover menu is only shown on hover when not on touch devices\n  const showOnHoverClass = 'show-on-hover';\n\n  const headerHeight = getHeaderHeight(theme, hasHeader);\n  const { contentStyle } = getContentStyle(padding, theme);\n\n  const headerStyles: CSSProperties = {\n    height: headerHeight,\n    cursor: dragClass ? 'move' : 'auto',\n  };\n\n  const containerStyles: CSSProperties = {};\n  if (displayMode === 'transparent') {\n    containerStyles.backgroundColor = 'transparent';\n    containerStyles.border = 'none';\n  }\n\n  const testid = title ? selectors.components.Panels.Panel.title(title) : 'Panel';\n\n  const headerContent = (\n    <>\n      {title && (\n        <h6 title={title} className={styles.title}>\n          {title}\n        </h6>\n      )}\n\n      <div className={cx(styles.titleItems, dragClassCancel)} data-testid=\"title-items-container\">\n        <PanelDescription description={description} className={dragClassCancel} />\n        {titleItems}\n      </div>\n\n      {loadingState === LoadingState.Streaming && (\n        <Tooltip content={onCancelQuery ? 'Stop streaming' : 'Streaming'}>\n          <TitleItem className={dragClassCancel} data-testid=\"panel-streaming\" onClick={onCancelQuery}>\n            <Icon name=\"circle-mono\" size=\"md\" className={styles.streaming} />\n          </TitleItem>\n        </Tooltip>\n      )}\n      {loadingState === LoadingState.Loading && onCancelQuery && (\n        <DelayRender delay={2000}>\n          <Tooltip content=\"Cancel query\">\n            <TitleItem\n              className={cx(dragClassCancel, styles.pointer)}\n              data-testid=\"panel-cancel-query\"\n              onClick={onCancelQuery}\n            >\n              <Icon name=\"sync-slash\" size=\"md\" />\n            </TitleItem>\n          </Tooltip>\n        </DelayRender>\n      )}\n      <div className={styles.rightAligned}>\n        {actions && <div className={styles.rightActions}>{itemsRenderer(actions, (item) => item)}</div>}\n      </div>\n    </>\n  );\n\n  return (\n    <div className={styles.container} style={containerStyles} data-testid={testid}>\n      <div className={styles.loadingBarContainer}>\n        {loadingState === LoadingState.Loading ? <LoadingBar width={width} ariaLabel=\"Panel loading bar\" /> : null}\n      </div>\n\n      {hoverHeader && (\n        <>\n          <HoverWidget\n            menu={menu}\n            title={title}\n            offset={hoverHeaderOffset}\n            dragClass={dragClass}\n            onOpenMenu={onOpenMenu}\n          >\n            {headerContent}\n          </HoverWidget>\n\n          {statusMessage && (\n            <div className={styles.errorContainerFloating}>\n              <PanelStatus message={statusMessage} onClick={statusMessageOnClick} ariaLabel=\"Panel status\" />\n            </div>\n          )}\n        </>\n      )}\n\n      {hasHeader && (\n        <div className={cx(styles.headerContainer, dragClass)} style={headerStyles} data-testid=\"header-container\">\n          {statusMessage && (\n            <div className={dragClassCancel}>\n              <PanelStatus message={statusMessage} onClick={statusMessageOnClick} ariaLabel=\"Panel status\" />\n            </div>\n          )}\n\n          {headerContent}\n\n          {menu && (\n            <PanelMenu\n              menu={menu}\n              title={title}\n              placement=\"bottom-end\"\n              menuButtonClass={cx(styles.menuItem, dragClassCancel, showOnHoverClass)}\n              onOpenMenu={onOpenMenu}\n            />\n          )}\n        </div>\n      )}\n\n      <div className={styles.content} style={contentStyle} ref={childrenContainerRef}>\n        {children}\n      </div>\n    </div>\n  );\n}\n\nconst itemsRenderer = (items: ReactNode[] | ReactNode, renderer: (items: ReactNode[]) => ReactNode): ReactNode => {\n  const toRender = React.Children.toArray(items).filter(Boolean);\n  return toRender.length > 0 ? renderer(toRender) : null;\n};\n\nconst getHeaderHeight = (theme: GrafanaTheme2, hasHeader: boolean) => {\n  if (hasHeader) {\n    return theme.spacing.gridSize * theme.components.panel.headerHeight;\n  }\n\n  return 0;\n};\n\nconst getContentStyle = (padding: string, theme: GrafanaTheme2) => {\n  const chromePadding = (padding === 'md' ? theme.components.panel.padding : 0) * theme.spacing.gridSize;\n\n  const contentStyle: CSSProperties = {\n    padding: chromePadding,\n  };\n\n  return { contentStyle };\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const { background, borderColor, padding } = theme.components.panel;\n\n  return {\n    container: css({\n      label: 'panel-container',\n      backgroundColor: background,\n      border: `1px solid ${borderColor}`,\n      position: 'relative',\n      borderRadius: theme.shape.radius.default,\n      height: '100%',\n      display: 'flex',\n      flexDirection: 'column',\n\n      '.show-on-hover': {\n        visibility: 'hidden',\n        opacity: '0',\n      },\n\n      '&:focus-visible, &:hover': {\n        // only show menu icon on hover or focused panel\n        '.show-on-hover': {\n          visibility: 'visible',\n          opacity: '1',\n        },\n      },\n\n      '&:focus-visible': {\n        outline: `1px solid ${theme.colors.action.focus}`,\n      },\n\n      '&:focus-within': {\n        '.show-on-hover': {\n          visibility: 'visible',\n          opacity: '1',\n        },\n      },\n    }),\n    loadingBarContainer: css({\n      label: 'panel-loading-bar-container',\n      position: 'absolute',\n      top: 0,\n      width: '100%',\n      overflow: 'hidden',\n    }),\n    content: css({\n      label: 'panel-content',\n      flexGrow: 1,\n      //contain: 'strict',\n    }),\n    headerContainer: css({\n      label: 'panel-header',\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    pointer: css({\n      cursor: 'pointer',\n    }),\n    streaming: css({\n      label: 'panel-streaming',\n      marginRight: 0,\n      color: theme.colors.success.text,\n\n      '&:hover': {\n        color: theme.colors.success.text,\n      },\n    }),\n    title: css({\n      label: 'panel-title',\n      marginBottom: 0, // override default h6 margin-bottom\n      padding: theme.spacing(0, padding),\n      textOverflow: 'ellipsis',\n      overflow: 'hidden',\n      whiteSpace: 'nowrap',\n      fontSize: theme.typography.h6.fontSize,\n      fontWeight: theme.typography.h6.fontWeight,\n    }),\n    items: css({\n      display: 'flex',\n    }),\n    item: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n    }),\n    hiddenMenu: css({\n      visibility: 'hidden',\n    }),\n    menuItem: css({\n      label: 'panel-menu',\n      border: 'none',\n      background: theme.colors.secondary.main,\n      '&:hover': {\n        background: theme.colors.secondary.shade,\n      },\n    }),\n    errorContainerFloating: css({\n      label: 'error-container',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      zIndex: theme.zIndex.tooltip,\n    }),\n    rightActions: css({\n      display: 'flex',\n      padding: theme.spacing(0, padding),\n      gap: theme.spacing(1),\n    }),\n    rightAligned: css({\n      label: 'right-aligned-container',\n      marginLeft: 'auto',\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    titleItems: css({\n      display: 'flex',\n      height: '100%',\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, LoadingState } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { ReactNode } from 'react';\n\nimport { GrafanaPanelBox } from './GrafanaPanelBox/GrafanaPanelBox';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  panelWrap: css`\n    margin-bottom: ${theme.spacing(1)};\n  `,\n});\n\ntype PanelProps = {\n  isLoading: boolean;\n  title?: ReactNode;\n  description?: ReactNode;\n  children: ReactNode;\n  className?: string;\n  headerActions?: ReactNode;\n  dataTestId?: string;\n};\n\nexport function Panel({\n  isLoading,\n  title,\n  description,\n  children,\n  className = '',\n  headerActions,\n  dataTestId,\n}: PanelProps) {\n  const s = useStyles2(getStyles);\n\n  const loadingState = isLoading ? LoadingState.Loading : LoadingState.Done;\n\n  return (\n    <div className={`${className} ${s.panelWrap}`} data-testid={dataTestId || 'panel'}>\n      <GrafanaPanelBox\n        loadingState={loadingState}\n        title={title as unknown as string}\n        description={description as unknown as string}\n        actions={headerActions}\n      >\n        {children}\n      </GrafanaPanelBox>\n    </div>\n  );\n}\n","import { useAssistant } from '@grafana/assistant';\nimport { featureToggles } from '@shared/infrastructure/settings/featureToggles';\n\nexport const useGrafanaAssistant = () => {\n  const { isAvailable } = useAssistant();\n\n  // Do not show AI button if the assistant integration is enabled to avoid having two AI buttons in the UI\n  // For debugging purposes and comparing both you can use localStorage flag grafana-pyroscope-app.forceShowAiButton\n  const hideAIButton =\n    featureToggles.grafanaAssistantInProfilesDrilldown &&\n    isAvailable &&\n    !localStorage.getItem('grafana-pyroscope-app.forceShowAIButton');\n\n  return { hideAIButton, isAvailable };\n};\n","/* https://platform.openai.com/docs/models/overview */\n\nexport const model = 'gpt-4-1106-preview';\n\n/* https://platform.openai.com/docs/guides/prompt-engineering/tactics */\n\nenum PromptCategories {\n  system = 'system',\n  user = 'user',\n}\n\ntype Prompts = Record<string, (profileType: string, profiles: string[]) => string>;\n\nconst prompts: Record<PromptCategories, Prompts> = {\n  system: {\n    // add new system prompts above\n    empty: () => `\n    You are a performance profiling expert and excel at analyzing profiles in the DOT format.\n    In the DOT format, a row like N47 -> N61 means the function from N47 called the function from N61.\n`,\n  },\n  user: {\n    // add new user prompts above\n    single: (profileType: string, profiles: string[]) => `\n    Analyze this flamegraph in DOT format and address these key aspects:\n    - **Performance Bottleneck**: Identify the primary factors slowing down the process, consuming excessive memory, or causing a bottleneck in the system.\n    - **Root Cause**: Explain clearly why these bottlenecks are occurring.\n    - **Recommended Fix**: Suggest practical solutions for these issues.\n\n    Guidelines:\n    - Always use full function names without splitting them from package names.\n    - Exclude numeric values, percentages, and node names (e.g., N1, N3, Node 1, Node 2).\n    - Focus on user code over low-level runtime optimizations.\n    - For standard library or runtime functions, explain their presence/function and link them to user code functions calling them. Avoid repetitive mentions from the same call chain.\n    - Do not mention that the flamegraph profile is in DOT format.\n    - Only use h5 and h6 markdown headers (e.g., ##### Performance Bottleneck, ###### Recommended Fix)\n    - Do not use h1,h2,h3,h4 headers (e.g., ## Bottleneck, ### Root Cause, #### Recommended Fix)\n\n    Format the response using markdown headers for each section corresponding to the key aspects.\n\n    The profile type is: ${profileType}\n    Profile in DOT format:\n    ${profiles[0]}\n`,\n    anton: (profileType: string, profiles: string[]) => `\nGive me actionable feedback and suggestions on how I improve the application performance.\n\nDo not break function names.\nDo not show any numeric values, absolute or percents.\nDo not show node names like N1, N3, or Node 1, Node 2.\nDo not suggest low-level runtime optimisations, focus on the user code.\n\nAlways use full function names.\nNever split function and package name.\n\nRemove any numeric values, absolute or percents, from the output.\nRemove node names like N1, N3, or Node 1, Node 2 from the output.\n\nIf the function is widely known (e.g., a runtime or stdlib function), provide me concise explanation why the function is present in the profile and what could be the cause.\nIf a function is defined in the runtime or in the standard library, tell me which function in the user code calls it.\nAvoid mentioning functions from the same call-chain.\n\n5 suggestions is enough.\nThe profile type is ${profileType}\nBelow is the performance profile in DOT format:\n${profiles[0]}\n`,\n    diff: (profileType: string, profiles: string[]) => `\nAnalyze the differences between these two performance profiles presented in DOT format. Provide a detailed comparison focusing on the following aspects:\n\n- Performance Change: Determine how the performance has changed from the first profile to the second. Identify if there are new bottlenecks, improved or worsened performance areas, or significant changes in resource consumption.\n- Function Impact: Highlight no more than 3 specific functions that have undergone notable changes in their performance impact. Discuss any new functions that have appeared in the second profile or any existing functions that have significantly increased or decreased in resource usage.\n- Potential Causes: Discuss the possible reasons for these changes in performance, linking them to the differences in function execution or resource usage between the two profiles.\n\nGuidelines for Analysis:\n- Use full function names without separating them from their package names\n- Focus on user code rather than low-level runtime optimizations or standard library functions unless they are directly relevant to the user code's performance changes\n- Exclude numeric values, percentages, and node names (e.g., N1, N3, Node 1, Node 2) from the analysis\n- Format the response using markdown headers for each section to structure the analysis clearly\n\nThe profile type is: ${profileType}\n\nFirst performance profile in DOT format:\n${profiles[0]}\n\nSecond performance profile in DOT format:\n${profiles[1]}\n`,\n  },\n};\n\nexport const buildPrompts = ({\n  system,\n  user,\n  profileType,\n  profiles,\n}: {\n  system: string;\n  user: string;\n  profileType: string;\n  profiles: string[];\n}) => {\n  const systemPrompt = prompts.system[system];\n\n  if (typeof systemPrompt !== 'function') {\n    throw new Error(`Cannot find system prompt \"${system}\"!`);\n  }\n\n  const userPrompt = prompts.user[user];\n\n  if (typeof userPrompt !== 'function') {\n    throw new Error(`Cannot find user prompt \"${user}\"!`);\n  }\n\n  return {\n    system: systemPrompt(profileType, profiles),\n    user: userPrompt(profileType, profiles),\n  };\n};\n","import { TimeRange } from '@grafana/data';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\n\nimport { DataSourceProxyClient } from '../series/http/DataSourceProxyClient';\n\ntype DiffProfileResponse = string | FlamebearerProfile;\n\ntype GetParams = {\n  query: string;\n  timeRange: TimeRange;\n  format: 'dot' | 'json';\n  maxNodes: number;\n};\n\nexport class ProfileApiClient extends DataSourceProxyClient {\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n  }\n\n  async get(params: GetParams): Promise<DiffProfileResponse> {\n    const searchParams = new URLSearchParams({\n      query: params.query,\n      from: String(params.timeRange.from.unix() * 1000),\n      until: String(params.timeRange.to.unix() * 1000),\n      format: params.format,\n    });\n\n    if (params.maxNodes) {\n      searchParams.set('max-nodes', String(params.maxNodes));\n    }\n\n    const response = await this.fetch(`/pyroscope/render?${searchParams.toString()}`);\n\n    switch (params.format) {\n      case 'dot':\n        return response.text();\n\n      case 'json':\n        return response.json();\n\n      default:\n        throw new TypeError(`Unknown format \"${params.format}\"!`);\n    }\n  }\n}\n","import { TimeRange } from '@grafana/data';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { useQuery } from '@tanstack/react-query';\n\nimport { ProfileApiClient } from '../../../infrastructure/profiles/ProfileApiClient';\nimport { DataSourceProxyClientBuilder } from '../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { cleanupDotResponse } from './cleanupDotResponse';\n\nexport type FetchParams = Array<{\n  query: string;\n  timeRange: TimeRange;\n}>;\n\nconst MAX_NODES = 100;\n\nexport function useFetchDotProfiles(\n  isDiff: boolean,\n  fetchParams: Array<{\n    query: string;\n    timeRange: TimeRange;\n  }>,\n  dataSourceUid: string,\n  profileMetricId: string\n) {\n  const { params, error: validationError } = validateFetchParams(isDiff, fetchParams);\n\n  const { error: fetchError, isFetching, profiles } = usePerformFetchDotProfiles(dataSourceUid, params);\n  const profileType = getProfileMetric(profileMetricId as ProfileMetricId).type;\n\n  return { profileType, profiles, validationError, fetchError, isFetching };\n}\n\nfunction validateFetchParams(isDiff: boolean, fetchParams: FetchParams) {\n  let params = fetchParams;\n  let error;\n\n  if (isDiff && fetchParams.length !== 2) {\n    error = new Error(`Invalid number of fetch parameters for analyzing the diff flame graph (${fetchParams.length})!`);\n    params = [];\n  } else if (!isDiff && fetchParams.length !== 1) {\n    error = new Error(`Invalid number of fetch parameters for analyzing the flame graph (${fetchParams.length})!`);\n    params = [];\n  }\n\n  return { params, error };\n}\n\nfunction usePerformFetchDotProfiles(dataSourceUid: string, fetchParams: FetchParams) {\n  const profileApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, ProfileApiClient);\n\n  const { isFetching, error, data } = useQuery({\n    queryKey: [\n      'dot-profiles',\n      dataSourceUid,\n      ...fetchParams.flatMap(({ query, timeRange }) => [query, timeRange.from.unix(), timeRange.to.unix()]),\n      MAX_NODES,\n    ],\n    queryFn: () => {\n      // TODO: pass a signal options to properly abort all in-flight requests\n      return Promise.all(\n        fetchParams.map(({ query, timeRange }) =>\n          profileApiClient\n            .get({ query, timeRange, format: 'dot', maxNodes: MAX_NODES })\n            .then((response) => cleanupDotResponse(response as string))\n        )\n      );\n    },\n  });\n\n  return {\n    isFetching,\n    error,\n    profiles: data || [],\n  };\n}\n","export function cleanupDotResponse(profile: string): string {\n  return profile\n    .replace(/fontsize=\\d+ /g, '')\n    .replace(/id=\"node\\d+\" /g, '')\n    .replace(/labeltooltip=\".*\\)\" /g, '')\n    .replace(/tooltip=\".*\\)\" /g, '')\n    .replace(/(N\\d+ -> N\\d+).*/g, '$1')\n    .replace(/N\\d+ \\[label=\"other.*\\n/, '')\n    .replace(/shape=box /g, '')\n    .replace(/fillcolor=\"#\\w{6}\"/g, '')\n    .replace(/color=\"#\\w{6}\" /g, '');\n}\n","import { css } from '@emotion/css';\nimport { createAssistantContextItem, OpenAssistantButton, useAssistant } from '@grafana/assistant';\nimport { Spinner } from '@grafana/ui';\nimport React from 'react';\n\nimport { buildPrompts } from './SceneAiPanel/domain/buildLlmPrompts';\nimport { FetchParams, useFetchDotProfiles } from './SceneAiPanel/infrastructure/useFetchDotProfiles';\n\ninterface AnalyzeDiffFlameGraphProps {\n  dataSourceUid: string;\n  profileMetricId: string;\n  isDiff: boolean;\n  fetchParams: FetchParams;\n}\n\nexport function AnalyzeDiffFlameGraph({\n  dataSourceUid,\n  profileMetricId,\n  isDiff,\n  fetchParams,\n}: AnalyzeDiffFlameGraphProps) {\n  const { isAvailable } = useAssistant();\n\n  const { profileType, profiles, validationError, fetchError, isFetching } = useFetchDotProfiles(\n    isDiff,\n    fetchParams,\n    dataSourceUid,\n    profileMetricId\n  );\n\n  if (!isAvailable) {\n    return null;\n  }\n\n  if (validationError || fetchError) {\n    return null;\n  }\n\n  if (!isFetching && profileType && profiles) {\n    const prompts = buildPrompts({\n      system: 'empty',\n      user: 'diff',\n      profileType,\n      profiles,\n    });\n\n    const context = [\n      createAssistantContextItem('datasource', {\n        datasourceUid: dataSourceUid,\n      }),\n      createAssistantContextItem('structured', {\n        title: 'DOT Profiles and instructions',\n        data: { stringifiedData: `${prompts.system}\\n${prompts.user}` },\n      }),\n    ];\n\n    return (\n      <div className={css({ marginTop: '10px' })}>\n        <OpenAssistantButton\n          origin=\"grafana/diff-flame-graph\"\n          prompt={`Analyze the differences between these two performance profiles.`}\n          context={context}\n        />\n      </div>\n    );\n  }\n\n  return <Spinner />;\n}\n","import { css } from '@emotion/css';\nimport { IconName } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React, { ReactNode } from 'react';\n\nimport { useFetchLlmPluginStatus } from './infrastructure/useFetchLlmPluginStatus';\n\ntype AIButtonProps = {\n  children: ReactNode;\n  onClick: (event: React.MouseEvent<HTMLButtonElement>) => void;\n  disabled?: boolean;\n  interactionName: 'g_pyroscope_app_explain_flamegraph_clicked' | 'g_pyroscope_app_optimize_code_clicked';\n};\n\nexport function AIButton({ children, onClick, disabled, interactionName }: AIButtonProps) {\n  const styles = useStyles2(getStyles);\n  const { isEnabled, error, isFetching } = useFetchLlmPluginStatus();\n\n  let icon: IconName = 'ai';\n  let tooltip = '';\n\n  if (isFetching) {\n    icon = 'fa fa-spinner';\n    tooltip = 'Checking the status of the Grafana LLM plugin...';\n  } else if (error) {\n    icon = 'exclamation-triangle';\n    tooltip = 'Error while checking the status of the Grafana LLM plugin!';\n  } else if (!isEnabled) {\n    icon = 'shield-exclamation';\n    tooltip = 'Grafana LLM plugin missing or not configured! Please check the plugins administration page.';\n  }\n\n  return (\n    <Button\n      className={styles.aiButton}\n      size=\"md\"\n      fill=\"text\"\n      icon={icon}\n      disabled={!isEnabled || disabled}\n      tooltip={tooltip}\n      tooltipPlacement=\"top\"\n      onClick={(event: React.MouseEvent<HTMLButtonElement>) => {\n        reportInteraction(interactionName);\n        onClick(event);\n      }}\n    >\n      {children}\n    </Button>\n  );\n}\n\nconst getStyles = () => ({\n  aiButton: css`\n    padding: 0 4px;\n  `,\n});\n","import { openai } from '@grafana/llm';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport { useQuery } from '@tanstack/react-query';\n\nexport function useFetchLlmPluginStatus() {\n  const { data, isFetching, error } = useQuery({\n    queryKey: ['llm'],\n    queryFn: () => openai.enabled(),\n  });\n\n  if (error) {\n    logger.error(error, { info: 'Error while checking the status of the Grafana LLM plugin!' });\n  }\n\n  return { isEnabled: Boolean(data), isFetching, error };\n}\n","import { css } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport Markdown from 'markdown-to-jsx';\nimport React, { ReactNode } from 'react';\n\nimport { OpenAiReply } from '../domain/useOpenAiChatCompletions';\n\n// yeah, I know...\nconst setNativeValue = (element: Element, value: string) => {\n  const valueSetter = Object!.getOwnPropertyDescriptor(element, 'value')!.set;\n  const prototypeValueSetter = Object!.getOwnPropertyDescriptor(Object.getPrototypeOf(element), 'value')!.set;\n\n  if (valueSetter && valueSetter !== prototypeValueSetter) {\n    prototypeValueSetter!.call(element, value);\n  } else {\n    valueSetter!.call(element, value);\n  }\n};\n\nconst onClickSearchTerm = (event: any) => {\n  const searchInputElement = document.querySelector('[placeholder^=\"Search\"]');\n\n  if (searchInputElement === null) {\n    logger.error(new Error('Cannot find search input element!'));\n    return;\n  }\n\n  const value = event.target.textContent.trim();\n\n  setNativeValue(searchInputElement, value);\n\n  searchInputElement.dispatchEvent(new Event('input', { bubbles: true }));\n};\n\nconst SearchTerm = ({ children }: { children: ReactNode }) => {\n  const styles = useStyles2(getStyles);\n\n  // If the code block contains newlines, don't make it a search link\n  if (typeof children === 'string' && children.includes('\\n')) {\n    return <code>{children}</code>;\n  }\n\n  return (\n    <code className={styles.searchLink} title=\"Search for this node\" onClick={onClickSearchTerm}>\n      {children}\n    </code>\n  );\n};\n\nconst MARKDOWN_OPTIONS = {\n  overrides: {\n    code: {\n      component: SearchTerm,\n    },\n  },\n};\n\ntype AiReplyProps = {\n  reply: OpenAiReply['reply'];\n};\n\nexport function AiReply({ reply }: AiReplyProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      {reply?.messages\n        ?.filter((message) => message.role !== 'system')\n        .map((message) => (\n          <>\n            <div className={styles.reply}>\n              <Markdown options={MARKDOWN_OPTIONS}>{message.content || ''}</Markdown>\n            </div>\n            <hr />\n          </>\n        ))}\n\n      <div className={styles.reply}>\n        <Markdown options={MARKDOWN_OPTIONS}>{reply.text}</Markdown>\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = () => ({\n  container: css`\n    width: 100%;\n    height: 100%;\n  `,\n  reply: css`\n    font-size: 13px;\n\n    & ol,\n    & ul {\n      margin: 0 0 16px 24px;\n    }\n  `,\n  searchLink: css`\n    color: rgb(255, 136, 51);\n    border: 1px solid transparent;\n    padding: 2px 4px;\n    cursor: pointer;\n    font-size: 13px;\n\n    &:hover,\n    &:focus,\n    &:active {\n      box-sizing: border-box;\n      border: 1px solid rgb(255, 136, 51, 0.8);\n      border-radius: 4px;\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { Button, TextArea, useStyles2 } from '@grafana/ui';\nimport React, { KeyboardEvent, useCallback, useState } from 'react';\n\nconst getStyles = () => ({\n  textarea: css`\n    margin-bottom: 8px;\n  `,\n  sendButton: css`\n    float: right;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n  `,\n});\n\ntype FollowUpFormProps = {\n  onSubmit: (question: string) => void;\n};\n\nfunction useFollowUpForm(onSubmit: FollowUpFormProps['onSubmit']) {\n  const [question, setQuestion] = useState('');\n\n  const onChangeInput = useCallback((event: any) => {\n    setQuestion(event.target.value);\n  }, []);\n\n  const onClickSend = useCallback(() => {\n    const questionToSend = question.trim();\n    if (!questionToSend) {\n      return;\n    }\n\n    onSubmit(questionToSend);\n\n    setQuestion('');\n  }, [question, onSubmit]);\n\n  return {\n    question,\n    onChangeInput,\n    onClickSend,\n  };\n}\n\nexport function FollowUpForm({ onSubmit }: FollowUpFormProps) {\n  const styles = useStyles2(getStyles);\n  const { question, onChangeInput, onClickSend } = useFollowUpForm(onSubmit);\n\n  const onKeyDown = (event: KeyboardEvent<HTMLTextAreaElement>) => {\n    if (event.code === 'Enter' && !event.shiftKey) {\n      onClickSend();\n    }\n  };\n\n  return (\n    <div>\n      <TextArea\n        className={styles.textarea}\n        placeholder=\"Ask a follow-up question...\"\n        value={question}\n        onChange={onChangeInput}\n        onKeyDown={onKeyDown}\n      />\n\n      <Button className={styles.sendButton} onClick={onClickSend}>\n        Send\n      </Button>\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Alert, Button, IconButton, Spinner, useStyles2 } from '@grafana/ui';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport { Panel } from '@shared/ui/Panel/Panel';\nimport React from 'react';\n\nimport { ProfilesDataSourceVariable } from '../../domain/variables/ProfilesDataSourceVariable';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { AiReply } from './components/AiReply';\nimport { FollowUpForm } from './components/FollowUpForm';\nimport { useOpenAiChatCompletions } from './domain/useOpenAiChatCompletions';\nimport { FetchParams, useFetchDotProfiles } from './infrastructure/useFetchDotProfiles';\n\ninterface SceneAiPanelState extends SceneObjectState {}\n\nexport class SceneAiPanel extends SceneObjectBase<SceneAiPanelState> {\n  constructor() {\n    super({ key: 'ai-panel' });\n  }\n\n  useSceneAiPanel = (isDiff: boolean, fetchParams: FetchParams): DomainHookReturnValue => {\n    const dataSourceUid = sceneGraph.findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable).useState()\n      .value as string;\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n\n    const { profileType, profiles, validationError, fetchError, isFetching } = useFetchDotProfiles(\n      isDiff,\n      fetchParams,\n      dataSourceUid,\n      profileMetricId\n    );\n\n    const { reply, error: llmError, retry } = useOpenAiChatCompletions(profileType, profiles);\n\n    return {\n      data: {\n        validationError,\n        isLoading: isFetching || (!isFetching && !fetchError && !llmError && !reply.text.trim()),\n        fetchError,\n        llmError,\n        reply,\n        shouldDisplayReply: Boolean(reply?.hasStarted || reply?.hasFinished),\n        shouldDisplayFollowUpForm: !fetchError && !llmError && Boolean(reply?.hasFinished),\n      },\n      actions: {\n        retry,\n        submitFollowupQuestion(question: string) {\n          reply.askFollowupQuestion(question);\n        },\n      },\n    };\n  };\n\n  static Component = ({\n    model,\n    isDiff,\n    fetchParams,\n    onClose,\n  }: SceneComponentProps<SceneAiPanel> & {\n    isDiff: boolean;\n    fetchParams: FetchParams;\n    onClose: () => void;\n  }) => {\n    const styles = useStyles2(getStyles);\n    const { data, actions } = model.useSceneAiPanel(isDiff, fetchParams);\n\n    return (\n      <Panel\n        className={styles.sidePanel}\n        title=\"Flame graph analysis\"\n        isLoading={data.isLoading}\n        headerActions={\n          <IconButton\n            title=\"Close panel\"\n            name=\"times-circle\"\n            variant=\"secondary\"\n            aria-label=\"close\"\n            onClick={onClose}\n          />\n        }\n        dataTestId=\"ai-panel\"\n      >\n        <div className={styles.content}>\n          {data.validationError && (\n            <InlineBanner severity=\"error\" title=\"Validation error!\" error={data.validationError} />\n          )}\n\n          {data.fetchError && (\n            <InlineBanner\n              severity=\"error\"\n              title=\"Error while loading profile data!\"\n              message=\"Sorry for any inconvenience, please try again later.\"\n              error={data.fetchError}\n            />\n          )}\n\n          {data.shouldDisplayReply && <AiReply reply={data.reply} />}\n\n          {data.isLoading && (\n            <>\n              <Spinner inline />\n              &nbsp;Analyzing...\n            </>\n          )}\n\n          {data.llmError && (\n            <Alert title=\"An error occured while generating content using OpenAI!\" severity=\"warning\">\n              <div>\n                <div>\n                  <p>{data.llmError.message}</p>\n                  <p>\n                    Sorry for any inconvenience, please retry or if the problem persists, contact your organization\n                    admin.\n                  </p>\n                </div>\n              </div>\n              <Button className={styles.retryButton} variant=\"secondary\" fill=\"outline\" onClick={() => actions.retry()}>\n                Retry\n              </Button>\n            </Alert>\n          )}\n\n          {data.shouldDisplayFollowUpForm && <FollowUpForm onSubmit={actions.submitFollowupQuestion} />}\n        </div>\n      </Panel>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  sidePanel: css`\n    flex: 1 0 50%;\n    margin-left: 8px;\n    max-width: calc(50% - 4px);\n  `,\n  title: css`\n    margin: -4px 0 4px 0;\n  `,\n  content: css`\n    padding: ${theme.spacing(1)};\n  `,\n  retryButton: css`\n    float: right;\n  `,\n});\n","import { openai } from '@grafana/llm';\nimport { useCallback, useEffect, useState } from 'react';\nimport { SubscriptionLike } from 'rxjs';\n\nimport { buildPrompts, model } from './buildLlmPrompts';\n\ntype Messages = openai.Message[];\n\nexport type OpenAiReply = {\n  reply: {\n    text: string;\n    hasStarted: boolean;\n    hasFinished: boolean;\n    messages: Messages;\n    askFollowupQuestion: (question: string) => void;\n  };\n  retry: () => void;\n  error: Error | null;\n};\n\nexport function useOpenAiChatCompletions(profileType: string, profiles: string[]): OpenAiReply {\n  const [reply, setReply] = useState('');\n  const [replyHasStarted, setReplyHasStarted] = useState(false);\n  const [replyHasFinished, setReplyHasFinished] = useState(false);\n  const [messages, setMessages] = useState<Messages>([]);\n  const [error, setError] = useState<Error | null>(null);\n  const [subscription, setSubscription] = useState<SubscriptionLike>();\n\n  const sendMessages = useCallback((messagesToSend: Messages) => {\n    setMessages(messagesToSend);\n\n    setError(null);\n\n    setReply('');\n    setReplyHasStarted(true);\n    setReplyHasFinished(false);\n\n    const stream = openai\n      .streamChatCompletions({\n        model,\n        messages: messagesToSend,\n      })\n      .pipe(\n        // Accumulate the stream content into a stream of strings, where each\n        // element contains the accumulated message so far.\n        openai.accumulateContent()\n      );\n\n    const subscription = stream.subscribe({\n      next: setReply,\n      error(e) {\n        setError(e);\n        setReplyHasStarted(false);\n        setReplyHasFinished(true);\n        setSubscription(undefined);\n      },\n      complete() {\n        setReplyHasStarted(false);\n        setReplyHasFinished(true);\n        setSubscription(undefined);\n      },\n    });\n\n    setSubscription(subscription);\n  }, []);\n\n  const askFollowupQuestion = useCallback(\n    (question: string): void => {\n      const messagesToAdd: Messages = [\n        {\n          role: 'assistant',\n          content: reply,\n        },\n        {\n          role: 'user',\n          content: question,\n        },\n      ];\n\n      try {\n        sendMessages([...messages, ...messagesToAdd]);\n      } catch (error) {\n        setError(error as Error);\n      }\n    },\n    [messages, reply, sendMessages]\n  );\n\n  useEffect(() => {\n    if (!profiles.length || messages.length > 0) {\n      return;\n    }\n\n    const prompts = buildPrompts({\n      system: 'empty',\n      user: profiles.length === 2 ? 'diff' : 'single',\n      profileType,\n      profiles,\n    });\n\n    try {\n      sendMessages([\n        {\n          role: 'system',\n          content: prompts.system,\n        },\n        {\n          role: 'system',\n          content: prompts.user,\n        },\n      ]);\n    } catch (error) {\n      setError(error as Error);\n    }\n  }, [messages.length, profileType, profiles, profiles.length, sendMessages]);\n\n  useEffect(() => {\n    return () => {\n      if (subscription) {\n        subscription.unsubscribe();\n        setSubscription(undefined);\n      }\n    };\n  }, [subscription]);\n\n  return {\n    reply: {\n      text: reply,\n      hasStarted: replyHasStarted,\n      hasFinished: replyHasFinished,\n      messages: messages,\n      askFollowupQuestion,\n    },\n    retry() {\n      if (messages.length > 0) {\n        try {\n          sendMessages(messages);\n        } catch (error) {\n          setError(error as Error);\n        }\n      }\n    },\n    error,\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventDiffAutoSelectPayload {\n  wholeRange: boolean;\n}\n\nexport class EventDiffAutoSelect extends BusEventWithPayload<EventDiffAutoSelectPayload> {\n  public static type = 'diff-auto-select';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventDiffChoosePresetPayload {}\n\nexport class EventDiffChoosePreset extends BusEventWithPayload<EventDiffChoosePresetPayload> {\n  public static type = 'diff-choose-preset';\n}\n","import { TimeRange } from '@grafana/data';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\n\nimport { DataSourceProxyClient } from '../../../../../infrastructure/series/http/DataSourceProxyClient';\n\ntype DiffProfileResponse = FlamebearerProfile;\n\ntype GetParams = {\n  leftQuery: string;\n  leftTimeRange: TimeRange;\n  rightQuery: string;\n  rightTimeRange: TimeRange;\n  maxNodes: number | null;\n};\n\nexport class DiffProfileApiClient extends DataSourceProxyClient {\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n  }\n\n  async get(params: GetParams): Promise<DiffProfileResponse> {\n    const searchParams = new URLSearchParams({\n      leftQuery: params.leftQuery,\n      leftFrom: String(params.leftTimeRange.from.unix() * 1000),\n      leftUntil: String(params.leftTimeRange.to.unix() * 1000),\n      rightQuery: params.rightQuery,\n      rightFrom: String(params.rightTimeRange.from.unix() * 1000),\n      rightUntil: String(params.rightTimeRange.to.unix() * 1000),\n    });\n\n    if (params.maxNodes) {\n      searchParams.set('max-nodes', String(params.maxNodes));\n    }\n\n    const response = await this.fetch(`/pyroscope/render-diff?${searchParams.toString()}`);\n\n    const json = await response.json();\n\n    return json;\n  }\n}\n","import { TimeRange } from '@grafana/data';\nimport { useMaxNodesFromUrl } from '@shared/domain/url-params/useMaxNodesFromUrl';\nimport { useQuery } from '@tanstack/react-query';\n\nimport { DataSourceProxyClientBuilder } from '../../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { DiffProfileApiClient } from './DiffProfileApiClient';\n\ntype FetchParams = {\n  enabled: boolean;\n  dataSourceUid: string;\n  baselineTimeRange: TimeRange;\n  baselineQuery: string;\n  comparisonTimeRange: TimeRange;\n  comparisonQuery: string;\n};\n\nexport function useFetchDiffProfile({\n  enabled,\n  dataSourceUid,\n  baselineTimeRange,\n  baselineQuery,\n  comparisonTimeRange,\n  comparisonQuery,\n}: FetchParams) {\n  const [maxNodes] = useMaxNodesFromUrl();\n\n  const diffProfileApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, DiffProfileApiClient);\n\n  const { isFetching, error, data, refetch } = useQuery({\n    // for UX: keep previous data while fetching -> profile does not re-render with empty panels when refreshing\n    placeholderData: (previousData) => previousData,\n    enabled: Boolean(enabled && maxNodes),\n    // eslint-disable-next-line @tanstack/query/exhaustive-deps\n    queryKey: [\n      'diff-profile',\n      dataSourceUid,\n      baselineQuery,\n      baselineTimeRange.from.unix(),\n      baselineTimeRange.to.unix(),\n      comparisonQuery,\n      comparisonTimeRange.from.unix(),\n      comparisonTimeRange.to.unix(),\n      maxNodes,\n    ],\n    queryFn: () => {\n      diffProfileApiClient.abort();\n\n      const params = {\n        leftQuery: baselineQuery,\n        leftTimeRange: baselineTimeRange,\n        rightQuery: comparisonQuery,\n        rightTimeRange: comparisonTimeRange,\n        maxNodes,\n      };\n\n      return diffProfileApiClient.get(params).then((json) => ({\n        profile: {\n          version: json.version,\n          flamebearer: json.flamebearer,\n          metadata: json.metadata,\n        },\n      }));\n    },\n  });\n\n  return {\n    isFetching,\n    error: diffProfileApiClient.isAbortError(error) ? null : error,\n    ...data,\n    refetch,\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Collapse, useStyles2 } from '@grafana/ui';\nimport DiffViewHowToImg from '@img/diff-view-how-to.gif';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport React, { useState } from 'react';\n\ntype MissingSelectionsBannerProps = {\n  onClickAutoSelect: () => void;\n  onClickChoosePreset: () => void;\n  onOpenLearnHow: () => void;\n};\n\nexport function MissingSelectionsBanner({\n  onClickAutoSelect,\n  onClickChoosePreset,\n  onOpenLearnHow,\n}: MissingSelectionsBannerProps) {\n  const styles = useStyles2(getStyles);\n\n  const [isCollapseOpen, setIsCollapseOpen] = useState(false);\n\n  const onToggleCollapse = () => {\n    if (!isCollapseOpen) {\n      onOpenLearnHow();\n    }\n    setIsCollapseOpen(!isCollapseOpen);\n  };\n\n  return (\n    <InlineBanner\n      severity=\"info\"\n      title=\"Select both the baseline and the comparison flame graph ranges to view the diff flame graph\"\n      message={\n        <div className={styles.infoMsg}>\n          <p>How?</p>\n          <p>\n            <Button variant=\"primary\" onClick={onClickAutoSelect}>\n              Auto-select\n            </Button>{' '}\n            or{' '}\n            <Button variant=\"primary\" fill=\"text\" className={styles.textButton} onClick={onClickChoosePreset}>\n              choose a preset\n            </Button>\n          </p>\n          <p>Alternatively:</p>\n          <Collapse\n            label=\"Click here to learn how to select the flame graph ranges with the mouse\"\n            collapsible\n            className={styles.collapse}\n            isOpen={isCollapseOpen}\n            onToggle={onToggleCollapse}\n          >\n            <div className={styles.collapseContent}>\n              <ol>\n                <li>Ensure that the &ldquo;Flame graph&rdquo; range selection mode is selected</li>\n                <li>\n                  Use your mouse to select the desired time ranges on both the baseline and the comparison time series\n                </li>\n              </ol>\n              <img src={DiffViewHowToImg} alt=\"How to view the diff flame graph\" />\n            </div>\n          </Collapse>\n        </div>\n      }\n    />\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  infoMsg: css`\n    padding: ${theme.spacing(2)} 0 0 0;\n  `,\n  textButton: css`\n    padding: 0;\n  `,\n  collapse: css`\n    background: transparent;\n    border: 0;\n  `,\n  collapseContent: css`\n    padding: 0 ${theme.spacing(5)};\n\n    & img {\n      max-width: 100%;\n      width: auto;\n      margin-top: ${theme.spacing(2)};\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport { FlameGraph } from '@shared/components/FlameGraph/FlameGraph';\nimport { displayWarning } from '@shared/domain/displayStatus';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { useToggleSidePanel } from '@shared/domain/useToggleSidePanel';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport { Panel } from '@shared/ui/Panel/Panel';\nimport { PyroscopeLogo } from '@shared/ui/PyroscopeLogo';\nimport React, { useEffect, useMemo } from 'react';\n\nimport { useBuildPyroscopeQuery } from '../../../../domain/useBuildPyroscopeQuery';\nimport { useGrafanaAssistant } from '../../../../domain/useGrafanaAssistant';\nimport { ProfilesDataSourceVariable } from '../../../../domain/variables/ProfilesDataSourceVariable';\nimport { getSceneVariableValue } from '../../../../helpers/getSceneVariableValue';\nimport { AnalyzeDiffFlameGraph } from '../../../AnalyzeDiffFlameGraph';\nimport { AIButton } from '../../../SceneAiPanel/components/AiButton/AIButton';\nimport { SceneAiPanel } from '../../../SceneAiPanel/SceneAiPanel';\nimport { EventDiffAutoSelect } from '../../domain/events/EventDiffAutoSelect';\nimport { EventDiffChoosePreset } from '../../domain/events/EventDiffChoosePreset';\nimport { SceneExploreDiffFlameGraph } from '../../SceneExploreDiffFlameGraph';\nimport { useFetchDiffProfile } from './infrastructure/useFetchDiffProfile';\nimport { MissingSelectionsBanner } from './ui/MissingSelectionsBanner';\n\ninterface SceneDiffFlameGraphState extends SceneObjectState {\n  aiPanel: SceneAiPanel;\n}\n\nexport class SceneDiffFlameGraph extends SceneObjectBase<SceneDiffFlameGraphState> {\n  constructor() {\n    super({\n      key: 'diff-flame-graph',\n      aiPanel: new SceneAiPanel(),\n    });\n  }\n\n  buildTitle() {\n    const serviceName = getSceneVariableValue(this, 'serviceName');\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const profileMetricType = getProfileMetric(profileMetricId as ProfileMetricId).type;\n\n    return (\n      <>\n        <PyroscopeLogo size=\"small\" />\n        Diff flame graph for {serviceName} ({profileMetricType})\n      </>\n    );\n  }\n\n  useSceneDiffFlameGraph = (): DomainHookReturnValue => {\n    const { aiPanel } = this.useState();\n    const { baselineTimeRange, comparisonTimeRange } = (this.parent as SceneExploreDiffFlameGraph).useDiffTimeRanges();\n\n    const baselineQuery = useBuildPyroscopeQuery(this, 'filtersBaseline');\n    const comparisonQuery = useBuildPyroscopeQuery(this, 'filtersComparison');\n\n    const { settings, error: fetchSettingsError } = useFetchPluginSettings();\n\n    const dataSourceUid = sceneGraph.findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable).useState()\n      .value as string;\n\n    const isDiffQueryEnabled = Boolean(\n      baselineQuery &&\n        comparisonQuery &&\n        // warning: sending zero parameters values to the API would make the pods crash\n        // so we enable only when we have non-zero parameters values\n        baselineTimeRange.from.unix() &&\n        baselineTimeRange.to.unix() &&\n        comparisonTimeRange.from.unix() &&\n        comparisonTimeRange.to.unix()\n    );\n\n    const {\n      isFetching,\n      error: fetchProfileError,\n      profile,\n    } = useFetchDiffProfile({\n      enabled: isDiffQueryEnabled,\n      dataSourceUid,\n      baselineTimeRange,\n      baselineQuery,\n      comparisonTimeRange,\n      comparisonQuery,\n    });\n\n    const noProfileDataAvailable =\n      isDiffQueryEnabled && !isFetching && !fetchProfileError && profile?.flamebearer.numTicks === 0;\n\n    const shouldDisplayFlamegraph = Boolean(\n      isDiffQueryEnabled && !fetchProfileError && !noProfileDataAvailable && profile\n    );\n    const hasMissingSelections = !isDiffQueryEnabled;\n\n    return {\n      data: {\n        title: this.buildTitle(),\n        isLoading: isFetching,\n        fetchProfileError,\n        noProfileDataAvailable,\n        shouldDisplayFlamegraph,\n        hasMissingSelections,\n        profile: profile as FlamebearerProfile,\n        settings,\n        fetchSettingsError,\n        ai: {\n          panel: aiPanel,\n          fetchParams: [\n            { query: baselineQuery, timeRange: baselineTimeRange },\n            { query: comparisonQuery, timeRange: comparisonTimeRange },\n          ],\n        },\n      },\n      actions: {},\n    };\n  };\n\n  onClickAutoSelect = () => {\n    reportInteraction('g_pyroscope_app_diff_auto_select_clicked');\n\n    this.publishEvent(new EventDiffAutoSelect({ wholeRange: false }), true);\n  };\n\n  onClickChoosePreset = () => {\n    reportInteraction('g_pyroscope_app_diff_choose_preset_clicked');\n\n    this.publishEvent(new EventDiffChoosePreset({}), true);\n  };\n\n  onOpenLearnHow = () => {\n    reportInteraction('g_pyroscope_app_diff_learn_how_clicked');\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneDiffFlameGraph>) => {\n    const styles = useStyles2(getStyles);\n\n    const { data } = model.useSceneDiffFlameGraph();\n    const sidePanel = useToggleSidePanel();\n\n    const { hideAIButton } = useGrafanaAssistant();\n\n    const isAiButtonDisabled = data.isLoading || data.hasMissingSelections || data.noProfileDataAvailable;\n\n    useEffect(() => {\n      if (isAiButtonDisabled) {\n        sidePanel.close();\n      }\n    }, [isAiButtonDisabled, sidePanel]);\n\n    if (data.fetchSettingsError) {\n      displayWarning([\n        'Error while retrieving the plugin settings!',\n        'Some features might not work as expected (e.g. flamegraph export options). Please try to reload the page, sorry for the inconvenience.',\n      ]);\n    }\n\n    const panelTitle = useMemo(\n      () => (\n        <>\n          {data.title}\n          {data.isLoading && <Spinner inline className={styles.spinner} />}\n        </>\n      ),\n      [data.isLoading, data.title, styles.spinner]\n    );\n\n    const dataSourceUid = sceneGraph.findByKeyAndType(model, 'dataSource', ProfilesDataSourceVariable).useState()\n      .value as string;\n    const profileMetricId = getSceneVariableValue(model, 'profileMetricId');\n\n    const aiActionButton = hideAIButton ? (\n      <AnalyzeDiffFlameGraph\n        dataSourceUid={dataSourceUid}\n        profileMetricId={profileMetricId}\n        isDiff\n        fetchParams={data.ai.fetchParams}\n      />\n    ) : (\n      <AIButton\n        disabled={isAiButtonDisabled || sidePanel.isOpen('ai')}\n        onClick={() => sidePanel.open('ai')}\n        interactionName=\"g_pyroscope_app_explain_flamegraph_clicked\"\n      >\n        Explain Diff Flame Graph\n      </AIButton>\n    );\n\n    return (\n      <div className={styles.flex}>\n        <Panel\n          dataTestId=\"diff-flame-graph-panel\"\n          className={styles.flamegraphPanel}\n          title={panelTitle}\n          isLoading={data.isLoading}\n          headerActions={aiActionButton}\n        >\n          {data.hasMissingSelections && (\n            <MissingSelectionsBanner\n              onClickAutoSelect={model.onClickAutoSelect}\n              onClickChoosePreset={model.onClickChoosePreset}\n              onOpenLearnHow={model.onOpenLearnHow}\n            />\n          )}\n\n          {data.fetchProfileError && (\n            <InlineBanner severity=\"error\" title=\"Error while loading profile data!\" error={data.fetchProfileError} />\n          )}\n\n          {data.noProfileDataAvailable && (\n            <InlineBanner\n              severity=\"warning\"\n              title=\"No profile data available\"\n              message=\"Please verify that you've selected adequate filters and time ranges.\"\n            />\n          )}\n\n          {data.shouldDisplayFlamegraph && (\n            <FlameGraph\n              diff={true}\n              profile={data.profile}\n              enableFlameGraphDotComExport={data.settings?.enableFlameGraphDotComExport}\n              collapsedFlamegraphs={data.settings?.collapsedFlamegraphs}\n              /** Grafana assistant does not support diff flame graphs yet, we will use LLM plugin if enabled */\n              showAnalyzeWithAssistant={false}\n            />\n          )}\n        </Panel>\n\n        {sidePanel.isOpen('ai') && (\n          <data.ai.panel.Component\n            model={data.ai.panel}\n            isDiff\n            fetchParams={data.ai.fetchParams}\n            onClose={sidePanel.close}\n          />\n        )}\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flex: css`\n    display: flex;\n  `,\n  flamegraphPanel: css`\n    min-width: 0;\n    flex-grow: 1;\n  `,\n  sidePanel: css`\n    flex: 1 0 50%;\n    margin-left: 8px;\n    max-width: calc(50% - 4px);\n  `,\n  spinner: css`\n    margin-left: ${theme.spacing(1)};\n  `,\n  aiButton: css`\n    margin-top: ${theme.spacing(1)};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nexport const FEEDBACK_FORM_URL = 'https://grafana.qualtrics.com/jfe/form/SV_6Gav4IUU6jcYfd4';\n\n// borrowed from https://github.com/grafana/explore-logs/blob/main/src/Components/IndexScene/GiveFeedbackButton.tsx\nexport const GiveFeedbackButton = () => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.wrapper}>\n      <a\n        href={FEEDBACK_FORM_URL}\n        className={styles.feedback}\n        title=\"Share your thoughts about Profiles in Grafana.\"\n        target=\"_blank\"\n        rel=\"noreferrer noopener\"\n      >\n        <Icon name=\"comment-alt-message\" /> Give feedback\n      </a>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      justifyContent: 'flex-end',\n      paddingTop: '4px',\n    }),\n    feedback: css({\n      alignSelf: 'center',\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport {\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VariableDependencyConfig,\n} from '@grafana/scenes';\nimport { Button, Modal, Select, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nimport { FEEDBACK_FORM_URL } from '../../../GiveFeedbackButton';\nimport { EventDiffAutoSelect } from '../../domain/events/EventDiffAutoSelect';\nimport { CompareTarget } from '../../domain/types';\nimport { SceneComparePanel } from '../SceneComparePanel/SceneComparePanel';\n\ninterface ScenePresetsPickerState extends SceneObjectState {\n  name: string;\n  label: string;\n  isModalOpen: boolean;\n  isSelectOpen: boolean;\n  value: string | null;\n}\n\nexport type Preset = {\n  from: string;\n  to: string;\n  diffFrom: string;\n  diffTo: string;\n  label: string;\n};\n\nexport class ScenePresetsPicker extends SceneObjectBase<ScenePresetsPickerState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: ['dataSource', 'serviceName'],\n    onReferencedVariableValueChanged: () => {\n      this.reset();\n    },\n  });\n\n  static PRESETS = [\n    {\n      label: 'Built-in presets',\n      value: 'built-in',\n      options: [\n        {\n          value: 'last hour (30m-window)',\n          label: 'Last hour (30m-window)',\n          baseline: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-1h',\n            diffTo: 'now-30m',\n            label: 'last hour',\n          },\n          comparison: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-30m',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n        },\n        {\n          value: 'last hour (1h-window)',\n          label: 'Last hour (1h-window)',\n          baseline: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-1h',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n          comparison: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-1h',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n        },\n        {\n          value: '6h ago vs now',\n          label: '6h ago vs now (30m-window)',\n          baseline: {\n            from: 'now-375m',\n            to: 'now-315m',\n            diffFrom: 'now-375m',\n            diffTo: 'now-345m',\n            label: '6h ago',\n          },\n          comparison: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-30m',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n        },\n        {\n          value: '24h ago vs now',\n          label: '24h ago vs now (30m-window)',\n          baseline: {\n            from: 'now-1455m',\n            to: 'now-1395m',\n            diffFrom: 'now-1455m',\n            diffTo: 'now-1425m',\n            label: '24h ago',\n          },\n          comparison: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-30m',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n        },\n        {\n          value: 'auto-select-25',\n          label: 'Auto-select (25% range)',\n        },\n        {\n          value: 'auto-select-whole',\n          label: 'Auto-select (whole range)',\n        },\n      ],\n    },\n    {\n      label: 'My presets',\n      value: 'custom',\n      options: [\n        {\n          label: 'Dummy preset saved earlier',\n          value: 'dummy',\n        },\n      ],\n    },\n  ];\n\n  constructor() {\n    super({\n      name: 'compare-presets',\n      label: 'Comparison presets',\n      value: null,\n      isModalOpen: false,\n      isSelectOpen: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    [CompareTarget.BASELINE, CompareTarget.COMPARISON].forEach((compareTarget) => {\n      this._subs.add(\n        sceneGraph\n          .findByKeyAndType(this, `${compareTarget}-panel`, SceneComparePanel)\n          .state.$timeRange.subscribeToState((newState, prevState) => {\n            if (newState.from !== prevState.from || newState.to !== prevState.to) {\n              this.setState({ value: null });\n            }\n          })\n      );\n    });\n  }\n\n  onChangePreset = (option: SelectableValue<string>) => {\n    reportInteraction('g_pyroscope_app_diff_preset_selected', { value: option.value as string });\n\n    this.closeSelect();\n\n    if (option.value === 'dummy') {\n      this.setState({ value: null, isModalOpen: true });\n      return;\n    }\n\n    if (option.value?.startsWith('auto-select-')) {\n      this.setState({ value: null });\n\n      this.publishEvent(new EventDiffAutoSelect({ wholeRange: option.value === 'auto-select-whole' }), true);\n      return;\n    }\n\n    [CompareTarget.BASELINE, CompareTarget.COMPARISON].forEach((compareTarget) => {\n      const panel = sceneGraph.findByKeyAndType(this, `${compareTarget}-panel`, SceneComparePanel);\n\n      panel.toggleTimeRangeSync(false);\n      panel.applyPreset(option[compareTarget]);\n    });\n\n    this.setState({ value: option.value });\n  };\n\n  onClickSave = () => {\n    reportInteraction('g_pyroscope_app_diff_preset_save_clicked');\n\n    this.setState({ isModalOpen: true });\n  };\n\n  closeModal = () => {\n    this.setState({ isModalOpen: false });\n  };\n\n  openSelect() {\n    this.setState({ isSelectOpen: true });\n  }\n\n  closeSelect() {\n    this.setState({ isSelectOpen: false });\n  }\n\n  onOpenSelect = () => {\n    setTimeout(() => this.openSelect(), 0);\n  };\n\n  onCloseSelect = () => {\n    this.closeSelect();\n  };\n\n  reset() {\n    this.setState({ value: null, isSelectOpen: false, isModalOpen: false });\n  }\n\n  static Component({ model }: SceneComponentProps<ScenePresetsPicker & { onChange: any }>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { value, isSelectOpen, isModalOpen } = model.useState();\n\n    return (\n      <>\n        <div className={styles.presetsContainer}>\n          <Select\n            className={styles.select}\n            placeholder=\"Choose a preset\"\n            value={value}\n            options={ScenePresetsPicker.PRESETS}\n            onChange={model.onChangePreset}\n            isOpen={isSelectOpen}\n            onOpenMenu={model.onOpenSelect}\n            onCloseMenu={model.onCloseSelect}\n          />\n\n          <Button\n            icon=\"save\"\n            variant=\"secondary\"\n            tooltip=\"Save the current time ranges and filters as a custom preset\"\n            onClick={model.onClickSave}\n          />\n        </div>\n        <Modal\n          title=\"Custom user presets\"\n          isOpen={isModalOpen}\n          closeOnEscape={true}\n          closeOnBackdropClick={true}\n          onDismiss={model.closeModal}\n        >\n          <p>\n            This feature, which would allow you to save the current time ranges and filters, is currently not\n            implemented.\n          </p>\n          <p>\n            Please let us know if you would be interested to use it by{' '}\n            <a href={FEEDBACK_FORM_URL} target=\"_blank\" rel=\"noreferrer noopener\" className={styles.link}>\n              leaving us your feedback.\n            </a>\n          </p>\n          <p>Thank you!</p>\n          <Modal.ButtonRow>\n            <Button variant=\"secondary\" fill=\"outline\" onClick={model.closeModal}>\n              Cancel\n            </Button>\n            <Button onClick={model.closeModal} disabled>\n              Save\n            </Button>\n          </Modal.ButtonRow>\n        </Modal>\n      </>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  presetsContainer: css`\n    display: flex;\n  `,\n  select: css`\n    min-width: ${theme.spacing(24)};\n    text-align: left;\n  `,\n  link: css`\n    color: ${theme.colors.text.link};\n  `,\n});\n","import { sceneGraph, SceneObject, SceneObjectState, VizPanel } from '@grafana/scenes';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport { cloneDeep, merge } from 'lodash';\n\nimport { EventTimeseriesDataReceived } from '../../../../domain/events/EventTimeseriesDataReceived';\n\nexport function syncYAxis() {\n  return (vizPanel: SceneObject<SceneObjectState>) => {\n    const maxima = new Map<string, number>();\n\n    const eventSub = vizPanel.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      const s = event.payload.series?.[0];\n      const refId = s?.refId;\n\n      if (!refId) {\n        logger.warn('Missing refId! Cannot sync y-axis on the timeseries.', event.payload.series);\n        return;\n      }\n\n      maxima.set(s.refId as string, Math.max(...s.fields[1].values));\n\n      updateTimeseriesAxis(vizPanel, Math.max(...maxima.values()));\n    });\n\n    return () => {\n      eventSub.unsubscribe();\n    };\n  };\n}\n\nfunction updateTimeseriesAxis(vizPanel: SceneObject, max: number) {\n  // findAllObjects searches down the full scene graph\n  const timeseries = sceneGraph.findAllObjects(\n    vizPanel,\n    (o) => o instanceof VizPanel && o.state.pluginId === 'timeseries'\n  ) as VizPanel[];\n\n  for (const t of timeseries) {\n    t.clearFieldConfigCache(); // required\n\n    t.setState({\n      fieldConfig: merge(cloneDeep(t.state.fieldConfig), { defaults: { max } }),\n    });\n  }\n}\n","import { css } from '@emotion/css';\nimport { AdHocVariableFilter, DashboardCursorSync, GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { locationService } from '@grafana/runtime';\nimport {\n  behaviors,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneTimeRangeState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { EventEnableSyncTimeRanges } from './components/SceneComparePanel/domain/events/EventEnableSyncTimeRanges';\nimport { EventSyncRefresh } from './components/SceneComparePanel/domain/events/EventSyncRefresh';\nimport { EventSyncTimeRanges } from './components/SceneComparePanel/domain/events/EventSyncTimeRanges';\nimport { SceneComparePanel } from './components/SceneComparePanel/SceneComparePanel';\nimport { SceneDiffFlameGraph } from './components/SceneDiffFlameGraph/SceneDiffFlameGraph';\nimport { ScenePresetsPicker } from './components/ScenePresetsPicker/ScenePresetsPicker';\nimport { syncYAxis } from './domain/behaviours/syncYAxis';\nimport { EventDiffAutoSelect } from './domain/events/EventDiffAutoSelect';\nimport { EventDiffChoosePreset } from './domain/events/EventDiffChoosePreset';\nimport { CompareTarget } from './domain/types';\n\ninterface SceneExploreDiffFlameGraphState extends SceneObjectState {\n  baselinePanel: SceneComparePanel;\n  comparisonPanel: SceneComparePanel;\n  body: SceneDiffFlameGraph;\n  presetsPicker: ScenePresetsPicker;\n}\n\nexport class SceneExploreDiffFlameGraph extends SceneObjectBase<SceneExploreDiffFlameGraphState> {\n  constructor({\n    useAncestorTimeRange,\n    clearDiffRange,\n    baselineFilters,\n    comparisonFilters,\n  }: {\n    useAncestorTimeRange?: boolean;\n    clearDiffRange?: boolean;\n    baselineFilters?: AdHocVariableFilter[];\n    comparisonFilters?: AdHocVariableFilter[];\n  }) {\n    super({\n      key: 'explore-diff-flame-graph',\n      baselinePanel: new SceneComparePanel({\n        target: CompareTarget.BASELINE,\n        useAncestorTimeRange: Boolean(useAncestorTimeRange),\n        clearDiffRange: Boolean(clearDiffRange),\n        filters: baselineFilters || [],\n      }),\n      comparisonPanel: new SceneComparePanel({\n        target: CompareTarget.COMPARISON,\n        useAncestorTimeRange: Boolean(useAncestorTimeRange),\n        clearDiffRange: Boolean(clearDiffRange),\n        filters: comparisonFilters || [],\n      }),\n      $behaviors: [\n        new behaviors.CursorSync({\n          key: 'metricCrosshairSync',\n          sync: DashboardCursorSync.Crosshair,\n        }),\n        syncYAxis(),\n      ],\n      body: new SceneDiffFlameGraph(),\n      presetsPicker: new ScenePresetsPicker(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    // hack to force UrlSyncManager to handle a new location\n    // this will sync the state from the URL by calling updateFromUrl() on all the time ranges (`SceneTimeRange` and our custom `SceneTimeRangeWithAnnotations`) that are defined on `SceneComparePanel`\n    // if not, landing on this view will result in empty URL search parameters (to/from and diffTo/diffFrom) which will make shareable links useless\n    locationService.partial({}, true); // replace to avoid creating history items\n\n    const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n\n    profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_SERVICE_NAME_DEPENDENT });\n    profileMetricVariable.update(true);\n\n    this.subscribeToEvents();\n\n    return () => {\n      profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_DEFAULT });\n      profileMetricVariable.update(true);\n    };\n  }\n\n  subscribeToEvents() {\n    this._subs.add(\n      this.subscribeToEvent(EventDiffAutoSelect, (event) => {\n        const selectWholeRange = event.payload.wholeRange;\n        const { baselinePanel, comparisonPanel } = this.state;\n\n        baselinePanel.toggleTimeRangeSync(false);\n        comparisonPanel.toggleTimeRangeSync(false);\n\n        baselinePanel.autoSelectDiffRange(selectWholeRange);\n        comparisonPanel.autoSelectDiffRange(selectWholeRange);\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventDiffChoosePreset, () => {\n        this.state.presetsPicker.openSelect();\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventEnableSyncTimeRanges, (event) => {\n        const { source, enable, timeRange, annotationTimeRange } = event.payload;\n        const { baselinePanel, comparisonPanel } = this.state;\n        const targetPanel = source === CompareTarget.BASELINE ? comparisonPanel : baselinePanel;\n\n        if (enable) {\n          this.syncTimeRanges(targetPanel, timeRange, annotationTimeRange);\n        }\n\n        comparisonPanel.toggleTimeRangeSync(enable);\n        baselinePanel.toggleTimeRangeSync(enable);\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventSyncTimeRanges, (event) => {\n        const { source, timeRange, annotationTimeRange } = event.payload;\n        const { baselinePanel, comparisonPanel } = this.state;\n        const targetPanel = source === CompareTarget.BASELINE ? comparisonPanel : baselinePanel;\n\n        this.syncTimeRanges(targetPanel, timeRange, annotationTimeRange);\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventSyncRefresh, (event) => {\n        const { source } = event.payload;\n        const { baselinePanel, comparisonPanel } = this.state;\n        const targetPanel = source === CompareTarget.BASELINE ? comparisonPanel : baselinePanel;\n\n        targetPanel.refreshTimeseries();\n      })\n    );\n  }\n\n  syncTimeRanges(targetPanel: SceneComparePanel, timeRange?: SceneTimeRangeState, annotationTimeRange?: TimeRange) {\n    if (timeRange) {\n      targetPanel.setTimeRange(timeRange);\n    }\n\n    if (annotationTimeRange) {\n      targetPanel.setDiffRange({\n        from: annotationTimeRange.from.toISOString(),\n        to: annotationTimeRange.to.toISOString(),\n      });\n    }\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [\n        sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable),\n        sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable),\n        this.state.presetsPicker,\n      ],\n      gridControls: [],\n    };\n  }\n\n  useDiffTimeRanges = () => {\n    const { baselinePanel, comparisonPanel } = this.state;\n\n    const { annotationTimeRange: baselineTimeRange } = baselinePanel.useDiffTimeRange();\n    const { annotationTimeRange: comparisonTimeRange } = comparisonPanel.useDiffTimeRange();\n\n    return {\n      baselineTimeRange,\n      comparisonTimeRange,\n    };\n  };\n\n  static Component({ model }: SceneComponentProps<SceneExploreDiffFlameGraph>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n\n    const { baselinePanel, comparisonPanel, body } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.columns}>\n          <baselinePanel.Component model={baselinePanel} />\n          <comparisonPanel.Component model={comparisonPanel} />\n        </div>\n\n        <body.Component model={body} />\n      </div>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n  `,\n  columns: css`\n    display: flex;\n    flex-direction: row;\n    gap: ${theme.spacing(1)};\n    margin-bottom: ${theme.spacing(1)};\n\n    & > div {\n      flex: 1 1 0;\n    }\n  `,\n});\n","import { GithubAppResponse } from '@shared/pyroscope-api/vcs/v1/vcs_pb';\n\nimport { DataSourceProxyClient } from '../../../../../infrastructure/series/http/DataSourceProxyClient';\n\ntype GithubLoginResponse = {\n  cookie: string;\n};\n\nexport class VcsClient extends DataSourceProxyClient {\n  async githubLogin(authorizationCode: string): Promise<GithubLoginResponse> {\n    const response = await this.fetch('/vcs.v1.VCSService/GithubLogin', {\n      method: 'POST',\n      body: JSON.stringify({\n        authorizationCode,\n      }),\n    });\n\n    const json = await response.json();\n\n    return json;\n  }\n\n  async githubApp(): Promise<GithubAppResponse> {\n    const response = await this.fetch('/vcs.v1.VCSService/GithubApp', {\n      method: 'POST',\n      body: JSON.stringify({}),\n    });\n\n    const json = await response.json();\n\n    return json;\n  }\n}\n","import { logger } from '@shared/infrastructure/tracking/logger';\n\n/** The maximum Unix ms timestamp that can be stored in a JS Date object. */\nconst MAX_UNIX_TS_MS = 8640000000000000;\n\n/**\n * This is a value class representing a GitSession cookie value in the browser.\n * It provides APIs to decode a GitSession cookie value and to check if the the\n * underlying user token is expired.\n */\nexport class GitSessionCookie {\n  private readonly oauthTokenMetadata: string;\n  private readonly expiry: Date;\n\n  constructor(metadata: string, expiry: number) {\n    this.oauthTokenMetadata = metadata;\n    this.expiry = new Date(expiry);\n  }\n\n  /**\n   * Checks if the session cookie is expired. If the optional `biasMs` is\n   * provided, then the expiry is biased to expire sooner by `biasMs`\n   * milliseconds.\n   *\n   * @param biasMs Offset in milliseconds\n   * @returns True if the session cookie is expired.\n   */\n  isUserTokenExpired(biasMs = 0): boolean {\n    return Date.now() >= this.expiry.getTime() - biasMs;\n  }\n\n  /**\n   * Decodes the base64 encoded value portion of a session cookie.\n   *\n   * @param value The value portion of a session cookie\n   * @returns A valid `GitSessionCookie` if the string can be decoded, otherwise\n   * undefined.\n   */\n  static decode(value: string | undefined): GitSessionCookie | undefined {\n    if (value === undefined || value === '') {\n      return undefined;\n    }\n\n    let decoded;\n    try {\n      decoded = atob(value);\n    } catch (error) {\n      logger.error(error as Error, { info: 'Failed to base64 decode GitSession value' });\n      return undefined;\n    }\n\n    const { payload, isLegacy } = GitSessionCookie.tryDecode(decoded);\n    if (isLegacy) {\n      // This is a legacy cookie value, which does not expose a plaintext\n      // expiry. The expiry is set to a maximum date value and we rely on a 401\n      // response from the server to indicate expiration.\n      return new GitSessionCookie(value, MAX_UNIX_TS_MS);\n    }\n\n    return new GitSessionCookie(payload.metadata, Number(payload.expiry));\n  }\n\n  /**\n   * Attempts to decode the plaintext value portion of a session cookie.\n   *\n   * @param input Plaintext representation of a session cookie value\n   * @returns The payload of the session cookie if it's not a legacy cookie. If\n   * it is a legacy cookie, isLegacy is set to true.\n   */\n  private static tryDecode(input: string): { payload: any; isLegacy: boolean } {\n    try {\n      const payload = JSON.parse(input);\n      return { payload, isLegacy: false };\n    } catch {\n      return { payload: undefined, isLegacy: true };\n    }\n  }\n}\n","import { GitSessionCookie } from './GitSessionCookie';\n\nconst LEGACY_GITHUB_SESSION_COOKIE_NAME = 'GitSession';\nconst GITHUB_SESSION_COOKIE_NAME = 'pyroscope_git_session';\n\nexport interface GitSessionCookieManager {\n  getCookie(): GitSessionCookie | undefined;\n  setCookie(cookie: string): void;\n  deleteCookie(): void;\n}\n\ntype Cookie = {\n  key: string;\n  value: string;\n};\n\nclass InternalGitSessionCookieManager implements GitSessionCookieManager {\n  private rawCookie: Cookie | undefined;\n  private sessionCookie: GitSessionCookie | undefined;\n\n  getCookie(): GitSessionCookie | undefined {\n    // To make sure we're using a cookie that accurately reflects the browser\n    // state, let's be paranoid and make sure our cached cookie is accurate.\n    this.syncCookieWithBrowser();\n    return this.sessionCookie;\n  }\n\n  setCookie(cookie: string): void {\n    if (!cookie.startsWith(`${GITHUB_SESSION_COOKIE_NAME}=`)) {\n      cookie = `${GITHUB_SESSION_COOKIE_NAME}=${cookie}`;\n    }\n\n    const rawCookie = InternalGitSessionCookieManager.getCookieFromJar(cookie, GITHUB_SESSION_COOKIE_NAME);\n    if (rawCookie === undefined) {\n      // If we can't parse the key-value pair out of [cookie], let's return now\n      // to avoid corrupting the state of the manager or browser cookie.\n      return;\n    }\n\n    this.deleteLegacyCookie();\n    this.rawCookie = rawCookie;\n    this.sessionCookie = GitSessionCookie.decode(rawCookie.value);\n    document.cookie = `${cookie}; path=/`;\n  }\n\n  deleteCookie(): void {\n    document.cookie = `${GITHUB_SESSION_COOKIE_NAME}=; Path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;`;\n    this.deleteLegacyCookie();\n    this.rawCookie = undefined;\n    this.sessionCookie = undefined;\n  }\n\n  private deleteLegacyCookie(): void {\n    document.cookie = `${LEGACY_GITHUB_SESSION_COOKIE_NAME}=; Path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;`;\n  }\n\n  private syncCookieWithBrowser(): void {\n    const cookie = InternalGitSessionCookieManager.getCookieFromJar(document.cookie, GITHUB_SESSION_COOKIE_NAME);\n    if (cookie?.key === this.rawCookie?.key && cookie?.value === this.rawCookie?.value) {\n      return;\n    }\n\n    if (cookie === undefined) {\n      this.deleteCookie();\n    } else {\n      this.rawCookie = cookie;\n      this.sessionCookie = GitSessionCookie.decode(cookie.value);\n    }\n  }\n\n  private static getCookieFromJar(jar: string, name: string): Cookie | undefined {\n    return jar\n      .split(';')\n      .map((ck) => {\n        // Just doing split('=') results in the trailing padding to be dropped.\n        // While `btoa` seems to handle this case without problem, being\n        // pedantic with padding isn't a bad thing. Doing this song and dance\n        // allows us to keep the trailing padding.\n        const [key, ...rest] = ck.trim().split('=');\n        const value = rest.join('=');\n        return { key: key.trim(), value: value?.trim() };\n      })\n      .find(({ key }) => key === name);\n  }\n}\n\nexport const gitSessionCookieManager: GitSessionCookieManager = new InternalGitSessionCookieManager();\n","import { config } from '@grafana/runtime';\n\nimport { PLUGIN_BASE_URL, ROUTES } from '../../../../../../../../../constants';\n\nfunction stripTrailingSlash(str: string): string {\n  return str.endsWith('/') ? str.slice(0, -1) : str;\n}\n\nfunction buildGitHubAuthURL(clientID: string, nonce: string, callbackUrl: string): string {\n  const appSubUrl = stripTrailingSlash(config.appSubUrl || '/');\n  const redirectUri = `${window.location.origin}${appSubUrl}${PLUGIN_BASE_URL}${ROUTES.GITHUB_CALLBACK}`;\n\n  const url = new URL('/login/oauth/authorize', 'https://github.com');\n  url.searchParams.set('client_id', clientID);\n  if (callbackUrl) {\n    url.searchParams.set('redirect_uri', callbackUrl);\n  }\n  url.searchParams.set('scope', 'repo');\n  url.searchParams.set(\n    'state',\n    btoa(\n      JSON.stringify({\n        redirect_uri: redirectUri,\n        nonce,\n      })\n    )\n  );\n\n  return url.toString();\n}\n\nconst POPUP_WIDTH = 800;\nconst POPUP_HEIGHT = 950;\n\nexport function openLoginPopup(clientId: string, nonce: string, callbackUrl: string): Window | null {\n  const oauthURL = buildGitHubAuthURL(clientId, nonce, callbackUrl);\n\n  const { top } = window;\n  const x = (top?.outerWidth ?? 0) / 2 + (top?.screenX ?? 0) - POPUP_WIDTH / 2;\n  const y = (top?.outerHeight ?? 0) / 2 + (top?.screenY ?? 0) - POPUP_HEIGHT / 2;\n\n  return window.open(\n    oauthURL,\n    'GitHub Login',\n    `toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=${POPUP_WIDTH}, height=${POPUP_HEIGHT}, top=${y}, left=${x}`\n  );\n}\n","import { displayError } from '@shared/domain/displayStatus';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport React from 'react';\n\nimport { VcsClient } from '../../../infrastructure/VcsClient';\nimport { PrivateVcsClient } from '../../GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { nonce } from '../GitHubContextProvider';\nimport { GitSessionCookie } from '../infrastructure/GitSessionCookie';\nimport { gitSessionCookieManager } from '../infrastructure/GitSessionCookieManager';\nimport { openLoginPopup } from './openLoginPopup';\n\nexport async function githubLogin(\n  vcsClient: VcsClient,\n  privateVcsClient: PrivateVcsClient,\n  sessionCookie: GitSessionCookie | undefined,\n  externalWindow: Window | null | undefined,\n  setExternalWindow: React.Dispatch<React.SetStateAction<Window | null | undefined>>\n): Promise<void> {\n  if (externalWindow) {\n    externalWindow.close();\n  }\n\n  if (sessionCookie?.isUserTokenExpired()) {\n    // A session already exists, but it's expired. Refresh the session.\n    try {\n      await privateVcsClient.refresh();\n      return;\n    } catch (error) {\n      // This error isn't fatal and we can recover from it by restarting the\n      // oauth login flow.\n      logger.error(error as Error, { info: 'Failed to refresh GitHub user token' });\n\n      // Failed to refresh the token. Delete the old token and enter the\n      // follow login flow to get a completely new token.\n      gitSessionCookieManager.deleteCookie();\n    }\n  }\n\n  // No session cookie exists, begin the complete login flow.\n  try {\n    const { clientID: clientId, callbackURL: callbackUrl } = await vcsClient.githubApp();\n    setExternalWindow(openLoginPopup(clientId, nonce, callbackUrl));\n  } catch (error) {\n    displayError(error as Error, ['Failed to start login flow.', (error as Error).message]);\n  }\n}\n","import { VcsClient } from '../../../infrastructure/VcsClient';\n\nexport async function authFromUrl(\n  vcsClient: VcsClient,\n  urlSearchParams: URLSearchParams,\n  nonce: string\n): Promise<string> {\n  const code = urlSearchParams.get('code');\n  if (!code) {\n    return '';\n  }\n\n  const stateValue = urlSearchParams.get('state');\n  if (!stateValue) {\n    throw new Error('Invalid state parameter!');\n  }\n\n  let state;\n\n  try {\n    state = JSON.parse(atob(stateValue));\n  } catch (error) {\n    throw new Error('Invalid state parameter!');\n  }\n\n  if (state.nonce !== nonce) {\n    throw new Error('Invalid nonce parameter!');\n  }\n\n  const res = await vcsClient.githubLogin(code);\n  return res.cookie;\n}\n","import { displayError } from '@shared/domain/displayStatus';\nimport { useEffect } from 'react';\n\nimport { VcsClient } from '../../../infrastructure/VcsClient';\nimport { authFromUrl } from './authFromUrl';\n\ntype PollGithubPopupParams = {\n  vcsClient: VcsClient;\n  externalWindow: Window | null | undefined;\n  setExternalWindow: (window: Window | null) => void;\n  setSessionCookie: (sessionCookie: string) => void;\n  nonce: string;\n};\n\nfunction tryGetWindowSearchParams(window: Window): URLSearchParams | null {\n  try {\n    return new URL(window.location.href).searchParams;\n  } catch {\n    return null;\n  }\n}\n\nexport function usePollGitHubPopup({\n  vcsClient,\n  externalWindow,\n  setExternalWindow,\n  setSessionCookie,\n  nonce,\n}: PollGithubPopupParams) {\n  // eslint-disable-next-line sonarjs/cognitive-complexity\n  useEffect(() => {\n    const checkPopup = async () => {\n      if (!externalWindow || externalWindow.closed) {\n        setExternalWindow(null);\n        return;\n      }\n\n      try {\n        const searchParams = tryGetWindowSearchParams(externalWindow);\n\n        if (searchParams !== null) {\n          const sessionCookie = await authFromUrl(vcsClient, searchParams, nonce);\n\n          if (sessionCookie) {\n            setSessionCookie(sessionCookie);\n            externalWindow.close();\n            setExternalWindow(null);\n            return;\n          }\n        }\n      } catch (error) {\n        displayError(error as Error, ['Error while login in with GitHub!', (error as Error).message]);\n        externalWindow.close();\n        setExternalWindow(null);\n        return;\n      }\n\n      // keep checking for the popup to close\n      window.setTimeout(checkPopup, 700);\n    };\n\n    if (externalWindow) {\n      checkPopup();\n    }\n\n    return () => {\n      if (externalWindow) {\n        externalWindow.close();\n        setExternalWindow(null);\n      }\n    };\n  }, [externalWindow, setExternalWindow, setSessionCookie, nonce, vcsClient]);\n}\n","import { createContext } from 'react';\n\nexport type TGitHubContext = {\n  isLoggedIn: boolean;\n  isSessionExpired: boolean;\n  isLoginInProgress: boolean;\n  login: () => Promise<void>;\n  logout: () => void;\n};\n\nexport const DEFAULT_GITHUB_CONTEXT: TGitHubContext = {\n  isLoginInProgress: false,\n  isLoggedIn: false,\n  isSessionExpired: false,\n  login: async () => {},\n  logout: () => {},\n};\n\nexport const GitHubContext = createContext(DEFAULT_GITHUB_CONTEXT);\n","import { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { DataSourceProxyClient } from '../../../../../../../infrastructure/series/http/DataSourceProxyClient';\nimport { GitSessionCookieManager, gitSessionCookieManager } from './GitSessionCookieManager';\n\ntype GetFileResponse = {\n  content: string;\n  URL: string;\n};\n\ntype Commit = {\n  repositoryUrl: string;\n  gitRef: string;\n};\n\ntype GetCommitResponse = {\n  author: {\n    avatarURL: string;\n    login: string;\n  };\n  date?: Date;\n  message: string;\n  sha: string;\n  URL: string;\n};\n\nexport const PLACEHOLDER_COMMIT_DATA = Object.freeze({\n  sha: '<unknown>',\n  date: undefined,\n  author: {\n    login: 'unknown author',\n    avatarURL: '',\n  },\n  message: '',\n  URL: '',\n});\n\n/**\n * Exposes VCSService endpoints which are protected by token authentication. It\n * implements middleware to try auto-refresh expired tokens. While an\n * auto-refresh is in progress, subsequent requests are queued. Once the token\n * is refreshed, the queued requests will be dispatched using the new token.\n *\n * WARNING: Only one instance of this class should be instantiated because it\n * needs to keep a singleton reference to the `GitSession` cookie. This class\n * will refresh the `GitSession` cookie whenever it expires and multiple\n * instances will cause unexpected errors and race conditions.\n */\nexport class PrivateVcsClient extends DataSourceProxyClient {\n  private sessionManager: GitSessionCookieManager;\n\n  private pendingQueue: Array<(err: Error | undefined) => void>;\n  private isRefreshing: boolean;\n\n  /** Time interval where the session should be considered expired. */\n  private static readonly BIAS_MS = 5 * 60 * 1000; // 5 minutes\n\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n\n    this.sessionManager = gitSessionCookieManager;\n    this.isRefreshing = false;\n    this.pendingQueue = [];\n  }\n\n  /**\n   * Fetches a file from GitHub.\n   *\n   * @param repositoryUrl A repository url\n   * @param gitRef A ref of the file version\n   * @param localPath A file path relative to the repository root\n   * @returns Base64 encoded file contents.\n   */\n  async getFile(\n    repositoryUrl: string,\n    gitRef: string,\n    localPath: string,\n    rootPath: string,\n    functionName: string\n  ): Promise<GetFileResponse> {\n    const response = await this.postWithRefresh(\n      '/vcs.v1.VCSService/GetFile',\n      JSON.stringify({\n        repositoryURL: repositoryUrl,\n        ref: gitRef,\n        localPath,\n        rootPath,\n        functionName,\n      })\n    );\n\n    return response.json();\n  }\n\n  /**\n   * Fetches a series of commit metadata (author, date, etc) for a list of\n   * commit refs.\n   *\n   * @param commits A list of commits\n   * @returns GitHub commit metadata for the commits\n   */\n  async getCommits(commits: Commit[]): Promise<GetCommitResponse[]> {\n    return await Promise.all(\n      commits.map(({ repositoryUrl, gitRef }) => {\n        if (!repositoryUrl || !gitRef) {\n          return PLACEHOLDER_COMMIT_DATA;\n        }\n\n        return this.getCommit(repositoryUrl, gitRef).catch((error) => {\n          logger.error(error, {\n            info: `Error while fetching commit from repo \"${repositoryUrl}\" (${gitRef})!'`,\n          });\n\n          return PLACEHOLDER_COMMIT_DATA;\n        });\n      })\n    );\n  }\n\n  async refresh(): Promise<void> {\n    return this.refreshSession();\n  }\n\n  /**\n   * Gets commit metadata (author, date, etc) for a single commit ref.\n   *\n   * @param repositoryUrl A repository url\n   * @param gitRef A commit ref\n   * @returns Metadata for a single GitHub commit.\n   */\n  private async getCommit(repositoryUrl: string, gitRef: string): Promise<GetCommitResponse> {\n    const response = await this.postWithRefresh(\n      '/vcs.v1.VCSService/GetCommit',\n      JSON.stringify({\n        repositoryURL: repositoryUrl,\n        ref: gitRef,\n      })\n    );\n\n    const json = await response.json();\n    json.date &&= new Date(json.date);\n    return json;\n  }\n\n  /**\n   * Makes an HTTP POST request. If the session cookie is expired, this method\n   * will auto-refresh the session cookie. During this time, all subsequent\n   * requests will be queued until the refresh is complete.\n   *\n   * @param path An API route path\n   * @param body Request body contents\n   * @returns A promise for the HTTP POST request.\n   */\n  private async postWithRefresh(path: string, body: string): Promise<Response> {\n    // Check if the session is refreshing.\n    if (this.isRefreshing) {\n      return this.queueRequest(path, body);\n    }\n\n    // Check if session is expired.\n    if (this.sessionManager.getCookie()?.isUserTokenExpired(PrivateVcsClient.BIAS_MS)) {\n      this.isRefreshing = true;\n\n      // Refresh the session.\n      try {\n        await this.refreshSession();\n      } catch (e) {\n        this.sessionManager.deleteCookie();\n        this.flushQueue(e as Error);\n      }\n\n      // Resolve the request that triggered the refresh.\n      this.flushQueue();\n      this.isRefreshing = false;\n    }\n\n    return this.post(path, body);\n  }\n\n  /**\n   * Makes an HTTP POST request. This method assumes a valid session cookie.\n   *\n   * @param path An API route path\n   * @param body Request body contents\n   * @returns A response of the resulting HTTP POST request.\n   */\n  private async post(path: string, body: string): Promise<Response> {\n    return this.fetch(path, {\n      method: 'POST',\n      body: body,\n    });\n  }\n\n  /**\n   * Exchanges the current session cookie for a new one, then saves the cookie\n   * in the session manager.\n   */\n  private async refreshSession(): Promise<void> {\n    const response = await this.fetch('/vcs.v1.VCSService/GithubRefresh', {\n      method: 'POST',\n      body: JSON.stringify({}),\n    });\n\n    const body = await response.json();\n    this.sessionManager.setCookie(body.cookie);\n  }\n\n  /**\n   * Queues an HTTP request to the provided path with the provided body. The\n   * request will be executed when the queue gets flushed.\n   *\n   * @param path An API route path\n   * @param body Request body contents\n   * @returns A response of the resulting HTTP POST request.\n   */\n  private async queueRequest(path: string, body: string): Promise<Response> {\n    return new Promise((resolve, reject) => {\n      this.pendingQueue.push((err) => {\n        if (err) {\n          reject(err);\n          return;\n        }\n\n        resolve(this.post(path, body));\n      });\n    });\n  }\n\n  /**\n   * Flushes a queue of requests in the order in which they were received. If\n   * an error occurred while the requests were queued, it is passed to each\n   * request callback.\n   *\n   * This function also resets the internal queue.\n   *\n   * @param err An optional error\n   */\n  private flushQueue(err: Error | undefined = undefined) {\n    this.pendingQueue.forEach((callback) => callback(err));\n    this.pendingQueue = [];\n  }\n}\n","import { displayError } from '@shared/domain/displayStatus';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { DataSourceProxyClientBuilder } from 'src/pages/ProfilesExplorerView/infrastructure/series/http/DataSourceProxyClientBuilder';\n\nimport { VcsClient } from '../../infrastructure/VcsClient';\nimport { generateNonce } from './domain/generateNonce';\nimport { githubLogin } from './domain/githubLogin';\nimport { useGithubSessionCookie } from './domain/useGithubSessionCookie';\nimport { usePollGitHubPopup } from './domain/usePollGitHubPopup';\nimport { DEFAULT_GITHUB_CONTEXT, GitHubContext } from './GitHubContext';\nimport { PrivateVcsClient } from './infrastructure/PrivateVcsClient';\n\ntype GitHubContextProviderProps = {\n  dataSourceUid: string;\n  children: React.ReactNode;\n};\n\nexport const nonce = generateNonce();\n\n// Keep the data source UID in session storage to reuse it if the page is refreshed\nconst LOCAL_STORAGE_GITHUB_INTEGRATION_DATASOURCE_UID = `grafana-pyroscope-app.gitHubIntegration.dataSourceUid`;\n\nexport function GitHubContextProvider({ dataSourceUid, children }: GitHubContextProviderProps) {\n  const vcsClient = DataSourceProxyClientBuilder.build(dataSourceUid, VcsClient);\n  const privateVcsClient = DataSourceProxyClientBuilder.build(dataSourceUid, PrivateVcsClient);\n\n  const [isLoginInProgress, setIsLoginInProgress] = useState(DEFAULT_GITHUB_CONTEXT.isLoginInProgress);\n  const [sessionCookie, setSessionCookie] = useGithubSessionCookie();\n  const [externalWindow, setExternalWindow] = useState<Window | null>();\n\n  useEffect(() => {\n    const gitHubIntegrationDataSourceUid = localStorage.getItem(LOCAL_STORAGE_GITHUB_INTEGRATION_DATASOURCE_UID);\n    if (gitHubIntegrationDataSourceUid !== dataSourceUid) {\n      setSessionCookie('');\n      localStorage.setItem(LOCAL_STORAGE_GITHUB_INTEGRATION_DATASOURCE_UID, dataSourceUid || '');\n    }\n  }, [dataSourceUid]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  usePollGitHubPopup({ vcsClient, externalWindow, setExternalWindow, setSessionCookie, nonce });\n\n  // Check if login window is open and toggle the login state accordingly. For\n  // example, if the login window IS open and the login state is not\n  // \"in progress\", then update the state to be \"in progress\".\n  const newIsLoginInProgress = externalWindow ? !externalWindow.closed : false;\n  if (newIsLoginInProgress !== isLoginInProgress) {\n    setIsLoginInProgress(newIsLoginInProgress);\n  }\n\n  const login = useCallback(async () => {\n    try {\n      await githubLogin(vcsClient, privateVcsClient, sessionCookie, externalWindow, setExternalWindow);\n    } catch (error) {\n      displayError(error as Error, ['Failed to login to GitHub', (error as Error).message]);\n    }\n  }, [vcsClient, privateVcsClient, sessionCookie, externalWindow]);\n\n  return (\n    <GitHubContext.Provider\n      value={{\n        isLoginInProgress,\n        isLoggedIn: Boolean(sessionCookie && !sessionCookie.isUserTokenExpired()),\n        isSessionExpired: Boolean(sessionCookie?.isUserTokenExpired()),\n        login,\n        logout: () => setSessionCookie(''),\n      }}\n    >\n      {children}\n    </GitHubContext.Provider>\n  );\n}\n","export function generateNonce(): string {\n  // https://stackoverflow.com/questions/76825670/how-to-generate-and-use-random-value-for-nonce-in-inline-script-in-javascript\n  return btoa(String.fromCharCode(...crypto.getRandomValues(new Uint8Array(32))));\n}\n","import { useState } from 'react';\n\nimport { gitSessionCookieManager } from '../infrastructure/GitSessionCookieManager';\n\nexport function useGithubSessionCookie() {\n  const [cookie, setCookie] = useState(gitSessionCookieManager.getCookie());\n\n  const setNextCookie = (nextValue: string) => {\n    if (!nextValue) {\n      gitSessionCookieManager.deleteCookie();\n      setCookie(undefined);\n    } else {\n      gitSessionCookieManager.setCookie(nextValue);\n      setCookie(gitSessionCookieManager.getCookie());\n    }\n  };\n\n  return [cookie, setNextCookie] as const;\n}\n","import React, { createContext, ReactNode, useContext } from 'react';\nimport { useLocalStorage } from 'react-use';\n\nimport { FunctionVersion } from './types/FunctionDetails';\n\ntype OverridesStorage = Record<string, Record<string, FunctionVersion>>;\n\n/**\n * Indicates how function version was defined\n */\nexport enum FunctionVersionOrigin {\n  // provided manually by the user\n  USER = 'user',\n  // retrieved from profile labels\n  LABELS = 'labels',\n}\n\ninterface FunctionVersionContextType {\n  saveOverride: (datasourceUid: string, serviceName: string, version: FunctionVersion) => void;\n  deleteOverride: (datasourceUid: string, serviceName: string) => void;\n  deleteAllOverrides: () => void;\n  getFunctionVersion: (\n    datasourceUid: string,\n    serviceName: string,\n    defaultVersion?: FunctionVersion\n  ) => {\n    functionVersion: FunctionVersion | undefined;\n    functionVersionOrigin: FunctionVersionOrigin | undefined;\n  };\n}\n\nconst FunctionVersionContext = createContext<FunctionVersionContextType | undefined>(undefined);\n\ninterface FunctionVersionProviderProps {\n  children: ReactNode;\n}\n\nexport function FunctionVersionProvider({ children }: FunctionVersionProviderProps) {\n  const [overrides, setOverrides] = useLocalStorage<OverridesStorage>(\n    'grafana-pyroscope-app.functionDetailsOverrides',\n    {}\n  );\n\n  const saveOverride = (datasourceUid: string, serviceName: string, version: FunctionVersion) => {\n    setOverrides((overrides) => {\n      if (!overrides) {\n        overrides = {};\n      }\n      if (!overrides[datasourceUid]) {\n        overrides[datasourceUid] = {};\n      }\n      overrides[datasourceUid][serviceName] = {\n        ...version,\n      };\n      return overrides;\n    });\n  };\n\n  const deleteOverride = (datasourceUid: string, serviceName: string) => {\n    setOverrides((overrides) => {\n      if (!overrides || !overrides[datasourceUid] || !overrides[datasourceUid][serviceName]) {\n        return overrides;\n      }\n      delete overrides[datasourceUid][serviceName];\n      return overrides;\n    });\n  };\n\n  const deleteAllOverrides = () => {\n    setOverrides({});\n  };\n\n  const getFunctionVersion = (datasourceUid: string, serviceName: string, defaultVersion?: FunctionVersion) => {\n    const overriddenVersion = overrides?.[datasourceUid]?.[serviceName];\n\n    let functionVersionOrigin: FunctionVersionOrigin | undefined;\n    if (overriddenVersion) {\n      functionVersionOrigin = FunctionVersionOrigin.USER;\n    } else if (defaultVersion) {\n      functionVersionOrigin = FunctionVersionOrigin.LABELS;\n    }\n\n    return {\n      functionVersion: overriddenVersion || defaultVersion,\n      functionVersionOrigin,\n    };\n  };\n\n  const value: FunctionVersionContextType = {\n    saveOverride,\n    deleteOverride,\n    deleteAllOverrides,\n    getFunctionVersion,\n  };\n\n  return <FunctionVersionContext.Provider value={value}>{children}</FunctionVersionContext.Provider>;\n}\n\nexport function useFunctionVersionContext(): FunctionVersionContextType {\n  const context = useContext(FunctionVersionContext);\n  if (context === undefined) {\n    throw new Error('useFunctionVersionContext must be used within a FunctionVersionProvider');\n  }\n  return context;\n}\n\nexport function useFunctionVersion(datasourceUid: string, serviceName: string, version: FunctionVersion | undefined) {\n  const { saveOverride, deleteOverride, deleteAllOverrides, getFunctionVersion } = useFunctionVersionContext();\n\n  const { functionVersion, functionVersionOrigin } = getFunctionVersion(datasourceUid, serviceName, version);\n\n  return {\n    saveOverride,\n    deleteOverride,\n    deleteAllOverrides,\n    functionVersion,\n    functionVersionOrigin,\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface RemoveSpanSelectorPayload {}\n\nexport class RemoveSpanSelector extends BusEventWithPayload<RemoveSpanSelectorPayload> {\n  public static type = 'remove-span-selector';\n}\n","import { usePluginComponent } from '@grafana/runtime';\nimport { sceneGraph } from '@grafana/scenes';\nimport React from 'react';\n\nimport { SceneExploreServiceFlameGraph } from '../../SceneExploreServiceFlameGraph';\n\ntype ResolutionBoostExtensionProps = {\n  serviceName: string;\n};\n\nconst SERVICE_NAME_EXPR = '${serviceName}';\n\nexport function ResolutionBoostExtensionPoint({ scene }: { scene: SceneExploreServiceFlameGraph }) {\n  const { component: ResolutionBoostExtension } = usePluginComponent<ResolutionBoostExtensionProps>(\n    'grafana-adaptiveprofiles-app/resolution-boost/v1'\n  );\n\n  if (!ResolutionBoostExtension) {\n    return;\n  }\n\n  const serviceName = sceneGraph.interpolate(scene, '${serviceName}');\n  // serviceNameUnavailable if the interpolation failed (returning the EXPR back again)\n  const serviceNameUnavailable = serviceName === SERVICE_NAME_EXPR;\n\n  if (serviceNameUnavailable) {\n    return;\n  }\n\n  return <ResolutionBoostExtension serviceName={serviceName} />;\n}\n","import { SceneQueryRunner } from '@grafana/scenes';\n\nimport { PYROSCOPE_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { TimeSeriesQueryRunnerParams } from '../timeseries/TimeSeriesQueryRunnerParams';\nimport { withPreventInvalidQuery } from '../withPreventInvalidQuery';\n\ntype FlameGraphQueryRunnerParams = TimeSeriesQueryRunnerParams & {\n  maxNodes?: number;\n  spanSelector?: string;\n};\n\nexport function buildFlameGraphQueryRunner({ filters, maxNodes, spanSelector }: FlameGraphQueryRunnerParams) {\n  const completeFilters = filters ? [...filters] : [];\n  completeFilters.unshift({ key: 'service_name', operator: '=', value: '$serviceName' });\n\n  const selector = completeFilters.map(({ key, operator, value }) => `${key}${operator}\"${value}\"`).join(',');\n\n  const queryRunner = new SceneQueryRunner({\n    datasource: PYROSCOPE_DATA_SOURCE,\n    queries: [\n      {\n        refId: 'profile',\n        queryType: 'profile',\n        profileTypeId: '$profileMetricId',\n        labelSelector: `{${selector},$filters}`,\n        maxNodes,\n        ...(spanSelector && { spanSelector: [spanSelector] }),\n      },\n    ],\n  });\n\n  return withPreventInvalidQuery(queryRunner);\n}\n","import { Field, Message } from 'protobufjs/light';\n\nexport class PprofRequest extends Message<PprofRequest> {\n    constructor(\n        profile_typeID: string,\n        label_selector: string,\n        start: number,\n        end: number,\n        max_nodes: number\n    ) {\n        super();\n        this.profile_typeID = profile_typeID;\n        this.label_selector = label_selector;\n        this.start = start;\n        this.end = end;\n        this.max_nodes = max_nodes;\n    }\n\n    @Field.d(1, 'string')\n    profile_typeID: string;\n\n    @Field.d(2, 'string')\n    label_selector: string;\n\n    @Field.d(3, 'int64')\n    start: number;\n\n    @Field.d(4, 'int64')\n    end: number;\n\n    @Field.d(5, 'int64')\n    max_nodes: number;\n}\n","import { TimeRange } from '@grafana/data';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\nimport { PprofProfile } from '@shared/types/PprofProfile';\n\nimport { DataSourceProxyClient } from '../../../infrastructure/series/http/DataSourceProxyClient';\nimport { PprofRequest } from './PprofRequest';\n\ntype SelectMergeProfileParams = {\n  query: string;\n  timeRange: TimeRange;\n  maxNodes: number;\n};\n\ntype SelectMergeProfileJsonParams = {\n  profileMetricId: string;\n  labelsSelector: string;\n  start: number;\n  end: number;\n  stackTrace: string[];\n  maxNodes: number;\n};\n\nexport class PprofApiClient extends DataSourceProxyClient {\n  static buildPprofRequest(query: string, timeRange: TimeRange, maxNodes: number): Uint8Array {\n    const { profileMetricId, labelsSelector } = parseQuery(query);\n\n    const start = timeRange.from.unix() * 1000;\n    const end = timeRange.to.unix() * 1000;\n\n    const message = new PprofRequest(profileMetricId, labelsSelector, start, end, maxNodes);\n\n    return PprofRequest.encode(message).finish();\n  }\n\n  async selectMergeProfile({ query, timeRange, maxNodes }: SelectMergeProfileParams): Promise<Blob> {\n    const response = await this.fetch('/querier.v1.QuerierService/SelectMergeProfile', {\n      method: 'POST',\n      headers: { 'content-type': 'application/proto' },\n      body: new Blob([PprofApiClient.buildPprofRequest(query, timeRange, maxNodes)]),\n    });\n\n    return response.blob();\n  }\n\n  async selectMergeProfileJson({\n    profileMetricId,\n    labelsSelector,\n    start,\n    end,\n    stackTrace,\n    maxNodes,\n  }: SelectMergeProfileJsonParams): Promise<PprofProfile> {\n    const response = await this.fetch('/querier.v1.QuerierService/SelectMergeProfile', {\n      method: 'POST',\n      body: JSON.stringify({\n        profile_typeID: profileMetricId,\n        label_selector: labelsSelector,\n        start: start * 1000,\n        end: end * 1000,\n        stackTraceSelector: {\n          call_site: stackTrace.map((name) => ({ name })),\n        },\n        maxNodes,\n      }),\n    });\n\n    return response.json();\n  }\n}\n","import { TimeRange } from '@grafana/data';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\n\nexport function getExportFilename(query: string, timeRange: TimeRange) {\n  const { serviceId, profileMetricId } = parseQuery(query);\n  const dateString = `${timeRange.from.format('YYYY-MM-DD_HHmm')}-to-${timeRange.to.format('YYYY-MM-DD_HHmm')}`;\n  return `${serviceId.replace(/\\//g, '-')}_${profileMetricId}_${dateString}`;\n}\n","import { HttpClient } from '@shared/infrastructure/http/HttpClient';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\n\ntype UploadResponse = {\n  key: string;\n  url: string;\n  subProfiles: any[]; // TODO: define them, what are they?\n};\n\nclass FlamegraphDotComApiClient extends HttpClient {\n  constructor() {\n    super('https://flamegraph.com/api', {\n      'content-type': 'application/json',\n    });\n  }\n\n  async upload(name: string, profile: FlamebearerProfile): Promise<UploadResponse> {\n    const response = await this.fetch('/upload/v1', {\n      method: 'POST',\n      body: JSON.stringify({\n        name,\n        profile: btoa(JSON.stringify(profile)),\n        fileTypeData: {\n          units: profile.metadata.units,\n          spyName: profile.metadata.spyName,\n        },\n        type: 'json',\n      }),\n    });\n\n    const json = await response.json();\n\n    return json;\n  }\n}\n\nexport const flamegraphDotComApiClient = new FlamegraphDotComApiClient();\n","import { TimeRange } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, Dropdown, Menu } from '@grafana/ui';\nimport { displayError } from '@shared/domain/displayStatus';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { useMaxNodesFromUrl } from '@shared/domain/url-params/useMaxNodesFromUrl';\nimport { DEFAULT_SETTINGS } from '@shared/infrastructure/settings/PluginSettings';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\nimport 'compression-streams-polyfill';\nimport saveAs from 'file-saver';\nimport React from 'react';\n\nimport { ProfilesDataSourceVariable } from '../../../../domain/variables/ProfilesDataSourceVariable';\nimport { ProfileApiClient } from '../../../../infrastructure/profiles/ProfileApiClient';\nimport { DataSourceProxyClientBuilder } from '../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { PprofApiClient } from '../../infrastructure/PprofApiClient';\nimport { getExportFilename } from './domain/getExportFilename';\nimport { flamegraphDotComApiClient } from './infrastructure/flamegraphDotComApiClient';\n\ninterface SceneExportMenuState extends SceneObjectState {}\n\ntype ExtraProps = {\n  query: string;\n  timeRange: TimeRange;\n};\n\nexport class SceneExportMenu extends SceneObjectBase<SceneExportMenuState> {\n  constructor() {\n    super({ key: 'export-flame-graph-menu' });\n  }\n\n  async fetchFlamebearerProfile({\n    dataSourceUid,\n    query,\n    timeRange,\n    maxNodes,\n  }: ExtraProps & { dataSourceUid: string; maxNodes: number | null }): Promise<FlamebearerProfile | null> {\n    const profileApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, ProfileApiClient);\n\n    let profile;\n\n    try {\n      profile = await profileApiClient.get({\n        query,\n        timeRange,\n        format: 'json',\n        maxNodes: maxNodes || DEFAULT_SETTINGS.maxNodes,\n      });\n    } catch (error) {\n      displayError(error as Error, ['Error while loading flamebearer profile data!', (error as Error).message]);\n      return null;\n    }\n\n    return profile as FlamebearerProfile;\n  }\n\n  async fetchPprofProfile({\n    dataSourceUid,\n    query,\n    timeRange,\n    maxNodes,\n  }: ExtraProps & { dataSourceUid: string; maxNodes: number | null }): Promise<Blob | null> {\n    const pprofApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, PprofApiClient);\n\n    let profile;\n\n    try {\n      const blob = await pprofApiClient.selectMergeProfile({\n        query,\n        timeRange,\n        maxNodes: maxNodes || DEFAULT_SETTINGS.maxNodes,\n      });\n      profile = await new Response(blob.stream().pipeThrough(new CompressionStream('gzip'))).blob();\n    } catch (error) {\n      displayError(error as Error, ['Failed to export to pprof!', (error as Error).message]);\n      return null;\n    }\n\n    return profile;\n  }\n\n  useSceneExportMenu = ({ query, timeRange }: ExtraProps): DomainHookReturnValue => {\n    const dataSourceUid = sceneGraph.findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable).useState()\n      .value as string;\n\n    const [maxNodes] = useMaxNodesFromUrl();\n    const { settings } = useFetchPluginSettings();\n\n    const downloadPng = () => {\n      reportInteraction('g_pyroscope_app_export_profile', { format: 'png' });\n\n      const filename = `${getExportFilename(query, timeRange)}.png`;\n\n      (document.querySelector('canvas[data-testid=\"flameGraph\"]') as HTMLCanvasElement).toBlob((blob) => {\n        if (!blob) {\n          const error = new Error('Error while creating the image, no blob.');\n          displayError(error, ['Failed to export to png!', error.message]);\n          return;\n        }\n\n        saveAs(blob, filename);\n      }, 'image/png');\n    };\n\n    const downloadJson = async () => {\n      reportInteraction('g_pyroscope_app_export_profile', { format: 'json' });\n\n      const profile = await this.fetchFlamebearerProfile({ dataSourceUid, query, timeRange, maxNodes });\n      if (!profile) {\n        return;\n      }\n\n      const filename = `${getExportFilename(query, timeRange)}.json`;\n      const data = `data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(profile))}`;\n\n      saveAs(data, filename);\n    };\n\n    const downloadPprof = async () => {\n      reportInteraction('g_pyroscope_app_export_profile', { format: 'pprof' });\n\n      const profile = await this.fetchPprofProfile({ dataSourceUid, query, timeRange, maxNodes });\n      if (!profile) {\n        return;\n      }\n\n      const filename = `${getExportFilename(query, timeRange)}.pb.gz`;\n\n      saveAs(profile, filename);\n    };\n\n    const uploadToFlamegraphDotCom = async () => {\n      reportInteraction('g_pyroscope_app_export_profile', { format: 'flamegraph.com' });\n\n      const profile = await this.fetchFlamebearerProfile({ dataSourceUid, query, timeRange, maxNodes });\n      if (!profile) {\n        return;\n      }\n\n      try {\n        const response = await flamegraphDotComApiClient.upload(getExportFilename(query, timeRange), profile);\n\n        if (!response.url) {\n          throw new Error('Empty URL received.');\n        }\n\n        const dlLink = document.createElement('a');\n        dlLink.target = '_blank';\n        dlLink.href = response.url;\n        document.body.appendChild(dlLink);\n        dlLink.click();\n        document.body.removeChild(dlLink);\n      } catch (error) {\n        displayError(error as Error, ['Failed to export to flamegraph.com!', (error as Error).message]);\n        return;\n      }\n    };\n\n    return {\n      data: {\n        shouldDisplayFlamegraphDotCom: Boolean(settings?.enableFlameGraphDotComExport),\n      },\n      actions: {\n        downloadPng,\n        downloadJson,\n        downloadPprof,\n        uploadToFlamegraphDotCom,\n      },\n    };\n  };\n\n  static Component = ({ model, query, timeRange }: SceneComponentProps<SceneExportMenu> & ExtraProps) => {\n    const { actions } = model.useSceneExportMenu({ query, timeRange });\n\n    return (\n      <Dropdown\n        overlay={\n          <Menu>\n            <Menu.Item label=\"png\" onClick={actions.downloadPng} />\n            <Menu.Item label=\"json\" onClick={actions.downloadJson} />\n            <Menu.Item label=\"pprof\" onClick={actions.downloadPprof} />\n          </Menu>\n        }\n      >\n        <Button\n          icon=\"download-alt\"\n          size=\"sm\"\n          variant=\"secondary\"\n          fill=\"outline\"\n          aria-label=\"Export profile data\"\n          tooltip=\"Export profile data\"\n        />\n      </Dropdown>\n    );\n  };\n}\n","import { useContext } from 'react';\n\nimport { GitHubContext, TGitHubContext } from './GitHubContext';\n\nexport function useGitHubContext(): TGitHubContext {\n  return useContext(GitHubContext);\n}\n","import { IconName } from '@grafana/data';\nimport { Props as FlameGraphProps } from '@grafana/flamegraph';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { useCallback, useState } from 'react';\n\nimport { useGitHubContext } from '../components/GitHubContextProvider/useGitHubContext';\nimport { buildStackTrace } from './buildStackTrace';\n\nexport function useGitHubIntegration(sidePanel: any): DomainHookReturnValue {\n  const { login, isSessionExpired } = useGitHubContext();\n  const { settings } = useFetchPluginSettings();\n\n  const isFunctionDetailsEnabled = settings?.enableFunctionDetails;\n\n  const [stacktrace, setStacktrace] = useState<string[]>([]);\n\n  const getExtraFlameGraphMenuItems: FlameGraphProps['getExtraContextMenuButtons'] = useCallback(\n    ({ item }: any, data: Record<string, any>) => {\n      // clicking on the top-level \"total\" node doesn't add \"Function details\" as an extra contextual menu item\n      if (!isFunctionDetailsEnabled || item.level === 0) {\n        return [];\n      }\n\n      return [\n        {\n          label: 'Function details',\n          icon: 'info-circle' as IconName,\n          onClick: () => {\n            reportInteraction('g_pyroscope_app_function_details_clicked');\n\n            setStacktrace(buildStackTrace(item, data));\n\n            sidePanel.open('function-details');\n\n            // login can only happen as a consequence of a user action\n            // this is why we check if the session is expired here and not whenever we make a request to the API\n            if (isSessionExpired) {\n              login();\n            }\n          },\n        },\n      ];\n    },\n    [isFunctionDetailsEnabled, isSessionExpired, login, sidePanel]\n  );\n\n  return {\n    data: {\n      stacktrace,\n    },\n    actions: {\n      getExtraFlameGraphMenuItems,\n    },\n  };\n}\n","import { createTheme, getDisplayProcessor } from '@grafana/data';\n\nimport { StackTrace } from './types/StackTrace';\n\nexport function buildStackTrace(levelItem: any, data: Record<string, any>): StackTrace {\n  let stacktrace: string[] = [];\n\n  const labels = data.fields.find(({ name }: { name: string }) => name === 'label');\n  if (!labels) {\n    return stacktrace;\n  }\n\n  const dp = getDisplayProcessor({ field: labels, theme: createTheme() });\n  let node = levelItem;\n\n  while (node && node.level > 0) {\n    for (const idx of node.itemIndexes) {\n      stacktrace.unshift(dp(labels.values[idx]).text);\n    }\n\n    node = node.parents?.[0];\n  }\n\n  return stacktrace;\n}\n","/* https://platform.openai.com/docs/models/overview */\nimport { FunctionDetails, LineProfile } from '../../../domain/types/FunctionDetails';\n\nexport const model = 'gpt-4-1106-preview';\n\n/* https://platform.openai.com/docs/guides/prompt-engineering/tactics */\n\nexport type SuggestionPromptInputs = {\n  functionDetails: FunctionDetails;\n  lines: LineProfile[];\n};\n\nexport const buildSuggestionPrompts = ({\n  functionDetails,\n  lines,\n}: // dotProfile,\nSuggestionPromptInputs) => {\n  const userPrompt = `\nYou are a code optimization expert. I will give you source code file where each line is annotated with profiling information. The annotation has the following format:\n\n\\`\\`\\`\n(<cost>) <source code line>\n\\`\\`\\`\n\nThe \\`\\`\\`<source code line>\\`\\`\\` is the exact line of source code.\n\nThe \\`\\`\\`<cost>\\`\\`\\` field will contain the resource cost of the given resource cost. This field will also contain the unit of the cost (e.g. seconds, bytes, etc). If \\`\\`\\`<cost>\\`\\`\\` is \\`-\\` that means there is no profiling data available.\n\nI want you to write back a new improved code for this function and explain why you made changes.\n\nMake sure to take annotations into strong consideration. If a suggested performance improvement isn't backed up by information from the annotations, do not include it. Prioritize lines annotated with a higher cost.\n\nDo not mention the actual numbers from the annotations, users can already see how much time was spent on each line. Do not list various lines and their time spent. When you mention functions or lines, do not mention the time spent on them.\n\nIf you can't find any meaningful performance optimizations, say so. Ask for context if you think other context might help make decisions. If you think the problem is with user input and not the actual code itself, say so.\n\nWhen you output code in markdown, please don't specify language after 3 backticks (e.g instead of saying \"\\`\\`\\`go\" say \"\\`\\`\\`\"), and always add a new line after 3 backticks.\n\nFunction name is \\`${functionDetails.name}\\`. Do not mention the function name, users can already see it.\n\nWhen posting a response, follow the outline below:\n* give a brief explanation of things that could be improve\n* print new code if it's possible\n* explain each change in more details\n\n\nAnnotated code is below:\n\\`\\`\\`\n${codeInfoToAnnotatedCode(functionDetails, lines)}\n\\`\\`\\`\n`;\n\n  return {\n    user: userPrompt,\n  };\n};\n\nfunction codeInfoToAnnotatedCode(functionDetails: FunctionDetails, lines: LineProfile[]): string {\n  return lines\n    .map((line) => {\n      if (line.cum === 0) {\n        return `(-) ${line.line}`;\n      }\n      return `(${line.cum} ${functionDetails.unit}) ${line.line}`;\n    })\n    .join('\\n');\n}\n","import { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\n\nimport { SuggestionPromptInputs } from './buildLlmSuggestionPrompts';\nimport { useOpenAiSuggestions } from './useOpenAiSuggestions';\n\nexport function useAiSuggestionsPanel(suggestionPromptInputs: SuggestionPromptInputs): DomainHookReturnValue {\n  const { reply, error: llmError } = useOpenAiSuggestions(suggestionPromptInputs);\n\n  return {\n    data: {\n      isLoading: !llmError && !reply.text.trim(),\n      llmError,\n      reply,\n      shouldDisplayReply: Boolean(reply?.hasStarted || reply?.hasFinished),\n      shouldDisplayFollowUpForm: !llmError && Boolean(reply?.hasFinished),\n    },\n    actions: {\n      submitFollowupQuestion(question: string) {\n        reply.askFollowupQuestion(question);\n      },\n    },\n  };\n}\n","import { openai } from '@grafana/llm';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { buildSuggestionPrompts, model, SuggestionPromptInputs } from './buildLlmSuggestionPrompts';\n\ntype Messages = openai.Message[];\n\n// TODO(@petethepig): this is largely same function as useOpenAiChatCompletions, maybe we should merge them somehow\nexport function useOpenAiSuggestions(suggestionPromptInputs: SuggestionPromptInputs) {\n  const [reply, setReply] = useState('');\n  const [replyHasStarted, setReplyHasStarted] = useState(false);\n  const [replyHasFinished, setReplyHasFinished] = useState(false);\n  const [messages, setMessages] = useState<Messages>([]);\n  const [error, setError] = useState<Error | null>(null);\n\n  const sendMessages = useCallback((messagesToSend: Messages) => {\n    setMessages(messagesToSend);\n\n    setError(null);\n\n    setReply('');\n    setReplyHasStarted(true);\n    setReplyHasFinished(false);\n\n    const stream = openai\n      .streamChatCompletions({\n        model,\n        messages: messagesToSend,\n      })\n      .pipe(\n        // Accumulate the stream content into a stream of strings, where each\n        // element contains the accumulated message so far.\n        openai.accumulateContent()\n      );\n\n    stream.subscribe({\n      next: setReply,\n      error(e) {\n        setError(e);\n        setReplyHasStarted(false);\n        setReplyHasFinished(true);\n      },\n      complete() {\n        setReplyHasStarted(false);\n        setReplyHasFinished(true);\n      },\n    });\n  }, []);\n\n  const askFollowupQuestion = useCallback(\n    (question: string): void => {\n      const messagesToAdd: Messages = [\n        {\n          role: 'assistant',\n          content: reply,\n        },\n        {\n          role: 'user',\n          content: question,\n        },\n      ];\n\n      try {\n        sendMessages([...messages, ...messagesToAdd]);\n      } catch (error) {\n        setError(error as Error);\n      }\n    },\n    [messages, reply, sendMessages]\n  );\n\n  useEffect(() => {\n    if (messages.length > 0) {\n      return;\n    }\n\n    const prompts = buildSuggestionPrompts(suggestionPromptInputs);\n\n    try {\n      sendMessages([\n        {\n          role: 'system',\n          content: prompts.user,\n        },\n      ]);\n    } catch (error) {\n      setError(error as Error);\n    }\n  }, [messages.length, suggestionPromptInputs, sendMessages]);\n\n  return {\n    reply: {\n      text: reply,\n      hasStarted: replyHasStarted,\n      hasFinished: replyHasFinished,\n      messages: messages,\n      askFollowupQuestion,\n    },\n    error,\n  };\n}\n","import { css } from '@emotion/css';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport React from 'react';\n\nimport { AiReply } from '../../../../../../components/SceneAiPanel/components/AiReply';\nimport { FollowUpForm } from '../../../../../../components/SceneAiPanel/components/FollowUpForm';\nimport { SuggestionPromptInputs } from './domain/buildLlmSuggestionPrompts';\nimport { useAiSuggestionsPanel } from './domain/useAiSuggestionsPanel';\n\nconst getStyles = () => ({\n  title: css`\n    margin: -4px 0 4px 0;\n  `,\n  content: css``,\n});\n\ntype AiSuggestionsPanelProps = {\n  suggestionPromptInputs: SuggestionPromptInputs;\n};\n\nexport function AiSuggestionsPanel({ suggestionPromptInputs }: AiSuggestionsPanelProps) {\n  const styles = useStyles2(getStyles);\n  const { data, actions } = useAiSuggestionsPanel(suggestionPromptInputs);\n\n  return (\n    <>\n      <h6 className={styles.title}>Code Optimization Suggestions</h6>\n      <div className={styles.content}>\n        {data.isLoading && (\n          <>\n            <Spinner inline />\n            &nbsp;Analyzing...\n          </>\n        )}\n\n        {data.fetchError && (\n          <InlineBanner\n            severity=\"error\"\n            title=\"Error while fetching profiles!\"\n            message=\"Sorry for any inconvenience, please try again later.\"\n          />\n        )}\n\n        {data.llmError && (\n          <InlineBanner\n            severity=\"error\"\n            title=\"Failed to generate content using OpenAI!\"\n            error={data.llmError}\n            message=\"Sorry for any inconvenience, please try again later or if the problem persists, contact your organization admin.\"\n          />\n        )}\n\n        {data.shouldDisplayReply && <AiReply reply={data.reply} />}\n\n        {data.shouldDisplayFollowUpForm && <FollowUpForm onSubmit={actions.submitFollowupQuestion} />}\n      </div>\n    </>\n  );\n}\n","import { CallSiteProps, LineProfile } from '../../../domain/types/FunctionDetails';\n\nconst VERTICAL_LINES_PADDING = 5;\n\ntype CallSitesMap = Map<number, CallSiteProps>;\n\ninterface AnnotatedLines {\n  snippetLines: LineProfile[];\n  allLines: LineProfile[];\n}\n\nexport function annotatePlaceholderLines(callSitesMap: CallSitesMap): AnnotatedLines {\n  if (!callSitesMap.size) {\n    return {\n      snippetLines: [],\n      allLines: [],\n    };\n  }\n\n  const callSites = Array.from(callSitesMap.values()).sort((a, b) => a.line - b.line);\n\n  const firstLineIndex = Math.max(0, callSites[0].line - VERTICAL_LINES_PADDING - 1);\n  const lastLineIndex = callSites[callSites.length - 1].line + VERTICAL_LINES_PADDING + 1;\n\n  const annotatedSnippet = [];\n  for (let lineNumber = firstLineIndex + 1; lineNumber < lastLineIndex; lineNumber++) {\n    const callSite = callSitesMap.get(lineNumber);\n\n    annotatedSnippet.push({\n      line: undefined,\n      number: lineNumber,\n      cum: callSite?.cum ?? 0,\n      flat: callSite?.flat ?? 0,\n    });\n  }\n\n  // With no file contents, we return only a dummy annotated snippet which shows\n  // the appropriate line numbers, but no content.\n  return {\n    snippetLines: annotatedSnippet,\n    allLines: [],\n  };\n}\n\nexport function annotateLines(fileContent: string, callSitesMap: CallSitesMap): AnnotatedLines {\n  const callSites = Array.from(callSitesMap.values()).sort((a, b) => a.line - b.line);\n  const lines = fileContent.split('\\n');\n\n  const annotatedLines = lines.map((line, index) => {\n    const lineNumber = index + 1;\n    const callSite = callSitesMap.get(lineNumber);\n\n    return {\n      line,\n      number: lineNumber,\n      cum: callSite?.cum ?? 0,\n      flat: callSite?.flat ?? 0,\n    };\n  });\n\n  if (callSitesMap.size === 0) {\n    // If the call site map is empty, there's no snippet to render.\n    return {\n      snippetLines: [],\n      allLines: annotatedLines,\n    };\n  }\n\n  const firstLineIndex = Math.max(0, callSites[0].line - VERTICAL_LINES_PADDING - 1);\n  const lastLineIndex = Math.min(lines.length, callSites[callSites.length - 1].line + VERTICAL_LINES_PADDING);\n  const annotatedSnippet = annotatedLines.slice(firstLineIndex, lastLineIndex);\n\n  return {\n    snippetLines: annotatedSnippet,\n    allLines: annotatedLines,\n  };\n}\n","/**\n * Converts raw.githubusercontent.com URLS to github.com URLs.\n *\n * E.g. https://raw.githubusercontent.com/golang/go/master/src/runtime/netpoll_kqueue.go\n * needs to be to transformed to: https://github.com/{org}/{repo}/blob/{filepath}\n */\nexport function buildGithubUrlForFunction(url: string, startLine: unknown): string {\n  let newUrl = url;\n\n  const matches = url.match(/raw\\.githubusercontent\\.com\\/([^/]+)\\/([^/]+)\\/(.+)/);\n  if (matches) {\n    const [, org, repo, rest] = matches;\n    newUrl = `https://github.com/${org}/${repo}/blob/${rest}`;\n  }\n\n  if (startLine !== undefined && !url.includes('#')) {\n    // link to the specific line this function exists at\n    newUrl += `#L${startLine}`;\n  }\n\n  return newUrl;\n}\n","import { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { useMemo, useState } from 'react';\n\nimport { FunctionDetails, LineProfile } from '../../../domain/types/FunctionDetails';\nimport { useGitHubContext } from '../../GitHubContextProvider/useGitHubContext';\nimport { useFetchVCSFile } from '../infrastructure/useFetchVCSFile';\nimport { annotateLines, annotatePlaceholderLines } from './annotateLines';\nimport { buildGithubUrlForFunction } from './buildGithubUrlForFunction';\n\n/**\n * View model for Code component\n */\nexport type CodeLine = LineProfile & { line: string };\n\ntype CodeContainerDomainValue = DomainHookReturnValue & { data: { snippetLines: CodeLine[]; allLines: CodeLine[] } };\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function useCodeContainer(dataSourceUid: string, functionDetails: FunctionDetails): CodeContainerDomainValue {\n  const { isLoggedIn } = useGitHubContext();\n  const { version } = functionDetails;\n\n  const [openAiSuggestions, setOpenAiSuggestions] = useState<boolean>(false);\n\n  const {\n    fileInfo,\n    error: fetchError,\n    isFetching,\n  } = useFetchVCSFile({\n    enabled: isLoggedIn,\n    dataSourceUid,\n    localPath: functionDetails.fileName,\n    repository: version?.repository ?? '',\n    gitRef: version?.git_ref ?? '',\n    rootPath: version?.root_path ?? '',\n    functionName: functionDetails.name ?? '',\n  });\n\n  // might be a bit costly so we memoize it\n  const { snippetLines, allLines } = useMemo(\n    () =>\n      fileInfo?.content\n        ? annotateLines(fileInfo.content, functionDetails.callSites)\n        : annotatePlaceholderLines(functionDetails.callSites),\n    [fileInfo?.content, functionDetails.callSites]\n  );\n\n  return {\n    data: {\n      fetchError,\n      openAiSuggestions,\n      isLoadingCode: isFetching,\n      unit: functionDetails.unit,\n      githubUrl: fileInfo?.URL ? buildGithubUrlForFunction(fileInfo.URL, functionDetails.startLine) : undefined,\n      snippetLines: snippetLines.map((annotatedLine) => ({ ...annotatedLine, line: annotatedLine.line ?? '???' })),\n      allLines: allLines.map((annotateLine) => ({ ...annotateLine, line: annotateLine.line ?? '???' })),\n      noCodeAvailable: Boolean(fetchError) || !allLines.some((line) => line.line),\n    },\n    actions: {\n      setOpenAiSuggestions,\n    },\n  };\n}\n","import { useQuery } from '@tanstack/react-query';\n\nimport { DataSourceProxyClientBuilder } from '../../../../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { PrivateVcsClient } from '../../GitHubContextProvider/infrastructure/PrivateVcsClient';\n\ntype FetchParams = {\n  enabled: boolean;\n  dataSourceUid: string;\n  repository: string;\n  gitRef: string;\n  localPath: string;\n  rootPath: string;\n  functionName: string;\n};\n\ntype FetchResponse = {\n  isFetching: boolean;\n  error: Error | null;\n  fileInfo?: {\n    content: string;\n    URL: string;\n  };\n};\n\nexport function useFetchVCSFile({\n  enabled,\n  dataSourceUid,\n  repository,\n  gitRef,\n  localPath,\n  rootPath,\n  functionName,\n}: FetchParams): FetchResponse {\n  const privateVcsClient = DataSourceProxyClientBuilder.build(dataSourceUid, PrivateVcsClient);\n  const { isFetching, error, data } = useQuery({\n    enabled: Boolean(enabled && repository && (localPath || functionName)),\n    queryKey: ['vcs-file', repository, gitRef, localPath, rootPath, functionName],\n    queryFn: () =>\n      privateVcsClient\n        .getFile(repository, gitRef, localPath, rootPath, functionName)\n        .then((code) => ({\n          content: code.content,\n          URL: code.URL,\n        }))\n        .then((json) => ({ URL: json.URL, content: atob(json.content) })),\n  });\n\n  return {\n    isFetching,\n    error: privateVcsClient.isAbortError(error) ? null : error,\n    fileInfo: data,\n  };\n}\n","import { getValueFormat, ValueFormatter } from '@grafana/data';\n\ntype FormatUnit = 'nanoseconds' | 'microseconds' | 'milliseconds' | 'seconds' | 'count' | string;\n\nexport function buildUnitFormatter(unit: FormatUnit): ValueFormatter {\n  switch (unit) {\n    case 'nanoseconds':\n      return getValueFormat('ns');\n    case 'microseconds':\n      return getValueFormat('s');\n    case 'milliseconds':\n      return getValueFormat('ms');\n    case 'seconds':\n      return getValueFormat('s');\n    case 'count':\n      return getValueFormat('short');\n    default:\n      return getValueFormat(unit);\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { LinkButton, Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { AIButton } from '../../../../../../../components/SceneAiPanel/components/AiButton/AIButton';\nimport { buildUnitFormatter } from '../../../domain/buildUnitFormatter';\nimport { CodeLine } from '../domain/useCodeContainer';\n\ntype CodeProps = {\n  lines: CodeLine[];\n  unit: string;\n  githubUrl?: string;\n  isLoadingCode: boolean;\n  noCodeAvailable: boolean;\n  onOptimizeCodeClick: () => void;\n};\n\nexport const Code = ({ lines, unit, githubUrl, isLoadingCode, noCodeAvailable, onOptimizeCodeClick }: CodeProps) => {\n  const styles = useStyles2(getStyles);\n\n  const fmt = buildUnitFormatter(unit);\n  const formatValue = (n: number): string => {\n    if (n <= 0) {\n      return '.';\n    }\n\n    const formatted = fmt(n);\n    if (!formatted.suffix) {\n      return formatted.text;\n    }\n    return formatted.text + formatted.suffix;\n  };\n\n  // TODO: memoize\n  // Trim common indent prefixes from each line, if possible. This prevents us\n  // from rendering deeply indented code where the user would have to\n  // immediately scroll right to read the code.\n  trimIndentPrefix(lines);\n\n  // TODO: move to useCodeContainer()?\n  const [sumSelf, sumTotal] = lines.reduce(\n    ([accSelf, accTotal], { flat, cum }) => [accSelf + flat, accTotal + cum],\n    [0, 0]\n  );\n\n  return (\n    <div data-testid=\"function-details-code-container\">\n      <div className={styles.container}>\n        <div className={styles.header}>\n          <div className={styles.breakdownLabel}>\n            <h6>Breakdown per line</h6>\n            <span>\n              {isLoadingCode && <Spinner inline />}\n              {!isLoadingCode && noCodeAvailable && '(file information unavailable)'}\n            </span>\n          </div>\n\n          <div className={styles.buttons}>\n            <LinkButton\n              disabled={Boolean(isLoadingCode || !githubUrl)}\n              href={githubUrl}\n              target=\"_blank\"\n              icon=\"github\"\n              fill=\"text\"\n            >\n              View on GitHub\n            </LinkButton>\n\n            <AIButton\n              onClick={onOptimizeCodeClick}\n              disabled={isLoadingCode || noCodeAvailable}\n              interactionName=\"g_pyroscope_app_optimize_code_clicked\"\n            >\n              Optimize Code\n            </AIButton>\n          </div>\n        </div>\n      </div>\n\n      <pre className={styles.codeBlock} data-testid=\"function-details-code\">\n        <div className={cx(styles.highlighted, styles.codeBlockHeader)}>\n          {formatLine('Total:', formatValue(sumSelf), formatValue(sumTotal), ' (self, total)')}\n        </div>\n        {lines.map(({ line, number, cum: total, flat: self }) => (\n          <div key={line + number + total + self} className={self + total > 0 ? styles.highlighted : ''}>\n            {\n              // The space after `number` is relevant. It aligns the line\n              // number with the `Total:` header to mimic the pprof tool.\n              formatLine(`${number} `, formatValue(self), formatValue(total), line)\n            }\n          </div>\n        ))}\n      </pre>\n    </div>\n  );\n};\n\nconst formatLine = (lineNumber: string, self: string, total: string, rest?: string): string => {\n  // The length of each column is important. In order for tabs to render to\n  // their full width, the length of all the column widths must be one less than\n  // a multiple of 8.\n  const cols = lineNumber.padStart(7, ' ') + self.padStart(12, ' ') + total.padStart(12, ' ');\n\n  if (!rest) {\n    return cols;\n  }\n  return `${cols} ${rest}`;\n};\n\nconst trimIndentPrefix = (lines: CodeLine[]) => {\n  if (lines.length === 0) {\n    return;\n  }\n\n  let commonPrefix = getIndentPrefix(lines[0].line);\n  for (let i = 1; i < lines.length; i++) {\n    const { line } = lines[i];\n    if (line.trim() === '') {\n      // Don't count blank lines or lines with only whitespace.\n      continue;\n    }\n\n    const prefix = getIndentPrefix(line);\n    commonPrefix = longestCommonPrefix(commonPrefix, prefix);\n  }\n\n  if (!commonPrefix) {\n    // No common prefixes were found.\n    return;\n  }\n\n  // Trim the common prefix.\n  for (let i = 0; i < lines.length; i++) {\n    lines[i].line = lines[i].line.substring(commonPrefix.length);\n  }\n};\n\nconst getIndentPrefix = (text: string): string => {\n  const matches = text.match(/^[ \\t]*/);\n  return matches?.[0] ?? '';\n};\n\nconst longestCommonPrefix = (a: string, b: string): string => {\n  let prefixLen = 0;\n  for (let i = 0; i < Math.min(a.length, b.length); i++) {\n    if (a[i] !== b[i]) {\n      break;\n    }\n\n    prefixLen++;\n  }\n  return a.substring(0, prefixLen);\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    width: 100%;\n  `,\n  header: css`\n    display: flex;\n    justify-content: space-between;\n    align-items: end;\n    width: 100%;\n  `,\n  breakdownLabel: css`\n    & > h6 {\n      display: inline-block;\n      margin-top: ${theme.spacing(1)};\n    }\n\n    & > span {\n      margin-left: ${theme.spacing(1)};\n      font-size: ${theme.typography.bodySmall.fontSize};\n    }\n\n    & > svg {\n      margin-left: ${theme.spacing(1)};\n    }\n  `,\n  buttons: css`\n    display: flex;\n    flex-wrap: no-wrap;\n  `,\n  codeBlock: css`\n    position: relative;\n    min-height: 240px;\n    font-size: 12px;\n    overflow-x: auto;\n    white-space: pre;\n    color: ${theme.colors.text.secondary};\n  `,\n  highlighted: css`\n    color: ${theme.colors.text.maxContrast};\n  `,\n  codeBlockHeader: css`\n    margin-bottom: 8px;\n  `,\n});\n","import { displayError } from '@shared/domain/displayStatus';\nimport { HttpClientError } from '@shared/infrastructure/http/HttpClientError';\nimport React from 'react';\n\nimport { FunctionDetails } from '../../domain/types/FunctionDetails';\nimport { AiSuggestionsPanel } from '../AiSuggestionsPanel/AiSuggestionsPanel';\nimport { useCodeContainer } from './domain/useCodeContainer';\nimport { Code } from './ui/Code';\n\ntype CodeContainerProps = {\n  dataSourceUid: string;\n  functionDetails: FunctionDetails;\n};\n\nexport function CodeContainer({ dataSourceUid, functionDetails }: CodeContainerProps) {\n  const { data, actions } = useCodeContainer(dataSourceUid, functionDetails);\n\n  if (data.fetchError && (data.fetchError as HttpClientError)?.response?.status !== 404) {\n    displayError(data.fetchError, ['Failed to fetch file information!', (data.fetchError as Error).message]);\n  }\n\n  return (\n    <>\n      <Code\n        lines={data.snippetLines}\n        unit={data.unit}\n        githubUrl={data.githubUrl}\n        isLoadingCode={data.isLoadingCode}\n        noCodeAvailable={data.noCodeAvailable}\n        onOptimizeCodeClick={() => {\n          actions.setOpenAiSuggestions(true);\n          document.getElementById('ai-suggestions-panel')?.scrollIntoView({\n            behavior: 'smooth',\n          });\n        }}\n      />\n      <h6 id=\"ai-suggestions-panel\" style={{ height: 0, marginBottom: 0 }}></h6>\n      {data.openAiSuggestions ? (\n        <AiSuggestionsPanel\n          suggestionPromptInputs={{\n            functionDetails: functionDetails,\n            lines: data.allLines,\n          }}\n        />\n      ) : null}\n    </>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Icon, IconButton, Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { useGitHubContext } from './GitHubContextProvider/useGitHubContext';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  ellipsis: css`\n    color: ${theme.colors.primary.text};\n    text-overflow: ellipsis;\n    overflow: hidden;\n    direction: rtl;\n    white-space: nowrap;\n  `,\n});\n\ntype GitHubRepositoryProps = {\n  enableIntegration: boolean;\n  repository: {\n    name: string;\n    commitUrl: string;\n    commitName: string;\n  };\n};\n\nexport const GitHubRepository = ({ enableIntegration, repository }: GitHubRepositoryProps) => {\n  const styles = useStyles2(getStyles);\n  const { isLoginInProgress, isLoggedIn, login, logout } = useGitHubContext();\n\n  if (!enableIntegration) {\n    return <>-</>;\n  }\n\n  // enableIntegration=true\n  if (isLoginInProgress) {\n    return (\n      <>\n        <Spinner />\n        <span>Connecting to GitHub...</span>\n      </>\n    );\n  }\n\n  // enableIntegration=true, isLoginInProgress=false\n  if (!isLoggedIn) {\n    return (\n      <Button\n        icon=\"github\"\n        variant=\"primary\"\n        onClick={login}\n        tooltip=\"Once connected, the GitHub code will be accessible only from this browser session.\"\n        tooltipPlacement=\"top\"\n      >\n        Connect to {repository.name}\n      </Button>\n    );\n  }\n\n  // enableIntegration=true, isLoginInProgress=false, isLoggedIn=true\n  return (\n    <>\n      <Icon name=\"github\" size=\"lg\" />\n      <a className={styles.ellipsis} href={repository.commitUrl} target=\"_blank\" rel=\"noreferrer\" title=\"View commit\">\n        <Icon name=\"external-link-alt\" />\n        &nbsp;\n        {repository.commitName}\n      </a>\n      <IconButton\n        name=\"signout\"\n        onClick={() => logout()}\n        aria-label=\"Disconnect from GitHub\"\n        title=\"Disconnect from GitHub\"\n      />\n    </>\n  );\n};\n","import { Commit, FunctionDetails } from './types/FunctionDetails';\n\nexport type CommitWithSamples = Commit & {\n  samples: {\n    unit: string;\n    current: number;\n    total: number;\n  };\n};\n\nexport function getCommitsWithSamples(functionsDetails: FunctionDetails[], totalSamples: number): CommitWithSamples[] {\n  const commits = functionsDetails.map((details) => ({\n    ...details.commit,\n    samples: {\n      unit: details.unit ?? 'count',\n      current: Array.from(details.callSites.values()).reduce((acc, { cum }) => acc + cum, 0),\n      total: totalSamples,\n    },\n  }));\n\n  return commits;\n}\n","export const GITHUB_URL = 'https://github.com/';\n\nexport const isGitHubRepository = (repositoryUrl: string): boolean => repositoryUrl.startsWith(GITHUB_URL);\n","import { GITHUB_URL } from './isGitHubRepository';\nimport { FunctionVersion } from './types/FunctionDetails';\n\nexport function getRepositoryDetails(isGitHub: boolean, functionVersion?: FunctionVersion) {\n  if (!functionVersion?.repository) {\n    return null;\n  }\n\n  const url = functionVersion.repository;\n  const name = url.replace(GITHUB_URL, '');\n  const gitRef = functionVersion.git_ref;\n\n  return {\n    isGitHub,\n    url,\n    name,\n    commitUrl: gitRef ? `${url}/commit/${gitRef}` : url,\n    commitName: gitRef ? `${name}@${gitRef.substring(0, 7)}` : name,\n  };\n}\n","import { Function, Line, Location, Mapping, PprofProfile, Sample } from '@shared/types/PprofProfile';\n\nimport { PLACEHOLDER_COMMIT_DATA } from '../components/GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { CallSiteProps, FunctionDetails } from './types/FunctionDetails';\n\nconst buildDetails = (profile: PprofProfile, func: Function, mapping?: Mapping) => {\n  let version;\n\n  try {\n    version = mapping ? JSON.parse(profile.stringTable[Number(mapping.buildId)]) : undefined;\n  } catch {}\n\n  return {\n    name: profile.stringTable[Number(func.name)],\n    version,\n    startLine: !Number.isNaN(Number(func.startLine)) ? Number(func.startLine) : undefined,\n    fileName: profile.stringTable[Number(func.filename)],\n    callSites: new Map<number, CallSiteProps>(),\n    unit: profile.stringTable[Number(profile.sampleType[0].unit)],\n    commit: PLACEHOLDER_COMMIT_DATA,\n  };\n};\n\n// sums up the value for a particular callsite\nfunction addCallSiteValue(details: FunctionDetails, line: Line, value: number, index: number): FunctionDetails {\n  const lineNumber = Number(line.line);\n  const callSite = details.callSites.get(lineNumber) || {\n    line: Number(line.line),\n    flat: 0,\n    cum: 0,\n  };\n\n  // if the function we're interested in is at the leaf node (index=0), we have its flat value...\n  const flat = index === 0 ? value : 0; // value of the location itself\n\n  // ...if not, that's its cum value\n  // locations above the leaf node don't contribute to the sample value (their self is 0)\n  // this is what the API returns\n  const cum = value; // value of the location plus all its descendants\n\n  callSite.flat += flat;\n  callSite.cum += cum;\n\n  details.callSites.set(lineNumber, callSite);\n\n  return details;\n}\n\n// This reimplements functionality simliar to the upstream project:\n// https://github.com/google/pprof/blob/997b0b79cac0f8c2f2566c506212de67a6edc5ff/internal/report/source.go#L318\nfunction convertSample(\n  fnName: string,\n  profile: PprofProfile,\n  locations: Map<string, Location>,\n  functions: Map<string, Function>,\n  mappings: Map<string, Mapping>,\n  sample: Sample,\n  versions: Map<string, FunctionDetails>\n) {\n  const locationIdSet = new Set();\n\n  sample.locationId.forEach((locationId, index) => {\n    const location = locations.get(locationId);\n    if (!location) {\n      return;\n    }\n\n    location.line.forEach((line) => {\n      const func = functions.get(line.functionId);\n      if (!func) {\n        return;\n      }\n\n      if (profile.stringTable[Number(func.name)] !== fnName) {\n        return;\n      }\n\n      // https://github.com/google/pprof/blob/main/doc/README.md#details\n      if (locationIdSet.has(locationId)) {\n        return;\n      }\n\n      locationIdSet.add(locationId);\n\n      const details = versions.get(location.mappingId) || buildDetails(profile, func, mappings.get(location.mappingId));\n\n      versions.set(location.mappingId, addCallSiteValue(details, line, Number(sample.value[0]), index));\n    });\n  });\n}\n\nexport function convertPprofToFunctionDetails(fnName: string, profile: PprofProfile): FunctionDetails[] {\n  const versions = new Map<string, FunctionDetails>();\n\n  const locations = new Map(profile.location?.map((l) => [l.id, l]));\n  const functions = new Map(profile.function?.map((f) => [f.id, f]));\n  const mappings = new Map(profile.mapping?.map((m) => [m.id, m]));\n\n  profile.sample\n    // Sometimes a sample may not have a stack trace associated with it. This\n    // may be a bug in the Pyroscope API or it may be an idiosyncrasy of the pprof format.\n    // While it may cause some counting errors, let's skip these for now.\n    ?.filter((sample) => sample.locationId !== undefined)\n    .forEach((sample) => convertSample(fnName, profile, locations, functions, mappings, sample, versions));\n\n  return Array.from(versions.values());\n}\n","import { DataSourceProxyClientBuilder } from '../../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { PrivateVcsClient } from '../components/GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { FunctionDetails, FunctionVersion } from '../domain/types/FunctionDetails';\n\nexport async function fetchCommitsInfo(\n  dataSourceUid: string,\n  functionsDetails: FunctionDetails[],\n  defaultFunctionVersion: FunctionVersion\n): Promise<FunctionDetails[]> {\n  const privateVcsClient = DataSourceProxyClientBuilder.build(dataSourceUid, PrivateVcsClient);\n\n  const commits = functionsDetails.map((details) => ({\n    repositoryUrl: details?.version?.repository || defaultFunctionVersion.repository,\n    gitRef: details?.version?.git_ref || defaultFunctionVersion.git_ref,\n    rootPath: details?.version?.root_path || defaultFunctionVersion.root_path,\n  }));\n\n  // TODO: extract to its own hook and simplify useSceneFunctionDetailsPanel()?\n  const commitsInfo = await privateVcsClient.getCommits(commits);\n\n  commitsInfo.forEach((commit, i) => {\n    functionsDetails[i].commit = commit;\n  });\n\n  return functionsDetails;\n}\n","import { FunctionDetails } from '../../domain/types/FunctionDetails';\n\nexport const getTotalSum = (fd: FunctionDetails): number =>\n  Array.from(fd.callSites.values()).reduce((acc, { cum }) => acc + cum, 0);\n","import { FunctionDetails } from '../../domain/types/FunctionDetails';\nimport { getTotalSum } from './getTotalSum';\n\nexport const sortByTotal = (a: FunctionDetails, b: FunctionDetails) => getTotalSum(b) - getTotalSum(a);\n","import { TimeRange } from '@grafana/data';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\nimport { useQuery } from '@tanstack/react-query';\nimport { useMemo } from 'react';\n\nimport { DataSourceProxyClientBuilder } from '../../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { PprofApiClient } from '../../../infrastructure/PprofApiClient';\nimport { PLACEHOLDER_COMMIT_DATA } from '../components/GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { useGitHubContext } from '../components/GitHubContextProvider/useGitHubContext';\nimport { convertPprofToFunctionDetails } from '../domain/convertPprofToFunctionDetails';\nimport { useFunctionVersion } from '../domain/FunctionVersionContext';\nimport { FunctionDetails, FunctionVersion } from '../domain/types/FunctionDetails';\nimport { fetchCommitsInfo } from './fetchCommitsInfo';\nimport { sortByTotal } from './helpers/sortByTotal';\n\ntype FetchParams = {\n  dataSourceUid: string;\n  query: string;\n  timeRange: TimeRange;\n  stackTrace: string[];\n};\n\ntype FetchResponse = {\n  isFetching: boolean;\n  error: Error | null;\n  functionsDetails: FunctionDetails[];\n};\n\n// We don't expect more than 500 nodes after the selected node.\n// This will avoid downloading too much data by removing leaf nodes.\n// TODO: This could be a setting in the UI.\nconst MAX_NODES = 500;\n\nconst DEFAULT_FUNCTION_VERSION: FunctionVersion = {\n  repository: '',\n  git_ref: 'HEAD',\n  root_path: '',\n};\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function useFetchFunctionsDetails({ dataSourceUid, query, timeRange, stackTrace }: FetchParams): FetchResponse {\n  const { profileMetricId, labelsSelector, serviceId } = parseQuery(query);\n  const [start, end] = [timeRange.from.unix(), timeRange.to.unix()];\n  const { isLoggedIn: isGitHubLogged } = useGitHubContext();\n\n  const pprofApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, PprofApiClient);\n\n  // Get the default function version for the service including provided overrides\n  const { functionVersion: defaultFunctionVersion } = useFunctionVersion(\n    dataSourceUid,\n    serviceId,\n    DEFAULT_FUNCTION_VERSION\n  );\n\n  const {\n    isFetching,\n    error: queryError,\n    data,\n  } = useQuery({\n    enabled: Boolean(profileMetricId && labelsSelector && stackTrace.length > 0 && start > 0 && end > 0),\n    // eslint-disable-next-line @tanstack/query/exhaustive-deps\n    queryKey: [\n      'function-details',\n      profileMetricId,\n      labelsSelector,\n      start,\n      end,\n      stackTrace,\n      isGitHubLogged,\n      defaultFunctionVersion,\n    ],\n    queryFn: async () => {\n      const pprof = await pprofApiClient.selectMergeProfileJson({\n        profileMetricId,\n        labelsSelector,\n        start,\n        end,\n        stackTrace,\n        maxNodes: MAX_NODES,\n      });\n\n      const functionsDetails = convertPprofToFunctionDetails(stackTrace[stackTrace.length - 1], pprof).sort(\n        sortByTotal\n      );\n\n      return isGitHubLogged\n        ? fetchCommitsInfo(dataSourceUid, functionsDetails, defaultFunctionVersion || DEFAULT_FUNCTION_VERSION)\n        : functionsDetails;\n    },\n  });\n\n  const functionsDetails = useMemo(\n    () =>\n      data?.length\n        ? data\n        : [\n            {\n              name: stackTrace.at(-1) as string,\n              startLine: undefined,\n              fileName: '',\n              callSites: new Map(),\n              unit: '',\n              commit: PLACEHOLDER_COMMIT_DATA,\n            },\n          ],\n    [data, stackTrace]\n  );\n\n  return {\n    isFetching,\n    error: pprofApiClient.isAbortError(queryError) ? null : queryError,\n    functionsDetails,\n  };\n}\n","// Array reprsenting one minute, hour, day, week, month, etc in seconds\nconst CUTOFFS = [60, 3600, 86400, 86400 * 7, 86400 * 30, 86400 * 365, Infinity];\n\n// Array equivalent to the above but in the string representation of the units\nconst UNITS: Intl.RelativeTimeFormatUnit[] = ['second', 'minute', 'hour', 'day', 'week', 'month', 'year'];\n\n// Intl.RelativeTimeFormat do its magic\nconst RTF = new Intl.RelativeTimeFormat('en-US', { numeric: 'auto' });\n\n/**\n * Convert a date to a relative time string, such as \"a minute ago\", \"in 2 hours\", \"yesterday\", \"3 months ago\", etc.\n *\n * Adapted from https://www.builder.io/blog/relative-time\n */\nexport function getRelativeTimeString(date: Date): string {\n  const timeMs = date.getTime();\n\n  // Get the amount of seconds between the given date and now\n  const deltaSeconds = Math.round((timeMs - Date.now()) / 1000);\n\n  // Grab the ideal cutoff unit\n  const unitIndex = CUTOFFS.findIndex((cutoff) => cutoff > Math.abs(deltaSeconds));\n\n  // Get the divisor to divide from the seconds. E.g. if our unit is \"day\" our divisor\n  // is one day in seconds, so we can divide our seconds by this to get the # of days\n  const divisor = unitIndex ? CUTOFFS[unitIndex - 1] : 1;\n\n  // Intl.RelativeTimeFormat do its magic\n  return RTF.format(Math.floor(deltaSeconds / divisor), UNITS[unitIndex]);\n}\n","import { getRelativeTimeString } from './getRelativeTimeString';\n\nconst DTF = new Intl.DateTimeFormat('en-US', {\n  year: 'numeric',\n  month: 'long',\n  day: '2-digit',\n});\n\nexport function formatCommitDate(commitDate?: Date) {\n  return commitDate ? `${DTF.format(commitDate)} (${getRelativeTimeString(commitDate)})` : '?';\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { buildUnitFormatter } from '../domain/buildUnitFormatter';\nimport { formatCommitDate } from '../domain/formatCommitDate';\nimport { CommitWithSamples } from '../domain/getCommitsWithSamples';\nimport { getCommitShortMessage, getCommitShortSha } from './CommitSelect';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n  `,\n  firstLine: css`\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 1em;\n  `,\n  sha: css`\n    font-family: monospace;\n  `,\n  sample: css`\n    font-size: 12px;\n  `,\n  secondLine: css`\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    font-size: 12px;\n    color: ${theme.colors.text.secondary};\n  `,\n  avatar: css`\n    display: inline-block;\n    margin-right: 4px;\n    border-radius: 50%;\n    background: grey;\n    width: 16px;\n    height: 16px;\n  `,\n  message: css`\n    font-size: 12px;\n    color: ${theme.colors.text.secondary};\n  `,\n});\n\ntype CommitOptionProps = {\n  commit: CommitWithSamples;\n};\n\nexport function CommitOption({ commit }: CommitOptionProps) {\n  const styles = useStyles2(getStyles);\n\n  const { author, samples } = commit;\n\n  const commitAuthor = author.login;\n  const commitAuthorAvatarUrl = author.avatarURL;\n\n  const total = buildUnitFormatter(samples.unit)(samples.current);\n  const samplePercent = Math.round((samples.current / samples.total) * 100);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.firstLine}>\n        <span className={styles.sha}>{getCommitShortSha(commit.sha)}</span>\n        <span className={styles.sample}>\n          {total.text}\n          {total.suffix} ({samplePercent}%)\n        </span>\n      </div>\n\n      <div className={styles.secondLine}>\n        {commitAuthorAvatarUrl && <img className={styles.avatar} src={commitAuthorAvatarUrl} alt={commitAuthor} />}\n        <span>\n          {commitAuthor} on {formatCommitDate(commit.date)}\n        </span>\n      </div>\n\n      <span className={styles.message}>{getCommitShortMessage(commit.message)}</span>\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { Commit } from '../domain/types/FunctionDetails';\nimport { getCommitShortMessage, getCommitShortSha } from './CommitSelect';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n    gap: 1em;\n  `,\n  sha: css`\n    font-family: monospace;\n  `,\n  message: css`\n    color: ${theme.colors.text.secondary};\n  `,\n});\n\ntype CommitOptionSelectedProps = {\n  commit: Commit;\n};\n\nexport function CommitOptionSelected({ commit }: CommitOptionSelectedProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <span className={styles.sha}>{getCommitShortSha(commit.sha)}</span>\n      <div className={styles.message}>\n        <span>{getCommitShortMessage(commit.message)}</span>\n      </div>\n    </div>\n  );\n}\n","import { SelectableValue } from '@grafana/data';\nimport { FormatOptionLabelMeta, Select } from '@grafana/ui';\nimport React from 'react';\n\nimport { PLACEHOLDER_COMMIT_DATA } from '../components/GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { CommitWithSamples } from '../domain/getCommitsWithSamples';\nimport { CommitOption } from './CommitOption';\nimport { CommitOptionSelected } from './CommitOptionSelected';\n\ntype CommitSelectProps = {\n  commits: CommitWithSamples[];\n  selectedCommit: CommitWithSamples;\n  onChange: (commit: CommitWithSamples) => void;\n};\n\nexport function CommitSelect({ commits, selectedCommit, onChange }: CommitSelectProps) {\n  return (\n    <Select\n      options={commits.map((commit) => ({\n        label: commit.sha,\n        value: commit,\n      }))}\n      value={{\n        label: selectedCommit.sha,\n        value: selectedCommit,\n      }}\n      hideSelectedOptions\n      isSearchable={false}\n      noOptionsMessage=\"No commits found\"\n      formatOptionLabel={formatOption}\n      onChange={(item) => {\n        if (item.value) {\n          onChange(item.value);\n        }\n      }}\n    />\n  );\n}\n\nfunction formatOption(\n  item: SelectableValue<CommitWithSamples>,\n  formatOptionMeta: FormatOptionLabelMeta<CommitWithSamples>\n) {\n  const { value: commit } = item;\n\n  if (!commit) {\n    return null;\n  }\n\n  const isSelected = formatOptionMeta.selectValue[0]?.value === commit;\n\n  return isSelected ? <CommitOptionSelected commit={commit} /> : <CommitOption commit={commit} />;\n}\n\nexport const getCommitShortSha = (sha: string): string => {\n  return sha === PLACEHOLDER_COMMIT_DATA.sha ? sha : sha.substring(0, 7);\n};\n\nexport const getCommitShortMessage = (message: string): string => {\n  return message.split('\\n')[0];\n};\n","import { Alert, Icon, TextLink } from '@grafana/ui';\nimport React from 'react';\n\ntype GitHubIntegrationBannerProps = {\n  onDismiss: () => void;\n};\n\nexport const GitHubIntegrationBanner = ({ onDismiss }: GitHubIntegrationBannerProps) => {\n  return (\n    <Alert severity=\"info\" title=\"Integrate with Github\" buttonContent=\"Dismiss\" onRemove={onDismiss}>\n      <p>\n        This language supports integration with <Icon name=\"github\" /> GitHub.\n      </p>\n      <p>\n        To activate this feature, you will need to add two new labels when sending profiles{' '}\n        <code>service_repository</code> and <code>service_git_ref</code>.{' '}\n      </p>\n      <p>\n        They should respectively be set to the full repository GitHub URL and the current{' '}\n        <TextLink href=\"https://docs.github.com/en/rest/git/refs?apiVersion=2022-11-28#about-git-references\" external>\n          git ref\n        </TextLink>{' '}\n        of the running service.\n      </p>\n      <Icon name=\"document-info\" />{' '}\n      <TextLink\n        href=\"https://grafana.com/docs/grafana-cloud/monitor-applications/profiles/pyroscope-github-integration/\"\n        external\n      >\n        Learn more\n      </TextLink>\n    </Alert>\n  );\n};\n","import { Spinner } from '@grafana/ui';\nimport React, { memo } from 'react';\n\ntype InlineSpinnerProps = {\n  isLoading: boolean;\n  children: React.ReactNode;\n};\n\nfunction InlineSpinnerComponent({ isLoading, children }: InlineSpinnerProps) {\n  return isLoading ? <Spinner inline /> : <>{children}</>;\n}\n\nexport const InlineSpinner = memo(InlineSpinnerComponent);\n","import { DataSourcePicker } from '@grafana/runtime';\nimport { Alert, Button, ConfirmButton, Field, Input, Modal, Stack, Text } from '@grafana/ui';\nimport React from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { FunctionVersionOrigin } from '../domain/FunctionVersionContext';\nimport { FunctionVersion } from '../domain/types/FunctionDetails';\n\ntype Props = {\n  serviceName: string;\n  datasourceName: string;\n  datasourceUid: string;\n  version?: FunctionVersion;\n  functionVersionOrigin?: FunctionVersionOrigin;\n  saveOverrides: (datasourceUid: string, serviceName: string, version: FunctionVersion) => void;\n  deleteOverride: (datasourceUid: string, serviceName: string) => void;\n  deleteAllOverrides: () => void;\n};\n\nexport const OverrideRepositoryDetailsButton = (props: Props) => {\n  const { serviceName, version, datasourceUid, saveOverrides, functionVersionOrigin } = props;\n  const [open, setOpen] = React.useState(false);\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n    reset,\n  } = useForm<FunctionVersion>({ mode: 'onChange' });\n\n  const onSubmit = (data: FunctionVersion) => {\n    saveOverrides(datasourceUid, serviceName, {\n      repository: data.repository,\n      git_ref: data.git_ref || 'HEAD',\n      root_path: data.root_path || '',\n    });\n    setOpen(false);\n  };\n\n  return (\n    <>\n      <Button\n        aria-label=\"override repository settings\"\n        variant=\"secondary\"\n        fill=\"text\"\n        size=\"sm\"\n        icon=\"pen\"\n        onClick={() => {\n          setOpen(true);\n          reset(version);\n        }}\n      >\n        {functionVersionOrigin === FunctionVersionOrigin.USER ? (\n          <Text element=\"span\" color=\"secondary\">\n            (user set)\n          </Text>\n        ) : (\n          ''\n        )}\n      </Button>\n      {open && (\n        <Modal\n          title={\n            functionVersionOrigin === FunctionVersionOrigin.USER\n              ? 'Edit repository details override'\n              : 'Add new repository details override'\n          }\n          isOpen={open}\n          onDismiss={() => setOpen(false)}\n        >\n          <form onSubmit={handleSubmit(onSubmit)}>\n            <Alert severity=\"info\" title=\"Github Integration labels\">\n              <p>\n                To activate GitHub Integration feature, you will need to add two new labels when sending profiles:\n                <code>service_repository</code> and <code>service_git_ref</code>.\n              </p>\n              <p>\n                For debugging purposes, you can manually provide repository details using this form. The custom value is\n                saved in your browser local storage for given data source and service name.\n              </p>\n            </Alert>\n\n            <Field label=\"Data source\">\n              <DataSourcePicker current={datasourceUid} disabled={true}></DataSourcePicker>\n            </Field>\n            <Field label=\"Service name\">\n              <Input disabled={true} value={serviceName}></Input>\n            </Field>\n\n            <Field\n              label=\"service_repository (repository URL) - required\"\n              invalid={!!errors.repository}\n              error={errors?.repository?.message?.toString()}\n            >\n              <Input\n                {...register('repository', { required: 'Repository name is required' })}\n                placeholder=\"Enter GitHub repo name, https://github.com/org/repo\"\n              />\n            </Field>\n            <Field\n              label=\"service_git_ref (commit reference)\"\n              invalid={!!errors.git_ref}\n              error={errors?.git_ref?.message?.toString()}\n            >\n              <Input {...register('git_ref')} placeholder=\"HEAD\" />\n            </Field>\n            <Field label=\"Path to root\">\n              <Input {...register('root_path')} placeholder=\"Enter root path\" />\n            </Field>\n\n            <Stack direction=\"row\">\n              <Button type=\"submit\">{functionVersionOrigin === FunctionVersionOrigin.USER ? 'Edit' : 'Add'}</Button>\n              {functionVersionOrigin === FunctionVersionOrigin.USER && (\n                <Button\n                  type=\"button\"\n                  variant=\"destructive\"\n                  onClick={() => {\n                    props.deleteOverride(datasourceUid, serviceName);\n                    reset();\n                    setOpen(false);\n                  }}\n                >\n                  Delete override\n                </Button>\n              )}\n              <ConfirmButton\n                confirmVariant=\"destructive\"\n                confirmText=\"Remove all\"\n                onConfirm={() => {\n                  props.deleteAllOverrides();\n                  reset();\n                  setOpen(false);\n                }}\n              >\n                Remove all overrides\n              </ConfirmButton>\n            </Stack>\n          </form>\n        </Modal>\n      )}\n    </>\n  );\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { IconButton, InlineLabel, TextLink, Tooltip, useStyles2 } from '@grafana/ui';\nimport { displaySuccess } from '@shared/domain/displayStatus';\nimport { userStorage } from '@shared/infrastructure/userStorage';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport { Panel } from '@shared/ui/Panel/Panel';\nimport React, { useMemo, useState } from 'react';\n\nimport { useBuildPyroscopeQuery } from '../../../../domain/useBuildPyroscopeQuery';\nimport { ProfilesDataSourceVariable } from '../../../../domain/variables/ProfilesDataSourceVariable';\nimport { getSceneVariableValue } from '../../../../helpers/getSceneVariableValue';\nimport { CodeContainer } from './components/CodeContainer/CodeContainer';\nimport { GitHubRepository } from './components/GitHubRepository';\nimport { calculateIsGitHubSupported } from './domain/calculateIsGitHubSupported';\nimport { formatFileName } from './domain/formatFileName';\nimport { useFunctionVersion } from './domain/FunctionVersionContext';\nimport { CommitWithSamples, getCommitsWithSamples } from './domain/getCommitsWithSamples';\nimport { getRepositoryDetails } from './domain/getRepositoryDetails';\nimport { isGitHubRepository } from './domain/isGitHubRepository';\nimport { FunctionDetails, FunctionVersion } from './domain/types/FunctionDetails';\nimport { StackTrace } from './domain/types/StackTrace';\nimport { useFetchFunctionsDetails } from './infrastructure/useFetchFunctionsDetails';\nimport { CommitSelect } from './ui/CommitSelect';\nimport { GitHubIntegrationBanner } from './ui/GitHubIntegrationBanner';\nimport { InlineSpinner } from './ui/InlineSpinner';\nimport { OverrideRepositoryDetailsButton } from './ui/OverrideRepositoryDetailsButton';\n\ninterface SceneFunctionDetailsPanelState extends SceneObjectState {}\n\nexport class SceneFunctionDetailsPanel extends SceneObjectBase<SceneFunctionDetailsPanelState> {\n  static LABEL_WIDTH = 16;\n\n  constructor() {\n    super({ key: 'function-details-panel' });\n  }\n\n  // eslint-disable-next-line sonarjs/cognitive-complexity\n  useSceneFunctionDetailsPanel = (stackTrace: StackTrace, timeRange: TimeRange): DomainHookReturnValue => {\n    const dataSourceUid = sceneGraph.findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable).useState()\n      .value as string;\n    const dataSourceName = sceneGraph.findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable).useState()\n      .text as string;\n    const serviceName = getSceneVariableValue(this, 'serviceName');\n    const query = useBuildPyroscopeQuery(this, 'filters');\n\n    const {\n      functionsDetails,\n      error: fetchFunctionDetailsError,\n      isFetching,\n    } = useFetchFunctionsDetails({ dataSourceUid, query, timeRange, stackTrace });\n\n    const { saveOverride, deleteOverride, functionVersion, deleteAllOverrides, functionVersionOrigin } =\n      useFunctionVersion(dataSourceUid, serviceName, functionsDetails[0].version);\n\n    const [prevFunctionsDetails, setPrevFunctionsDetails] = useState<FunctionDetails[]>();\n    const [currentFunctionDetails, setCurrentFunctionDetails] = useState<FunctionDetails>(functionsDetails[0]);\n    const [isGitHubBannerDismissed, setIsGitHubBannerDismissed] = useState(\n      userStorage.has(userStorage.KEYS.GITHUB_INTEGRATION)\n    );\n\n    if (functionsDetails && prevFunctionsDetails !== functionsDetails) {\n      setPrevFunctionsDetails(functionsDetails);\n\n      if (currentFunctionDetails !== functionsDetails[0]) {\n        setCurrentFunctionDetails(functionsDetails[0]);\n      }\n    }\n\n    const isGitHubRepo = isGitHubRepository(functionVersion?.repository || '');\n    const isGitHubSupported = calculateIsGitHubSupported(currentFunctionDetails);\n    const shouldDisplayGitHubBanner = !isGitHubBannerDismissed && !isGitHubRepo && isGitHubSupported;\n\n    // TODO: massage in useFetchFunctionsDetails?\n    const totalSamples = useMemo(\n      () =>\n        functionsDetails\n          .map((details) => Array.from(details.callSites.values()).reduce((acc, { cum }) => acc + cum, 0))\n          .reduce((acc, total) => acc + total, 0),\n      [functionsDetails]\n    );\n    const commits = getCommitsWithSamples(functionsDetails, totalSamples);\n    const selectedCommit = commits.find(({ sha }) => sha === currentFunctionDetails?.commit?.sha);\n\n    return {\n      data: {\n        serviceName,\n        dataSourceName,\n        isLoading: isFetching,\n        fetchFunctionDetailsError,\n        functionDetails: {\n          ...currentFunctionDetails,\n          version: { ...currentFunctionDetails?.version, ...functionVersion },\n        },\n        functionVersionOrigin,\n        // TODO: massage in useFetchFunctionsDetails?\n        repository: getRepositoryDetails(isGitHubRepo, functionVersion),\n        commits,\n        selectedCommit,\n        isGitHubSupported,\n        shouldDisplayGitHubBanner,\n        dataSourceUid,\n      },\n      actions: {\n        deleteFunctionOverride(datasourceUid: string, serviceName: string) {\n          deleteOverride(datasourceUid, serviceName);\n        },\n        deleteFunctionAllOverrides() {\n          deleteAllOverrides();\n        },\n        saveFunctionDetails(datasourceUid: string, serviceName: string, o: FunctionVersion) {\n          saveOverride(datasourceUid, serviceName, o);\n        },\n        selectCommit(selectedCommit: CommitWithSamples) {\n          const details = functionsDetails.find(({ commit }) => commit.sha === selectedCommit.sha);\n          setCurrentFunctionDetails(details as FunctionDetails);\n        },\n        async copyFilePathToClipboard() {\n          try {\n            if (currentFunctionDetails?.fileName) {\n              await navigator.clipboard.writeText(currentFunctionDetails.fileName);\n              displaySuccess(['File path copied to clipboard!']);\n            }\n          } catch {}\n        },\n        dismissGitHubBanner() {\n          userStorage.set(userStorage.KEYS.GITHUB_INTEGRATION, {});\n          setIsGitHubBannerDismissed(true);\n        },\n      },\n    };\n  };\n\n  static Component = ({\n    model,\n    timeRange,\n    stackTrace,\n    onClose,\n  }: SceneComponentProps<SceneFunctionDetailsPanel> & {\n    timeRange: TimeRange;\n    stackTrace: StackTrace;\n    onClose: () => void;\n  }) => {\n    const styles = useStyles2(getStyles);\n    const { data, actions } = model.useSceneFunctionDetailsPanel(stackTrace, timeRange);\n\n    return (\n      <Panel\n        className={styles.sidePanel}\n        title=\"Function Details\"\n        isLoading={false}\n        headerActions={<IconButton name=\"times-circle\" variant=\"secondary\" aria-label=\"close\" onClick={onClose} />}\n        dataTestId=\"function-details-panel\"\n      >\n        <div className={styles.content}>\n          {data.fetchFunctionDetailsError && (\n            <InlineBanner\n              severity=\"error\"\n              title=\"Error while fetching function details!\"\n              error={data.fetchFunctionDetailsError}\n            />\n          )}\n\n          <div className={styles.container}>\n            <div className={styles.row} data-testid=\"row-function-name\">\n              <InlineLabel width={SceneFunctionDetailsPanel.LABEL_WIDTH}>Function name</InlineLabel>\n              <Tooltip content={data.functionDetails.name} placement=\"top\">\n                <span className={styles.textValue}>{data.functionDetails.name}</span>\n              </Tooltip>\n            </div>\n\n            <div className={styles.row} data-testid=\"row-start-line\">\n              <InlineLabel\n                tooltip=\"The line where this function definition starts\"\n                width={SceneFunctionDetailsPanel.LABEL_WIDTH}\n              >\n                Start line\n              </InlineLabel>\n              <span className={styles.textValue}>\n                <InlineSpinner isLoading={data.isLoading}>\n                  {data.functionDetails.startLine !== undefined ? data.functionDetails.startLine : '-'}\n                </InlineSpinner>\n              </span>\n            </div>\n\n            <div className={styles.row} data-testid=\"row-file-path\">\n              <InlineLabel\n                tooltip=\"File path where that function is defined\"\n                width={SceneFunctionDetailsPanel.LABEL_WIDTH}\n              >\n                File\n              </InlineLabel>\n              <InlineSpinner isLoading={data.isLoading}>\n                {data.functionDetails.fileName ? (\n                  <>\n                    <Tooltip content={data.functionDetails.fileName} placement=\"top\">\n                      {/* adding LRM to prevent ellipsis with RTL to fail when the file name starts with non-alpha chars (e.g. \"$\")  */}\n                      <span className={styles.textValue}>&lrm;{formatFileName(data.functionDetails.fileName)}</span>\n                    </Tooltip>\n                    <IconButton\n                      name=\"clipboard-alt\"\n                      tooltip=\"Copy to clipboard\"\n                      onClick={actions.copyFilePathToClipboard}\n                    />\n                  </>\n                ) : (\n                  '-'\n                )}\n              </InlineSpinner>\n            </div>\n\n            {data.shouldDisplayGitHubBanner && (\n              <div className={styles.row} data-testid=\"row-github-banner\">\n                <GitHubIntegrationBanner onDismiss={actions.dismissGitHubBanner} />\n              </div>\n            )}\n\n            <div className={styles.row} data-testid=\"row-repository\">\n              <InlineLabel\n                tooltip=\"The repository configured for the selected service\"\n                width={SceneFunctionDetailsPanel.LABEL_WIDTH}\n              >\n                Repository\n              </InlineLabel>\n              <InlineSpinner isLoading={data.isLoading}>\n                {data.repository ? (\n                  data.repository.isGitHub ? (\n                    <GitHubRepository enableIntegration={data.isGitHubSupported} repository={data.repository} />\n                  ) : (\n                    <TextLink href={data.repository.url} external>\n                      {data.repository.url}\n                    </TextLink>\n                  )\n                ) : (\n                  '-'\n                )}\n              </InlineSpinner>\n              {!data.isLoading && (\n                <OverrideRepositoryDetailsButton\n                  serviceName={data.serviceName}\n                  datasourceName={data.dataSourceName}\n                  datasourceUid={data.dataSourceUid}\n                  version={data.functionDetails.version}\n                  functionVersionOrigin={data.functionVersionOrigin}\n                  saveOverrides={actions.saveFunctionDetails}\n                  deleteAllOverrides={actions.deleteFunctionAllOverrides}\n                  deleteOverride={actions.deleteFunctionOverride}\n                />\n              )}\n            </div>\n\n            <div className={styles.row} data-testid=\"row-commit\">\n              <InlineLabel\n                width={SceneFunctionDetailsPanel.LABEL_WIDTH}\n                tooltip=\"The version of the application (commit) where the function is defined. Use the dropdown menu to target a specific commit.\"\n              >\n                Commit\n              </InlineLabel>\n              <InlineSpinner isLoading={data.isLoading}>\n                <CommitSelect\n                  commits={data.commits}\n                  selectedCommit={data.selectedCommit}\n                  onChange={actions.selectCommit}\n                />\n              </InlineSpinner>\n            </div>\n          </div>\n\n          <CodeContainer dataSourceUid={data.dataSourceUid} functionDetails={data.functionDetails} />\n        </div>\n      </Panel>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  sidePanel: css`\n    flex: 1 0 50%;\n    margin-left: 8px;\n    max-width: calc(50% - 4px);\n  `,\n  title: css`\n    margin: -4px 0 4px 0;\n  `,\n  content: css`\n    padding: ${theme.spacing(1)};\n  `,\n  container: css`\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n  `,\n  row: css`\n    width: 100%;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    padding-bottom: 10px;\n    > * {\n      margin-right: 10px !important;\n    }\n  `,\n  textValue: css`\n    // hack to have the ellipsis appear at the start of the string\n    direction: rtl;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n  `,\n});\n","import { FunctionDetails } from './types/FunctionDetails';\n\n/**\n * Determines if GitHub integration is supported for the given function details.\n *\n * GitHub integration is supported when:\n * 1. At least one of name or fileName is non-empty\n * 2. At least one callSite has a line number > 0\n *\n * @param functionDetails - The function details to check\n * @returns true if GitHub integration is supported, false otherwise\n */\nexport function calculateIsGitHubSupported(functionDetails: FunctionDetails | undefined): boolean {\n  const hasNameOrFileName = Boolean(functionDetails?.name || functionDetails?.fileName);\n  const hasLineNumber = Boolean(\n    functionDetails?.callSites &&\n      Array.from(functionDetails.callSites.values()).some((callSite) => callSite.line > 0)\n  );\n  return hasNameOrFileName && hasLineNumber;\n}\n","// when using direction=rtl, the first / is ending up at the end of the string\n// so we add a / at the end of the string to make it look better\nexport const formatFileName = (fileName: string): string =>\n  fileName?.[0] === '/' ? fileName.substring(1) + '/' : fileName;\n","import { css } from '@emotion/css';\nimport { Button, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ntype Props = {\n  spanSelector: string;\n  removeSpanSelector: () => void;\n};\n\nexport function SpanSelectorLabel(props: Props) {\n  const { spanSelector, removeSpanSelector } = props;\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <Tooltip content={`You have added a span selector to the flamegraph query (${spanSelector}).`} placement=\"top\">\n        <span>Span selector added</span>\n      </Tooltip>\n      <Button\n        size=\"md\"\n        fill=\"text\"\n        variant=\"secondary\"\n        icon=\"times\"\n        tooltip={`Remove span selector from query`}\n        tooltipPlacement=\"top\"\n        onClick={() => {\n          removeSpanSelector();\n        }}\n      />\n    </div>\n  );\n}\n\nconst getStyles = () => ({\n  container: css`\n    padding: 0 4px;\n  `,\n});\n","import { css } from '@emotion/css';\nimport { createTheme, GrafanaTheme2, LoadingState, TimeRange } from '@grafana/data';\nimport { FlameGraph, Props as FlameGraphProps } from '@grafana/flamegraph';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState, SceneQueryRunner } from '@grafana/scenes';\nimport { Spinner, useStyles2, useTheme2 } from '@grafana/ui';\nimport { displayWarning } from '@shared/domain/displayStatus';\nimport { useMaxNodesFromUrl } from '@shared/domain/url-params/useMaxNodesFromUrl';\nimport { useToggleSidePanel } from '@shared/domain/useToggleSidePanel';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { featureToggles } from '@shared/infrastructure/settings/featureToggles';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport { Panel } from '@shared/ui/Panel/Panel';\nimport { PyroscopeLogo } from '@shared/ui/PyroscopeLogo';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { Unsubscribable } from 'rxjs';\n\nimport { useBuildPyroscopeQuery } from '../../domain/useBuildPyroscopeQuery';\nimport { useGrafanaAssistant } from '../../domain/useGrafanaAssistant';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { buildFlameGraphQueryRunner } from '../../infrastructure/flame-graph/buildFlameGraphQueryRunner';\nimport { PYROSCOPE_DATA_SOURCE } from '../../infrastructure/pyroscope-data-sources';\nimport { AIButton } from '../SceneAiPanel/components/AiButton/AIButton';\nimport { SceneAiPanel } from '../SceneAiPanel/SceneAiPanel';\nimport { useCreateRecordingRulesMenu } from '../SceneCreateMetricModal/domain/useMenuOption';\nimport { SceneCreateRecordingRuleModal } from '../SceneCreateMetricModal/SceneCreateRecordingRuleModal';\nimport { SceneExportMenu } from './components/SceneExportMenu/SceneExportMenu';\nimport { useGitHubIntegration } from './components/SceneFunctionDetailsPanel/domain/useGitHubIntegration';\nimport { SceneFunctionDetailsPanel } from './components/SceneFunctionDetailsPanel/SceneFunctionDetailsPanel';\nimport { RemoveSpanSelector } from './domain/events/RemoveSpanSelector';\nimport { SpanSelectorLabel } from './SpanSelectorLabel';\n\ninterface SceneFlameGraphState extends SceneObjectState {\n  $data: SceneQueryRunner;\n  lastTimeRange?: TimeRange;\n  exportMenu: SceneExportMenu;\n  aiPanel: SceneAiPanel;\n  functionDetailsPanel: SceneFunctionDetailsPanel;\n  createRecordingRuleModal: SceneCreateRecordingRuleModal;\n}\n\n// I've tried to use a SplitLayout for the body without any success (left: flame graph, right: explain flame graph content)\n// without success: the flame graph dimensions are set in runtime and do not change when the user resizes the layout\nexport class SceneFlameGraph extends SceneObjectBase<SceneFlameGraphState> {\n  constructor() {\n    super({\n      key: 'flame-graph',\n      $data: new SceneQueryRunner({\n        datasource: PYROSCOPE_DATA_SOURCE,\n        queries: [],\n      }),\n      lastTimeRange: undefined,\n      exportMenu: new SceneExportMenu(),\n      aiPanel: new SceneAiPanel(),\n      functionDetailsPanel: new SceneFunctionDetailsPanel(),\n      createRecordingRuleModal: new SceneCreateRecordingRuleModal(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    let dataSubscription: Unsubscribable | undefined;\n\n    const stateSubscription = this.subscribeToState((newState, prevState) => {\n      if (newState.$data === prevState.$data) {\n        return;\n      }\n\n      if (dataSubscription) {\n        dataSubscription.unsubscribe();\n      }\n\n      dataSubscription = newState.$data?.subscribeToState((newDataState) => {\n        if (newDataState.data?.state === LoadingState.Done) {\n          this.setState({ lastTimeRange: newDataState.data.timeRange });\n        }\n      });\n    });\n\n    return () => {\n      stateSubscription.unsubscribe();\n      dataSubscription?.unsubscribe();\n    };\n  }\n\n  buildTitle() {\n    const serviceName = getSceneVariableValue(this, 'serviceName');\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const profileMetricType = getProfileMetric(profileMetricId as ProfileMetricId).type;\n\n    return (\n      <>\n        <PyroscopeLogo size=\"small\" />\n        Flame graph for {serviceName} ({profileMetricType})\n      </>\n    );\n  }\n\n  useSceneFlameGraph = (spanSelector: string): DomainHookReturnValue => {\n    const { isLight } = useTheme2();\n    const getTheme = useMemo(() => () => createTheme({ colors: { mode: isLight ? 'light' : 'dark' } }), [isLight]);\n\n    const [maxNodes] = useMaxNodesFromUrl();\n    const { settings, error: isFetchingSettingsError } = useFetchPluginSettings();\n    const { $data, lastTimeRange, exportMenu, aiPanel, functionDetailsPanel, createRecordingRuleModal } =\n      this.useState();\n\n    if (isFetchingSettingsError) {\n      displayWarning([\n        'Error while retrieving the plugin settings!',\n        'Some features might not work as expected (e.g. collapsed flame graphs). Please try to reload the page, sorry for the inconvenience.',\n      ]);\n    }\n\n    useEffect(() => {\n      if (maxNodes) {\n        this.setState({\n          $data: buildFlameGraphQueryRunner({ maxNodes, spanSelector }),\n        });\n      }\n    }, [maxNodes, spanSelector]);\n\n    const $dataState = $data.useState();\n    const loadingState = $dataState?.data?.state;\n\n    const fetchProfileError =\n      loadingState === LoadingState.Error\n        ? ($dataState?.data?.errors?.[0] as Error) || new Error('Unknown error!')\n        : null;\n\n    const isFetchingProfileData = loadingState === LoadingState.Loading;\n    const profileData = $dataState?.data?.series?.[0];\n    const hasProfileData = Number(profileData?.length) > 1;\n\n    const query = useBuildPyroscopeQuery(this, 'filters');\n\n    return {\n      data: {\n        title: this.buildTitle(),\n        isLoading: isFetchingProfileData,\n        isFetchingProfileData,\n        hasProfileData,\n        profileData,\n        spanSelector,\n        fetchProfileError,\n        settings,\n        export: {\n          menu: exportMenu,\n          query,\n          timeRange: lastTimeRange,\n        },\n        ai: {\n          panel: aiPanel,\n          fetchParams: [{ query, timeRange: lastTimeRange }],\n        },\n        gitHub: {\n          panel: functionDetailsPanel,\n          timeRange: lastTimeRange,\n        },\n        recordingRules: {\n          modal: createRecordingRuleModal,\n        },\n      },\n      actions: {\n        getTheme,\n      },\n    };\n  };\n\n  removeSpanSelector() {\n    this.publishEvent(new RemoveSpanSelector({}), true);\n  }\n\n  static Component = ({ model }: SceneComponentProps<SceneFlameGraph>) => {\n    const styles = useStyles2(getStyles);\n\n    const spanSelector = getSceneVariableValue(model, 'spanSelector');\n    const { data, actions } = model.useSceneFlameGraph(spanSelector);\n    const sidePanel = useToggleSidePanel();\n    const gitHubIntegration = useGitHubIntegration(sidePanel);\n\n    const { settings } = useFetchPluginSettings();\n\n    const [recordingRulesModalState, setRecordingRulesModalState] = useState<{\n      isOpen: boolean;\n      functionName?: string;\n    }>({ isOpen: false });\n\n    const recordingRulesMenu = useCreateRecordingRulesMenu((functionName?: string) => {\n      setRecordingRulesModalState({ isOpen: true, functionName });\n    });\n\n    const { hideAIButton } = useGrafanaAssistant();\n\n    const isAiButtonDisabled = data.isLoading || !data.hasProfileData;\n\n    useEffect(() => {\n      if (isAiButtonDisabled) {\n        sidePanel.close();\n      }\n    }, [isAiButtonDisabled, sidePanel]);\n\n    const panelTitle = useMemo(\n      () => (\n        <>\n          {data.title}\n          {data.isLoading && <Spinner inline className={styles.spinner} />}\n        </>\n      ),\n      [data.isLoading, data.title, styles.spinner]\n    );\n\n    const extraContextMenuButtons: FlameGraphProps['getExtraContextMenuButtons'] = (clickedItemData, data) => {\n      const ghButtons = gitHubIntegration.actions.getExtraFlameGraphMenuItems(clickedItemData, data);\n      const recordingRulesButtons =\n        settings?.enableMetricsFromProfiles && featureToggles.metricsFromProfiles\n          ? recordingRulesMenu.actions.getExtraFlameGraphMenuItems(clickedItemData, data)\n          : [];\n\n      return [...ghButtons, ...recordingRulesButtons];\n    };\n\n    return (\n      <div className={styles.flex}>\n        <Panel\n          dataTestId=\"flame-graph-panel\"\n          className={styles.flamegraphPanel}\n          title={panelTitle}\n          isLoading={data.isLoading}\n          headerActions={\n            <>\n              {spanSelector && (\n                <SpanSelectorLabel spanSelector={spanSelector} removeSpanSelector={() => model.removeSpanSelector()} />\n              )}\n              {!hideAIButton && (\n                <AIButton\n                  disabled={isAiButtonDisabled || sidePanel.isOpen('ai')}\n                  onClick={() => sidePanel.open('ai')}\n                  interactionName=\"g_pyroscope_app_explain_flamegraph_clicked\"\n                >\n                  Explain Flame Graph\n                </AIButton>\n              )}\n            </>\n          }\n        >\n          {data.fetchProfileError && (\n            <InlineBanner severity=\"error\" title=\"Error while loading profile data!\" error={data.fetchProfileError} />\n          )}\n\n          {!data.fetchProfileError && (\n            <FlameGraph\n              data={data.profileData as any}\n              disableCollapsing={!data.settings?.collapsedFlamegraphs}\n              getTheme={actions.getTheme as any}\n              getExtraContextMenuButtons={extraContextMenuButtons}\n              extraHeaderElements={\n                <data.export.menu.Component\n                  model={data.export.menu}\n                  query={data.export.query}\n                  timeRange={data.export.timeRange}\n                />\n              }\n              keepFocusOnDataChange\n            />\n          )}\n        </Panel>\n\n        {sidePanel.isOpen('ai') && (\n          <data.ai.panel.Component model={data.ai.panel} fetchParams={data.ai.fetchParams} onClose={sidePanel.close} />\n        )}\n\n        {sidePanel.isOpen('function-details') && (\n          <data.gitHub.panel.Component\n            model={data.gitHub.panel}\n            timeRange={data.gitHub.timeRange}\n            stackTrace={gitHubIntegration.data.stacktrace}\n            onClose={sidePanel.close}\n          />\n        )}\n\n        <data.recordingRules.modal.Component\n          model={data.recordingRules.modal}\n          isModalOpen={recordingRulesModalState.isOpen}\n          functionName={recordingRulesModalState.functionName}\n          onDismiss={() => setRecordingRulesModalState({ isOpen: false })}\n          onCreated={() => {\n            setRecordingRulesModalState({ isOpen: false });\n          }}\n        />\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flex: css`\n    display: flex;\n  `,\n  flamegraphPanel: css`\n    min-width: 0;\n    flex-grow: 1;\n  `,\n  spinner: css`\n    margin-left: ${theme.spacing(1)};\n  `,\n});\n","import { IconName } from '@grafana/data';\nimport { Props as FlameGraphProps } from '@grafana/flamegraph';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { useCallback } from 'react';\n\nexport function useCreateRecordingRulesMenu(setModalOpen: (functionName?: string) => void): DomainHookReturnValue {\n  const getExtraFlameGraphMenuItems: FlameGraphProps['getExtraContextMenuButtons'] = useCallback(\n    ({ item, label }: any) => {\n      return [\n        {\n          label: 'Create recording rule',\n          icon: 'download-alt' as IconName,\n          onClick: () => setModalOpen(label === 'total' && item.level === 0 ? undefined : label),\n        },\n      ];\n    },\n    [setModalOpen]\n  );\n\n  return {\n    data: {},\n    actions: {\n      getExtraFlameGraphMenuItems,\n    },\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState, SceneReactObject } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneMainServiceTimeseries } from '../SceneMainServiceTimeseries';\nimport { ResolutionBoostExtensionPoint } from './components/ResolutionBoostExtensionPoint';\nimport { SceneFlameGraph } from './SceneFlameGraph';\n\ninterface SceneExploreServiceFlameGraphState extends SceneObjectState {\n  mainTimeseries: SceneMainServiceTimeseries;\n  body: SceneFlameGraph;\n}\n\nexport class SceneExploreServiceFlameGraph extends SceneObjectBase<SceneExploreServiceFlameGraphState> {\n  constructor({ item }: { item?: GridItemData }) {\n    super({\n      key: 'explore-service-flame-graph',\n      mainTimeseries: new SceneMainServiceTimeseries({\n        item,\n        headerActions: (item) => [\n          new SceneReactObject({ component: ResolutionBoostExtensionPoint, props: { scene: this } }),\n          new SelectAction({ type: 'view-labels', item }),\n          new FavAction({ item }),\n        ],\n      }),\n      body: new SceneFlameGraph(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item?: GridItemData) {\n    if (item) {\n      this.initVariables(item);\n    }\n\n    const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n\n    profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_SERVICE_NAME_DEPENDENT });\n    profileMetricVariable.update(true);\n\n    return () => {\n      profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_DEFAULT });\n      profileMetricVariable.update(true);\n    };\n  }\n\n  initVariables(item: GridItemData) {\n    const { serviceName, profileMetricId, filters } = item.queryRunnerParams;\n\n    if (serviceName) {\n      const serviceNameVariable = sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable);\n      serviceNameVariable.changeValueTo(serviceName);\n    }\n\n    if (profileMetricId) {\n      const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n      profileMetricVariable.changeValueTo(profileMetricId);\n    }\n\n    if (filters) {\n      const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n      filtersVariable.setState({ filters });\n    }\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [\n        sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable),\n        sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable),\n        sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable),\n      ],\n      gridControls: [],\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreServiceFlameGraph>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { mainTimeseries, body } = model.useState();\n\n    // we use CSS here and Scenes Flex layout because we encountered a problem where the Flamegraph would not respect each panel width,\n    // resulting in a cropped flame graph when opening the side panel\n    return (\n      <div className={styles.flex}>\n        <div className={styles.mainTimeseries}>\n          <mainTimeseries.Component model={mainTimeseries} />\n        </div>\n        <body.Component model={body} />\n      </div>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flex: css`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    gap: ${theme.spacing(1)};\n  `,\n  mainTimeseries: css`\n    height: ${SceneMainServiceTimeseries.MIN_HEIGHT}px;\n  `,\n});\n","import { SceneObject, SceneVariable } from '@grafana/scenes';\nimport { displaySuccess } from '@shared/domain/displayStatus';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport { useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { PLUGIN_BASE_URL, ROUTES } from 'src/constants';\nimport { getSceneVariableValue } from 'src/pages/ProfilesExplorerView/helpers/getSceneVariableValue';\n\nimport { ProfilesDataSourceVariable } from '../../../../domain/variables/ProfilesDataSourceVariable';\nimport { ExplorationType } from '../../SceneProfilesExplorer';\nimport { HeaderProps } from '../Header';\nimport { builsShareableUrl } from './builsShareableUrl';\n\nasync function onClickShareLink() {\n  reportInteraction('g_pyroscope_app_share_link_clicked');\n\n  try {\n    await navigator.clipboard.writeText(builsShareableUrl().toString());\n\n    displaySuccess(['Link copied to clipboard!']);\n  } catch (error) {\n    logger.error(error as Error, { info: 'Error while creating the shareable link!' });\n  }\n}\n\nexport function useHeader({ explorationType, controls, body, $variables, onChangeExplorationType }: HeaderProps) {\n  const [timePickerControl, refreshPickerControl] =\n    explorationType === ExplorationType.DIFF_FLAME_GRAPH ? [] : (controls as [SceneObject, SceneObject]);\n\n  const dataSourceVariable = $variables.state.variables[0] as ProfilesDataSourceVariable;\n\n  const bodySceneObject = body?.state.primary as any;\n\n  if (typeof bodySceneObject.getVariablesAndGridControls !== 'function') {\n    throw new Error(\n      `Error while rendering \"${bodySceneObject.constructor.name}\": the \"getVariablesAndGridControls\" method is missing! Please implement it.`\n    );\n  }\n\n  const { variables: sceneVariables, gridControls } = bodySceneObject.getVariablesAndGridControls() as {\n    variables: SceneVariable[];\n    gridControls: SceneObject[];\n  };\n\n  const dataSourceUid = dataSourceVariable.useState().value as string;\n\n  const navigate = useNavigate();\n\n  const explorationTypeHasServiceName =\n    explorationType !== ExplorationType.ALL_SERVICES && explorationType !== ExplorationType.FAVORITES;\n\n  const serviceName = explorationTypeHasServiceName ? getSceneVariableValue($variables, 'serviceName') : undefined;\n\n  return {\n    data: {\n      explorationType,\n      dataSourceVariable,\n      timePickerControl,\n      refreshPickerControl,\n      sceneVariables,\n      gridControls,\n      body,\n      dataSourceUid,\n      serviceName,\n    },\n    actions: {\n      onChangeExplorationType,\n      onClickShareLink,\n      onClickRecordingRules: useCallback(() => {\n        reportInteraction('g_pyroscope_app_open_recording_rules_view');\n\n        navigate(`${PLUGIN_BASE_URL}${ROUTES.RECORDING_RULES}`, { state: { referrer: window.location.href } });\n      }, [navigate]),\n      onClickAdHoc: useCallback(() => {\n        reportInteraction('g_pyroscope_app_upload_ad_hoc_clicked');\n\n        navigate(`${PLUGIN_BASE_URL}${ROUTES.ADHOC}`, { state: { referrer: window.location.href } });\n      }, [navigate]),\n      onClickUserSettings: useCallback(() => {\n        reportInteraction('g_pyroscope_app_user_settings_clicked');\n\n        navigate(`${PLUGIN_BASE_URL}${ROUTES.SETTINGS}`, { state: { referrer: window.location.href } });\n      }, [navigate]),\n    },\n  };\n}\n","import { dateMath } from '@grafana/data';\n\nimport { getDefaultTimeRange } from '../../../..//domain/buildTimeRange';\n\nexport function builsShareableUrl(): URL {\n  const shareableUrl = new URL(window.location.toString());\n  const { searchParams } = shareableUrl;\n\n  if (!searchParams.get('from')) {\n    searchParams.set('from', getDefaultTimeRange().from);\n  }\n  if (!searchParams.get('to')) {\n    searchParams.set('to', getDefaultTimeRange().to);\n  }\n\n  ['from', 'to', 'from-2', 'to-2', 'from-3', 'to-3', 'diffFrom', 'diffTo', 'diffFrom-2', 'diffTo-2'].forEach((name) => {\n    const value = searchParams.get(name);\n    if (value) {\n      searchParams.set(name, String(dateMath.parse(value)!.valueOf()));\n    }\n  });\n\n  return shareableUrl;\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { noOp } from '@shared/domain/noOp';\nimport React, { Fragment } from 'react';\n\ntype ExplorationTypeSelectorProps = {\n  options: Array<SelectableValue<string>>;\n  value: string;\n  onChange: (newValue: string) => void;\n};\n\nexport function ExplorationTypeSelector({ options, value, onChange }: ExplorationTypeSelectorProps) {\n  const styles = useStyles2(getStyles);\n\n  const activeIndex = options.findIndex((o) => o.value === value);\n\n  const getButtonVariant = (currentIndex: number) => {\n    if (activeIndex === options.length - 1) {\n      // \"Favorites\" is the last option, so in this case we don't want all the previous buttons to be active\n      return currentIndex === activeIndex ? 'primary' : 'secondary';\n    }\n\n    return currentIndex <= activeIndex ? 'primary' : 'secondary';\n  };\n\n  return (\n    <div className={styles.explorationTypeContainer} data-testid=\"exploration-types\">\n      <div className={styles.label}>Exploration</div>\n\n      <div className={styles.breadcrumb}>\n        {options.map((option, i) => {\n          const isActive = value === option.value;\n          const variant = getButtonVariant(i);\n          const isPrimary = variant === 'primary';\n          const extraClasses = [isActive && 'active', isPrimary && 'primary'];\n\n          return (\n            <Fragment key={option.value}>\n              <Button\n                className={cx(styles.button, ...extraClasses)}\n                variant={variant}\n                size=\"sm\"\n                aria-label={option.label}\n                icon={option.icon as any}\n                onClick={isActive ? noOp : () => onChange(option.value as string)}\n                tooltip={option.description}\n                tooltipPlacement=\"top\"\n                data-testid={isActive ? 'is-active' : undefined}\n              >\n                {option.label}\n              </Button>\n\n              {/* add a connection only for buttons before \"Diff flame graph\" and \"Favorites\" */}\n              {i < options.length - 3 && (\n                <div\n                  className={\n                    activeIndex !== options.length - 1 && i <= activeIndex - 1\n                      ? cx(styles.arrow, 'arrow', ...extraClasses)\n                      : styles.arrow\n                  }\n                />\n              )}\n            </Fragment>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  explorationTypeContainer: css`\n    display: flex;\n    align-items: center;\n  `,\n  label: css`\n    display: flex;\n    gap: 2px;\n    align-items: center;\n    font-size: 14px;\n    margin-right: ${theme.spacing(1)};\n\n    ${theme.breakpoints.down('xxl')} {\n      display: none;\n    }\n  `,\n  breadcrumb: css`\n    display: flex;\n    align-items: center;\n    height: 32px;\n    line-height: 32px;\n\n    .active {\n      background-color: ${theme.colors.primary.main};\n    }\n\n    .arrow.primary {\n      background-color: ${theme.colors.primary.main};\n    }\n\n    & button.primary:not(.active),\n    & .arrow.primary:not(.active) {\n      opacity: 0.7;\n    }\n\n    & button.primary:not(.active):hover {\n      opacity: 1;\n      background-color: ${theme.colors.primary.main};\n    }\n  `,\n  button: css`\n    height: 27px;\n    line-height: 27px;\n    border-radius: 15px;\n\n    &:hover {\n      border-color: ${theme.colors.primary.main};\n    }\n\n    &.active:hover {\n      cursor: default;\n      background-color: ${theme.colors.primary.main};\n    }\n\n    &:nth-last-child(2) {\n      margin-left: ${theme.spacing(1)};\n    }\n\n    &:nth-last-child(1) {\n      margin-left: ${theme.spacing(2)};\n    }\n  `,\n  arrow: css`\n    background-color: ${theme.colors.text.disabled};\n    width: 10px;\n    height: 2px;\n  `,\n});\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useChromeHeaderHeight, usePluginComponent } from '@grafana/runtime';\nimport { Dropdown, ErrorBoundary, Field, Icon, IconButton, Menu, useStyles2 } from '@grafana/ui';\nimport { featureToggles } from '@shared/infrastructure/settings/featureToggles';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { PluginInfo } from '@shared/ui/PluginInfo';\nimport React from 'react';\n\nimport { GiveFeedbackButton } from '../../GiveFeedbackButton';\nimport { SceneProfilesExplorer, SceneProfilesExplorerState } from '../SceneProfilesExplorer';\nimport { useHeader } from './domain/useHeader';\nimport { ExplorationTypeSelector } from './ui/ExplorationTypeSelector';\n\nexport type HeaderProps = {\n  explorationType: SceneProfilesExplorerState['explorationType'];\n  controls: SceneProfilesExplorerState['controls'];\n  body: SceneProfilesExplorerState['body'];\n  $variables: SceneProfilesExplorerState['$variables'];\n  onChangeExplorationType: (explorationType: string) => void;\n  onCreateRecordingRule: () => void;\n  isEmbedded?: boolean;\n};\n\nexport function Header(props: HeaderProps) {\n  const chromeHeaderHeight = useChromeHeaderHeight?.();\n  const styles = useStyles2(getStyles, chromeHeaderHeight ?? 0, props.isEmbedded ?? false);\n\n  const { data, actions } = useHeader(props);\n\n  const { settings } = useFetchPluginSettings();\n\n  const {\n    explorationType,\n    dataSourceVariable,\n    timePickerControl,\n    refreshPickerControl,\n    sceneVariables,\n    gridControls,\n    serviceName,\n  } = data;\n\n  type InsightsLauncherProps = {\n    dataSourceUid: string;\n    serviceName?: string;\n  };\n  const { component: InsightsLauncher } = usePluginComponent<InsightsLauncherProps>(\n    'grafana-o11yinsights-app/insights-launcher/v1'\n  );\n\n  const metricsFromProfilesMenu = (\n    <Menu>\n      <Menu.Item\n        ariaLabel=\"View recording rules\"\n        label=\"View recording rules\"\n        onClick={actions.onClickRecordingRules}\n      />\n      <Menu.Item ariaLabel=\"Add recording rule\" label=\"Add recording rule\" onClick={props.onCreateRecordingRule} />\n    </Menu>\n  );\n\n  return (\n    <div className={styles.header} data-testid=\"allControls\">\n      {!props.isEmbedded && <GiveFeedbackButton />}\n\n      <div className={styles.appControls} data-testid=\"appControls\">\n        <div className={styles.appControlsLeft}>\n          <ExplorationTypeSelector\n            options={SceneProfilesExplorer.EXPLORATION_TYPE_OPTIONS}\n            value={explorationType as string}\n            onChange={actions.onChangeExplorationType}\n          />\n        </div>\n\n        <div className={styles.appControlsRight}>\n          {InsightsLauncher && (\n            <ErrorBoundary>\n              {({ error }) =>\n                error ? undefined : (\n                  <InsightsLauncher dataSourceUid={dataSourceVariable.getValueText()} serviceName={serviceName} />\n                )\n              }\n            </ErrorBoundary>\n          )}\n\n          {timePickerControl && (\n            <timePickerControl.Component key={timePickerControl.state.key} model={timePickerControl} />\n          )}\n          {refreshPickerControl && (\n            <refreshPickerControl.Component key={refreshPickerControl.state.key} model={refreshPickerControl} />\n          )}\n\n          {!props.isEmbedded && (\n            <div className={styles.appMiscButtons}>\n              {settings?.enableMetricsFromProfiles && featureToggles.metricsFromProfiles && (\n                <>\n                  <Dropdown overlay={metricsFromProfilesMenu}>\n                    <IconButton name=\"gf-prometheus\" tooltip=\"Recording rules\" aria-label=\"Recording rules\" />\n                  </Dropdown>\n                </>\n              )}\n\n              <IconButton name=\"upload\" tooltip=\"Upload ad hoc profiles\" onClick={actions.onClickAdHoc} />\n\n              <IconButton name=\"cog\" tooltip=\"View/edit tenant settings\" onClick={actions.onClickUserSettings} />\n\n              <IconButton\n                name=\"share-alt\"\n                tooltip=\"Copy shareable link to the clipboard\"\n                onClick={actions.onClickShareLink}\n              />\n\n              <PluginInfo />\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div id={`scene-controls-${explorationType}`} className={styles.sceneControls} data-testid=\"sceneControls\">\n        {!props.isEmbedded && (\n          <Field\n            label={dataSourceVariable.state.label}\n            className={cx(styles.sceneVariable, dataSourceVariable.state.name)}\n            data-testid={dataSourceVariable.state.name}\n          >\n            <dataSourceVariable.Component model={dataSourceVariable} />\n          </Field>\n        )}\n\n        {sceneVariables.map((variable) => (\n          <Field\n            key={variable.state.name}\n            label={\n              variable.state.label === 'Filters' ? (\n                <div className={styles.sceneVariableLabel}>\n                  <Icon name=\"filter\" className={styles.icon} />\n                  {variable.state.label}\n                </div>\n              ) : (\n                variable.state.label\n              )\n            }\n            className={cx(styles.sceneVariable, variable.state.name)}\n            data-testid={variable.state.name}\n          >\n            <variable.Component model={variable} />\n          </Field>\n        ))}\n\n        {gridControls.map((control) => (\n          <Field key={control.state.key} id={control.state.key} className={styles.gridControl} label=\"\">\n            <control.Component model={control} />\n          </Field>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2, chromeHeaderHeight: number, isEmbedded: boolean) => ({\n  header: css`\n    background-color: ${isEmbedded ? theme.colors.background.primary : theme.colors.background.canvas};\n    position: sticky;\n    top: ${isEmbedded ? 0 : chromeHeaderHeight}px;\n    z-index: 1;\n    padding-bottom: ${theme.spacing(2)};\n  `,\n  appControls: css`\n    display: flex;\n    padding: ${theme.spacing(1)} 0;\n    justify-content: space-between;\n    gap: ${theme.spacing(2)};\n    flex-flow: wrap;\n  `,\n  appControlsLeft: css`\n    display: flex;\n    gap: ${theme.spacing(1)};\n  `,\n  appControlsRight: css`\n    display: flex;\n    gap: ${theme.spacing(1)};\n  `,\n  appMiscButtons: css`\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    border: 1px solid ${theme.colors.border.weak};\n    background-color: ${theme.colors.background.secondary};\n    height: 32px;\n    padding: 0 ${theme.spacing(1)};\n\n    & svg {\n      width: 18px;\n      height: 18px;\n    }\n  `,\n  sceneControls: css`\n    display: flex;\n    flex-wrap: wrap;\n    gap: ${theme.spacing(1)};\n    padding: 0;\n    margin-top: 20px;\n  `,\n  sceneVariable: css`\n    display: flex;\n    margin-bottom: 0;\n\n    & #dataSource {\n      width: ${theme.spacing(32)};\n    }\n\n    &.filters {\n      flex-grow: 1;\n    }\n\n    &.compare-presets {\n      margin-left: auto;\n      text-align: right;\n    }\n  `,\n  sceneVariableLabel: css`\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 15px;\n    height: 15px;\n    margin-bottom: 4px;\n    color: ${theme.colors.text.primary};\n    max-width: 480px;\n  `,\n  icon: css`\n    display: inline-block;\n    margin-right: 4px;\n  `,\n  gridControl: css`\n    margin-bottom: 0;\n\n    &#quick-filter {\n      flex: 1;\n      min-width: 112px;\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { AdHocVariableFilter } from '@grafana/data';\nimport {\n  EmbeddedSceneState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  sceneUtils,\n  SceneVariableSet,\n  SplitLayout,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport { displayError } from '@shared/domain/displayStatus';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport React, { useState } from 'react';\n\nimport { SceneExploreAllServices } from '../../components/SceneExploreAllServices/SceneExploreAllServices';\nimport { SceneExploreFavorites } from '../../components/SceneExploreFavorites/SceneExploreFavorites';\nimport { SceneExploreServiceLabels } from '../../components/SceneExploreServiceLabels/SceneExploreServiceLabels';\nimport { SceneExploreServiceProfileTypes } from '../../components/SceneExploreServiceProfileTypes/SceneExploreServiceProfileTypes';\nimport { getDefaultTimeRange } from '../../domain/buildTimeRange';\nimport { EventViewDiffFlameGraph } from '../../domain/events/EventViewDiffFlameGraph';\nimport { EventViewServiceFlameGraph } from '../../domain/events/EventViewServiceFlameGraph';\nimport { EventViewServiceLabels } from '../../domain/events/EventViewServiceLabels';\nimport { EventViewServiceProfiles } from '../../domain/events/EventViewServiceProfiles';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { GroupByVariable } from '../../domain/variables/GroupByVariable/GroupByVariable';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ProfilesDataSourceVariable } from '../../domain/variables/ProfilesDataSourceVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { SpanSelectorVariable } from '../../domain/variables/SpanSelectorVariable';\nimport { FavoritesDataSource } from '../../infrastructure/favorites/FavoritesDataSource';\nimport { LabelsDataSource } from '../../infrastructure/labels/LabelsDataSource';\nimport { SeriesDataSource } from '../../infrastructure/series/SeriesDataSource';\nimport { SceneLayoutSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { SceneNoDataSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher';\nimport { ScenePanelTypeSwitcher } from '../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter } from '../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneCreateRecordingRuleModal } from '../SceneCreateMetricModal/SceneCreateRecordingRuleModal';\nimport { SceneExploreDiffFlameGraph } from '../SceneExploreDiffFlameGraph/SceneExploreDiffFlameGraph';\nimport { GitHubContextProvider } from '../SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/GitHubContextProvider';\nimport { FunctionVersionProvider } from '../SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/FunctionVersionContext';\nimport { RemoveSpanSelector } from '../SceneExploreServiceFlameGraph/domain/events/RemoveSpanSelector';\nimport { SceneExploreServiceFlameGraph } from '../SceneExploreServiceFlameGraph/SceneExploreServiceFlameGraph';\nimport { Header } from './components/Header';\n\nexport interface SceneProfilesExplorerState extends Partial<EmbeddedSceneState> {\n  $timeRange: SceneTimeRange;\n  $variables: SceneVariableSet;\n  gridControls: Array<SceneObject & { key?: string }>;\n  explorationType?: ExplorationType;\n  body?: SplitLayout;\n  createRecordingRuleModal: SceneCreateRecordingRuleModal;\n  isEmbedded?: boolean;\n  initialFilters?: AdHocVariableFilter[];\n  initialDS?: string;\n}\n\nexport enum ExplorationType {\n  ALL_SERVICES = 'all',\n  PROFILE_TYPES = 'profiles',\n  LABELS = 'labels',\n  FLAME_GRAPH = 'flame-graph',\n  DIFF_FLAME_GRAPH = 'diff-flame-graph',\n  FAVORITES = 'favorites',\n}\n\nexport class SceneProfilesExplorer extends SceneObjectBase<SceneProfilesExplorerState> {\n  static EXPLORATION_TYPE_OPTIONS = [\n    {\n      value: ExplorationType.ALL_SERVICES,\n      label: 'All services',\n      description: 'Overview of all services, for any given profile type',\n    },\n    {\n      value: ExplorationType.PROFILE_TYPES,\n      label: 'Profile types',\n      description: 'Overview of all the profile types for a single service',\n    },\n    {\n      value: ExplorationType.LABELS,\n      label: 'Labels',\n      description: 'Single service label exploration and filtering',\n    },\n    {\n      value: ExplorationType.FLAME_GRAPH,\n      label: 'Flame graph',\n      description: 'Single service flame graph',\n    },\n    {\n      value: ExplorationType.DIFF_FLAME_GRAPH,\n      label: 'Diff flame graph',\n      description: 'Compare the differences between two flame graphs',\n    },\n    {\n      value: ExplorationType.FAVORITES,\n      label: 'Favorites',\n      description: 'Overview of favorited visualizations',\n      icon: 'favorite',\n    },\n  ];\n\n  static DEFAULT_EXPLORATION_TYPE = SceneProfilesExplorer.EXPLORATION_TYPE_OPTIONS[0].value;\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['explorationType'] });\n  private initialFilters?: AdHocVariableFilter[];\n\n  public constructor(state: Partial<SceneProfilesExplorerState>) {\n    super({\n      key: 'profiles-explorer',\n      explorationType: state.initialFilters && state.initialFilters.length > 0 ? ExplorationType.LABELS : undefined,\n      body: undefined,\n      $timeRange: state?.$timeRange ?? new SceneTimeRange(getDefaultTimeRange()),\n      $variables:\n        state?.$variables ??\n        new SceneVariableSet({\n          // in order to sync with the URL and...\n          // ...because of a limitation of the Scenes library, we have to create them now, once, and not every time we set a new exploration type\n          // also, we prevent re-creating all variables when switching exploration type, which would lead to unecessary work and layout shifts in the UI\n          // (because values would be empty before loading, then populated after fetched)\n          // see setExplorationType() for dynamic updates\n          variables: [\n            new ProfilesDataSourceVariable({ initialDS: state?.initialDS }),\n            new ServiceNameVariable({ initialFilters: state?.initialFilters }),\n            new ProfileMetricVariable(),\n            new FiltersVariable({\n              key: 'filters',\n              initialFilters: (() => {\n                if (!state?.initialFilters) {\n                  return undefined;\n                }\n                const filtered = state.initialFilters.filter(\n                  (filter: AdHocVariableFilter) => filter.key !== 'service_name'\n                );\n                return filtered.length > 0 ? filtered : undefined;\n              })(),\n            }),\n            new FiltersVariable({ key: 'filtersBaseline' }),\n            new FiltersVariable({ key: 'filtersComparison' }),\n            new GroupByVariable(),\n            new SpanSelectorVariable(),\n          ],\n        }),\n      createRecordingRuleModal: new SceneCreateRecordingRuleModal(),\n      controls: [new SceneTimePicker({ isOnCanvas: true }), new SceneRefreshPicker({ isOnCanvas: true })],\n      // these scenes also sync with the URL so...\n      // ...because of a limitation of the Scenes library, we have to create them now, once, and not every time we set a new exploration type\n      gridControls: [\n        new SceneQuickFilter({ placeholder: '' }),\n        new ScenePanelTypeSwitcher(),\n        new SceneLayoutSwitcher(),\n        new SceneNoDataSwitcher(),\n      ],\n      isEmbedded: state?.isEmbedded,\n    });\n\n    this.registerRuntimeDataSources();\n\n    this.initialFilters = state?.initialFilters;\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const varSub = this.subscribeToVariableChanges();\n    const eventsSub = this.subscribeToEvents();\n\n    if (!this.state.explorationType) {\n      this.setExplorationType({\n        type: SceneProfilesExplorer.DEFAULT_EXPLORATION_TYPE,\n      });\n    }\n\n    return () => {\n      eventsSub.unsubscribe();\n      varSub.unsubscribe();\n    };\n  }\n\n  getUrlState() {\n    return {\n      explorationType: this.state.explorationType,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    // Don't update from URL if initialFilters are provided - we want to select the LABELS view as we are in embedded mode\n    if (this.initialFilters && this.initialFilters.length > 0) {\n      this.setExplorationType({ type: ExplorationType.LABELS, comesFromUserAction: false });\n      return;\n    }\n\n    if (typeof values.explorationType === 'string' && values.explorationType !== this.state.explorationType) {\n      const type = values.explorationType as ExplorationType;\n      this.setExplorationType({\n        type: Object.values(ExplorationType).includes(type) ? type : SceneProfilesExplorer.DEFAULT_EXPLORATION_TYPE,\n      });\n    }\n  }\n\n  registerRuntimeDataSources() {\n    // wrapped in a try-catch to prevent error when registered twice, which can easily happen if we go back & forth to the Profiles Explorer page\n    try {\n      sceneUtils.registerRuntimeDataSource({ dataSource: new SeriesDataSource() });\n      sceneUtils.registerRuntimeDataSource({ dataSource: new FavoritesDataSource() });\n      sceneUtils.registerRuntimeDataSource({ dataSource: new LabelsDataSource() });\n    } catch (error) {\n      const { message } = error as Error;\n\n      if (!/A runtime data source with uid (.+) has already been registered/.test(message)) {\n        displayError(error as Error, [\n          'Fail to register all the runtime data sources!',\n          'The application cannot work as expected, please try reloading the page or if the problem persists, contact your organization admin.',\n        ]);\n      }\n    }\n  }\n\n  subscribeToVariableChanges() {\n    const dataSourceSub = sceneGraph\n      .findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable)\n      .subscribeToState((newState, prevState) => {\n        if (newState.value && newState.value !== prevState.value) {\n          FiltersVariable.resetAll(this);\n          this.resetSpanSelector();\n        }\n      });\n\n    const serviceNameSub = sceneGraph\n      .findByKeyAndType(this, 'serviceName', ServiceNameVariable)\n      .subscribeToState((newState, prevState) => {\n        if (newState.value && newState.value !== prevState.value) {\n          FiltersVariable.resetAll(this);\n          // This is to prevent removing the span selector if the previous service name was not correct\n          // This way a user can still select the service name for selected span in case there's a mismatch\n          // in the service name that was provided from the trace\n          if (newState.options.some((option) => option.value === prevState.value)) {\n            this.resetSpanSelector();\n          }\n        }\n      });\n\n    const profileTypeSub = sceneGraph\n      .findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable)\n      .subscribeToState((newState, prevState) => {\n        if (newState.value && newState.value !== prevState.value) {\n          this.resetSpanSelector();\n        }\n      });\n\n    const filtersSub = sceneGraph\n      .findByKeyAndType(this, 'filters', FiltersVariable)\n      .subscribeToState((newState, prevState) => {\n        if (JSON.stringify(newState.filters) !== JSON.stringify(prevState.filters)) {\n          this.resetSpanSelector();\n        }\n      });\n\n    return {\n      unsubscribe() {\n        serviceNameSub.unsubscribe();\n        dataSourceSub.unsubscribe();\n        filtersSub.unsubscribe();\n        profileTypeSub.unsubscribe();\n      },\n    };\n  }\n\n  subscribeToEvents() {\n    const profilesSub = this.subscribeToEvent(EventViewServiceProfiles, (event) => {\n      this.setExplorationType({\n        type: ExplorationType.PROFILE_TYPES,\n        comesFromUserAction: true,\n        item: event.payload.item,\n      });\n    });\n\n    const labelsSub = this.subscribeToEvent(EventViewServiceLabels, (event) => {\n      this.setExplorationType({\n        type: ExplorationType.LABELS,\n        comesFromUserAction: true,\n        item: event.payload.item,\n      });\n    });\n\n    const flameGraphSub = this.subscribeToEvent(EventViewServiceFlameGraph, (event) => {\n      this.setExplorationType({\n        type: ExplorationType.FLAME_GRAPH,\n        comesFromUserAction: true,\n        item: event.payload.item,\n      });\n    });\n\n    const diffFlameGraphSub = this.subscribeToEvent(EventViewDiffFlameGraph, (event) => {\n      const { useAncestorTimeRange, clearDiffRange, baselineFilters, comparisonFilters } = event.payload;\n\n      this.setExplorationType({\n        type: ExplorationType.DIFF_FLAME_GRAPH,\n        comesFromUserAction: true,\n        bodySceneOptions: {\n          useAncestorTimeRange,\n          clearDiffRange,\n          baselineFilters,\n          comparisonFilters,\n        },\n      });\n    });\n\n    const removeSpanSelectorSub = this.subscribeToEvent(RemoveSpanSelector, () => {\n      this.resetSpanSelector();\n    });\n\n    return {\n      unsubscribe() {\n        diffFlameGraphSub.unsubscribe();\n        flameGraphSub.unsubscribe();\n        labelsSub.unsubscribe();\n        profilesSub.unsubscribe();\n        removeSpanSelectorSub.unsubscribe();\n      },\n    };\n  }\n\n  setExplorationType({\n    type,\n    comesFromUserAction,\n    item,\n    bodySceneOptions,\n  }: {\n    type: ExplorationType;\n    comesFromUserAction?: boolean;\n    item?: GridItemData;\n    bodySceneOptions?: Record<string, any>;\n  }) {\n    if (comesFromUserAction) {\n      prepareHistoryEntry();\n      this.resetVariables(type);\n    }\n\n    this.setState({\n      explorationType: type,\n      body: this.buildBodyScene(type, item, bodySceneOptions),\n    });\n  }\n\n  resetSpanSelector() {\n    sceneGraph.findByKeyAndType(this, 'spanSelector', SpanSelectorVariable).reset();\n  }\n\n  resetVariables(nextExplorationType: string) {\n    sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter).reset();\n    sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable).changeValueTo(GroupByVariable.DEFAULT_VALUE);\n    sceneGraph.findByKeyAndType(this, 'panel-type-switcher', ScenePanelTypeSwitcher).reset();\n    this.resetSpanSelector();\n\n    // preserve existing filters only when switching to \"Labels\", \"Flame graph\" or \"Diff flame graph\"\n    // if not, they will be added to the queries without any notice on the UI\n    if (\n      ![ExplorationType.LABELS, ExplorationType.FLAME_GRAPH, ExplorationType.DIFF_FLAME_GRAPH].includes(\n        nextExplorationType as ExplorationType\n      )\n    ) {\n      sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable).reset();\n    }\n  }\n\n  buildBodyScene(explorationType: ExplorationType, item?: GridItemData, bodySceneOptions?: Record<string, any>) {\n    let primary;\n\n    switch (explorationType) {\n      case ExplorationType.PROFILE_TYPES:\n        primary = new SceneExploreServiceProfileTypes({ item });\n        break;\n\n      case ExplorationType.LABELS:\n        primary = new SceneExploreServiceLabels({ item });\n        break;\n\n      case ExplorationType.FLAME_GRAPH:\n        primary = new SceneExploreServiceFlameGraph({ item });\n        break;\n\n      case ExplorationType.DIFF_FLAME_GRAPH:\n        primary = new SceneExploreDiffFlameGraph(bodySceneOptions || {});\n        break;\n\n      case ExplorationType.FAVORITES:\n        primary = new SceneExploreFavorites();\n        break;\n\n      case ExplorationType.ALL_SERVICES:\n      default:\n        primary = new SceneExploreAllServices();\n    }\n\n    return new SplitLayout({\n      direction: 'column',\n      primary,\n    });\n  }\n\n  onChangeExplorationType = (explorationType: string) => {\n    reportInteraction('g_pyroscope_app_exploration_type_clicked', { explorationType });\n\n    this.setExplorationType({\n      type: explorationType as ExplorationType,\n      comesFromUserAction: true,\n    });\n  };\n\n  useProfilesExplorer = (): DomainHookReturnValue => {\n    const { explorationType, controls, body, $variables } = this.useState();\n\n    const dataSourceVariable = $variables.state.variables[0] as ProfilesDataSourceVariable;\n    const dataSourceUid = dataSourceVariable.useState().value as string;\n\n    return {\n      data: {\n        explorationType,\n        controls,\n        body,\n        $variables,\n        dataSourceUid,\n      },\n      actions: {\n        onChangeExplorationType: this.onChangeExplorationType,\n      },\n    };\n  };\n\n  static Component({ model }: SceneComponentProps<SceneProfilesExplorer>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n\n    const { data, actions } = model.useProfilesExplorer();\n    const { explorationType, controls, body, $variables, dataSourceUid } = data;\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const [recordingRulesModalState, setRecordingRulesModalState] = useState<{\n      isOpen: boolean;\n      functionName?: string;\n    }>({ isOpen: false });\n    const { createRecordingRuleModal, isEmbedded } = model.useState();\n\n    return (\n      <FunctionVersionProvider>\n        <GitHubContextProvider dataSourceUid={dataSourceUid}>\n          <Header\n            explorationType={explorationType}\n            controls={controls}\n            body={body}\n            $variables={$variables}\n            onChangeExplorationType={actions.onChangeExplorationType}\n            isEmbedded={isEmbedded}\n            onCreateRecordingRule={() => {\n              setRecordingRulesModalState({ isOpen: true });\n            }}\n          />\n\n          <div className={styles.body} data-testid=\"sceneBody\">\n            {body && <body.Component model={body} />}\n          </div>\n\n          {recordingRulesModalState.isOpen && (\n            <SceneCreateRecordingRuleModal.Component\n              model={createRecordingRuleModal}\n              isModalOpen={recordingRulesModalState.isOpen}\n              functionName={recordingRulesModalState.functionName}\n              onDismiss={() => setRecordingRulesModalState({ isOpen: false })}\n              onCreated={() => {\n                setRecordingRulesModalState({ isOpen: false });\n              }}\n            />\n          )}\n        </GitHubContextProvider>\n      </FunctionVersionProvider>\n    );\n  }\n}\n\nconst getStyles = () => ({\n  body: css`\n    position: relative;\n    z-index: 0;\n    background: transparent;\n  `,\n});\n","import { HttpClient } from '@shared/infrastructure/http/HttpClient';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\n\ntype UploadResponse = {\n  key: string;\n  url: string;\n  subProfiles: any[]; // TODO: define them, what are they?\n};\n\nclass FlamegraphDotComApiClient extends HttpClient {\n  constructor() {\n    super('https://flamegraph.com/api', {\n      'content-type': 'application/json',\n    });\n  }\n\n  async upload(name: string, profile: FlamebearerProfile): Promise<UploadResponse> {\n    const response = await this.fetch('/upload/v1', {\n      method: 'POST',\n      body: JSON.stringify({\n        name,\n        profile: btoa(JSON.stringify(profile)),\n        fileTypeData: {\n          units: profile.metadata.units,\n          spyName: profile.metadata.spyName,\n        },\n        type: 'json',\n      }),\n    });\n\n    const json = await response.json();\n\n    return json;\n  }\n}\n\nexport const flamegraphDotComApiClient = new FlamegraphDotComApiClient();\n","import { dateTimeParse, TimeRange } from '@grafana/data';\n\nimport { CompareTarget } from '../../../../../pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/types';\n\ntype DateParts = {\n  year: string;\n  month: string;\n  day: string;\n  hour: string;\n  minute: string;\n  second: string;\n};\n\nconst DATETIME_FORMATTER = new Intl.DateTimeFormat('fr-CA', {\n  year: 'numeric',\n  month: '2-digit',\n  day: '2-digit',\n  hour12: false,\n  hour: '2-digit',\n  minute: '2-digit',\n  second: '2-digit',\n});\n\nfunction format(date: Date): string {\n  const parts = DATETIME_FORMATTER.formatToParts(date).reduce((acc, { type, value }) => {\n    acc[type as keyof DateParts] = value;\n    return acc;\n  }, {} as DateParts);\n\n  return `${parts.year}-${parts.month}-${parts.day}_${parts.hour}${parts.minute}`;\n}\n\nfunction dateForExportFilename(timeRange: TimeRange) {\n  const from = new Date(Math.round(timeRange.from.unix() * 1000));\n  const to = new Date(Math.round(timeRange.to.unix() * 1000));\n\n  return `${format(from)}-to-${format(to)}`;\n}\n\nfunction getTimeRange(target: CompareTarget) {\n  const [fromKey, toKey] = target === CompareTarget.BASELINE ? ['diffFrom', 'diffTo'] : ['diffFrom-2', 'diffTo-2'];\n\n  const searchParams = new URLSearchParams(window.location.search);\n  const from = searchParams.get(fromKey) as string;\n  const to = searchParams.get(toKey) as string;\n\n  return {\n    raw: { from, to },\n    from: dateTimeParse(from),\n    to: dateTimeParse(to),\n  };\n}\n\nexport function getExportFilename(appName?: string) {\n  const timeRanges = [\n    'baseline',\n    dateForExportFilename(getTimeRange(CompareTarget.BASELINE)),\n    'comparison',\n    dateForExportFilename(getTimeRange(CompareTarget.COMPARISON)),\n  ];\n\n  return appName ? [appName, ...timeRanges].join('_') : ['flamegraph', ...timeRanges].join('_');\n}\n","import { displayError } from '@shared/domain/displayStatus';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport 'compression-streams-polyfill';\nimport saveAs from 'file-saver';\n\nimport { ExportDataProps } from '../ExportData';\nimport { flamegraphDotComApiClient } from '../infrastructure/flamegraphDotComApiClient';\nimport { getExportFilename } from './getExportFilename';\n\n/* Note: no pprof export, as the underlying API only accepts a single query (see PprofApiClient) */\nexport function useExportMenu({ profile, enableFlameGraphDotComExport }: ExportDataProps) {\n  const downloadPng = () => {\n    reportInteraction('g_pyroscope_app_export_profile', { format: 'png' });\n\n    const customExportName = getExportFilename(profile.metadata.appName);\n    const filename = `${customExportName}.png`;\n\n    // TODO use ref, this won't work for comparison side by side (??!)\n    const canvasElement = document.querySelector('canvas[data-testid=\"flameGraph\"]') as HTMLCanvasElement;\n\n    canvasElement.toBlob((blob) => {\n      if (!blob) {\n        const error = new Error('No Blob, the image cannot be created.');\n        displayError(error, ['Failed to export to png!', error.message]);\n        return;\n      }\n\n      saveAs(blob, filename);\n    }, 'image/png');\n  };\n\n  const downloadJson = () => {\n    reportInteraction('g_pyroscope_app_export_profile', { format: 'json' });\n\n    const customExportName = getExportFilename(profile.metadata.appName);\n    const filename = `${customExportName}.json`;\n    const dataStr = `data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(profile))}`;\n\n    try {\n      saveAs(dataStr, filename);\n    } catch (error) {\n      displayError(error as Error, ['Failed to export to JSON!', (error as Error).message]);\n      return;\n    }\n  };\n\n  const uploadToFlamegraphDotCom = async () => {\n    reportInteraction('g_pyroscope_app_export_profile', { format: 'flamegraph.com' });\n\n    const customExportName = getExportFilename(profile.metadata.appName);\n\n    let response;\n\n    try {\n      response = await flamegraphDotComApiClient.upload(customExportName, profile);\n    } catch (error) {\n      displayError(error as Error, ['Failed to export to flamegraph.com!', (error as Error).message]);\n      return;\n    }\n\n    const dlLink = document.createElement('a');\n    dlLink.target = '_blank';\n    dlLink.href = response.url;\n    document.body.appendChild(dlLink);\n    dlLink.click();\n    document.body.removeChild(dlLink);\n  };\n\n  return {\n    data: {\n      shouldDisplayFlamegraphDotCom: Boolean(enableFlameGraphDotComExport),\n    },\n    actions: {\n      downloadPng,\n      downloadJson,\n      uploadToFlamegraphDotCom,\n    },\n  };\n}\n","import { Menu } from '@grafana/ui';\nimport React from 'react';\n\nimport { useExportMenu } from './domain/useExportMenu';\nimport { ExportDataProps } from './ExportData';\n\nexport function ExportMenu(props: ExportDataProps) {\n  const { actions } = useExportMenu(props);\n\n  return (\n    <Menu>\n      <Menu.Item label=\"png\" onClick={actions.downloadPng} />\n      <Menu.Item label=\"json\" onClick={actions.downloadJson} />\n    </Menu>\n  );\n}\n","import { Button, Dropdown } from '@grafana/ui';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\nimport React, { memo } from 'react';\n\nimport { ExportMenu } from './ExportMenu';\n\nexport type ExportDataProps = {\n  profile: FlamebearerProfile;\n  enableFlameGraphDotComExport?: boolean;\n};\n\nfunction ExportDataComponent(props: ExportDataProps) {\n  const { profile, enableFlameGraphDotComExport } = props;\n\n  return (\n    <Dropdown overlay={<ExportMenu profile={profile} enableFlameGraphDotComExport={enableFlameGraphDotComExport} />}>\n      <Button\n        icon=\"download-alt\"\n        size=\"sm\"\n        variant=\"secondary\"\n        fill=\"outline\"\n        aria-label=\"Export profile data\"\n        tooltip=\"Export profile data\"\n      />\n    </Dropdown>\n  );\n}\n\nexport const ExportData = memo(ExportDataComponent);\n","import { createDataFrame, DataFrameDTO, FieldType } from '@grafana/data';\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nfunction getNodes(level: number[], names: string[], diff: boolean) {\n  const nodes = [];\n  const itemOffset = diff ? 7 : 4;\n\n  for (let i = 0; i < level.length; i += itemOffset) {\n    nodes.push({\n      level: 0,\n      label: diff ? names[level[i + 6]] : names[level[i + 3]],\n      offset: level[i],\n      val: level[i + 1],\n      self: level[i + 2],\n      selfRight: diff ? level[i + 5] : 0,\n      valRight: diff ? level[i + 4] : 0,\n      valTotal: diff ? level[i + 1] + level[i + 4] : level[i + 1],\n      offsetRight: diff ? level[i + 3] : 0,\n      offsetTotal: diff ? level[i] + level[i + 3] : level[i],\n      children: [],\n    });\n  }\n\n  return nodes;\n}\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function flamebearerToDataFrameDTO(levels: number[][], names: string[], unit: string, diff: boolean) {\n  if (!levels.length) {\n    return;\n  }\n\n  const nodeLevels: any[][] = [];\n\n  for (let i = 0; i < levels.length; i++) {\n    nodeLevels[i] = [];\n\n    for (const node of getNodes(levels[i], names, diff)) {\n      node.level = i;\n      nodeLevels[i].push(node);\n\n      if (i > 0) {\n        const prevNodesInLevel = nodeLevels[i].slice(0, -1);\n        const currentNodeStart =\n          prevNodesInLevel.reduce((acc, n) => n.offsetTotal + n.valTotal + acc, 0) + node.offsetTotal;\n\n        const prevLevel = nodeLevels[i - 1];\n        let prevLevelOffset = 0;\n\n        for (const prevLevelNode of prevLevel) {\n          const parentNodeStart = prevLevelOffset + prevLevelNode.offsetTotal;\n          const parentNodeEnd = parentNodeStart + prevLevelNode.valTotal;\n\n          if (parentNodeStart <= currentNodeStart && parentNodeEnd > currentNodeStart) {\n            prevLevelNode.children.push(node);\n            break;\n          } else {\n            prevLevelOffset += prevLevelNode.offsetTotal + prevLevelNode.valTotal;\n          }\n        }\n      }\n    }\n  }\n\n  const root = nodeLevels[0][0];\n  const stack = [root];\n\n  const labelValues = [];\n  const levelValues = [];\n  const selfValues = [];\n  const valueValues = [];\n  const selfRightValues = [];\n  const valueRightValues = [];\n\n  while (stack.length) {\n    const node = stack.shift();\n    labelValues.push(node.label);\n    levelValues.push(node.level);\n    selfValues.push(node.self);\n    valueValues.push(node.val);\n    selfRightValues.push(node.selfRight);\n    valueRightValues.push(node.valRight);\n    stack.unshift(...node.children);\n  }\n\n  let valueUnit = 'short';\n\n  // See format.ts#getFormatter. We have to use Grafana unit string here though.\n  switch (unit) {\n    case 'samples':\n    case 'trace_samples':\n    case 'lock_nanoseconds':\n    case 'nanoseconds':\n      valueUnit = 'ns';\n      break;\n    case 'bytes':\n      valueUnit = 'bytes';\n      break;\n  }\n\n  const fields = [\n    { name: 'level', values: levelValues },\n    { name: 'label', values: labelValues, type: FieldType.string },\n    { name: 'self', values: selfValues, config: { unit: valueUnit } },\n    { name: 'value', values: valueValues, config: { unit: valueUnit } },\n  ];\n\n  if (diff) {\n    fields.push(\n      ...[\n        {\n          name: 'selfRight',\n          values: selfRightValues,\n          config: { unit: valueUnit },\n        },\n        {\n          name: 'valueRight',\n          values: valueRightValues,\n          config: { unit: valueUnit },\n        },\n      ]\n    );\n  }\n\n  const frame: DataFrameDTO = {\n    name: 'response',\n    meta: { preferredVisualisationType: 'flamegraph' },\n    fields,\n  };\n\n  return createDataFrame(frame);\n}\n","import { createTheme } from '@grafana/data';\nimport { FlameGraph as GrafanaFlameGraph, Props } from '@grafana/flamegraph';\nimport { useTheme2 } from '@grafana/ui';\nimport React, { memo, useMemo } from 'react';\n\nimport type { FlamebearerProfile } from '../../types/FlamebearerProfile';\nimport { ExportData } from './components/ExportData';\nimport { flamebearerToDataFrameDTO } from './domain/flamebearerToDataFrameDTO';\n\ntype FlameGraphProps = {\n  profile: FlamebearerProfile;\n  diff?: boolean;\n  vertical?: boolean;\n  enableFlameGraphDotComExport?: boolean;\n  collapsedFlamegraphs?: boolean;\n  getExtraContextMenuButtons?: Props['getExtraContextMenuButtons'];\n  showAnalyzeWithAssistant?: boolean;\n};\n\nfunction FlameGraphComponent({\n  profile,\n  diff,\n  vertical,\n  enableFlameGraphDotComExport,\n  collapsedFlamegraphs,\n  getExtraContextMenuButtons,\n  showAnalyzeWithAssistant,\n}: FlameGraphProps) {\n  const { isLight } = useTheme2();\n  const getTheme = () => createTheme({ colors: { mode: isLight ? 'light' : 'dark' } });\n\n  const dataFrame = useMemo(\n    () =>\n      flamebearerToDataFrameDTO(\n        profile.flamebearer.levels,\n        profile.flamebearer.names,\n        profile.metadata.units,\n        Boolean(diff)\n      ),\n    [profile, diff]\n  );\n\n  return (\n    <GrafanaFlameGraph\n      data={dataFrame as any}\n      disableCollapsing={!collapsedFlamegraphs}\n      extraHeaderElements={<ExportData profile={profile} enableFlameGraphDotComExport={enableFlameGraphDotComExport} />}\n      vertical={vertical}\n      getTheme={getTheme as any}\n      getExtraContextMenuButtons={getExtraContextMenuButtons}\n      keepFocusOnDataChange\n      showAnalyzeWithAssistant={showAnalyzeWithAssistant}\n    />\n  );\n}\n\nexport const FlameGraph = memo(FlameGraphComponent);\n","import { AppEvents } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nexport function displayError(error: Error, msgs: string[]) {\n  const context = msgs.reduce((acc, msg, i) => ({ ...acc, [`info${i + 1}`]: msg }), { handheldBy: 'displayError' });\n\n  logger.error(error, context);\n\n  getAppEvents().publish({\n    type: AppEvents.alertError.name,\n    payload: msgs,\n  });\n}\n\nexport function displayWarning(msgs: string[]) {\n  logger.warn(msgs);\n\n  getAppEvents().publish({\n    type: AppEvents.alertWarning.name,\n    payload: msgs,\n  });\n}\n\nexport function displaySuccess(msgs: string[]) {\n  getAppEvents().publish({\n    type: AppEvents.alertSuccess.name,\n    payload: msgs,\n  });\n}\n","export const noOp = () => {};\n","import { config, reportInteraction as grafanaReportInteraction } from '@grafana/runtime';\nimport { ScaleDistribution } from '@grafana/schema';\nimport { ActionType } from 'xstate';\n\nimport { PYROSCOPE_APP_ID, ROUTES } from '../../constants';\nimport { LayoutType } from '../../pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { PanelType } from '../../pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { GIT_COMMIT } from '../../version';\n\nexport type PageName = 'explore' | 'settings' | 'ad_hoc';\n\n// hey future dev: don't forget to add any new value to our features tracking dashboard!\nexport type Interactions = {\n  g_pyroscope_app_page_initialized: {\n    page: PageName;\n  };\n\n  g_pyroscope_app_ad_hoc_file_dropped: {\n    fileType: string;\n  };\n  g_pyroscope_app_ad_hoc_file_removed: {};\n  g_pyroscope_app_ad_hoc_profile_metric_selected: {};\n  g_pyroscope_app_ad_hoc_profile: {};\n  g_pyroscope_app_compare_link_clicked: {};\n  g_pyroscope_app_diff_auto_select_clicked: {};\n  g_pyroscope_app_diff_choose_preset_clicked: {};\n  g_pyroscope_app_diff_learn_how_clicked: {};\n  g_pyroscope_app_diff_preset_save_clicked: {};\n  g_pyroscope_app_diff_preset_selected: {\n    value: string;\n  };\n  g_pyroscope_app_exclude_action_clicked: {};\n  g_pyroscope_app_explain_flamegraph_clicked: {};\n  g_pyroscope_app_exploration_type_clicked: {\n    explorationType: string;\n  };\n  g_pyroscope_app_export_profile: {\n    format: 'png' | 'json' | 'pprof' | 'flamegraph.com';\n  };\n  g_pyroscope_app_fav_action_clicked: {\n    favAfterClick: boolean;\n  };\n  g_pyroscope_app_filters_changed: {\n    name: string;\n    count: number;\n    operators: string[];\n  };\n  g_pyroscope_app_function_details_clicked: {};\n  g_pyroscope_app_group_by_label_clicked: {};\n  g_pyroscope_app_hide_no_data_changed: {\n    hideNoData: 'on' | 'off';\n  };\n  g_pyroscope_app_include_action_clicked: {};\n  g_pyroscope_app_layout_changed: {\n    layout: LayoutType;\n  };\n  g_pyroscope_app_open_in_explore_clicked: {};\n  g_pyroscope_app_open_recording_rules_view: {};\n  g_pyroscope_app_optimize_code_clicked: {};\n  g_pyroscope_app_panel_type_changed: {\n    panelType: PanelType;\n  };\n  g_pyroscope_app_profile_metric_selected: {};\n  g_pyroscope_app_quick_filter_focused: {};\n  g_pyroscope_app_select_action_clicked: {\n    type: ActionType;\n  };\n  g_pyroscope_app_service_name_selected: {};\n  g_pyroscope_app_share_link_clicked: {};\n  g_pyroscope_app_timeseries_scale_changed: {\n    scale: ScaleDistribution;\n  };\n  g_pyroscope_app_upload_ad_hoc_clicked: {};\n  g_pyroscope_app_user_settings_clicked: {};\n};\n\nconst PROFILES_EXPLORER_PAGE_NAME = ROUTES.EXPLORE.slice(1);\n\nfunction getCurrentPage(): string {\n  const { pathname } = new URL(window.location.toString());\n  return pathname.split('/').pop() || '';\n}\n\nfunction getMetaProperties() {\n  const meta: Record<string, any> = {\n    // same naming as Faro (see src/shared/infrastructure/tracking/faro/faro.ts)\n    appRelease: config.apps[PYROSCOPE_APP_ID].version,\n    appVersion: GIT_COMMIT,\n    page: getCurrentPage(),\n  };\n\n  if (meta.page === PROFILES_EXPLORER_PAGE_NAME) {\n    // same naming as Faro (see src/shared/infrastructure/tracking/faro/faro.ts)\n    meta.view = new URLSearchParams(window.location.search).get('explorationType') || '';\n  }\n\n  return meta;\n}\n\nexport function reportInteraction<E extends keyof Interactions, P extends Interactions[E]>(\n  interactionName: E,\n  props?: P\n) {\n  grafanaReportInteraction(interactionName, {\n    props,\n    meta: getMetaProperties(),\n  });\n}\n","type ParsedQuery = {\n  serviceId: string;\n  profileMetricId: string;\n  labelsSelector: string;\n  labels: string[];\n};\n\nexport function parseQuery(query: string): ParsedQuery {\n  const [, serviceId = ''] = query.match(/.+\\{.*service_name=\"([^\"]+)\".*\\}/) || [];\n  const [, profileMetricId = ''] = query.match(/([^{]+)\\{.*}/) || [];\n\n  const labelsSelector = query.substring(query.indexOf('{'));\n\n  const labels = labelsSelector\n    .replace(/(\\{|\\})/, '')\n    .split(',')\n    .map((m) => m.match(/\\W*([^=!~]+)(=|!=|=~|!~)\"(.*)\"/)?.[0])\n    .filter((label) => label && !label.includes('service_name')) as string[];\n\n  return { serviceId, profileMetricId, labelsSelector, labels };\n}\n\ntype BuildQueryParams = {\n  serviceId: string;\n  profileMetricId: string;\n  labels?: string[];\n};\n\nexport const buildQuery = ({ serviceId, profileMetricId, labels }: BuildQueryParams): string =>\n  labels?.length\n    ? `${profileMetricId}{service_name=\"${serviceId}\",${labels.join()}}`\n    : `${profileMetricId}{service_name=\"${serviceId}\"}`;\n","import { displayWarning } from '@shared/domain/displayStatus';\nimport { DEFAULT_SETTINGS } from '@shared/infrastructure/settings/PluginSettings';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { useUrlSearchParams } from './useUrlSearchParams';\n\nfunction useSetDefaultMaxNodes(hasMaxNodes: boolean, setMaxNodes: (newMaxNodes: number) => void) {\n  const { isFetching, error, settings } = useFetchPluginSettings({ enabled: !hasMaxNodes });\n\n  if (hasMaxNodes || isFetching) {\n    return;\n  }\n\n  if (error) {\n    displayWarning([\n      'Error while retrieving the plugin settings!',\n      'Some features might not work as expected (e.g. flame graph max nodes). Please try to reload the page, sorry for the inconvenience.',\n    ]);\n    logger.error(error);\n\n    setMaxNodes(DEFAULT_SETTINGS.maxNodes);\n\n    return;\n  }\n\n  setMaxNodes(settings!.maxNodes);\n}\n\nexport function useMaxNodesFromUrl(): [number | null, (newMaxNodes: number) => void] {\n  const { searchParams, pushNewUrl } = useUrlSearchParams();\n  const maxNodes = Number(searchParams.get('maxNodes') ?? '');\n\n  const setMaxNodes = (newMaxNodes: number) => {\n    pushNewUrl({ maxNodes: String(newMaxNodes) });\n  };\n\n  useSetDefaultMaxNodes(maxNodes > 0, setMaxNodes);\n\n  return [maxNodes, setMaxNodes];\n}\n","import { useLocation, useNavigate } from 'react-router-dom';\n\nexport function useUrlSearchParams() {\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  return {\n    searchParams: new URLSearchParams(location.search),\n    pushNewUrl: (newParams: Record<string, string>) => {\n      const newSearchParams = new URLSearchParams(window.location.search);\n\n      for (const [key, value] of Object.entries(newParams)) {\n        newSearchParams.set(key, value);\n      }\n\n      navigate({ search: newSearchParams.toString() }, { replace: true });\n    },\n  };\n}\n","import { DataSourceInstanceSettings, DataSourceJsonData } from '@grafana/data';\nimport { config } from '@grafana/runtime';\n\nimport { logger } from '../tracking/logger';\nimport { userStorage } from '../userStorage';\nimport { HttpClient } from './HttpClient';\n\nconst PYROSCOPE_DATA_SOURCES_TYPE = 'grafana-pyroscope-datasource';\nconst PYROSCOPE_URL_SEARCH_PARAM_NAME = 'var-dataSource'; // matches with the Scenes library\n\ntype CustomDataSourceJsonData = { overridesDefault: boolean };\ntype CustomDataSourceInstanceSettings = DataSourceInstanceSettings<DataSourceJsonData & CustomDataSourceJsonData>;\n\n/**\n * An HTTP client ready to fetch data from the plugin's backend\n */\nexport class ApiClient extends HttpClient {\n  static getPyroscopeDataSources() {\n    return Object.values(config.datasources).filter((ds) => ds.type === PYROSCOPE_DATA_SOURCES_TYPE);\n  }\n\n  static selectDefaultDataSource() {\n    const pyroscopeDataSources = ApiClient.getPyroscopeDataSources() as CustomDataSourceInstanceSettings[];\n\n    const uidFromUrl = new URL(window.location.href).searchParams.get(PYROSCOPE_URL_SEARCH_PARAM_NAME);\n    const uidFromLocalStorage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER)?.dataSource;\n\n    const defaultDataSource =\n      pyroscopeDataSources.find((ds) => ds.uid === uidFromUrl) ||\n      pyroscopeDataSources.find((ds) => ds.uid === uidFromLocalStorage) ||\n      pyroscopeDataSources.find((ds) => ds.jsonData.overridesDefault) ||\n      pyroscopeDataSources.find((ds) => ds.isDefault) ||\n      pyroscopeDataSources[0];\n\n    if (!defaultDataSource) {\n      logger.warn(\n        'Cannot find any Pyroscope data source! Please add and configure a Pyroscope data source to your Grafana instance.'\n      );\n\n      // because we instantiate most of our API clients before exporting them,\n      // we have to return a dummy data source to prevent the whole app to fail\n      return { uid: 'no-data-source-configured' };\n    }\n\n    return defaultDataSource;\n  }\n\n  static getBaseUrl() {\n    const pyroscopeDataSource = ApiClient.selectDefaultDataSource();\n\n    let appSubUrl = config.appSubUrl || '';\n    if (appSubUrl.at(-1) !== '/') {\n      // ensures that the API pathname is appended correctly (appUrl seems to always have it but better to be extra careful)\n      appSubUrl += '/';\n    }\n\n    return `${appSubUrl}api/datasources/proxy/uid/${pyroscopeDataSource.uid}`;\n  }\n\n  constructor() {\n    super(ApiClient.getBaseUrl().toString(), {\n      'content-type': 'application/json',\n      'X-Grafana-Org-Id': String(config.bootData?.user?.orgId || ''),\n    });\n  }\n}\n","export class HttpClientError extends Error {\n  response: Response;\n  reason?: any;\n\n  constructor(response: Response, responseJson?: Record<string, any>) {\n    let message = `HTTP ${response.status} (${response.statusText || '?'})`;\n\n    if (responseJson?.message) {\n      message = `${message}  ${responseJson.message}`;\n    }\n\n    super(message);\n\n    this.response = response;\n  }\n}\n","import { noOp } from '@shared/domain/noOp';\n\nimport { HttpClientError } from './HttpClientError';\n\nexport class HttpClient {\n  baseUrl = '';\n  defaultHeaders = {};\n  abortController?: AbortController | null = null;\n\n  constructor(baseUrl: string, defaultHeaders: Record<string, string> = {}) {\n    this.baseUrl = baseUrl;\n    this.defaultHeaders = Object.freeze(defaultHeaders);\n  }\n\n  async fetch(pathname: string, options?: RequestInit) {\n    this.abortController = new AbortController();\n    const { signal } = this.abortController;\n\n    const fullUrl = `${this.baseUrl}${pathname}`;\n    const headers = { ...this.defaultHeaders, ...options?.headers };\n    const fullOptions = {\n      signal, // we allow signal to be passed as an option\n      ...options,\n      headers,\n    };\n\n    let response;\n\n    try {\n      response = await fetch(fullUrl, fullOptions);\n\n      if (!response.ok) {\n        throw new HttpClientError(response, await response.json().catch(noOp));\n      }\n    } catch (error) {\n      if (this.isAbortError(error)) {\n        (error as any).reason = options?.signal?.reason || signal.reason;\n      }\n\n      throw error;\n    } finally {\n      this.abortController = null;\n    }\n\n    return response;\n  }\n\n  abort(reason?: any) {\n    if (this.abortController) {\n      this.abortController.abort(reason);\n    }\n  }\n\n  isAbortError(error: unknown) {\n    return error instanceof DOMException && error.name === 'AbortError';\n  }\n}\n","import PROFILE_METRICS from './profile-metrics.json';\n\nexport type ProfileMetricId = keyof typeof PROFILE_METRICS;\n\nexport type ProfileMetric = {\n  id: ProfileMetricId;\n  description: string;\n  type: string;\n  group: string;\n  unit: string; // TODO: enum\n};\n\nexport function getProfileMetric(profileMetricId: ProfileMetricId): ProfileMetric {\n  if (PROFILE_METRICS[profileMetricId]) {\n    return PROFILE_METRICS[profileMetricId] as ProfileMetric;\n  }\n\n  const [group = '?', type = '?'] = profileMetricId ? profileMetricId.split(':') : [];\n\n  // TODO: add missing metrics (e.g. godeltaprof are not yet defined)\n  // logger.warn(`No profile metric found for id \"${profileMetricId}\"`);\n\n  return {\n    id: profileMetricId,\n    description: '',\n    type,\n    group,\n    unit: 'short',\n  };\n}\n","import { QueryClient } from '@tanstack/react-query';\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      networkMode: 'always',\n      retry: false,\n      refetchOnWindowFocus: false,\n    },\n  },\n});\n","// @generated by protoc-gen-es v2.2.3 with parameter \"target=ts\"\n// @generated from file types/v1/types.proto (package types.v1, syntax proto3)\n/* eslint-disable */\n\nimport type { GenEnum, GenFile, GenMessage } from \"@bufbuild/protobuf/codegenv1\";\nimport { enumDesc, fileDesc, messageDesc } from \"@bufbuild/protobuf/codegenv1\";\nimport type { Message } from \"@bufbuild/protobuf\";\n\n/**\n * Describes the file types/v1/types.proto.\n */\nexport const file_types_v1_types: GenFile = /*@__PURE__*/\n  fileDesc(\"ChR0eXBlcy92MS90eXBlcy5wcm90bxIIdHlwZXMudjEiKAoJTGFiZWxQYWlyEgwKBG5hbWUYASABKAkSDQoFdmFsdWUYAiABKAkiewoLUHJvZmlsZVR5cGUSCgoCSUQYASABKAkSDAoEbmFtZRgCIAEoCRITCgtzYW1wbGVfdHlwZRgEIAEoCRITCgtzYW1wbGVfdW5pdBgFIAEoCRITCgtwZXJpb2RfdHlwZRgGIAEoCRITCgtwZXJpb2RfdW5pdBgHIAEoCSItCgZMYWJlbHMSIwoGbGFiZWxzGAEgAygLMhMudHlwZXMudjEuTGFiZWxQYWlyIk4KBlNlcmllcxIjCgZsYWJlbHMYASADKAsyEy50eXBlcy52MS5MYWJlbFBhaXISHwoGcG9pbnRzGAIgAygLMg8udHlwZXMudjEuUG9pbnQiWwoFUG9pbnQSDQoFdmFsdWUYASABKAESEQoJdGltZXN0YW1wGAIgASgDEjAKC2Fubm90YXRpb25zGAMgAygLMhsudHlwZXMudjEuUHJvZmlsZUFubm90YXRpb24iLwoRUHJvZmlsZUFubm90YXRpb24SCwoDa2V5GAEgASgJEg0KBXZhbHVlGAIgASgJIlAKEkxhYmVsVmFsdWVzUmVxdWVzdBIMCgRuYW1lGAEgASgJEhAKCG1hdGNoZXJzGAIgAygJEg0KBXN0YXJ0GAMgASgDEgsKA2VuZBgEIAEoAyIkChNMYWJlbFZhbHVlc1Jlc3BvbnNlEg0KBW5hbWVzGAEgAygJIkEKEUxhYmVsTmFtZXNSZXF1ZXN0EhAKCG1hdGNoZXJzGAEgAygJEg0KBXN0YXJ0GAIgASgDEgsKA2VuZBgDIAEoAyIjChJMYWJlbE5hbWVzUmVzcG9uc2USDQoFbmFtZXMYASADKAkikQEKCUJsb2NrSW5mbxIMCgR1bGlkGAEgASgJEhAKCG1pbl90aW1lGAIgASgDEhAKCG1heF90aW1lGAMgASgDEi0KCmNvbXBhY3Rpb24YBCABKAsyGS50eXBlcy52MS5CbG9ja0NvbXBhY3Rpb24SIwoGbGFiZWxzGAUgAygLMhMudHlwZXMudjEuTGFiZWxQYWlyIkIKD0Jsb2NrQ29tcGFjdGlvbhINCgVsZXZlbBgBIAEoBRIPCgdzb3VyY2VzGAIgAygJEg8KB3BhcmVudHMYAyADKAkiXAoSU3RhY2tUcmFjZVNlbGVjdG9yEiUKCWNhbGxfc2l0ZRgBIAMoCzISLnR5cGVzLnYxLkxvY2F0aW9uEh8KBmdvX3BnbxgCIAEoCzIPLnR5cGVzLnYxLkdvUEdPIhgKCExvY2F0aW9uEgwKBG5hbWUYASABKAkiOgoFR29QR08SFgoOa2VlcF9sb2NhdGlvbnMYASABKA0SGQoRYWdncmVnYXRlX2NhbGxlZXMYAiABKAgiGAoWR2V0UHJvZmlsZVN0YXRzUmVxdWVzdCJqChdHZXRQcm9maWxlU3RhdHNSZXNwb25zZRIVCg1kYXRhX2luZ2VzdGVkGAEgASgIEhsKE29sZGVzdF9wcm9maWxlX3RpbWUYAiABKAMSGwoTbmV3ZXN0X3Byb2ZpbGVfdGltZRgDIAEoAyprChlUaW1lU2VyaWVzQWdncmVnYXRpb25UeXBlEiQKIFRJTUVfU0VSSUVTX0FHR1JFR0FUSU9OX1RZUEVfU1VNEAASKAokVElNRV9TRVJJRVNfQUdHUkVHQVRJT05fVFlQRV9BVkVSQUdFEAFiBnByb3RvMw\");\n\n/**\n * @generated from message types.v1.LabelPair\n */\nexport type LabelPair = Message<\"types.v1.LabelPair\"> & {\n  /**\n   * @generated from field: string name = 1;\n   */\n  name: string;\n\n  /**\n   * @generated from field: string value = 2;\n   */\n  value: string;\n};\n\n/**\n * Describes the message types.v1.LabelPair.\n * Use `create(LabelPairSchema)` to create a new message.\n */\nexport const LabelPairSchema: GenMessage<LabelPair> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 0);\n\n/**\n * @generated from message types.v1.ProfileType\n */\nexport type ProfileType = Message<\"types.v1.ProfileType\"> & {\n  /**\n   * @generated from field: string ID = 1;\n   */\n  ID: string;\n\n  /**\n   * @generated from field: string name = 2;\n   */\n  name: string;\n\n  /**\n   * @generated from field: string sample_type = 4;\n   */\n  sampleType: string;\n\n  /**\n   * @generated from field: string sample_unit = 5;\n   */\n  sampleUnit: string;\n\n  /**\n   * @generated from field: string period_type = 6;\n   */\n  periodType: string;\n\n  /**\n   * @generated from field: string period_unit = 7;\n   */\n  periodUnit: string;\n};\n\n/**\n * Describes the message types.v1.ProfileType.\n * Use `create(ProfileTypeSchema)` to create a new message.\n */\nexport const ProfileTypeSchema: GenMessage<ProfileType> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 1);\n\n/**\n * @generated from message types.v1.Labels\n */\nexport type Labels = Message<\"types.v1.Labels\"> & {\n  /**\n   * LabelPair is the key value pairs to identify the corresponding profile\n   *\n   * @generated from field: repeated types.v1.LabelPair labels = 1;\n   */\n  labels: LabelPair[];\n};\n\n/**\n * Describes the message types.v1.Labels.\n * Use `create(LabelsSchema)` to create a new message.\n */\nexport const LabelsSchema: GenMessage<Labels> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 2);\n\n/**\n * @generated from message types.v1.Series\n */\nexport type Series = Message<\"types.v1.Series\"> & {\n  /**\n   * @generated from field: repeated types.v1.LabelPair labels = 1;\n   */\n  labels: LabelPair[];\n\n  /**\n   * @generated from field: repeated types.v1.Point points = 2;\n   */\n  points: Point[];\n};\n\n/**\n * Describes the message types.v1.Series.\n * Use `create(SeriesSchema)` to create a new message.\n */\nexport const SeriesSchema: GenMessage<Series> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 3);\n\n/**\n * @generated from message types.v1.Point\n */\nexport type Point = Message<\"types.v1.Point\"> & {\n  /**\n   * @generated from field: double value = 1;\n   */\n  value: number;\n\n  /**\n   * Milliseconds unix timestamp\n   *\n   * @generated from field: int64 timestamp = 2;\n   */\n  timestamp: bigint;\n\n  /**\n   * @generated from field: repeated types.v1.ProfileAnnotation annotations = 3;\n   */\n  annotations: ProfileAnnotation[];\n};\n\n/**\n * Describes the message types.v1.Point.\n * Use `create(PointSchema)` to create a new message.\n */\nexport const PointSchema: GenMessage<Point> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 4);\n\n/**\n * @generated from message types.v1.ProfileAnnotation\n */\nexport type ProfileAnnotation = Message<\"types.v1.ProfileAnnotation\"> & {\n  /**\n   * @generated from field: string key = 1;\n   */\n  key: string;\n\n  /**\n   * @generated from field: string value = 2;\n   */\n  value: string;\n};\n\n/**\n * Describes the message types.v1.ProfileAnnotation.\n * Use `create(ProfileAnnotationSchema)` to create a new message.\n */\nexport const ProfileAnnotationSchema: GenMessage<ProfileAnnotation> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 5);\n\n/**\n * @generated from message types.v1.LabelValuesRequest\n */\nexport type LabelValuesRequest = Message<\"types.v1.LabelValuesRequest\"> & {\n  /**\n   * @generated from field: string name = 1;\n   */\n  name: string;\n\n  /**\n   * @generated from field: repeated string matchers = 2;\n   */\n  matchers: string[];\n\n  /**\n   * @generated from field: int64 start = 3;\n   */\n  start: bigint;\n\n  /**\n   * @generated from field: int64 end = 4;\n   */\n  end: bigint;\n};\n\n/**\n * Describes the message types.v1.LabelValuesRequest.\n * Use `create(LabelValuesRequestSchema)` to create a new message.\n */\nexport const LabelValuesRequestSchema: GenMessage<LabelValuesRequest> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 6);\n\n/**\n * @generated from message types.v1.LabelValuesResponse\n */\nexport type LabelValuesResponse = Message<\"types.v1.LabelValuesResponse\"> & {\n  /**\n   * @generated from field: repeated string names = 1;\n   */\n  names: string[];\n};\n\n/**\n * Describes the message types.v1.LabelValuesResponse.\n * Use `create(LabelValuesResponseSchema)` to create a new message.\n */\nexport const LabelValuesResponseSchema: GenMessage<LabelValuesResponse> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 7);\n\n/**\n * @generated from message types.v1.LabelNamesRequest\n */\nexport type LabelNamesRequest = Message<\"types.v1.LabelNamesRequest\"> & {\n  /**\n   * @generated from field: repeated string matchers = 1;\n   */\n  matchers: string[];\n\n  /**\n   * @generated from field: int64 start = 2;\n   */\n  start: bigint;\n\n  /**\n   * @generated from field: int64 end = 3;\n   */\n  end: bigint;\n};\n\n/**\n * Describes the message types.v1.LabelNamesRequest.\n * Use `create(LabelNamesRequestSchema)` to create a new message.\n */\nexport const LabelNamesRequestSchema: GenMessage<LabelNamesRequest> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 8);\n\n/**\n * @generated from message types.v1.LabelNamesResponse\n */\nexport type LabelNamesResponse = Message<\"types.v1.LabelNamesResponse\"> & {\n  /**\n   * @generated from field: repeated string names = 1;\n   */\n  names: string[];\n};\n\n/**\n * Describes the message types.v1.LabelNamesResponse.\n * Use `create(LabelNamesResponseSchema)` to create a new message.\n */\nexport const LabelNamesResponseSchema: GenMessage<LabelNamesResponse> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 9);\n\n/**\n * @generated from message types.v1.BlockInfo\n */\nexport type BlockInfo = Message<\"types.v1.BlockInfo\"> & {\n  /**\n   * @generated from field: string ulid = 1;\n   */\n  ulid: string;\n\n  /**\n   * @generated from field: int64 min_time = 2;\n   */\n  minTime: bigint;\n\n  /**\n   * @generated from field: int64 max_time = 3;\n   */\n  maxTime: bigint;\n\n  /**\n   * @generated from field: types.v1.BlockCompaction compaction = 4;\n   */\n  compaction?: BlockCompaction;\n\n  /**\n   * @generated from field: repeated types.v1.LabelPair labels = 5;\n   */\n  labels: LabelPair[];\n};\n\n/**\n * Describes the message types.v1.BlockInfo.\n * Use `create(BlockInfoSchema)` to create a new message.\n */\nexport const BlockInfoSchema: GenMessage<BlockInfo> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 10);\n\n/**\n * @generated from message types.v1.BlockCompaction\n */\nexport type BlockCompaction = Message<\"types.v1.BlockCompaction\"> & {\n  /**\n   * @generated from field: int32 level = 1;\n   */\n  level: number;\n\n  /**\n   * @generated from field: repeated string sources = 2;\n   */\n  sources: string[];\n\n  /**\n   * @generated from field: repeated string parents = 3;\n   */\n  parents: string[];\n};\n\n/**\n * Describes the message types.v1.BlockCompaction.\n * Use `create(BlockCompactionSchema)` to create a new message.\n */\nexport const BlockCompactionSchema: GenMessage<BlockCompaction> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 11);\n\n/**\n * StackTraceSelector is used for filtering stack traces by locations.\n *\n * @generated from message types.v1.StackTraceSelector\n */\nexport type StackTraceSelector = Message<\"types.v1.StackTraceSelector\"> & {\n  /**\n   * Stack trace of the call site. Root at call_site[0].\n   * Only stack traces having the prefix provided will be selected.\n   * If empty, the filter is ignored.\n   *\n   * @generated from field: repeated types.v1.Location call_site = 1;\n   */\n  callSite: Location[];\n\n  /**\n   * Stack trace selector for profiles purposed for Go PGO.\n   * If set, call_site is ignored.\n   *\n   * @generated from field: types.v1.GoPGO go_pgo = 2;\n   */\n  goPgo?: GoPGO;\n};\n\n/**\n * Describes the message types.v1.StackTraceSelector.\n * Use `create(StackTraceSelectorSchema)` to create a new message.\n */\nexport const StackTraceSelectorSchema: GenMessage<StackTraceSelector> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 12);\n\n/**\n * @generated from message types.v1.Location\n */\nexport type Location = Message<\"types.v1.Location\"> & {\n  /**\n   * @generated from field: string name = 1;\n   */\n  name: string;\n};\n\n/**\n * Describes the message types.v1.Location.\n * Use `create(LocationSchema)` to create a new message.\n */\nexport const LocationSchema: GenMessage<Location> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 13);\n\n/**\n * @generated from message types.v1.GoPGO\n */\nexport type GoPGO = Message<\"types.v1.GoPGO\"> & {\n  /**\n   * Specifies the number of leaf locations to keep.\n   *\n   * @generated from field: uint32 keep_locations = 1;\n   */\n  keepLocations: number;\n\n  /**\n   * Aggregate callees causes the leaf location line number to be ignored,\n   * thus aggregating all callee samples (but not callers).\n   *\n   * @generated from field: bool aggregate_callees = 2;\n   */\n  aggregateCallees: boolean;\n};\n\n/**\n * Describes the message types.v1.GoPGO.\n * Use `create(GoPGOSchema)` to create a new message.\n */\nexport const GoPGOSchema: GenMessage<GoPGO> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 14);\n\n/**\n * @generated from message types.v1.GetProfileStatsRequest\n */\nexport type GetProfileStatsRequest = Message<\"types.v1.GetProfileStatsRequest\"> & {\n};\n\n/**\n * Describes the message types.v1.GetProfileStatsRequest.\n * Use `create(GetProfileStatsRequestSchema)` to create a new message.\n */\nexport const GetProfileStatsRequestSchema: GenMessage<GetProfileStatsRequest> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 15);\n\n/**\n * @generated from message types.v1.GetProfileStatsResponse\n */\nexport type GetProfileStatsResponse = Message<\"types.v1.GetProfileStatsResponse\"> & {\n  /**\n   * Whether we received any data at any time in the past.\n   *\n   * @generated from field: bool data_ingested = 1;\n   */\n  dataIngested: boolean;\n\n  /**\n   * Milliseconds since epoch.\n   *\n   * @generated from field: int64 oldest_profile_time = 2;\n   */\n  oldestProfileTime: bigint;\n\n  /**\n   * Milliseconds since epoch.\n   *\n   * @generated from field: int64 newest_profile_time = 3;\n   */\n  newestProfileTime: bigint;\n};\n\n/**\n * Describes the message types.v1.GetProfileStatsResponse.\n * Use `create(GetProfileStatsResponseSchema)` to create a new message.\n */\nexport const GetProfileStatsResponseSchema: GenMessage<GetProfileStatsResponse> = /*@__PURE__*/\n  messageDesc(file_types_v1_types, 16);\n\n/**\n * @generated from enum types.v1.TimeSeriesAggregationType\n */\nexport enum TimeSeriesAggregationType {\n  /**\n   * @generated from enum value: TIME_SERIES_AGGREGATION_TYPE_SUM = 0;\n   */\n  SUM = 0,\n\n  /**\n   * @generated from enum value: TIME_SERIES_AGGREGATION_TYPE_AVERAGE = 1;\n   */\n  AVERAGE = 1,\n}\n\n/**\n * Describes the enum types.v1.TimeSeriesAggregationType.\n */\nexport const TimeSeriesAggregationTypeSchema: GenEnum<TimeSeriesAggregationType> = /*@__PURE__*/\n  enumDesc(file_types_v1_types, 0);\n\n","// @generated by protoc-gen-es v2.2.3 with parameter \"target=ts\"\n// @generated from file settings/v1/recording_rules.proto (package settings.v1, syntax proto3)\n/* eslint-disable */\n\nimport type { GenEnum, GenFile, GenMessage, GenService } from \"@bufbuild/protobuf/codegenv1\";\nimport { enumDesc, fileDesc, messageDesc, serviceDesc } from \"@bufbuild/protobuf/codegenv1\";\nimport type { LabelPair } from \"../../types/v1/types_pb\";\nimport { file_types_v1_types } from \"../../types/v1/types_pb\";\nimport type { Message } from \"@bufbuild/protobuf\";\n\n/**\n * Describes the file settings/v1/recording_rules.proto.\n */\nexport const file_settings_v1_recording_rules: GenFile = /*@__PURE__*/\n  fileDesc(\"CiFzZXR0aW5ncy92MS9yZWNvcmRpbmdfcnVsZXMucHJvdG8SC3NldHRpbmdzLnYxIiUKF0dldFJlY29yZGluZ1J1bGVSZXF1ZXN0EgoKAmlkGAEgASgJIkQKGEdldFJlY29yZGluZ1J1bGVSZXNwb25zZRIoCgRydWxlGAEgASgLMhouc2V0dGluZ3MudjEuUmVjb3JkaW5nUnVsZSIbChlMaXN0UmVjb3JkaW5nUnVsZXNSZXF1ZXN0IkcKGkxpc3RSZWNvcmRpbmdSdWxlc1Jlc3BvbnNlEikKBXJ1bGVzGAEgAygLMhouc2V0dGluZ3MudjEuUmVjb3JkaW5nUnVsZSL4AQoaVXBzZXJ0UmVjb3JkaW5nUnVsZVJlcXVlc3QSCgoCaWQYASABKAkSEwoLbWV0cmljX25hbWUYAiABKAkSEAoIbWF0Y2hlcnMYAyADKAkSEAoIZ3JvdXBfYnkYBCADKAkSLAoPZXh0ZXJuYWxfbGFiZWxzGAUgAygLMhMudHlwZXMudjEuTGFiZWxQYWlyEhIKCmdlbmVyYXRpb24YBiABKAMSPQoRc3RhY2t0cmFjZV9maWx0ZXIYByABKAsyHS5zZXR0aW5ncy52MS5TdGFja3RyYWNlRmlsdGVySACIAQFCFAoSX3N0YWNrdHJhY2VfZmlsdGVyIkcKG1Vwc2VydFJlY29yZGluZ1J1bGVSZXNwb25zZRIoCgRydWxlGAEgASgLMhouc2V0dGluZ3MudjEuUmVjb3JkaW5nUnVsZSIoChpEZWxldGVSZWNvcmRpbmdSdWxlUmVxdWVzdBIKCgJpZBgBIAEoCSIdChtEZWxldGVSZWNvcmRpbmdSdWxlUmVzcG9uc2UilgIKDVJlY29yZGluZ1J1bGUSCgoCaWQYASABKAkSEwoLbWV0cmljX25hbWUYAiABKAkSFAoMcHJvZmlsZV90eXBlGAMgASgJEhAKCG1hdGNoZXJzGAQgAygJEhAKCGdyb3VwX2J5GAUgAygJEiwKD2V4dGVybmFsX2xhYmVscxgGIAMoCzITLnR5cGVzLnYxLkxhYmVsUGFpchISCgpnZW5lcmF0aW9uGAcgASgDEj0KEXN0YWNrdHJhY2VfZmlsdGVyGAggASgLMh0uc2V0dGluZ3MudjEuU3RhY2t0cmFjZUZpbHRlckgAiAEBEhMKC3Byb3Zpc2lvbmVkGAkgASgIQhQKEl9zdGFja3RyYWNlX2ZpbHRlciJrChBTdGFja3RyYWNlRmlsdGVyEkUKDWZ1bmN0aW9uX25hbWUYASABKAsyKS5zZXR0aW5ncy52MS5TdGFja3RyYWNlRmlsdGVyRnVuY3Rpb25OYW1lSACIAQFCEAoOX2Z1bmN0aW9uX25hbWUiYwocU3RhY2t0cmFjZUZpbHRlckZ1bmN0aW9uTmFtZRIVCg1mdW5jdGlvbl9uYW1lGAEgASgJEiwKC21ldHJpY190eXBlGAIgASgOMhcuc2V0dGluZ3MudjEuTWV0cmljVHlwZSKQAgoSUmVjb3JkaW5nUnVsZVN0b3JlEgoKAmlkGAEgASgJEhMKC21ldHJpY19uYW1lGAIgASgJEh4KFnByb21ldGhldXNfZGF0YV9zb3VyY2UYAyABKAkSEAoIbWF0Y2hlcnMYBCADKAkSEAoIZ3JvdXBfYnkYBSADKAkSLAoPZXh0ZXJuYWxfbGFiZWxzGAYgAygLMhMudHlwZXMudjEuTGFiZWxQYWlyEhIKCmdlbmVyYXRpb24YByABKAMSPQoRc3RhY2t0cmFjZV9maWx0ZXIYCCABKAsyHS5zZXR0aW5ncy52MS5TdGFja3RyYWNlRmlsdGVySACIAQFCFAoSX3N0YWNrdHJhY2VfZmlsdGVyIlkKE1JlY29yZGluZ1J1bGVzU3RvcmUSLgoFcnVsZXMYASADKAsyHy5zZXR0aW5ncy52MS5SZWNvcmRpbmdSdWxlU3RvcmUSEgoKZ2VuZXJhdGlvbhgCIAEoAyoXCgpNZXRyaWNUeXBlEgkKBVRPVEFMEAAyuwMKFVJlY29yZGluZ1J1bGVzU2VydmljZRJhChBHZXRSZWNvcmRpbmdSdWxlEiQuc2V0dGluZ3MudjEuR2V0UmVjb3JkaW5nUnVsZVJlcXVlc3QaJS5zZXR0aW5ncy52MS5HZXRSZWNvcmRpbmdSdWxlUmVzcG9uc2UiABJnChJMaXN0UmVjb3JkaW5nUnVsZXMSJi5zZXR0aW5ncy52MS5MaXN0UmVjb3JkaW5nUnVsZXNSZXF1ZXN0Gicuc2V0dGluZ3MudjEuTGlzdFJlY29yZGluZ1J1bGVzUmVzcG9uc2UiABJqChNVcHNlcnRSZWNvcmRpbmdSdWxlEicuc2V0dGluZ3MudjEuVXBzZXJ0UmVjb3JkaW5nUnVsZVJlcXVlc3QaKC5zZXR0aW5ncy52MS5VcHNlcnRSZWNvcmRpbmdSdWxlUmVzcG9uc2UiABJqChNEZWxldGVSZWNvcmRpbmdSdWxlEicuc2V0dGluZ3MudjEuRGVsZXRlUmVjb3JkaW5nUnVsZVJlcXVlc3QaKC5zZXR0aW5ncy52MS5EZWxldGVSZWNvcmRpbmdSdWxlUmVzcG9uc2UiAGIGcHJvdG8z\", [file_types_v1_types]);\n\n/**\n * @generated from message settings.v1.GetRecordingRuleRequest\n */\nexport type GetRecordingRuleRequest = Message<\"settings.v1.GetRecordingRuleRequest\"> & {\n  /**\n   * @generated from field: string id = 1;\n   */\n  id: string;\n};\n\n/**\n * Describes the message settings.v1.GetRecordingRuleRequest.\n * Use `create(GetRecordingRuleRequestSchema)` to create a new message.\n */\nexport const GetRecordingRuleRequestSchema: GenMessage<GetRecordingRuleRequest> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 0);\n\n/**\n * @generated from message settings.v1.GetRecordingRuleResponse\n */\nexport type GetRecordingRuleResponse = Message<\"settings.v1.GetRecordingRuleResponse\"> & {\n  /**\n   * @generated from field: settings.v1.RecordingRule rule = 1;\n   */\n  rule?: RecordingRule;\n};\n\n/**\n * Describes the message settings.v1.GetRecordingRuleResponse.\n * Use `create(GetRecordingRuleResponseSchema)` to create a new message.\n */\nexport const GetRecordingRuleResponseSchema: GenMessage<GetRecordingRuleResponse> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 1);\n\n/**\n * @generated from message settings.v1.ListRecordingRulesRequest\n */\nexport type ListRecordingRulesRequest = Message<\"settings.v1.ListRecordingRulesRequest\"> & {\n};\n\n/**\n * Describes the message settings.v1.ListRecordingRulesRequest.\n * Use `create(ListRecordingRulesRequestSchema)` to create a new message.\n */\nexport const ListRecordingRulesRequestSchema: GenMessage<ListRecordingRulesRequest> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 2);\n\n/**\n * @generated from message settings.v1.ListRecordingRulesResponse\n */\nexport type ListRecordingRulesResponse = Message<\"settings.v1.ListRecordingRulesResponse\"> & {\n  /**\n   * @generated from field: repeated settings.v1.RecordingRule rules = 1;\n   */\n  rules: RecordingRule[];\n};\n\n/**\n * Describes the message settings.v1.ListRecordingRulesResponse.\n * Use `create(ListRecordingRulesResponseSchema)` to create a new message.\n */\nexport const ListRecordingRulesResponseSchema: GenMessage<ListRecordingRulesResponse> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 3);\n\n/**\n * @generated from message settings.v1.UpsertRecordingRuleRequest\n */\nexport type UpsertRecordingRuleRequest = Message<\"settings.v1.UpsertRecordingRuleRequest\"> & {\n  /**\n   * The unique id of the recording rule. If an id is not provided, this will\n   * create a new recording rule. If an id is provided, it will replace the\n   * existing recording rule.\n   *\n   * @generated from field: string id = 1;\n   */\n  id: string;\n\n  /**\n   * @generated from field: string metric_name = 2;\n   */\n  metricName: string;\n\n  /**\n   * @generated from field: repeated string matchers = 3;\n   */\n  matchers: string[];\n\n  /**\n   * @generated from field: repeated string group_by = 4;\n   */\n  groupBy: string[];\n\n  /**\n   * @generated from field: repeated types.v1.LabelPair external_labels = 5;\n   */\n  externalLabels: LabelPair[];\n\n  /**\n   * The observed generation of this recording rule. If this value does not\n   * match the generation stored in the database, this upsert will be rejected.\n   *\n   * @generated from field: int64 generation = 6;\n   */\n  generation: bigint;\n\n  /**\n   * @generated from field: optional settings.v1.StacktraceFilter stacktrace_filter = 7;\n   */\n  stacktraceFilter?: StacktraceFilter;\n};\n\n/**\n * Describes the message settings.v1.UpsertRecordingRuleRequest.\n * Use `create(UpsertRecordingRuleRequestSchema)` to create a new message.\n */\nexport const UpsertRecordingRuleRequestSchema: GenMessage<UpsertRecordingRuleRequest> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 4);\n\n/**\n * @generated from message settings.v1.UpsertRecordingRuleResponse\n */\nexport type UpsertRecordingRuleResponse = Message<\"settings.v1.UpsertRecordingRuleResponse\"> & {\n  /**\n   * @generated from field: settings.v1.RecordingRule rule = 1;\n   */\n  rule?: RecordingRule;\n};\n\n/**\n * Describes the message settings.v1.UpsertRecordingRuleResponse.\n * Use `create(UpsertRecordingRuleResponseSchema)` to create a new message.\n */\nexport const UpsertRecordingRuleResponseSchema: GenMessage<UpsertRecordingRuleResponse> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 5);\n\n/**\n * @generated from message settings.v1.DeleteRecordingRuleRequest\n */\nexport type DeleteRecordingRuleRequest = Message<\"settings.v1.DeleteRecordingRuleRequest\"> & {\n  /**\n   * @generated from field: string id = 1;\n   */\n  id: string;\n};\n\n/**\n * Describes the message settings.v1.DeleteRecordingRuleRequest.\n * Use `create(DeleteRecordingRuleRequestSchema)` to create a new message.\n */\nexport const DeleteRecordingRuleRequestSchema: GenMessage<DeleteRecordingRuleRequest> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 6);\n\n/**\n * @generated from message settings.v1.DeleteRecordingRuleResponse\n */\nexport type DeleteRecordingRuleResponse = Message<\"settings.v1.DeleteRecordingRuleResponse\"> & {\n};\n\n/**\n * Describes the message settings.v1.DeleteRecordingRuleResponse.\n * Use `create(DeleteRecordingRuleResponseSchema)` to create a new message.\n */\nexport const DeleteRecordingRuleResponseSchema: GenMessage<DeleteRecordingRuleResponse> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 7);\n\n/**\n * @generated from message settings.v1.RecordingRule\n */\nexport type RecordingRule = Message<\"settings.v1.RecordingRule\"> & {\n  /**\n   * The unique id of the recording rule.\n   *\n   * @generated from field: string id = 1;\n   */\n  id: string;\n\n  /**\n   * The name of the recording rule, this does not necessarily need to be\n   * unique.\n   *\n   * @generated from field: string metric_name = 2;\n   */\n  metricName: string;\n\n  /**\n   * Used in the UI to display what type of profile type this recording rule is\n   * generated from.\n   *\n   * This should be the standard format of:\n   *\n   *   <name>:<sample-type>:<sample-unit>:<period-type>:<period-unit>\n   *\n   * For example:\n   *\n   *   process_cpu:cpu:nanoseconds:cpu:nanoseconds\n   *\n   * @generated from field: string profile_type = 3;\n   */\n  profileType: string;\n\n  /**\n   * @generated from field: repeated string matchers = 4;\n   */\n  matchers: string[];\n\n  /**\n   * @generated from field: repeated string group_by = 5;\n   */\n  groupBy: string[];\n\n  /**\n   * @generated from field: repeated types.v1.LabelPair external_labels = 6;\n   */\n  externalLabels: LabelPair[];\n\n  /**\n   * The observed generation of this recording rule. This value should be\n   * provided when making updates to this record, to avoid conflicting\n   * concurrent updates.\n   *\n   * @generated from field: int64 generation = 7;\n   */\n  generation: bigint;\n\n  /**\n   * The stacktrace filter allows filtering on particular function names in the stacktrace.\n   * This allows recording rules to focus on specific functions and calculate their \"total\"\n   * resource usage.\n   *\n   * @generated from field: optional settings.v1.StacktraceFilter stacktrace_filter = 8;\n   */\n  stacktraceFilter?: StacktraceFilter;\n\n  /**\n   * Provisioned rules are added by config and can't be Upsert or Deleted\n   *\n   * @generated from field: bool provisioned = 9;\n   */\n  provisioned: boolean;\n};\n\n/**\n * Describes the message settings.v1.RecordingRule.\n * Use `create(RecordingRuleSchema)` to create a new message.\n */\nexport const RecordingRuleSchema: GenMessage<RecordingRule> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 8);\n\n/**\n * @generated from message settings.v1.StacktraceFilter\n */\nexport type StacktraceFilter = Message<\"settings.v1.StacktraceFilter\"> & {\n  /**\n   * @generated from field: optional settings.v1.StacktraceFilterFunctionName function_name = 1;\n   */\n  functionName?: StacktraceFilterFunctionName;\n};\n\n/**\n * Describes the message settings.v1.StacktraceFilter.\n * Use `create(StacktraceFilterSchema)` to create a new message.\n */\nexport const StacktraceFilterSchema: GenMessage<StacktraceFilter> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 9);\n\n/**\n * @generated from message settings.v1.StacktraceFilterFunctionName\n */\nexport type StacktraceFilterFunctionName = Message<\"settings.v1.StacktraceFilterFunctionName\"> & {\n  /**\n   * @generated from field: string function_name = 1;\n   */\n  functionName: string;\n\n  /**\n   * @generated from field: settings.v1.MetricType metric_type = 2;\n   */\n  metricType: MetricType;\n};\n\n/**\n * Describes the message settings.v1.StacktraceFilterFunctionName.\n * Use `create(StacktraceFilterFunctionNameSchema)` to create a new message.\n */\nexport const StacktraceFilterFunctionNameSchema: GenMessage<StacktraceFilterFunctionName> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 10);\n\n/**\n * @generated from message settings.v1.RecordingRuleStore\n */\nexport type RecordingRuleStore = Message<\"settings.v1.RecordingRuleStore\"> & {\n  /**\n   * @generated from field: string id = 1;\n   */\n  id: string;\n\n  /**\n   * @generated from field: string metric_name = 2;\n   */\n  metricName: string;\n\n  /**\n   * @generated from field: string prometheus_data_source = 3;\n   */\n  prometheusDataSource: string;\n\n  /**\n   * @generated from field: repeated string matchers = 4;\n   */\n  matchers: string[];\n\n  /**\n   * @generated from field: repeated string group_by = 5;\n   */\n  groupBy: string[];\n\n  /**\n   * @generated from field: repeated types.v1.LabelPair external_labels = 6;\n   */\n  externalLabels: LabelPair[];\n\n  /**\n   * @generated from field: int64 generation = 7;\n   */\n  generation: bigint;\n\n  /**\n   * @generated from field: optional settings.v1.StacktraceFilter stacktrace_filter = 8;\n   */\n  stacktraceFilter?: StacktraceFilter;\n};\n\n/**\n * Describes the message settings.v1.RecordingRuleStore.\n * Use `create(RecordingRuleStoreSchema)` to create a new message.\n */\nexport const RecordingRuleStoreSchema: GenMessage<RecordingRuleStore> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 11);\n\n/**\n * @generated from message settings.v1.RecordingRulesStore\n */\nexport type RecordingRulesStore = Message<\"settings.v1.RecordingRulesStore\"> & {\n  /**\n   * @generated from field: repeated settings.v1.RecordingRuleStore rules = 1;\n   */\n  rules: RecordingRuleStore[];\n\n  /**\n   * @generated from field: int64 generation = 2;\n   */\n  generation: bigint;\n};\n\n/**\n * Describes the message settings.v1.RecordingRulesStore.\n * Use `create(RecordingRulesStoreSchema)` to create a new message.\n */\nexport const RecordingRulesStoreSchema: GenMessage<RecordingRulesStore> = /*@__PURE__*/\n  messageDesc(file_settings_v1_recording_rules, 12);\n\n/**\n * @generated from enum settings.v1.MetricType\n */\nexport enum MetricType {\n  /**\n   * @generated from enum value: TOTAL = 0;\n   */\n  TOTAL = 0,\n}\n\n/**\n * Describes the enum settings.v1.MetricType.\n */\nexport const MetricTypeSchema: GenEnum<MetricType> = /*@__PURE__*/\n  enumDesc(file_settings_v1_recording_rules, 0);\n\n/**\n * @generated from service settings.v1.RecordingRulesService\n */\nexport const RecordingRulesService: GenService<{\n  /**\n   * @generated from rpc settings.v1.RecordingRulesService.GetRecordingRule\n   */\n  getRecordingRule: {\n    methodKind: \"unary\";\n    input: typeof GetRecordingRuleRequestSchema;\n    output: typeof GetRecordingRuleResponseSchema;\n  },\n  /**\n   * @generated from rpc settings.v1.RecordingRulesService.ListRecordingRules\n   */\n  listRecordingRules: {\n    methodKind: \"unary\";\n    input: typeof ListRecordingRulesRequestSchema;\n    output: typeof ListRecordingRulesResponseSchema;\n  },\n  /**\n   * @generated from rpc settings.v1.RecordingRulesService.UpsertRecordingRule\n   */\n  upsertRecordingRule: {\n    methodKind: \"unary\";\n    input: typeof UpsertRecordingRuleRequestSchema;\n    output: typeof UpsertRecordingRuleResponseSchema;\n  },\n  /**\n   * @generated from rpc settings.v1.RecordingRulesService.DeleteRecordingRule\n   */\n  deleteRecordingRule: {\n    methodKind: \"unary\";\n    input: typeof DeleteRecordingRuleRequestSchema;\n    output: typeof DeleteRecordingRuleResponseSchema;\n  },\n}> = /*@__PURE__*/\n  serviceDesc(file_settings_v1_recording_rules, 0);\n\n","import { create } from '@bufbuild/protobuf';\nimport { ApiClient } from '@shared/infrastructure/http/ApiClient';\nimport {\n  ListRecordingRulesResponse,\n  MetricType,\n  RecordingRule,\n  StacktraceFilterFunctionNameSchema,\n  StacktraceFilterSchema,\n  UpsertRecordingRuleRequest,\n} from '@shared/pyroscope-api/settings/v1/recording_rules_pb';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\n\nfunction mapRuleToRecordingRuleViewModel(rule: RecordingRule): RecordingRuleViewModel {\n  let serviceName = '';\n  for (let matcher of rule.matchers || []) {\n    if (matcher.includes('service_name=')) {\n      serviceName = matcher?.match(/service_name=\"([^\"]+)\"/)?.[1] || '';\n      break;\n    }\n  }\n\n  const functionName = rule.stacktraceFilter?.functionName?.functionName;\n\n  return {\n    id: rule.id,\n    metricName: rule.metricName,\n    serviceName,\n    profileType: rule.profileType,\n    matchers: rule.matchers,\n    groupBy: rule.groupBy || [],\n    functionName,\n    readonly: rule.provisioned,\n  };\n}\n\nclass RecordingRulesApiClient extends ApiClient {\n  async get(): Promise<RecordingRuleViewModel[]> {\n    return super\n      .fetch('/settings.v1.RecordingRulesService/ListRecordingRules', {\n        method: 'POST',\n        body: JSON.stringify({}),\n      })\n      .then((response) => response.json())\n      .then((json: ListRecordingRulesResponse) => {\n        if (!json.rules) {\n          return [];\n        }\n        return json.rules.map((rule: RecordingRule) => {\n          return mapRuleToRecordingRuleViewModel(rule);\n        });\n      });\n  }\n\n  async create(rule: RecordingRuleViewModel): Promise<void> {\n    const basicMatchers = rule.serviceName ? [`{ service_name=\"${rule.serviceName}\" }`] : [];\n\n    let requestBody: UpsertRecordingRuleRequest = {\n      metricName: rule.metricName,\n      matchers: [...basicMatchers, `{ __profile_type__=\"${rule.profileType}\"}`, ...(rule.matchers || [])],\n      groupBy: rule.groupBy || [],\n    } as UpsertRecordingRuleRequest;\n\n    // Add stacktrace filter if function name is provided\n    if (rule.functionName) {\n      requestBody.stacktraceFilter = create(StacktraceFilterSchema, {\n        functionName: create(StacktraceFilterFunctionNameSchema, {\n          functionName: rule.functionName,\n          metricType: MetricType.TOTAL,\n        }),\n      });\n    }\n\n    return super\n      .fetch('/settings.v1.RecordingRulesService/UpsertRecordingRule', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n      })\n      .then((response) => response.json());\n  }\n\n  async remove(rule: RecordingRuleViewModel): Promise<void> {\n    return super\n      .fetch('/settings.v1.RecordingRulesService/DeleteRecordingRule', {\n        method: 'POST',\n        body: JSON.stringify({\n          id: rule.id,\n        }),\n      })\n      .then((response) => response.json());\n  }\n}\n\nexport const recordingRulesApiClient = new RecordingRulesApiClient();\n","import { HttpClientError } from '@shared/infrastructure/http/HttpClientError';\nimport { recordingRulesApiClient } from '@shared/infrastructure/recording-rules/recordingRulesApiClient';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\n\ntype FetchParams = {\n  enabled?: boolean;\n};\n\ntype FetchResponse = {\n  isFetching: boolean;\n  error: HttpClientError | null;\n  recordingRules?: RecordingRuleViewModel[];\n  mutate: (rule: RecordingRuleViewModel) => Promise<void>;\n  remove: (rule: RecordingRuleViewModel) => Promise<void>;\n};\n\nexport function useFetchRecordingRules({ enabled }: FetchParams = {}): FetchResponse {\n  const queryClient = useQueryClient();\n\n  const { isFetching, error, data } = useQuery<RecordingRuleViewModel[], HttpClientError>({\n    enabled,\n    queryKey: ['recording_rules'],\n    queryFn: () => recordingRulesApiClient.get(),\n  });\n\n  const { mutateAsync: mutate } = useMutation({\n    mutationFn: (rule: RecordingRuleViewModel) => recordingRulesApiClient.create(rule),\n    networkMode: 'always',\n  });\n\n  const { mutateAsync: remove } = useMutation({\n    mutationFn: async (rule: RecordingRuleViewModel) => {\n      await recordingRulesApiClient.remove(rule);\n      await queryClient.invalidateQueries({ queryKey: ['recording_rules'] });\n    },\n    networkMode: 'always',\n  });\n\n  return {\n    isFetching,\n    error: recordingRulesApiClient.isAbortError(error) ? null : error,\n    recordingRules: data,\n    mutate,\n    remove,\n  };\n}\n","export type PluginSettings = {\n  collapsedFlamegraphs: boolean;\n  maxNodes: number;\n  enableFlameGraphDotComExport: boolean;\n  enableFunctionDetails: boolean;\n  enableMetricsFromProfiles?: boolean;\n};\n\nexport const DEFAULT_SETTINGS: PluginSettings = Object.freeze({\n  collapsedFlamegraphs: false,\n  maxNodes: 16384,\n  enableFlameGraphDotComExport: true,\n  enableFunctionDetails: true,\n  enableMetricsFromProfiles: false,\n});\n","import { config } from '@grafana/runtime';\n\nexport const featureToggles = {\n  // @ts-ignore Remove after upgrading grafana/runtime to version including the toggle type\n  metricsFromProfiles: !!config.featureToggles['metricsFromProfiles'],\n  // @ts-ignore Remove after upgrading grafana/runtime to version including the toggle type\n  grafanaAssistantInProfilesDrilldown: !!config.featureToggles['grafanaAssistantInProfilesDrilldown'],\n};\n","import { ApiClient } from '../http/ApiClient';\nimport { PluginSettings } from './PluginSettings';\n\ntype ApiResponse = {\n  settings: Array<{ name: string; value: string }>;\n};\n\nclass SettingsApiClient extends ApiClient {\n  static PLUGIN_SETTING_NAME = 'pluginSettings';\n\n  async get(): Promise<PluginSettings> {\n    return super\n      .fetch('/settings.v1.SettingsService/Get', { method: 'POST', body: JSON.stringify({}) })\n      .then((response) => response.json())\n      .then((json: ApiResponse) => {\n        const setting = json.settings?.find(({ name }) => name === SettingsApiClient.PLUGIN_SETTING_NAME);\n\n        if (!setting) {\n          return {};\n        }\n\n        return JSON.parse(setting.value);\n      });\n  }\n\n  async set(newSettings: PluginSettings) {\n    return super\n      .fetch('/settings.v1.SettingsService/Set', {\n        method: 'POST',\n        body: JSON.stringify({\n          setting: {\n            name: SettingsApiClient.PLUGIN_SETTING_NAME,\n            value: JSON.stringify(newSettings),\n          },\n        }),\n      })\n      .then((response) => response.json());\n  }\n}\n\nexport const useSettingsApiClient = () => {\n  return new SettingsApiClient();\n};\n","import { ApiClient } from '@shared/infrastructure/http/ApiClient';\nimport { useMutation, useQuery } from '@tanstack/react-query';\n\nimport { DEFAULT_SETTINGS, PluginSettings } from './PluginSettings';\nimport { useSettingsApiClient } from './settingsApiClient';\n\ntype FetchParams = {\n  enabled?: boolean;\n};\n\ntype FetchResponse = {\n  isFetching: boolean;\n  error: Error | null;\n  settings?: PluginSettings;\n  mutate: (newSettings: PluginSettings) => Promise<void>;\n};\n\n/**\n * Fetches the plugin settings and, if none/only some have been stored previously, returns adequate default values for the rest of the application\n */\nexport function useFetchPluginSettings({ enabled }: FetchParams = {}): FetchResponse {\n  const settingsApiClient = useSettingsApiClient();\n\n  const { isFetching, error, data } = useQuery({\n    enabled,\n    queryKey: ['settings', 'ds-uid-' + ApiClient.selectDefaultDataSource().uid],\n    queryFn: () =>\n      settingsApiClient.get().then(\n        (json) =>\n          // provide defaults if any value comes null or undefined from the API (which can be the case ;))\n          Object.keys(DEFAULT_SETTINGS).reduce((acc, key) => {\n            acc[key] ??= DEFAULT_SETTINGS[key as keyof PluginSettings]; // TS luv :man_shrug:\n            return acc;\n          }, json as Record<string, any>) as PluginSettings // TS luv :man_shrug:\n      ),\n  });\n\n  const { mutateAsync: mutate } = useMutation({\n    mutationFn: (newSettings: PluginSettings) => settingsApiClient.set(newSettings),\n    networkMode: 'always',\n  });\n\n  return {\n    isFetching,\n    error: settingsApiClient.isAbortError(error) ? null : error,\n    settings: data,\n    mutate,\n  };\n}\n","import { Environment } from '../getEnvironment';\nimport { FaroEnvironment } from './getFaroEnvironment';\n\nexport const FARO_ENVIRONMENTS = new Map<Environment, FaroEnvironment>([\n  // Uncomment this map entry to test from your local machine\n  // [\n  //   'local',\n  //   {\n  //     environment: 'local',\n  //     appName: 'grafana-pyroscope-local',\n  //     faroUrl: 'https://faro-collector-ops-eu-south-0.grafana-ops.net/collect/d6ca259b3387e6ddd641973d0fad3ed0',\n  //   },\n  // ],\n  // Always keep the options below\n  [\n    'dev',\n    {\n      environment: 'dev',\n      appName: 'grafana-pyroscope-dev',\n      faroUrl: 'https://faro-collector-ops-eu-south-0.grafana-ops.net/collect/48e03a2647389f2f6494af7f975b4084',\n    },\n  ],\n  [\n    'ops',\n    {\n      environment: 'ops',\n      appName: 'grafana-pyroscope-ops',\n      faroUrl: 'https://faro-collector-ops-eu-south-0.grafana-ops.net/collect/b5cfd5eeb412cf5e74bd828b4ddd17ff',\n    },\n  ],\n  [\n    'prod',\n    {\n      environment: 'prod',\n      appName: 'grafana-pyroscope-prod',\n      faroUrl: 'https://faro-collector-ops-eu-south-0.grafana-ops.net/collect/6cbe17b3af4b72ce5936bf4d15a5c393',\n    },\n  ],\n]);\n","import { Faro, getWebInstrumentations, initializeFaro } from '@grafana/faro-web-sdk';\nimport { config } from '@grafana/runtime';\n\nimport { PLUGIN_BASE_URL, PYROSCOPE_APP_ID } from '../../../../constants';\nimport { GIT_COMMIT } from '../../../../version';\nimport { getFaroEnvironment } from './getFaroEnvironment';\n\nlet faro: Faro | null = null;\n\nexport const getFaro = () => faro;\nexport const setFaro = (instance: Faro | null) => (faro = instance);\n\nexport function initFaro() {\n  if (getFaro()) {\n    return;\n  }\n\n  const faroEnvironment = getFaroEnvironment();\n  if (!faroEnvironment) {\n    return;\n  }\n\n  const { environment, faroUrl, appName } = faroEnvironment;\n\n  const { apps, bootData, buildInfo } = config;\n\n  const appRelease = apps[PYROSCOPE_APP_ID].version;\n  const userEmail = bootData.user.email;\n  const grafanaVersion = `v${buildInfo.version} (${buildInfo.edition})`;\n\n  setFaro(\n    initializeFaro({\n      url: faroUrl,\n      app: {\n        name: appName,\n        release: appRelease,\n        version: GIT_COMMIT,\n        environment,\n        namespace: grafanaVersion, // :man_shrug:\n      },\n      user: {\n        email: userEmail,\n      },\n      instrumentations: [\n        ...getWebInstrumentations({\n          captureConsole: false,\n        }),\n      ],\n      isolate: true,\n      beforeSend: (event) => {\n        if ((event.meta.page?.url ?? '').includes(PLUGIN_BASE_URL)) {\n          event.meta.view = {\n            name: new URLSearchParams(event.meta.page?.url).get('explorationType') || '',\n          };\n\n          return event;\n        }\n\n        return null;\n      },\n    })\n  );\n}\n","import { Environment, getEnvironment } from '../getEnvironment';\nimport { FARO_ENVIRONMENTS } from './faro-environments';\n\nexport type FaroEnvironment = { environment: Environment; appName: string; faroUrl: string };\n\nexport function getFaroEnvironment() {\n  const environment = getEnvironment();\n\n  if (!environment || !FARO_ENVIRONMENTS.has(environment)) {\n    return;\n  }\n\n  return FARO_ENVIRONMENTS.get(environment) as FaroEnvironment;\n}\n","export type Environment = 'local' | 'dev' | 'ops' | 'prod';\n\nconst MATCHERS: Array<{ regExp: RegExp; environment: Environment }> = [\n  {\n    regExp: /localhost/,\n    environment: 'local',\n  },\n  {\n    regExp: /grafana-dev\\.net/,\n    environment: 'dev',\n  },\n  {\n    regExp: /grafana-ops\\.net/,\n    environment: 'ops',\n  },\n  {\n    regExp: /grafana\\.net/,\n    environment: 'prod',\n  },\n];\n\nexport function getEnvironment(): Environment | null {\n  if (!window?.location?.host) {\n    return null;\n  }\n\n  const found = MATCHERS.find(({ regExp }) => regExp.test(window.location.host));\n\n  return found ? found.environment : null;\n}\n","import { LogLevel } from '@grafana/faro-web-sdk';\nimport { getFaro } from '@shared/infrastructure/tracking/faro/faro';\n\nimport { Environment, getEnvironment } from './getEnvironment';\n\nexport type ErrorContext = Record<string, string>;\n\nexport class Logger {\n  #environment: Environment | null;\n\n  constructor() {\n    this.#environment = getEnvironment();\n  }\n\n  #callConsole(methodName: 'trace' | 'debug' | 'info' | 'log' | 'warn' | 'error', args: any[]) {\n    // silence console in production\n    if (this.#environment !== 'prod') {\n      console[methodName](...args); // eslint-disable-line no-console\n    }\n  }\n\n  trace() {\n    this.#callConsole('trace', []);\n\n    getFaro()?.api.pushLog([], {\n      level: LogLevel.TRACE,\n    });\n  }\n\n  debug(...args: any) {\n    this.#callConsole('debug', args);\n\n    getFaro()?.api.pushLog(args, {\n      level: LogLevel.DEBUG,\n    });\n  }\n\n  info(...args: any) {\n    this.#callConsole('info', args);\n\n    getFaro()?.api.pushLog(args, {\n      level: LogLevel.INFO,\n    });\n  }\n\n  log(...args: any) {\n    this.#callConsole('log', args);\n\n    getFaro()?.api.pushLog(args, {\n      level: LogLevel.LOG,\n    });\n  }\n\n  warn(...args: any) {\n    this.#callConsole('warn', args);\n\n    getFaro()?.api.pushLog(args, {\n      level: LogLevel.WARN,\n    });\n  }\n\n  error(error: Error, context?: ErrorContext) {\n    this.#callConsole('error', [error]);\n\n    if (context) {\n      this.#callConsole('error', ['Error context', context]);\n    }\n\n    // does not report an error, but an exception ;)\n    getFaro()?.api.pushError(error, {\n      context,\n    });\n  }\n}\n\nexport const logger = new Logger();\n","import { logger } from '@shared/infrastructure/tracking/logger';\n\nimport plugin from '../../plugin.json';\n\nclass UserStorage {\n  #storage: Storage = window.localStorage;\n\n  KEYS = {\n    SETTINGS: `${plugin.id}.userSettings`,\n    GITHUB_INTEGRATION: `${plugin.id}.gitHubIntegration`,\n    PROFILES_EXPLORER: `${plugin.id}.profilesExplorer`,\n  };\n\n  has(itemName: string): boolean {\n    return this.#storage.hasOwnProperty(itemName);\n  }\n\n  get(itemName: string): null | any {\n    if (!this.has(itemName)) {\n      return null;\n    }\n\n    try {\n      return JSON.parse(this.#storage.getItem(itemName) as string);\n    } catch (error) {\n      logger.error(error as Error, { info: `Error parsing JSON for storage item \"${itemName}\"!` });\n      return null;\n    }\n  }\n\n  set(itemName: string, value: any): void {\n    try {\n      this.#storage.setItem(itemName, JSON.stringify(value));\n    } catch (error) {\n      logger.error(error as Error, { info: `Error setting storage item \"${itemName}\"!` });\n    }\n  }\n}\n\nexport const userStorage = new UserStorage();\n","import { Alert, AlertVariant } from '@grafana/ui';\nimport { ErrorContext, logger } from '@shared/infrastructure/tracking/logger';\nimport React from 'react';\n\ntype InlineBannerProps = {\n  severity: AlertVariant;\n  title: string;\n  message?: string | React.ReactNode;\n  error?: Error;\n  errorContext?: ErrorContext;\n};\n\nexport function InlineBanner({ severity, title, message, error, errorContext }: InlineBannerProps) {\n  if (error) {\n    logger.error(error, errorContext);\n  }\n\n  return (\n    <Alert title={title} severity={severity}>\n      {error && (\n        <>\n          {error.message}\n          <br />\n        </>\n      )}\n      {message}\n    </Alert>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, usePluginContext } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { Dropdown, IconButton, Menu, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GIT_COMMIT } from '../../version';\nimport { PyroscopeLogo } from './PyroscopeLogo';\n\nconst pluginCommitSha: string = GIT_COMMIT;\nconst pluginCommitURL = `https://github.com/grafana/profiles-drilldown/commit/${pluginCommitSha}`;\n\nconst { buildInfo: grafanaBuildInfo } = config;\n\nfunction InfoMenuHeader() {\n  const styles = useStyles2(getStyles);\n\n  const {\n    meta: {\n      info: { version, updated },\n    },\n  } = usePluginContext() || { meta: { info: { version: '?.?.?', updated: '?' } } };\n\n  return (\n    <div className={styles.menuHeader}>\n      <h5>\n        <PyroscopeLogo size=\"small\" />\n        Grafana Profiles Drilldown v{version}\n      </h5>\n      <div className={styles.subTitle}>Last update: {updated}</div>\n    </div>\n  );\n}\n\nfunction InfoMenu() {\n  const isDev = pluginCommitSha === 'dev';\n  const shortCommitSha = isDev ? pluginCommitSha : pluginCommitSha.slice(0, 8);\n\n  return (\n    <Menu header={<InfoMenuHeader />}>\n      <Menu.Item\n        label={`Commit SHA: ${shortCommitSha}`}\n        icon=\"github\"\n        onClick={() => window.open(pluginCommitURL)}\n        disabled={isDev}\n      />\n      <Menu.Item\n        label=\"Changelog\"\n        icon=\"list-ul\"\n        onClick={() => window.open('https://github.com/grafana/profiles-drilldown/blob/main/CHANGELOG.md')}\n      />\n      <Menu.Item\n        label=\"Contribute\"\n        icon=\"external-link-alt\"\n        onClick={() => window.open('https://github.com/grafana/profiles-drilldown/blob/main/docs/CONTRIBUTING.md')}\n      />\n      <Menu.Item\n        label=\"Documentation\"\n        icon=\"document-info\"\n        onClick={() => window.open('https://grafana.com/docs/grafana/latest/explore/simplified-exploration/profiles')}\n      />\n      <Menu.Item\n        label=\"Report an issue\"\n        icon=\"bug\"\n        onClick={() => window.open('https://github.com/grafana/profiles-drilldown/issues/new?template=bug_report.md')}\n      />\n      <Menu.Divider />\n      <Menu.Item\n        label={`Grafana ${grafanaBuildInfo.edition} v${grafanaBuildInfo.version} (${grafanaBuildInfo.env})`}\n        icon=\"github\"\n        onClick={() => window.open(`https://github.com/grafana/grafana/commit/${grafanaBuildInfo.commit}`)}\n      />\n    </Menu>\n  );\n}\n\nexport function PluginInfo() {\n  return (\n    <Dropdown overlay={() => <InfoMenu />} placement=\"bottom-end\">\n      <IconButton name=\"info-circle\" aria-label=\"Plugin info\" title=\"Plugin info\" />\n    </Dropdown>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  menuHeader: css`\n    padding: ${theme.spacing(0.5, 1)};\n    white-space: nowrap;\n  `,\n  subTitle: css`\n    color: ${theme.colors.text.secondary};\n    font-size: ${theme.typography.bodySmall.fontSize};\n  `,\n});\n","import { css, cx } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ntype PyroscopeLogoProps = {\n  size: 'small' | 'large';\n};\n\nfunction PyroscopeLogoComponent({ size }: PyroscopeLogoProps) {\n  const styles = useStyles2(getStyles);\n  return <img className={cx(styles.logo, size)} src=\"public/plugins/grafana-pyroscope-app/img/logo.svg\" />;\n}\n\nexport const PyroscopeLogo = React.memo(PyroscopeLogoComponent);\n\nconst getStyles = () => ({\n  logo: css`\n    &.small {\n      width: 16px;\n      height: 16px;\n      margin-right: 4px;\n      position: relative;\n      top: -2px;\n    }\n\n    &.large {\n      width: 40px;\n      height: 40px;\n    }\n  `,\n});\n","export const GIT_COMMIT = 'dev';\n"],"names":["PYROSCOPE_APP_ID","plugin","PLUGIN_BASE_URL","ROUTES","CompareTarget","prepareHistoryEntry","history","pushState","EventTimeseriesDataReceived","BusEventWithPayload","type","FilterKind","OperatorKind","FilterPartKind","SuggestionKind","DataSourceProxyClient","HttpClient","constructor","options","bootData","dataSourceUid","appSubUrl","config","at","super","String","user","orgId","this","LabelsApiClient","queryToMatchers","query","labelsIndex","indexOf","substring","length","fetchLabels","from","to","_post","matchers","start","end","then","response","json","fetchLabelValues","labelId","name","pathname","body","fetch","method","JSON","stringify","MemoryCacheClient","buildCacheKey","args","key","arg","get","store","set","data","delete","Map","invariant","check","message","Error","AbstractRepository","setApiClient","apiClient","setCacheClient","cacheClient","cancel","reason","abort","ApiClient","LabelsRepository","parseLabelsResponse","Array","isArray","names","Set","filter","isNotMetaLabelOrServiceName","map","label","value","parseLabelValuesResponse","assertParams","Boolean","listLabels","cacheParams","baseUrl","labelsFromCacheP","labels","fetchP","error","listLabelValues","labelValuesFromCacheP","labelValues","test","labelsRepository","areFiltersEqual","newFilters","previousFilters","newFiltersWithoutPartial","partial","previousFiltersWithoutPartial","every","find","attribute","operator","IsEmptyFilter","buildIsEmptyFilter","filtersToQuery","filters","labelsList","in","serviceNameLabel","match","unshift","replace","join","getLastFilter","isMultipleValuesOperator","isPartialFilter","isEditingOperatorMode","currentOperator","newOperator","includes","isSwitchingOperatorMode","filterUnderEdition","parseRawFilters","rawFilters","matches","matchAll","LABELS_REGEX","REGEX_CHARS_REGEX","queryToFilters","rawLabels","id","nanoid","active","split","v","trim","toggleCompleteFilters","updateFiltersAndQuery","context","isQueryUpToDate","inputParams","actions","cancelAllLoad","setFilterAttribute","assign","event","editFilterAttribute","edition","filterId","undefined","setFilterOperator","editFilterOperator","newEdition","previousOperator","part","shift","setFilterValue","editFilterValue","removeFilter","removeLastFilter","lastFilter","slice","concat","setEdition","changeInputParams","activateFilters","getFilterUnderEdition","guards","shouldSuggestAttributes","shouldSuggestOperators","shouldSuggestValues","isEditing","shouldSuggestValuesAfterOperatorEdition","shouldNotSuggestValuesAfterOperatorEdition","hasPartialFilter","shouldEditAttribute","shouldEditOperator","shouldEditValue","operatorsRepository","list","description","isPrivateLabel","startsWith","handleError","info","DOMException","logger","services","publicLabels","privateLabels","forEach","push","fetchOperators","targetFilter","suggestions","disabled","autoSuggestProxy","always","cond","target","MESSAGES","FILTER_ADD","SELECT_LABEL","SELECT_OPERATOR","SELECT_VALUE","SELECT_VALUES","TYPE_VALUE","LOADING","ERROR_LOAD","SUGGESTIONS_NONE","SUGGESTIONS_DISABLED","isRegexOperator","idle","entry","placeholder","allowCustomValue","defaultContext","on","START_INPUT","EDIT_FILTER","REMOVE_FILTER","REMOVE_LAST_FILTER","CHANGE_INPUT_PARAMS","EXECUTE_QUERY","loadLabels","isVisible","isLoading","invoke","src","onDone","items","some","onError","DISCARD_SUGGESTIONS","displayLabels","SELECT_SUGGESTION","loadLabelValues","displayLabelValues","targetOperator","multiple","noOptionsMessage","loadOperators","displayOperators","Object","freeze","initial","predictableActionArguments","states","buildStateMachine","initialContext","stateMachine","createMachine","actor","interpret","localeCompare","Intl","Collator","sensitivity","compare","placeSelectedValuesFirst","values","a","b","aIsSelected","bIsSelected","MultipleEditionSelect","selection","onCloseMenu","styles","useStyles2","getStyles","defaultValue","useMemo","selectionValues","selectionLabels","i","setValues","useState","sortedOptions","sort","onChange","useCallback","newValues","onInternalCloseMenu","MultiSelect","className","editionSelect","loadingMessage","closeMenuOnSelect","hideSelectedOptions","backspaceRemovesValue","autoFocus","isOpen","invalid","css","SingleEditionInput","onFocus","onBlur","inputRef","useRef","setInvalid","useEffect","current","focus","Input","ref","cx","onKeyUp","e","code","SingleEditionSelect","Select","noOp","ChicletAttributeOperator","onClick","onRemove","chiclet","inactiveChiclet","div","aria-label","Tag","chicletAttribute","chicletOperator","tabIndex","chicletRemoveButton","icon","ChicletAttributeOperatorValue","Tooltip","content","chicletValue","PartialChiclet","partialChiclet","colorIndex","title","activeBackgroundColor","inactiveBorderColor","theme","colors","background","primary","text","maxContrast","secondary","ChicletComponent","TypeError","Chiclet","memo","prevProps","nextProps","chicletsList","editChicletContainer","ChicletsListComponent","onClickChiclet","onRemoveChiclet","onChangeSingleSuggestion","onCloseSingleSuggestionsMenu","onCloseMultipleSuggestionsMenu","data-testid","ChicletsList","select","SingleSelect","onKeyDown","setIsOpen","setTimeout","useEnsureIsOpenHack","DisabledSelect","MultipleSelect","onInternalKeyDown","queryBuilder","controls","executeButton","QueryBuilderComponent","props","internalProps","onChangeQuery","send","setInternalProps","subscribe","stop","useStateMachine","useChicletHandlers","onSingleSelectKeyDown","onCloseSingleMenu","onMultipleSelectKeyDown","onCloseMultipleMenu","queryBuilderId","suggestion","previousSuggestionsIsVisible","state","usePrevious","document","querySelector","blur","useSelectHandlers","onClickExecute","autoExecute","onTransition","off","Button","tooltip","QueryBuilder","PYROSCOPE_DATA_SOURCE","uid","PYROSCOPE_SERIES_DATA_SOURCE","PYROSCOPE_FAVORITES_DATA_SOURCE","PYROSCOPE_LABELS_DATA_SOURCE","ProfileMetricVariable","QueryVariable","onActivate","setState","DEFAULT_VALUE","update","force","loading","lastValueFrom","getValueOptions","buildCascaderOptions","optionsMap","profileMetric","getProfileMetric","group","nameSpaceServices","datasource","QUERY_DEFAULT","refresh","VariableRefresh","onTimeRangeChanged","onSelect","newValue","reportInteraction","skipUrlSync","changeValueTo","bind","addActivationHandler","QUERY_SERVICE_NAME_DEPENDENT","Component","model","cascaderOptions","toString","Icon","iconError","size","Cascader","width","separator","displayAllSelectedLevels","initialValue","changeOnSelect","ServiceNameVariable","setInitialValue","subscribeToState","newState","prevState","storage","userStorage","KEYS","PROFILES_EXPLORER","serviceName","serviceNameFromStorage","initialServiceName","initialFilters","selectNewValue","QUERY_PROFILE_METRIC_DEPENDENT","serviceNames","sortedServiceNames","rootElements","hierarchy","serviceId","parts","currentPath","previousPath","isComplete","has","option","parent","buildServiceNameCascaderOptions","useBuildPyroscopeQuery","sceneObject","filterKey","sceneGraph","findByKeyAndType","profileMetricId","filterExpression","FiltersVariable","ProfilesDataSourceVariable","DataSourceVariable","dataSource","initialDS","pluginId","selectDefaultDataSource","convertPyroscopeToVariableFilter","searchForFilter","found","filtersWithoutFound","f","addToFilters","filterToAdd","includeLabelValue","filterForInclude","foundValues","add","excludeLabelValue","filterForExclude","clearLabelValue","filterForClear","filteredValues","isFilterValid","AdHocFiltersVariable","reset","resetAll","dataSourceSub","unsubscribe","expressionBuilder","count","operators","uniq","getSceneVariableValue","variableName","lookupVariable","getValue","getTimeRange","unix","PanelType","ScenePanelTypeSwitcher","SceneObjectBase","getUrlState","panelType","updateFromUrl","stateUpdate","DEFAULT_PANEL_TYPE","_urlSync","SceneObjectUrlSyncConfig","keys","OPTIONS","RadioButtonGroup","fullWidth","getColorByIndex","index","visTheme","theme2","visualization","getColorByName","palette","getSeriesLabelFieldName","metricField","getSeriesStatsValue","series","displayName","meta","stats","s","withPreventInvalidQuery","queryRunner","profileTypeId","labelSelector","queries","refId","buildErrorData","interpolate","parseQuery","errorMsg","LoadingState","errors","timeRange","buildTimeSeriesQueryRunner","groupBy","limit","annotations","completeFilters","selector","SceneQueryRunner","queryType","addRefId","source","pipe","d","merge","addStats","totalSeriesCount","maxValue","Number","NEGATIVE_INFINITY","allValuesSum","fields","field","reduce","acc","SceneLabelValuesBarGauge","item","sub","$data","Done","getConfig","publishEvent","max","groupByLabel","queryRunnerParams","reduceOptions","calcs","orientation","VizOrientation","Horizontal","displayMode","BarGaugeDisplayMode","Gradient","valueMode","BarGaugeValueMode","Text","showUnfilled","sizing","BarGaugeSizing","Manual","titleSize","valueSize","namePlacement","BarGaugeNamePlacement","Top","minVizHeight","maxVizHeight","legend","showLegend","fieldConfig","defaults","min","thresholds","mode","ThresholdsMode","Percentage","steps","overrides","getOverrides","startColorIndex","matcher","FieldMatcherID","byFrameRefID","properties","fixedColor","headerActions","PanelBuilders","bargauge","setTitle","setData","SceneDataTransformer","transformations","setHeaderActions","build","formatSingleSeriesDisplayName","metricFieldUnit","unit","isRateCalculated","rateCalculated","custom","isRateCalculatedByBackend","displayValue","displayLabel","valueField","displayFormatted","getValueFormat","maxValueFormatted","suffix","SceneLabelValuesHistogram","legendPlacement","TooltipDisplayMode","Single","SortOrder","None","LegendDisplayMode","List","placement","lineWidth","histogram","SceneLabelValuesTable","cardinality","unitValue","filterable","cellOptions","span","container","table","DataTransformerID","reducers","labelsToFields","filterFieldsByName","exclude","renameByRegex","regex","renamePattern","sortBy","desc","computeRoundedTimeRange","Math","floor","valueOf","safeInterpolate","expr","pLimit","LabelsDataSource","RuntimeDataSource","FieldType","other","getParams","scopedVars","range","__sceneObject","labelName","metricFindQuery","_","isActive","warn","variable","labelsWithValuesAndCount","Promise","all","sortedLabels","testDatasource","status","MAX_TIMESERIES_LABEL_VALUES","getProfileMetricLabel","SCALE_TYPES","scaleDistribution","ScaleDistribution","Linear","Log","log","SceneTimeseriesMenu","buildMenuItems","addToInvestigationLink","scaleType","menuItems","subMenu","onClickScaleOption","iconClassName","onClickExplore","existingAddToInvestigationItem","scale","getAncestor","SceneLabelValuesTimeseries","changeScale","exploreUrl","rawTimeRange","exploreState","toURLRange","panelsState","subUrl","urlUtil","renderUrl","panes","schemaVersion","getExploreUrl","raw","getInterpolatedQuery","window","open","timeseries","nonInterpolatedQuery","entries","useGetInvestigationPluginLinkContext","parsedQuery","titleParts","origin","url","location","href","logoPath","PyroscopeLogo","useUpdateMenuItems","link","extensionPointId","pluginLinks","usePluginLinks","links","useGetPluginExtensionLink","VizPanelMenu","dataSub","handleDataStateChange","profileMetricSub","subscribeToProfileMetricChanges","retainPreviousAnnotations","updateBodyConfig","displayAllValues","getAllValuesConfig","handleProfileMetricChange","currentData","buildDescription","fillOpacity","gradientMode","GraphGradientMode","Opacity","pointSize","updateItem","partialItem","updatedItem","hasOwnProperty","isEqual","runQueries","axisLabel","clearFieldConfigCache","setMenu","vizPanelBuilder","BARGAUGE","TABLE","HISTOGRAM","TIMESERIES","throttleInterval","mousePosition","setMousePosition","x","y","updateMousePosition","throttle","clientX","clientY","addEventListener","removeEventListener","GrotNotFound","height","show404","useTheme2","useMousePosition","SVG","isDark","dark404","light404","svg","xPos","yPos","innerWidth","innerHeight","heightRatio","widthRatio","rotation","getIntermediateValue","translation","transform","transformOrigin","transition","display","ratio","EmptyState","Box","paddingY","Stack","direction","alignItems","gap","variant","justifyContent","flexDirection","SceneEmptyState","SceneErrorState","Alert","severity","LayoutType","SceneLayoutSwitcher","layout","DEFAULT_LAYOUT","SceneNoDataSwitcher","hideNoData","InlineSwitch","showLabel","checked","SceneQuickFilter","setPlaceholder","setResultsCount","resultsCount","searchText","DEFAULT_SEARCH_TEXT","clearSearchText","DEBOUNCE_DELAY","prefix","IconButton","spacing","FavoritesDataSource","getAllFavorites","favorites","areFavoritesEqual","f1","f2","exists","favorite","addFavorite","removeFavorite","textParts","interpolateQueryRunnerVariables","interpolatedParams","clone","parsedFilters","uniqBy","FavAction","isFav","isStored","buildFavorite","skipVariablesInterpolation","_variableDependency","VariableDependencyConfig","variableNames","onReferencedVariableValueChanged","favAfterClick","favedButton","notFavedbutton","tooltipPlacement","sortFavGridItems","aIsFav","bIsFav","GRID_AUTO_ROWS","SceneByVariableRepeaterGrid","buildGridItemKey","getGridColumnsTemplate","ROWS","variableSub","renderGridItems","quickFilterSub","subscribeToQuickFilterChange","layoutChangeSub","subscribeToLayoutChange","hideNoDataSub","subscribeToHideNoDataChange","filtersSub","subscribeToFiltersChange","quickFilter","debounce","layoutSwitcher","onChangeState","templateColumns","noDataSwitcher","filtersVariable","buildItemsData","mapOptionToItem","variableValues","filterItems","sortItemsFn","shouldRenderItems","newItems","forceRender","renderErrorState","renderEmptyState","gridItems","vizPanel","setupHideNoData","SceneCSSGridItem","autoRows","children","subscribeToEvent","payload","gridItem","gridItemKey","grid","SceneCSSGridLayout","filteredChildren","c","quickFilterScene","regexes","t","r","RegExp","Spinner","isLazy","$behaviors","behaviors","sync","DashboardCursorSync","Crosshair","EventExpandPanel","EventSelectLabel","EventViewServiceFlameGraph","EventViewServiceLabels","EventViewServiceProfiles","Events","ariaLabel","EventConstructor","SelectAction","buildEvent","lookup","selectButton","fill","SceneExploreAllServices","getVariablesAndGridControls","variables","gridControls","$variables","SceneVariableSet","SceneDrawer","subTitle","close","Drawer","subtitle","closeOnMaskClick","onClose","FavoriteVariable","never","SceneExploreFavorites","expandPanelSub","openExpandedPanelDrawer","drawer","parse","GroupBySelector","mainLabels","onRefresh","labelSelectorRequiredWidth","setLabelSelectorRequiredWidth","availableWidth","setAvailableWidth","useHorizontalLabelSelector","controlsContainer","useResizeObserver","onResize","element","clientWidth","mainOptions","o","otherOptions","fontSize","typography","textWidth","measureText","Field","selected","isClearable","GroupByVariable","RefreshPicker","noIntervalPicker","isOnCanvas","onIntervalChanged","findCurrentOption","parsedValue","MAX_MAIN_LABELS","groupByOptions","spinner","groupByErrorContainer","getMainLabels","SceneMainServiceTimeseries","supportGroupBy","initVariables","buildTimeseries","subscribeToGroupByStateChanges","serviceNameVariable","profileMetricsVariable","_subs","resetTimeseries","timeseriesItem","buildTitle","groupByVariable","onGroupByChanged","resetFilters","MIN_HEIGHT","EventViewDiffFlameGraph","EventSelectForCompare","CompareAction","checkboxRef","showTooltip","setShowTooltip","closest","onMouseEnter","onMouseLeave","show","tooltipAnchor","Checkbox","checkbox","StatsPanel","itemStats","statsDescription","compareActionChecks","onChangeCompareTarget","color","total","inline","BASELINE","COMPARISON","h1","style","compareActions","canvas","border","weak","strong","SceneStatsPanel","SceneGroupByLabels","getCompare","updateCompareActions","getStatsDescription","baselineItem","comparisonItem","getStats","updateStats","compareTarget","WIDTH_IN_PIXELS","SceneLabelValuePanel","buildPanelKey","statsPanel","timeseriesPanel","timeseriesSub","isSelected","main","buildLabelValuesGridQueryRunner","SceneLabelValuesGrid","subscribeOnceToDataChange","groupBySub","subscribeToGroupByChange","refreshSub","subscribeToRefreshClick","Loading","refetchData","onClickRefresh","refreshButton","setAttribute","removeAttribute","labelValue","loadingState","buildVizPanel","marginBottom","EventClearLabelFromFilters","EventExcludeLabelFromFilters","EventIncludeLabelInFilters","FilterButtonsComponent","include","onInclude","onExclude","onClear","isIncludeSelected","isExcludeSelected","getStatus","aria-selected","includeButton","excludeButton","FilterButtons","shape","radius","default","IncludeExcludeAction","CompareControls","onClickCompare","onClickClear","compareIsDisabled","hasSelection","arial-label","compareButton","clearButton","clearButtonActive","medium","initVariablesAndControls","renderBody","panelEventsSub","subscribeToPanelEvents","panelTypeChangeSub","selectLabelSub","selectLabel","selectForCompareSub","selectForCompare","includeFilterSub","includeLabelValueInFilters","excludeFilterSub","excludeLabelValueFromFilters","clearFilterSub","clearLabelValueFromFilters","subscribeToPanelTypeChange","switchToLabelNamesGrid","switchToLabelValuesGrid","buildSceneLabelNamesGrid","clearCompare","buildSceneLabelValuesGrid","groupByValue","filterToInclude","filterToExclude","filterToClear","updateStatsPanels","statsPanels","findAllObjects","panel","onClickCompareButton","baselineFilters","comparisonFilters","useAncestorTimeRange","clearDiffRange","onClickClearCompareButton","groupByVariableValue","SceneProfilesExplorer","sceneControls","wrap","control","SceneExploreServiceLabels","profileMetricVariable","timeseriesTitle","SceneFlexLayout","SceneFlexItem","minHeight","SceneExploreServiceProfileTypes","buildTimeRange","dateTimeParse","getDefaultTimeRange","SpanSelectorVariable","CustomVariable","formatSeriesToProfileMetrics","pyroscopeSeries","profileMetricsMap","profileMetrics","formatSeriesToServices","servicesSet","DataSourceProxyClientBuilder","ApiClientClass","cacheKey","cachedInstance","cache","clientInstance","findServiceNameAndProfileMetricId","formatSeriesResponse","labelsSet","serviceProfileMetrics","profileMetricServices","SeriesApiClient","labelNames","seriesRepository","responseFromCacheP","SeriesDataSource","fetchSeries","useCreateRecordingRule","recordingRules","fetchError","mutate","useFetchRecordingRules","save","rule","displaySuccess","metricName","displayError","METRIC_NAME_PREFIX","SceneCreateRecordingRuleModal","isModalOpen","onDismiss","onCreated","functionName","setOptions","explorationType","ExplorationType","ALL_SERVICES","FAVORITES","useCurrentServiceName","filterQuery","ruleForAllServices","register","handleSubmit","formState","useForm","shouldUnregister","profileType","onSubmit","readonly","useMount","Modal","form","MetricNameErrorComponent","alignContent","fontFamily","input","paddingLeft","required","pattern","Controller","render","opt","toggleAllOptions","enabled","Divider","hidden","ButtonRow","ul","errorList","li","EventEnableSyncTimeRanges","EventSyncRefresh","EventSyncTimeRanges","SceneTimePickerWithoutSync","SceneTimePicker","hidePicker","timeZone","getTimeZone","timeRangeState","TimeRangePicker","onTimeRangeChange","fiscalYearStartMonth","onMoveBackward","onMoveForward","onZoom","onChangeTimeZone","onTimeZoneChange","onChangeFiscalYearStartMonth","isSynced","INTERVAL_STRING_REGEX","parseUrlParam","utcValue","toUtc","isValid","toISOString","epoch","parseInt","isNaN","RangeAnnotation","MutableDataFrame","addRange","isRegion","time","boolean","string","addField","TimeRangeWithAnnotationsMode","TIMERANGE_NIL","dateTime","SceneTimeRangeWithAnnotations","omit","getAncestorTimeRange","getTimeseries","updateTimeseriesAnnotation","VizPanel","annotationTimeRange","annotationColor","annotationTitle","annotation","timeEnd","setAnnotationTimeRange","updateTimeseries","nullifyAnnotationTimeRange","diffFrom","diffTo","buildAnnotationTimeRange","delay","hasDelay","dateMath","evaluateTimeRange","UNSAFE_nowDelay","EventSwitchTimerangeSelectionMode","TimerangeSelectionMode","SwitchTimeRangeSelectionModeAction","newMode","dl","dt","dd","buildCompareTimeSeriesQueryRunner","BASELINE_COLORS","COLOR","Color","OVERLAY","alpha","COMPARISON_COLORS","SceneComparePanel","$timeRange","setDiffRange","findByKey","buildTimeseriesTitle","eventSub","subscribeToEvents","buildTimeSeriesPanel","buildSeriesOverrides","configureTimeRange","getProperLabel","formatTotalValue","labelMatch","displayUnit","safeDisplayUnit","formattedValue","ANNOTATIONS","getDiffRange","$annotationTimeRange","switchSub","FLAMEGRAPH","DEFAULT","annotationTimeRangeSub","timeRangeSyncEnabled","timeRangeSub","updateTitle","syncStepSizeWithSibling","useDiffTimeRange","applyPreset","setTimeRange","newTimeRange","isSame","$diffTimeRange","newAnnotationTimeRange","autoSelectDiffRange","selectWholeRange","diff","round","subtract","newTitle","toggleTimeRangeSync","refreshTimeseries","myData","siblingPanel","getSiblingPanel","siblingData","getSiblingData","performStepSynchronization","parentState","comparisonPanel","baselinePanel","myStep","extractStepDuration","siblingStep","abs","targetStep","lastSyncedStepSec","updateQueryStep","timeField","times","targetStepSec","updatedQueries","step","SceneTimeRange","timePicker","refreshPicker","SceneRefreshPicker","onClickTimeRangeSync","enable","panelHeader","h6","colorCircle","timeControls","syncButton","shade","useToggleSidePanel","openPanelId","setOpenPanelId","onOpenHandler","setOnOpenHandler","onOpen","handler","panelId","DelayRender","shouldRender","setShouldRender","PanelMenu","menu","offset","dragClassCancel","menuButtonClass","onVisibleChange","onOpenMenu","testId","selectors","components","Panels","Panel","handleVisibility","Dropdown","overlay","ToolbarButton","iconSize","narrow","HoverWidget","dragClass","draggableRef","e2eSelectors","onPointerDown","setPointerCapture","pointerId","onPointerUp","releasePointerCapture","menuOpen","setMenuOpen","React","top","square","draggable","dragIcon","draggableIcon","untitled","menuButton","visibility","opacity","position","zIndex","right","boxSizing","borderRadius","boxShadow","shadows","z1","cursor","breakpoints","down","fontStyle","padding","TitleItem","forwardRef","rest","linkItem","headerHeight","getFocusStyles","outline","outlineOffset","transitionTimingFunction","transitionDuration","transitionProperty","PanelDescription","interactive","panelDescription","dangerouslySetInnerHTML","__html","whiteSpace","wordWrap","PanelStatus","buttonStyles","GrafanaPanelBox","titleItems","hoverHeader","hoverHeaderOffset","statusMessage","statusMessageOnClick","onCancelQuery","setWidth","childrenContainerRef","offsetWidth","hasHeader","getHeaderHeight","contentStyle","getContentStyle","headerStyles","containerStyles","backgroundColor","testid","headerContent","Streaming","streaming","pointer","rightAligned","rightActions","itemsRenderer","loadingBarContainer","LoadingBar","errorContainerFloating","headerContainer","menuItem","renderer","toRender","toArray","gridSize","borderColor","action","overflow","flexGrow","marginRight","success","textOverflow","fontWeight","hiddenMenu","left","marginLeft","panelWrap","dataTestId","useGrafanaAssistant","isAvailable","useAssistant","hideAIButton","featureToggles","grafanaAssistantInProfilesDrilldown","localStorage","getItem","prompts","system","empty","single","profiles","anton","buildPrompts","systemPrompt","userPrompt","ProfileApiClient","params","searchParams","URLSearchParams","until","format","maxNodes","MAX_NODES","useFetchDotProfiles","isDiff","fetchParams","validationError","validateFetchParams","isFetching","profileApiClient","useQuery","queryKey","flatMap","queryFn","usePerformFetchDotProfiles","AnalyzeDiffFlameGraph","createAssistantContextItem","datasourceUid","stringifiedData","marginTop","OpenAssistantButton","prompt","AIButton","interactionName","isEnabled","openai","useFetchLlmPluginStatus","aiButton","onClickSearchTerm","searchInputElement","valueSetter","getOwnPropertyDescriptor","prototypeValueSetter","getPrototypeOf","call","setNativeValue","textContent","dispatchEvent","Event","bubbles","MARKDOWN_OPTIONS","component","searchLink","AiReply","reply","messages","role","Markdown","hr","textarea","sendButton","FollowUpForm","question","onChangeInput","onClickSend","setQuestion","questionToSend","useFollowUpForm","TextArea","shiftKey","SceneAiPanel","useSceneAiPanel","llmError","retry","setReply","replyHasStarted","setReplyHasStarted","replyHasFinished","setReplyHasFinished","setMessages","setError","subscription","setSubscription","sendMessages","messagesToSend","next","complete","askFollowupQuestion","messagesToAdd","hasStarted","hasFinished","useOpenAiChatCompletions","shouldDisplayReply","shouldDisplayFollowUpForm","submitFollowupQuestion","sidePanel","InlineBanner","p","retryButton","EventDiffAutoSelect","EventDiffChoosePreset","DiffProfileApiClient","leftQuery","leftFrom","leftTimeRange","leftUntil","rightQuery","rightFrom","rightTimeRange","rightUntil","useFetchDiffProfile","baselineTimeRange","baselineQuery","comparisonTimeRange","comparisonQuery","useMaxNodesFromUrl","diffProfileApiClient","refetch","placeholderData","previousData","profile","version","flamebearer","metadata","isAbortError","MissingSelectionsBanner","onClickAutoSelect","onClickChoosePreset","onOpenLearnHow","isCollapseOpen","setIsCollapseOpen","infoMsg","textButton","Collapse","collapsible","collapse","onToggle","collapseContent","ol","img","alt","SceneDiffFlameGraph","profileMetricType","aiPanel","useSceneDiffFlameGraph","useDiffTimeRanges","settings","fetchSettingsError","useFetchPluginSettings","isDiffQueryEnabled","fetchProfileError","noProfileDataAvailable","numTicks","shouldDisplayFlamegraph","hasMissingSelections","ai","wholeRange","isAiButtonDisabled","displayWarning","panelTitle","aiActionButton","flex","flamegraphPanel","FlameGraph","enableFlameGraphDotComExport","collapsedFlamegraphs","showAnalyzeWithAssistant","FEEDBACK_FORM_URL","GiveFeedbackButton","wrapper","feedback","rel","paddingTop","alignSelf","bodySmall","ScenePresetsPicker","openSelect","isSelectOpen","closeSelect","presetsContainer","PRESETS","onChangePreset","onOpenSelect","onCloseSelect","onClickSave","closeOnEscape","closeOnBackdropClick","closeModal","baseline","comparison","syncYAxis","maxima","cloneDeep","updateTimeseriesAxis","SceneExploreDiffFlameGraph","locationService","presetsPicker","targetPanel","syncTimeRanges","columns","VcsClient","githubLogin","authorizationCode","githubApp","GitSessionCookie","isUserTokenExpired","biasMs","Date","now","expiry","getTime","decode","decoded","atob","isLegacy","tryDecode","oauthTokenMetadata","GITHUB_SESSION_COOKIE_NAME","InternalGitSessionCookieManager","getCookie","syncCookieWithBrowser","sessionCookie","setCookie","cookie","rawCookie","getCookieFromJar","deleteLegacyCookie","deleteCookie","jar","ck","gitSessionCookieManager","POPUP_WIDTH","POPUP_HEIGHT","openLoginPopup","clientId","nonce","callbackUrl","oauthURL","clientID","str","endsWith","redirectUri","GITHUB_CALLBACK","URL","btoa","redirect_uri","buildGitHubAuthURL","outerWidth","screenX","outerHeight","screenY","vcsClient","privateVcsClient","externalWindow","setExternalWindow","callbackURL","authFromUrl","urlSearchParams","stateValue","usePollGitHubPopup","setSessionCookie","checkPopup","closed","tryGetWindowSearchParams","DEFAULT_GITHUB_CONTEXT","isLoginInProgress","isLoggedIn","isSessionExpired","login","logout","GitHubContext","createContext","PLACEHOLDER_COMMIT_DATA","sha","date","author","avatarURL","PrivateVcsClient","repositoryUrl","gitRef","localPath","rootPath","postWithRefresh","repositoryURL","commits","getCommit","catch","refreshSession","path","isRefreshing","queueRequest","sessionManager","BIAS_MS","flushQueue","post","resolve","reject","pendingQueue","err","callback","fromCharCode","crypto","getRandomValues","Uint8Array","LOCAL_STORAGE_GITHUB_INTEGRATION_DATASOURCE_UID","GitHubContextProvider","setIsLoginInProgress","nextValue","useGithubSessionCookie","setItem","newIsLoginInProgress","Provider","FunctionVersionOrigin","FunctionVersionContext","FunctionVersionProvider","setOverrides","useLocalStorage","saveOverride","deleteOverride","deleteAllOverrides","getFunctionVersion","defaultVersion","overriddenVersion","functionVersionOrigin","functionVersion","useFunctionVersion","useContext","useFunctionVersionContext","RemoveSpanSelector","ResolutionBoostExtensionPoint","scene","ResolutionBoostExtension","usePluginComponent","buildFlameGraphQueryRunner","spanSelector","PprofRequest","Message","profile_typeID","label_selector","max_nodes","PprofApiClient","buildPprofRequest","labelsSelector","encode","finish","selectMergeProfile","headers","Blob","blob","selectMergeProfileJson","stackTrace","stackTraceSelector","call_site","getExportFilename","dateString","FlamegraphDotComApiClient","upload","fileTypeData","units","spyName","flamegraphDotComApiClient","SceneExportMenu","fetchFlamebearerProfile","DEFAULT_SETTINGS","fetchPprofProfile","pprofApiClient","Response","stream","pipeThrough","CompressionStream","useSceneExportMenu","downloadJson","filename","encodeURIComponent","saveAs","downloadPprof","uploadToFlamegraphDotCom","dlLink","createElement","appendChild","click","removeChild","shouldDisplayFlamegraphDotCom","downloadPng","toBlob","useGitHubContext","useGitHubIntegration","isFunctionDetailsEnabled","enableFunctionDetails","stacktrace","setStacktrace","getExtraFlameGraphMenuItems","level","levelItem","dp","getDisplayProcessor","createTheme","node","idx","itemIndexes","parents","buildStackTrace","Menu","Item","buildSuggestionPrompts","functionDetails","lines","line","cum","codeInfoToAnnotatedCode","useAiSuggestionsPanel","suggestionPromptInputs","useOpenAiSuggestions","AiSuggestionsPanel","VERTICAL_LINES_PADDING","buildGithubUrlForFunction","startLine","newUrl","org","repo","useCodeContainer","openAiSuggestions","setOpenAiSuggestions","fileInfo","repository","getFile","useFetchVCSFile","fileName","git_ref","root_path","snippetLines","allLines","fileContent","callSitesMap","callSites","annotatedLines","lineNumber","callSite","number","flat","firstLineIndex","lastLineIndex","annotateLines","annotatedSnippet","annotatePlaceholderLines","isLoadingCode","githubUrl","annotatedLine","annotateLine","noCodeAvailable","buildUnitFormatter","Code","onOptimizeCodeClick","fmt","formatValue","n","formatted","trimIndentPrefix","sumSelf","sumTotal","accSelf","accTotal","header","breakdownLabel","buttons","LinkButton","pre","codeBlock","highlighted","codeBlockHeader","formatLine","self","cols","padStart","commonPrefix","getIndentPrefix","longestCommonPrefix","prefixLen","CodeContainer","getElementById","scrollIntoView","behavior","ellipsis","GitHubRepository","enableIntegration","commitUrl","commitName","getCommitsWithSamples","functionsDetails","totalSamples","details","commit","samples","GITHUB_URL","getRepositoryDetails","isGitHub","buildDetails","func","mapping","stringTable","buildId","sampleType","convertSample","fnName","locations","functions","mappings","sample","versions","locationIdSet","locationId","functionId","mappingId","addCallSiteValue","fetchCommitsInfo","defaultFunctionVersion","getCommits","getTotalSum","fd","sortByTotal","DEFAULT_FUNCTION_VERSION","useFetchFunctionsDetails","isGitHubLogged","queryError","pprof","l","function","m","convertPprofToFunctionDetails","CUTOFFS","Infinity","UNITS","RTF","RelativeTimeFormat","numeric","DTF","DateTimeFormat","year","month","day","formatCommitDate","commitDate","timeMs","deltaSeconds","unitIndex","findIndex","cutoff","divisor","getRelativeTimeString","firstLine","secondLine","avatar","CommitOption","commitAuthor","commitAuthorAvatarUrl","samplePercent","getCommitShortSha","getCommitShortMessage","CommitOptionSelected","CommitSelect","selectedCommit","isSearchable","formatOptionLabel","formatOption","formatOptionMeta","selectValue","GitHubIntegrationBanner","buttonContent","TextLink","external","InlineSpinnerComponent","InlineSpinner","OverrideRepositoryDetailsButton","saveOverrides","setOpen","USER","DataSourcePicker","ConfirmButton","confirmVariant","confirmText","onConfirm","SceneFunctionDetailsPanel","useSceneFunctionDetailsPanel","dataSourceName","fetchFunctionDetailsError","prevFunctionsDetails","setPrevFunctionsDetails","currentFunctionDetails","setCurrentFunctionDetails","isGitHubBannerDismissed","setIsGitHubBannerDismissed","GITHUB_INTEGRATION","isGitHubRepo","isGitHubSupported","hasNameOrFileName","hasLineNumber","calculateIsGitHubSupported","shouldDisplayGitHubBanner","deleteFunctionOverride","deleteFunctionAllOverrides","saveFunctionDetails","selectCommit","copyFilePathToClipboard","navigator","clipboard","writeText","dismissGitHubBanner","LABEL_WIDTH","row","InlineLabel","textValue","datasourceName","SpanSelectorLabel","removeSpanSelector","SceneFlameGraph","dataSubscription","stateSubscription","newDataState","lastTimeRange","exportMenu","functionDetailsPanel","createRecordingRuleModal","useSceneFlameGraph","$dataState","isLight","getTheme","isFetchingSettingsError","isFetchingProfileData","profileData","hasProfileData","export","gitHub","modal","gitHubIntegration","recordingRulesModalState","setRecordingRulesModalState","recordingRulesMenu","setModalOpen","disableCollapsing","getExtraContextMenuButtons","clickedItemData","enableMetricsFromProfiles","metricsFromProfiles","extraHeaderElements","keepFocusOnDataChange","SceneExploreServiceFlameGraph","mainTimeseries","SceneReactObject","onClickShareLink","shareableUrl","builsShareableUrl","ExplorationTypeSelector","activeIndex","explorationTypeContainer","breadcrumb","currentIndex","extraClasses","Fragment","button","arrow","Header","chromeHeaderHeight","useChromeHeaderHeight","isEmbedded","onChangeExplorationType","timePickerControl","refreshPickerControl","DIFF_FLAME_GRAPH","dataSourceVariable","bodySceneObject","sceneVariables","navigate","useNavigate","onClickRecordingRules","RECORDING_RULES","referrer","onClickAdHoc","ADHOC","onClickUserSettings","SETTINGS","useHeader","InsightsLauncher","metricsFromProfilesMenu","onCreateRecordingRule","appControls","appControlsLeft","EXPLORATION_TYPE_OPTIONS","appControlsRight","ErrorBoundary","getValueText","appMiscButtons","PluginInfo","sceneVariable","sceneVariableLabel","gridControl","varSub","subscribeToVariableChanges","eventsSub","setExplorationType","DEFAULT_EXPLORATION_TYPE","comesFromUserAction","registerRuntimeDataSources","sceneUtils","registerRuntimeDataSource","resetSpanSelector","serviceNameSub","profileTypeSub","profilesSub","labelsSub","flameGraphSub","diffFlameGraphSub","bodySceneOptions","removeSpanSelectorSub","resetVariables","buildBodyScene","nextExplorationType","SplitLayout","useProfilesExplorer","filtered","DATETIME_FORMATTER","hour12","hour","minute","second","formatToParts","dateForExportFilename","fromKey","toKey","search","appName","timeRanges","useExportMenu","customExportName","dataStr","ExportMenu","ExportDataComponent","ExportData","getNodes","nodes","itemOffset","val","selfRight","valRight","valTotal","offsetRight","offsetTotal","FlameGraphComponent","vertical","dataFrame","levels","nodeLevels","currentNodeStart","prevLevel","prevLevelOffset","prevLevelNode","parentNodeStart","parentNodeEnd","stack","levelValues","selfValues","valueValues","selfRightValues","valueRightValues","valueUnit","frame","preferredVisualisationType","createDataFrame","flamebearerToDataFrameDTO","GrafanaFlameGraph","msgs","msg","handheldBy","getAppEvents","publish","AppEvents","alertError","alertWarning","alertSuccess","PROFILES_EXPLORER_PAGE_NAME","EXPLORE","getCurrentPage","pop","getMetaProperties","appRelease","apps","appVersion","GIT_COMMIT","page","view","grafanaReportInteraction","pushNewUrl","useLocation","newParams","newSearchParams","useUrlSearchParams","setMaxNodes","newMaxNodes","hasMaxNodes","useSetDefaultMaxNodes","getPyroscopeDataSources","datasources","ds","pyroscopeDataSources","uidFromUrl","uidFromLocalStorage","defaultDataSource","jsonData","overridesDefault","isDefault","getBaseUrl","pyroscopeDataSource","HttpClientError","responseJson","statusText","abortController","AbortController","signal","fullUrl","defaultHeaders","fullOptions","ok","PROFILE_METRICS","queryClient","QueryClient","defaultOptions","networkMode","refetchOnWindowFocus","file_types_v1_types","fileDesc","file_settings_v1_recording_rules","StacktraceFilterSchema","messageDesc","StacktraceFilterFunctionNameSchema","MetricType","RecordingRulesApiClient","rules","stacktraceFilter","provisioned","mapRuleToRecordingRuleViewModel","create","basicMatchers","requestBody","metricType","TOTAL","remove","recordingRulesApiClient","useQueryClient","mutateAsync","useMutation","mutationFn","invalidateQueries","SettingsApiClient","setting","PLUGIN_SETTING_NAME","newSettings","useSettingsApiClient","settingsApiClient","FARO_ENVIRONMENTS","environment","faroUrl","faro","getFaro","setFaro","instance","initFaro","faroEnvironment","getEnvironment","getFaroEnvironment","buildInfo","userEmail","email","grafanaVersion","initializeFaro","app","release","namespace","instrumentations","getWebInstrumentations","captureConsole","isolate","beforeSend","MATCHERS","regExp","host","methodName","console","trace","api","pushLog","LogLevel","TRACE","debug","DEBUG","INFO","LOG","WARN","pushError","itemName","errorContext","br","pluginCommitSha","pluginCommitURL","grafanaBuildInfo","InfoMenuHeader","updated","usePluginContext","menuHeader","h5","InfoMenu","isDev","shortCommitSha","env","PyroscopeLogoComponent","logo"],"sourceRoot":""}